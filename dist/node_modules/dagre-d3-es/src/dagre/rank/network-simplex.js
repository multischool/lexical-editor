import"../../graphlib/alg/topsort.js";import{postorder as e}from"../../graphlib/alg/postorder.js";import{preorder as n}from"../../graphlib/alg/preorder.js";import"../../graphlib/graph.js";import{simplify as r}from"../util.js";import{feasibleTree as o}from"./feasible-tree.js";import{longestPath as t,slack as i}from"./util.js";import a from"../../../../lodash-es/forEach.js";import d from"../../../../lodash-es/has.js";import s from"../../../../lodash-es/find.js";import u from"../../../../lodash-es/filter.js";import l from"../../../../lodash-es/minBy.js";function f(e){e=r(e),t(e);var n,i=o(e);for(c(i),m(i,e);n=v(i);)j(i,e,n,h(i,e,n))}function m(n,r){var o=e(n,n.nodes());o=o.slice(0,o.length-1),a(o,(function(e){!function(e,n,r){var o=e.node(r),t=o.parent;e.edge(r,t).cutvalue=g(e,n,r)}(n,r,e)}))}function g(e,n,r){var o=e.node(r).parent,t=!0,i=n.edge(r,o),d=0;return i||(t=!1,i=n.edge(o,r)),d=i.weight,a(n.nodeEdges(r),(function(i){var a,s,u=i.v===r,l=u?i.w:i.v;if(l!==o){var f=u===t,m=n.edge(i).weight;if(d+=f?m:-m,a=r,s=l,e.hasEdge(a,s)){var g=e.edge(r,l).cutvalue;d+=f?-g:g}}})),d}function c(e,n){arguments.length<2&&(n=e.nodes()[0]),p(e,{},1,n)}function p(e,n,r,o,t){var i=r,s=e.node(o);return n[o]=!0,a(e.neighbors(o),(function(t){d(n,t)||(r=p(e,n,r,t,o))})),s.low=i,s.lim=r++,t?s.parent=t:delete s.parent,r}function v(e){return s(e.edges(),(function(n){return e.edge(n).cutvalue<0}))}function h(e,n,r){var o=r.v,t=r.w;n.hasEdge(o,t)||(o=r.w,t=r.v);var a=e.node(o),d=e.node(t),s=a,f=!1;a.lim>d.lim&&(s=d,f=!0);var m=u(n.edges(),(function(n){return f===w(e,e.node(n.v),s)&&f!==w(e,e.node(n.w),s)}));return l(m,(function(e){return i(n,e)}))}function j(e,r,o,t){var i=o.v,d=o.w;e.removeEdge(i,d),e.setEdge(t.v,t.w,{}),c(e),m(e,r),function(e,r){var o=s(e.nodes(),(function(e){return!r.node(e).parent})),t=n(e,o);t=t.slice(1),a(t,(function(n){var o=e.node(n).parent,t=r.edge(n,o),i=!1;t||(t=r.edge(o,n),i=!0),r.node(n).rank=r.node(o).rank+(i?t.minlen:-t.minlen)}))}(e,r)}function w(e,n,r){return r.low<=n.lim&&n.lim<=r.lim}f.initLowLimValues=c,f.initCutValues=m,f.calcCutValue=g,f.leaveEdge=v,f.enterEdge=h,f.exchangeEdges=j;export{f as networkSimplex};
//# sourceMappingURL=network-simplex.js.map
