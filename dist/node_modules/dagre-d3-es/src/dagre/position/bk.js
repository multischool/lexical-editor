import{Graph as r}from"../../graphlib/graph.js";import{buildLayerMatrix as n}from"../util.js";import o from"../../../../lodash-es/forIn.js";import e from"../../../../lodash-es/merge.js";import t from"../../../../lodash-es/forEach.js";import s from"../../../../lodash-es/values.js";import i from"../../../../lodash-es/map.js";import u from"../../../../lodash-es/mapValues.js";import a from"../../../../lodash-es/reduce.js";import f from"../../../../lodash-es/sortBy.js";import d from"../../../../lodash-es/minBy.js";import c from"../../../../lodash-es/min.js";import m from"../../../../lodash-es/max.js";import h from"../../../../lodash-es/has.js";import l from"../../../../lodash-es/last.js";import p from"../../../../lodash-es/find.js";import v from"../../../../lodash-es/range.js";function g(r,n){var o={};return a(n,(function(n,e){var s=0,i=0,u=n.length,a=l(e);return t(e,(function(n,f){var d=function(r,n){if(r.node(n).dummy)return p(r.predecessors(n),(function(n){return r.node(n).dummy}))}(r,n),c=d?r.node(d).order:u;(d||n===a)&&(t(e.slice(i,f+1),(function(n){t(r.predecessors(n),(function(e){var t=r.node(e),i=t.order;!(i<s||c<i)||t.dummy&&r.node(n).dummy||b(o,e,n)}))})),i=f+1,s=c)})),e})),o}function I(r,n){var o={};function e(n,e,s,i,u){var a;t(v(e,s),(function(e){a=n[e],r.node(a).dummy&&t(r.predecessors(a),(function(n){var e=r.node(n);e.dummy&&(e.order<i||e.order>u)&&b(o,n,a)}))}))}return a(n,(function(n,o){var s,i=-1,u=0;return t(o,(function(t,a){if("border"===r.node(t).dummy){var f=r.predecessors(t);f.length&&(s=r.node(f[0]).order,e(o,u,a,i,s),u=a,i=s)}e(o,u,o.length,s,n.length)})),o})),o}function b(r,n,o){if(n>o){var e=n;n=o,o=e}var t=r[n];t||(r[n]=t={}),t[o]=!0}function j(r,n,o){if(n>o){var e=n;n=o,o=e}return h(r[n],o)}function w(r,n,o,e){var s={},i={},u={};return t(n,(function(r){t(r,(function(r,n){s[r]=r,i[r]=r,u[r]=n}))})),t(n,(function(r){var n=-1;t(r,(function(r){var t=e(r);if(t.length){t=f(t,(function(r){return u[r]}));for(var a=(t.length-1)/2,d=Math.floor(a),c=Math.ceil(a);d<=c;++d){var m=t[d];i[r]===r&&n<u[m]&&!j(o,r,m)&&(i[m]=r,i[r]=s[r]=s[m],n=u[m])}}}))})),{root:s,align:i}}function N(n,o,e,s,i){var u={},a=function(n,o,e,s){var i=new r,u=n.graph(),a=function(r,n,o){return function(e,t,s){var i,u=e.node(t),a=e.node(s),f=0;if(f+=u.width/2,h(u,"labelpos"))switch(u.labelpos.toLowerCase()){case"l":i=-u.width/2;break;case"r":i=u.width/2}if(i&&(f+=o?i:-i),i=0,f+=(u.dummy?n:r)/2,f+=(a.dummy?n:r)/2,f+=a.width/2,h(a,"labelpos"))switch(a.labelpos.toLowerCase()){case"l":i=a.width/2;break;case"r":i=-a.width/2}return i&&(f+=o?i:-i),i=0,f}}(u.nodesep,u.edgesep,s);return t(o,(function(r){var o;t(r,(function(r){var t=e[r];if(i.setNode(t),o){var s=e[o],u=i.edge(s,t);i.setEdge(s,t,Math.max(a(n,r,o),u||0))}o=r}))})),i}(n,o,e,i),f=i?"borderLeft":"borderRight";function d(r,n){for(var o=a.nodes(),e=o.pop(),t={};e;)t[e]?r(e):(t[e]=!0,o.push(e),o=o.concat(n(e))),e=o.pop()}return d((function(r){u[r]=a.inEdges(r).reduce((function(r,n){return Math.max(r,u[n.v]+a.edge(n))}),0)}),a.predecessors.bind(a)),d((function(r){var o=a.outEdges(r).reduce((function(r,n){return Math.min(r,u[n.w]-a.edge(n))}),Number.POSITIVE_INFINITY),e=n.node(r);o!==Number.POSITIVE_INFINITY&&e.borderType!==f&&(u[r]=Math.max(u[r],o))}),a.successors.bind(a)),t(s,(function(r){u[r]=u[e[r]]})),u}function y(r,n){return d(s(n),(function(n){var e=Number.NEGATIVE_INFINITY,t=Number.POSITIVE_INFINITY;return o(n,(function(n,o){var s=function(r,n){return r.node(n).width}(r,o)/2;e=Math.max(n+s,e),t=Math.min(n-s,t)})),e-t}))}function E(r,n){var o=s(n),e=c(o),i=m(o);t(["u","d"],(function(o){t(["l","r"],(function(t){var a,f=o+t,d=r[f];if(d!==n){var h=s(d);(a="l"===t?e-c(h):i-m(h))&&(r[f]=u(d,(function(r){return r+a})))}}))}))}function T(r,n){return u(r.ul,(function(o,e){if(n)return r[n.toLowerCase()][e];var t=f(i(r,e));return(t[1]+t[2])/2}))}function M(r){var o,a=n(r),f=e(g(r,a),I(r,a)),d={};t(["u","d"],(function(n){o="u"===n?a:s(a).reverse(),t(["l","r"],(function(e){"r"===e&&(o=i(o,(function(r){return s(r).reverse()})));var t=("u"===n?r.predecessors:r.successors).bind(r),a=w(0,o,f,t),c=N(r,o,a.root,a.align,"r"===e);"r"===e&&(c=u(c,(function(r){return-r}))),d[n+e]=c}))}));var c=y(r,d);return E(d,c),T(d,r.graph().align)}export{b as addConflict,E as alignCoordinates,T as balance,y as findSmallestWidthAlignment,g as findType1Conflicts,I as findType2Conflicts,j as hasConflict,N as horizontalCompaction,M as positionX,w as verticalAlignment};
//# sourceMappingURL=bk.js.map
