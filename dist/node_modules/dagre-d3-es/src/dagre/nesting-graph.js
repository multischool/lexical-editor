import{addDummyNode as e,addBorderNode as n}from"./util.js";import o from"../../../lodash-es/max.js";import t from"../../../lodash-es/values.js";import r from"../../../lodash-es/forEach.js";import i from"../../../lodash-es/reduce.js";function d(n){var d=e(n,"root",{},"_root"),s=function(e){var n={};function o(t,i){var d=e.children(t);d&&d.length&&r(d,(function(e){o(e,i+1)})),n[t]=i}return r(e.children(),(function(e){o(e,1)})),n}(n),a=o(t(s))-1,m=2*a+1;n.graph().nestingRoot=d,r(n.edges(),(function(e){n.edge(e).minlen*=m}));var c=function(e){return i(e.edges(),(function(n,o){return n+e.edge(o).weight}),0)}(n)+1;r(n.children(),(function(e){g(n,d,m,c,a,s,e)})),n.graph().nodeRankFactor=m}function g(e,o,t,i,d,s,a){var m=e.children(a);if(m.length){var c=n(e,"_bt"),f=n(e,"_bb"),h=e.node(a);e.setParent(c,a),h.borderTop=c,e.setParent(f,a),h.borderBottom=f,r(m,(function(n){g(e,o,t,i,d,s,n);var r=e.node(n),m=r.borderTop?r.borderTop:n,h=r.borderBottom?r.borderBottom:n,l=r.borderTop?i:2*i,u=m!==h?1:d-s[a]+1;e.setEdge(c,m,{weight:l,minlen:u,nestingEdge:!0}),e.setEdge(h,f,{weight:l,minlen:u,nestingEdge:!0})})),e.parent(a)||e.setEdge(o,c,{weight:0,minlen:d+s[a]})}else a!==o&&e.setEdge(o,a,{weight:0,minlen:t})}function s(e){var n=e.graph();e.removeNode(n.nestingRoot),delete n.nestingRoot,r(e.edges(),(function(n){e.edge(n).nestingEdge&&e.removeEdge(n)}))}export{s as cleanup,d as run};
//# sourceMappingURL=nesting-graph.js.map
