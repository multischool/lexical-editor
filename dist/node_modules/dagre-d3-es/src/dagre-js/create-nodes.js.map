{"version":3,"file":"create-nodes.js","sources":["../../../../../node_modules/dagre-d3-es/src/dagre-js/create-nodes.js"],"sourcesContent":["import * as d3 from 'd3';\nimport * as _ from 'lodash-es';\nimport { addLabel } from './label/add-label.js';\nimport * as util from './util.js';\n\nexport { createNodes, setCreateNodes };\n\nvar createNodes = function (selection, g, shapes) {\n  var simpleNodes = g.nodes().filter(function (v) {\n    return !util.isSubgraph(g, v);\n  });\n  var svgNodes = selection\n    .selectAll('g.node')\n    .data(simpleNodes, function (v) {\n      return v;\n    })\n    .classed('update', true);\n\n  svgNodes.exit().remove();\n\n  svgNodes.enter().append('g').attr('class', 'node').style('opacity', 0);\n\n  svgNodes = selection.selectAll('g.node');\n\n  svgNodes.each(function (v) {\n    var node = g.node(v);\n    var thisGroup = d3.select(this);\n    util.applyClass(\n      thisGroup,\n      node['class'],\n      (thisGroup.classed('update') ? 'update ' : '') + 'node'\n    );\n\n    thisGroup.select('g.label').remove();\n    var labelGroup = thisGroup.append('g').attr('class', 'label');\n    var labelDom = addLabel(labelGroup, node);\n    var shape = shapes[node.shape];\n    var bbox = _.pick(labelDom.node().getBBox(), 'width', 'height');\n\n    node.elem = this;\n\n    if (node.id) {\n      thisGroup.attr('id', node.id);\n    }\n    if (node.labelId) {\n      labelGroup.attr('id', node.labelId);\n    }\n\n    if (_.has(node, 'width')) {\n      bbox.width = node.width;\n    }\n    if (_.has(node, 'height')) {\n      bbox.height = node.height;\n    }\n\n    bbox.width += node.paddingLeft + node.paddingRight;\n    bbox.height += node.paddingTop + node.paddingBottom;\n    labelGroup.attr(\n      'transform',\n      'translate(' +\n        (node.paddingLeft - node.paddingRight) / 2 +\n        ',' +\n        (node.paddingTop - node.paddingBottom) / 2 +\n        ')'\n    );\n\n    var root = d3.select(this);\n    root.select('.label-container').remove();\n    var shapeSvg = shape(root, bbox, node).classed('label-container', true);\n    util.applyStyle(shapeSvg, node.style);\n\n    var shapeBBox = shapeSvg.node().getBBox();\n    node.width = shapeBBox.width;\n    node.height = shapeBBox.height;\n  });\n\n  var exitSelection;\n\n  if (svgNodes.exit) {\n    exitSelection = svgNodes.exit();\n  } else {\n    exitSelection = svgNodes.selectAll(null); // empty selection\n  }\n\n  util.applyTransition(exitSelection, g).style('opacity', 0).remove();\n\n  return svgNodes;\n};\n\nfunction setCreateNodes(value) {\n  createNodes = value;\n}\n"],"names":["createNodes","selection","g","shapes","exitSelection","simpleNodes","nodes","filter","v","util.isSubgraph","svgNodes","selectAll","data","classed","exit","remove","enter","append","attr","style","each","node","thisGroup","d3.select","this","util.applyClass","select","labelGroup","labelDom","addLabel","shape","bbox","_.pick","getBBox","elem","id","labelId","_.has","width","height","paddingLeft","paddingRight","paddingTop","paddingBottom","root","shapeSvg","util.applyStyle","shapeBBox","util.applyTransition","setCreateNodes","value"],"mappings":"kXAOG,IAACA,EAAc,SAAUC,EAAWC,EAAGC,GACxC,IAoEIC,EApEAC,EAAcH,EAAEI,QAAQC,QAAO,SAAUC,GAC3C,OAAQC,EAAgBP,EAAGM,EAC/B,IACME,EAAWT,EACZU,UAAU,UACVC,KAAKP,GAAa,SAAUG,GAC3B,OAAOA,CACb,IACKK,QAAQ,UAAU,GAsErB,OApEAH,EAASI,OAAOC,SAEhBL,EAASM,QAAQC,OAAO,KAAKC,KAAK,QAAS,QAAQC,MAAM,UAAW,IAEpET,EAAWT,EAAUU,UAAU,WAEtBS,MAAK,SAAUZ,GACtB,IAAIa,EAAOnB,EAAEmB,KAAKb,GACdc,EAAYC,EAAUC,MAC1BC,EACEH,EACAD,EAAY,OACXC,EAAUT,QAAQ,UAAY,UAAY,IAAM,QAGnDS,EAAUI,OAAO,WAAWX,SAC5B,IAAIY,EAAaL,EAAUL,OAAO,KAAKC,KAAK,QAAS,SACjDU,EAAWC,EAASF,EAAYN,GAChCS,EAAQ3B,EAAOkB,EAAKS,OACpBC,EAAOC,EAAOJ,EAASP,OAAOY,UAAW,QAAS,UAEtDZ,EAAKa,KAAOV,KAERH,EAAKc,IACPb,EAAUJ,KAAK,KAAMG,EAAKc,IAExBd,EAAKe,SACPT,EAAWT,KAAK,KAAMG,EAAKe,SAGzBC,EAAMhB,EAAM,WACdU,EAAKO,MAAQjB,EAAKiB,OAEhBD,EAAMhB,EAAM,YACdU,EAAKQ,OAASlB,EAAKkB,QAGrBR,EAAKO,OAASjB,EAAKmB,YAAcnB,EAAKoB,aACtCV,EAAKQ,QAAUlB,EAAKqB,WAAarB,EAAKsB,cACtChB,EAAWT,KACT,YACA,cACGG,EAAKmB,YAAcnB,EAAKoB,cAAgB,EACzC,KACCpB,EAAKqB,WAAarB,EAAKsB,eAAiB,EACzC,KAGJ,IAAIC,EAAOrB,EAAUC,MACrBoB,EAAKlB,OAAO,oBAAoBX,SAChC,IAAI8B,EAAWf,EAAMc,EAAMb,EAAMV,GAAMR,QAAQ,mBAAmB,GAClEiC,EAAgBD,EAAUxB,EAAKF,OAE/B,IAAI4B,EAAYF,EAASxB,OAAOY,UAChCZ,EAAKiB,MAAQS,EAAUT,MACvBjB,EAAKkB,OAASQ,EAAUR,MAC5B,IAKInC,EADEM,EAASI,KACKJ,EAASI,OAETJ,EAASC,UAAU,MAGrCqC,EAAqB5C,EAAeF,GAAGiB,MAAM,UAAW,GAAGJ,SAEpDL,CACT,EAEA,SAASuC,EAAeC,GACtBlD,EAAckD,CAChB"}