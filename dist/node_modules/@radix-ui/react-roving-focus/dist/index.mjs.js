import*as e from"react";import{composeEventHandlers as r}from"../../primitive/dist/index.mjs.js";import{createCollection as t}from"@radix-ui/react-collection";import{useComposedRefs as o}from"../../react-compose-refs/dist/index.mjs.js";import{createContextScope as n}from"../../react-context/dist/index.mjs.js";import{useId as s}from"../../react-id/dist/index.mjs.js";import{Primitive as i}from"../../react-primitive/dist/index.mjs.js";import{useCallbackRef as c}from"../../react-use-callback-ref/dist/index.mjs.js";import{useControllableState as a}from"../../react-use-controllable-state/dist/index.mjs.js";import{useDirection as u}from"../../react-direction/dist/index.mjs.js";import"../../../react/jsx-runtime.js";import{j as l}from"../../../../_virtual/jsx-runtime.js";var f="rovingFocusGroup.onEntryFocus",p={bubbles:!1,cancelable:!0},d="RovingFocusGroup",[m,v,x]=t(d),[b,j]=n(d,[x]),[w,g]=b(d),F=e.forwardRef(((e,r)=>l.exports.jsx(m.Provider,{scope:e.__scopeRovingFocusGroup,children:l.exports.jsx(m.Slot,{scope:e.__scopeRovingFocusGroup,children:l.exports.jsx(I,{...e,ref:r})})})));F.displayName=d;var I=e.forwardRef(((t,n)=>{const{__scopeRovingFocusGroup:s,orientation:d,loop:m=!1,dir:x,currentTabStopId:b,defaultCurrentTabStopId:j,onCurrentTabStopIdChange:g,onEntryFocus:F,preventScrollOnEntryFocus:I=!1,...h}=t,R=e.useRef(null),y=o(n,R),S=u(x),[T=null,E]=a({prop:b,defaultProp:j,onChange:g}),[D,C]=e.useState(!1),_=c(F),k=v(s),G=e.useRef(!1),[K,L]=e.useState(0);return e.useEffect((()=>{const e=R.current;if(e)return e.addEventListener(f,_),()=>e.removeEventListener(f,_)}),[_]),l.exports.jsx(w,{scope:s,orientation:d,dir:S,loop:m,currentTabStopId:T,onItemFocus:e.useCallback((e=>E(e)),[E]),onItemShiftTab:e.useCallback((()=>C(!0)),[]),onFocusableItemAdd:e.useCallback((()=>L((e=>e+1))),[]),onFocusableItemRemove:e.useCallback((()=>L((e=>e-1))),[]),children:l.exports.jsx(i.div,{tabIndex:D||0===K?-1:0,"data-orientation":d,...h,ref:y,style:{outline:"none",...t.style},onMouseDown:r(t.onMouseDown,(()=>{G.current=!0})),onFocus:r(t.onFocus,(e=>{const r=!G.current;if(e.target===e.currentTarget&&r&&!D){const r=new CustomEvent(f,p);if(e.currentTarget.dispatchEvent(r),!r.defaultPrevented){const e=k().filter((e=>e.focusable));A([e.find((e=>e.active)),e.find((e=>e.id===T)),...e].filter(Boolean).map((e=>e.ref.current)),I)}}G.current=!1})),onBlur:r(t.onBlur,(()=>C(!1)))})})})),h="RovingFocusGroupItem",R=e.forwardRef(((t,o)=>{const{__scopeRovingFocusGroup:n,focusable:c=!0,active:a=!1,tabStopId:u,...f}=t,p=s(),d=u||p,x=g(h,n),b=x.currentTabStopId===d,j=v(n),{onFocusableItemAdd:w,onFocusableItemRemove:F}=x;return e.useEffect((()=>{if(c)return w(),()=>F()}),[c,w,F]),l.exports.jsx(m.ItemSlot,{scope:n,id:d,focusable:c,active:a,children:l.exports.jsx(i.span,{tabIndex:b?0:-1,"data-orientation":x.orientation,...f,ref:o,onMouseDown:r(t.onMouseDown,(e=>{c?x.onItemFocus(d):e.preventDefault()})),onFocus:r(t.onFocus,(()=>x.onItemFocus(d))),onKeyDown:r(t.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void x.onItemShiftTab();if(e.target!==e.currentTarget)return;const r=function(e,r,t){const o=function(e,r){return"rtl"!==r?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,t);return"vertical"===r&&["ArrowLeft","ArrowRight"].includes(o)||"horizontal"===r&&["ArrowUp","ArrowDown"].includes(o)?void 0:y[o]}(e,x.orientation,x.dir);if(void 0!==r){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let n=j().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===r)n.reverse();else if("prev"===r||"next"===r){"prev"===r&&n.reverse();const s=n.indexOf(e.currentTarget);n=x.loop?(o=s+1,(t=n).map(((e,r)=>t[(o+r)%t.length]))):n.slice(s+1)}setTimeout((()=>A(n)))}var t,o}))})})}));R.displayName=h;var y={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function A(e,r=!1){const t=document.activeElement;for(const o of e){if(o===t)return;if(o.focus({preventScroll:r}),document.activeElement!==t)return}}var S=F,T=R;export{T as Item,S as Root,F as RovingFocusGroup,R as RovingFocusGroupItem,j as createRovingFocusGroupScope};
//# sourceMappingURL=index.mjs.js.map
