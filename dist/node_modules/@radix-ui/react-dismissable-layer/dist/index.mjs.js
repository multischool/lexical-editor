import*as e from"react";import{composeEventHandlers as t}from"../../primitive/dist/index.mjs.js";import{Primitive as n,dispatchDiscreteCustomEvent as r}from"../../react-primitive/dist/index.mjs.js";import{useComposedRefs as s}from"../../react-compose-refs/dist/index.mjs.js";import{useCallbackRef as i}from"../../react-use-callback-ref/dist/index.mjs.js";import{useEscapeKeydown as o}from"../../react-use-escape-keydown/dist/index.mjs.js";import"../../../react/jsx-runtime.js";import{j as a}from"../../../../_virtual/jsx-runtime.js";var u,c="dismissableLayer.update",d="dismissableLayer.pointerDownOutside",l="dismissableLayer.focusOutside",m=e.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),f=e.forwardRef(((r,f)=>{const{disableOutsidePointerEvents:v=!1,onEscapeKeyDown:y,onPointerDownOutside:b,onFocusOutside:w,onInteractOutside:h,onDismiss:D,...j}=r,x=e.useContext(m),[C,L]=e.useState(null),P=C?.ownerDocument??globalThis?.document,[,O]=e.useState({}),g=s(f,(e=>L(e))),W=Array.from(x.layers),[k]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),R=W.indexOf(k),T=C?W.indexOf(C):-1,B=x.layersWithOutsidePointerEventsDisabled.size>0,F=T>=R,S=function(t,n=globalThis?.document){const r=i(t),s=e.useRef(!1),o=e.useRef((()=>{}));return e.useEffect((()=>{const e=e=>{if(e.target&&!s.current){let t=function(){E(d,r,s,{discrete:!0})};const s={originalEvent:e};"touch"===e.pointerType?(n.removeEventListener("click",o.current),o.current=t,n.addEventListener("click",o.current,{once:!0})):t()}else n.removeEventListener("click",o.current);s.current=!1},t=window.setTimeout((()=>{n.addEventListener("pointerdown",e)}),0);return()=>{window.clearTimeout(t),n.removeEventListener("pointerdown",e),n.removeEventListener("click",o.current)}}),[n,r]),{onPointerDownCapture:()=>s.current=!0}}((e=>{const t=e.target,n=[...x.branches].some((e=>e.contains(t)));F&&!n&&(b?.(e),h?.(e),e.defaultPrevented||D?.())}),P),z=function(t,n=globalThis?.document){const r=i(t),s=e.useRef(!1);return e.useEffect((()=>{const e=e=>{if(e.target&&!s.current){E(l,r,{originalEvent:e},{discrete:!1})}};return n.addEventListener("focusin",e),()=>n.removeEventListener("focusin",e)}),[n,r]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}((e=>{const t=e.target;[...x.branches].some((e=>e.contains(t)))||(w?.(e),h?.(e),e.defaultPrevented||D?.())}),P);return o((e=>{T===x.layers.size-1&&(y?.(e),!e.defaultPrevented&&D&&(e.preventDefault(),D()))}),P),e.useEffect((()=>{if(C)return v&&(0===x.layersWithOutsidePointerEventsDisabled.size&&(u=P.body.style.pointerEvents,P.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(C)),x.layers.add(C),p(),()=>{v&&1===x.layersWithOutsidePointerEventsDisabled.size&&(P.body.style.pointerEvents=u)}}),[C,P,v,x]),e.useEffect((()=>()=>{C&&(x.layers.delete(C),x.layersWithOutsidePointerEventsDisabled.delete(C),p())}),[C,x]),e.useEffect((()=>{const e=()=>O({});return document.addEventListener(c,e),()=>document.removeEventListener(c,e)}),[]),a.exports.jsx(n.div,{...j,ref:g,style:{pointerEvents:B?F?"auto":"none":void 0,...r.style},onFocusCapture:t(r.onFocusCapture,z.onFocusCapture),onBlurCapture:t(r.onBlurCapture,z.onBlurCapture),onPointerDownCapture:t(r.onPointerDownCapture,S.onPointerDownCapture)})}));f.displayName="DismissableLayer";var v=e.forwardRef(((t,r)=>{const i=e.useContext(m),o=e.useRef(null),u=s(r,o);return e.useEffect((()=>{const e=o.current;if(e)return i.branches.add(e),()=>{i.branches.delete(e)}}),[i.branches]),a.exports.jsx(n.div,{...t,ref:u})}));function p(){const e=new CustomEvent(c);document.dispatchEvent(e)}function E(e,t,n,{discrete:s}){const i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),s?r(i,o):i.dispatchEvent(o)}v.displayName="DismissableLayerBranch";export{f as DismissableLayer,v as DismissableLayerBranch};
//# sourceMappingURL=index.mjs.js.map
