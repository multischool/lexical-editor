import*as e from"react";import{useComposedRefs as n}from"../../react-compose-refs/dist/index.mjs.js";import{useLayoutEffect as t}from"../../react-use-layout-effect/dist/index.mjs.js";var r=r=>{const{present:i,children:s}=r,u=function(n){const[r,i]=e.useState(),s=e.useRef({}),u=e.useRef(n),a=e.useRef("none"),c=n?"mounted":"unmounted",[m,d]=function(n,t){return e.useReducer(((e,n)=>t[e][n]??e),n)}(c,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return e.useEffect((()=>{const e=o(s.current);a.current="mounted"===m?e:"none"}),[m]),t((()=>{const e=s.current,t=u.current;if(t!==n){const r=a.current,i=o(e);if(n)d("MOUNT");else if("none"===i||"none"===e?.display)d("UNMOUNT");else{d(t&&r!==i?"ANIMATION_OUT":"UNMOUNT")}u.current=n}}),[n,d]),t((()=>{if(r){let e;const n=r.ownerDocument.defaultView??window,t=t=>{const i=o(s.current).includes(t.animationName);if(t.target===r&&i&&(d("ANIMATION_END"),!u.current)){const t=r.style.animationFillMode;r.style.animationFillMode="forwards",e=n.setTimeout((()=>{"forwards"===r.style.animationFillMode&&(r.style.animationFillMode=t)}))}},i=e=>{e.target===r&&(a.current=o(s.current))};return r.addEventListener("animationstart",i),r.addEventListener("animationcancel",t),r.addEventListener("animationend",t),()=>{n.clearTimeout(e),r.removeEventListener("animationstart",i),r.removeEventListener("animationcancel",t),r.removeEventListener("animationend",t)}}d("ANIMATION_END")}),[r,d]),{isPresent:["mounted","unmountSuspended"].includes(m),ref:e.useCallback((e=>{e&&(s.current=getComputedStyle(e)),i(e)}),[])}}(i),a="function"==typeof s?s({present:u.isPresent}):e.Children.only(s),c=n(u.ref,function(e){let n=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,t=n&&"isReactWarning"in n&&n.isReactWarning;if(t)return e.ref;if(n=Object.getOwnPropertyDescriptor(e,"ref")?.get,t=n&&"isReactWarning"in n&&n.isReactWarning,t)return e.props.ref;return e.props.ref||e.ref}(a));return"function"==typeof s||u.isPresent?e.cloneElement(a,{ref:c}):null};function o(e){return e?.animationName||"none"}r.displayName="Presence";export{r as Presence};
//# sourceMappingURL=index.mjs.js.map
