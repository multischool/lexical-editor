{"version":3,"file":"parseMermaid.js","sources":["../../../../../node_modules/@excalidraw/mermaid-to-excalidraw/dist/parseMermaid.js"],"sourcesContent":["import mermaid from \"mermaid\";\nimport { MERMAID_CONFIG } from \"./constants.js\";\nimport { encodeEntities } from \"./utils.js\";\nimport { parseMermaidFlowChartDiagram } from \"./parser/flowchart.js\";\nimport { parseMermaidSequenceDiagram } from \"./parser/sequence.js\";\nimport { parseMermaidClassDiagram } from \"./parser/class.js\";\n// Fallback to Svg\nconst convertSvgToGraphImage = (svgContainer) => {\n    // Extract SVG width and height\n    // TODO: make width and height change dynamically based on user's screen dimension\n    const svgEl = svgContainer.querySelector(\"svg\");\n    if (!svgEl) {\n        throw new Error(\"SVG element not found\");\n    }\n    const rect = svgEl.getBoundingClientRect();\n    const width = rect.width;\n    const height = rect.height;\n    // Set width and height explictly since in firefox it gets set to 0\n    // if the width and height are not expilcitly set\n    // eg in some cases like er Diagram, gnatt, width and height is set as 100%\n    // which sets the dimensions as 0 in firefox and thus the diagram isn't rendered\n    svgEl.setAttribute(\"width\", `${width}`);\n    svgEl.setAttribute(\"height\", `${height}`);\n    // Convert SVG to image\n    const mimeType = \"image/svg+xml\";\n    const decoded = unescape(encodeURIComponent(svgEl.outerHTML));\n    const base64 = btoa(decoded);\n    const dataURL = `data:image/svg+xml;base64,${base64}`;\n    const graphImage = {\n        type: \"graphImage\",\n        mimeType,\n        dataURL,\n        width,\n        height,\n    };\n    return graphImage;\n};\nexport const parseMermaid = async (definition, config = MERMAID_CONFIG) => {\n    mermaid.initialize({ ...MERMAID_CONFIG, ...config });\n    // Parse the diagram\n    const diagram = await mermaid.mermaidAPI.getDiagramFromText(encodeEntities(definition));\n    // Render the SVG diagram\n    const { svg } = await mermaid.render(\"mermaid-to-excalidraw\", definition);\n    // Append Svg to DOM\n    const svgContainer = document.createElement(\"div\");\n    svgContainer.setAttribute(\"style\", `opacity: 0; position: relative; z-index: -1;`);\n    svgContainer.innerHTML = svg;\n    svgContainer.id = \"mermaid-diagram\";\n    document.body.appendChild(svgContainer);\n    let data;\n    switch (diagram.type) {\n        case \"flowchart-v2\": {\n            data = parseMermaidFlowChartDiagram(diagram, svgContainer);\n            break;\n        }\n        case \"sequence\": {\n            data = parseMermaidSequenceDiagram(diagram, svgContainer);\n            break;\n        }\n        case \"classDiagram\": {\n            data = parseMermaidClassDiagram(diagram, svgContainer);\n            break;\n        }\n        // fallback to image if diagram type not-supported\n        default: {\n            data = convertSvgToGraphImage(svgContainer);\n        }\n    }\n    svgContainer.remove();\n    return data;\n};\n"],"names":["parseMermaid","async","definition","config","MERMAID_CONFIG","mermaid","initialize","diagram","mermaidAPI","getDiagramFromText","encodeEntities","svg","render","svgContainer","document","createElement","data","setAttribute","innerHTML","id","body","appendChild","type","parseMermaidFlowChartDiagram","parseMermaidSequenceDiagram","parseMermaidClassDiagram","svgEl","querySelector","Error","rect","getBoundingClientRect","width","height","decoded","unescape","encodeURIComponent","outerHTML","mimeType","dataURL","btoa","convertSvgToGraphImage","remove"],"mappings":"2kBAOA,MA8BaA,EAAeC,MAAOC,EAAYC,EAASC,KACpDC,EAAQC,WAAW,IAAKF,KAAmBD,IAE3C,MAAMI,QAAgBF,EAAQG,WAAWC,mBAAmBC,EAAeR,KAErES,IAAEA,SAAcN,EAAQO,OAAO,wBAAyBV,GAExDW,EAAeC,SAASC,cAAc,OAK5C,IAAIC,EACJ,OALAH,EAAaI,aAAa,QAAS,gDACnCJ,EAAaK,UAAYP,EACzBE,EAAaM,GAAK,kBAClBL,SAASM,KAAKC,YAAYR,GAElBN,EAAQe,MACZ,IAAK,eACDN,EAAOO,EAA6BhB,EAASM,GAC7C,MAEJ,IAAK,WACDG,EAAOQ,EAA4BjB,EAASM,GAC5C,MAEJ,IAAK,eACDG,EAAOS,EAAyBlB,EAASM,GACzC,MAGJ,QACIG,EA1DmB,CAACH,IAG5B,MAAMa,EAAQb,EAAac,cAAc,OACzC,IAAKD,EACD,MAAM,IAAIE,MAAM,yBAEpB,MAAMC,EAAOH,EAAMI,wBACbC,EAAQF,EAAKE,MACbC,EAASH,EAAKG,OAKpBN,EAAMT,aAAa,QAAS,GAAGc,KAC/BL,EAAMT,aAAa,SAAU,GAAGe,KAEhC,MACMC,EAAUC,SAASC,mBAAmBT,EAAMU,YAUlD,MAPmB,CACfd,KAAM,aACNe,SANa,gBAObC,QAJY,6BADDC,KAAKN,KAMhBF,QACAC,SAEa,EA8BFQ,CAAuB3B,GAItC,OADAA,EAAa4B,SACNzB,CAAI"}