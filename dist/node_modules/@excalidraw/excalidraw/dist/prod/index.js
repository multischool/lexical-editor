import{$c as e,$a as t,pf as s,Qf as n,Oe as i,zb as a,db as l,F as r,pd as o,Pe as d,Vg as c,gd as p,za as h,sc as m,mf as u,lf as g,kb as x,l as f,Od as b,fd as E,ya as v,Nd as w,vk as S,rg as C,Ya as I,kd as k,jd as M,hg as j,of as D,gf as L,tf as N,qf as A,bf as _,r as P,Hb as R,Db as O,Wb as B,ch as z,Qi as U,ge as H,Da as Y,Ja as $,ec as V,Vc as W,Fc as K,fb as Z,G as X,Xa as q,Oj as Q,Xg as J,_c as ee,C as te,Yb as se,Xb as ne,mb as ie,Tj as ae,Yg as le,e as re,Zg as oe,Zc as de,Ri as ce,Ga as pe,Gi as he,wg as me,B as ue,ac as ge,jf as xe,_e as fe,kf as be,fj as Ee,Pi as ye,oi as ve,Vb as we,ed as Se,D as Ce,Ab as Ie,q as ke,yc as Te,ej as Me,tk as je,Jc as De,Pb as Le,ub as Ne,Gc as Ae,jb as _e,cd as Pe,Fg as Re,gc as Oe,Lg as Fe,ob as Be,pj as ze,Gh as Ue,Pj as He,xk as Ye,lb as Ge,K as $e,L as Ve,cb as We,Rf as Ke,dj as Ze,zc as Xe,vc as qe,Ec as Qe,Xf as Je,Ac as et,_b as tt,ng as st,tg as nt,bc as it,zi as at,N as lt,_j as rt,eg as ot,fg as dt,qg as ct,ug as pt,jc as ht,aj as mt,dc as ut,bd as gt,bj as xt,oj as ft,bg as bt,oc as Et,ua as yt,gj as vt,ij as wt,hj as St,Pc as Ct,Bj as It,x as kt,Fb as Tt,tc as Mt,ud as jt,Qj as Dt,Wg as Lt,Tg as Nt,pk as At,Wd as _t,gg as Pt,Vd as Rt,Yd as Ot,Xd as Ft,uf as Bt,cc as zt,wd as Ut,xb as Ht,Lc as Yt,Qc as Gt,Bi as $t,rb as Vt,mc as Wt,zj as Kt,nc as Zt,Aj as Xt,vj as qt,Sg as Qt,wi as Jt,rk as es,bb as ts,qd as ss,f as ns,i as is,g as as,j as ls,je as rs,ke as os,le as ds,me as cs,va as ps,ne as hs,oe as ms,pe as us,se as gs,te as xs,ue as fs,qe as bs,re as Es,Je as ys,Ke as vs,Le as ws,Me as Ss,Ne as Cs,uj as Is,Qe as ks,Re as Ts,Se as Ms,sa as js,Te as Ds,Ve as Ls,Ue as Ns,wk as As,ve as _s,we as Ps,$i as Rs,Fa as Os,If as Fs,Kf as Bs,Jf as zs,h as Us,rd as Hs,Ak as Ys,$ as Gs,ba as $s,sd as Vs,aa as Ws,td as Ks,zf as Zs,xd as Xs,yd as qs,Ye as Qs,Hc as Js,z as en,Ig as tn,Sj as sn,xg as nn,Ua as an,ad as ln,Qd as rn,Hd as on,la as dn,fi as cn,Td as pn,Ad as hn,sh as mn,Kh as un,Kd as gn,Lh as xn,yf as fn,kc as bn,pc as En,qc as yn,I as vn,J as wn,zd as Sn,lk as Cn,Md as In,Cd as kn,he as Tn,Di as Mn,Mc as jn,Ai as Dn,Ji as Ln,Sc as Nn,Mj as An,Ic as _n,ie as Pn,Tc as Rn,Ci as On,Li as Fn,Ei as Bn,sf as zn,rf as Un,Zd as Hn,_d as Yn,$d as Gn,ae as $n,de as Vn,ee as Wn,be as Kn,ce as Zn,xf as Xn,Mi as qn,wf as Qn,cj as Jn,hk as ei,Jg as si,ki as ni,li as ii,n as ai,ji as li,$e as oi,Af as di,hi as ci,Bf as hi,ii as mi,Jj as gi,Gf as xi,Df as fi,Cf as bi,vf as Ei,tj as yi,sj as wi,xj as Si,ta as Ci,rj as Ii,Sf as ki,ra as Ti,Gj as Mi,Xc as ji,$g as Di,Yc as Li,Cb as Ni,Pf as Ai,Id as _i,Tb as Pi,tb as Ri,dg as Oi,T as Fi,Mh as Bi,Gb as zi,Ib as Hi,Wi as Yi,Vi as Gi,Zh as $i,Yh as Vi,_h as Wi,ab as Ki,Hf as Zi,xa as Xi,E as qi,Of as Qi,Rd as Ji,ig as ea,Sd as ta,m as sa,ic as na,Kb as ia,$b as aa,xi as la,yi as ra,id as oa,Ld as da,Jd as ca,Bd as pa,Ef as ha,Ed as ma,Gd as ga,Fd as xa,fe as fa,Wc as ba,zk as Ea,Ki as ya,ff as va,dd as wa,Vf as Sa,Ii as Ca,eb as Ia,ci as ka,Lb as Ta,bi as Ma,pa as ja,Qb as Da,y as La,mi as Na,Hj as Aa,Dc as _a,yj as Pa,Rj as Ra,A as Oa,Oi as Fa,da as Ba,H as za,pb as Ua,Aa as Ya,Wf as Ga,qk as $a,lh as Va,$h as Wa,ha as Ka,ja as Za,ia as Xa,ka as qa,p as Qa,Y as Ja,Fh as el,th as tl,Rb as sl,_g as nl,jh as il,Hi as al,o as ll,ai as rl,gb as ol,s as dl,Bh as cl,Rh as pl,Dh as hl,Nj as ml,_a as ul,jg as gl,lc as xl,Uj as fl,w as bl,v as El,Pg as yl,Kg as vl,Fj as wl,sg as Sl,Za as Cl,fc as Il,wc as kl,Rc as Tl,Zb as Ml,sb as jl,Uh as Dl,Wa as Ll,t as Nl,nj as Al,mj as _l,Ob as Pl,hc as Rl,u as Ol,mg as Fl,Vj as Bl,$j as zl,bk as Ul,ak as Hl,Th as Yl,Z as Gl,ek as $l,fk as Vl,Oc as Wl,Zf as Kl,Og as Zl,Uf as Xl,Tf as ql,ag as Ql,$f as Jl,_f as er,zh as tr,Eh as sr,na as nr,oa as ir,Ch as ar,Ah as lr,Oh as rr,fh as or,S as dr,Ph as cr,Qh as pr,Eg as hr,Ng as mr,Hh as ur,vh as gr,wh as xr,Ih as fr,uh as br,uc as Er,kk as yr,ib as vr,lg as wr,kg as Sr,lj as Cr,kj as Ir,bh as kr,ck as Tr,Yf as Mr,xc as jr,Fi as Dr,Wj as Lr,Ni as Nr,Kc as Ar,pg as _r,ga as Pr,Ub as Rr,cg as Or,R as Fr,Mf as Br,Lf as zr,uk as Ur,rc as Hr,xe as Yr,ye as Gr,Ce as $r,De as Vr,ze as Wr,Ae as Kr,Ee as Zr,Fe as Xr,Be as qr,He as Qr,Ge as Jr,Ie as eo,Qg as to,Mg as so,Rg as no,Nb as io,ei as ao,gh as lo,di as ro,yh as oo,Jh as co,ni as po,ma as ho,Ca as mo,qh as uo,rh as go,ca as xo,Sh as fo,og as bo,ri as Eo,wa as yo,xh as vo,mh as wo,ih as So,Sb as Co,cf as Io,hf as ko,We as To,Na as Mo,Va as jo,dh as Do,Bk as Lo,Jb as No,hh as Ao,Bb as _o,qj as Po,Ij as Ro,Cj as Oo,_ as Fo,Bc as Bo,ld as zo,nd as Uo,md as Ho,Kj as Yo,yb as Go,Ia as $o,Ka as Vo,yk as Wo,vb as Ko,Uc as Zo,qa as Xo,Xi as qo,Yi as Qo,Zi as Jo,_i as ed,Ej as td,Dj as sd,ef as nd,vd as id,if as ad,Dg as ld,vg as rd,Cg as od,Ag as dd,yg as cd,zg as pd,Bg as hd,od as md,gi as ud,Dd as gd,Ff as xd,Nf as fd,Ba as bd,La as Ed,Ea as yd,gk as vd,Wh as wd,Xh as Sd,Si as Cd,Zj as Id,Xj as kd,M as Td,Yj as Md,X as jd,jk as Dd,Sa as Ld,Oa as Nd,Pa as Ad,Ta as _d,Ra as Pd,Qa as Rd,jj as Od,ik as Fd,sk as Bd,qb as zd,d as Ud,c as Hd,k as Yd,df as Gd,Q as $d,O as Vd,P as Wd,hd as Kd,Xe as Zd,pi as Xd,U as qd,Ze as Qd,af as Jd,nb as ec,Pd as tc,Eb as sc,Mb as nc,ah as ic,Ma as ac,Vh as lc,Nc as rc,Ti as oc,a as dc,Nh as pc,wj as hc,b as mc,dk as uc,Gg as gc,Hg as xc,Ug as fc,hb as bc,V as Ec,W as yc}from"./chunk-FX7ZIABN.js";export{Wg as CaptureUpdateAction,y as DEFAULT_LASER_COLOR,F as FONT_FAMILY,T as MIME_TYPES,ua as ROUNDNESS,G as THEME,Ha as UserIdleState,Rj as bumpVersion,ui as elementPartiallyOverlapsWithOrContainsBBox,vi as elementsOverlappingBBox,pi as exportToCanvas,ri as exportToSvg,bj as getCommonBounds,Ah as getDataURL,Ui as getFreeDrawSvgPath,pk as getNonDeletedElements,Jj as getTextFromElements,dj as getVisibleSceneBounds,ok as hashString,ti as isElementInsideBBox,$h as isElementLink,Sj as isInvisiblySmallElement,cc as isLinearElement,vh as loadFromBlob,xh as loadLibraryFromBlob,uh as loadSceneOrLibraryFromBlob,Pj as mutateElement,Qj as newElementWith,Xc as normalizeLink,lh as restore,kh as restoreAppState,jh as restoreElements,mh as restoreLibraryItems,mb as sceneCoordsToViewportCoords,Jh as serializeAsJSON,Mh as serializeLibraryAsJSON,lb as viewportCoordsToSceneCoords}from"./chunk-FX7ZIABN.js";import{a as vc}from"./chunk-SQ5PDB2P.js";import{J as wc}from"./chunk-6U3AYISY.js";import{c as Sc}from"./chunk-Z3N5DIM6.js";import{d as Cc,c as Ic,b as kc}from"./chunk-SRAX5OIU.js";import Tc,{useState as Mc,useRef as jc,useEffect as Dc,forwardRef as Lc,useMemo as Nc,useCallback as Ac,memo as _c,useImperativeHandle as Pc,useLayoutEffect as Rc,createElement as Oc,version as Fc,useContext as Bc,Children as zc,Fragment as Uc,useDeferredValue as Hc}from"react";import{createStore as Yc,atom as Gc}from"jotai";import{createIsolation as $c}from"../../../../jotai-scope/dist/index.modern.js";import"../../../../react/jsx-runtime.js";import Vc from"../../node_modules/clsx/dist/clsx.m.js";import{unstable_batchedUpdates as Wc,flushSync as Kc,createPortal as Zc}from"react-dom";import qc from"../../../../roughjs/bin/rough.js";import{nanoid as Qc}from"../../node_modules/nanoid/index.js";import{Portal as Jc,Content as ep,Arrow as tp,Root as sp,Trigger as np}from"../../../../@radix-ui/react-popover/dist/index.mjs.js";import ip from"../../../../open-color/open-color.json.js";import ap from"../../../../lodash.throttle/index.js";import lp from"../../../../fuzzy/lib/fuzzy.js";import rp from"../../../../tunnel-rat/dist/index.js";import{List as op,Trigger as dp,Root as cp,Content as pp}from"../../node_modules/@radix-ui/react-tabs/dist/index.module.js";import hp from"../../../../lodash.debounce/index.js";import{LaserPointer as mp}from"../../../laser-pointer/dist/esm.js";import{supported as up}from"../../../../browser-fs-access/dist/index.mjs.js";import{j as gp}from"../../../../../_virtual/jsx-runtime.js";var xp=$c(),{useAtom:fp,useSetAtom:bp,useAtomValue:Ep,useStore:yp}=xp,vp=xp.Provider,wp=Yc(),Sp=kc({"./locales/ar-SA.json":()=>import("./locales/ar-SA-G6X2FPQ2.js"),"./locales/az-AZ.json":()=>import("./locales/az-AZ-76LH7QW2.js"),"./locales/bg-BG.json":()=>import("./locales/bg-BG-XCXSNQG7.js"),"./locales/bn-BD.json":()=>import("./locales/bn-BD-2XOGV67Q.js"),"./locales/ca-ES.json":()=>import("./locales/ca-ES-6MX7JW3Y.js"),"./locales/cs-CZ.json":()=>import("./locales/cs-CZ-2BRQDIVT.js"),"./locales/da-DK.json":()=>import("./locales/da-DK-5WZEPLOC.js"),"./locales/de-DE.json":()=>import("./locales/de-DE-XR44H4JA.js"),"./locales/el-GR.json":()=>import("./locales/el-GR-BZB4AONW.js"),"./locales/en.json":()=>import("./locales/en-B4ZKOASM.js"),"./locales/es-ES.json":()=>import("./locales/es-ES-U4NZUMDT.js"),"./locales/eu-ES.json":()=>import("./locales/eu-ES-A7QVB2H4.js"),"./locales/fa-IR.json":()=>import("./locales/fa-IR-HGAKTJCU.js"),"./locales/fi-FI.json":()=>import("./locales/fi-FI-Z5N7JZ37.js"),"./locales/fr-FR.json":()=>import("./locales/fr-FR-RHASNOE6.js"),"./locales/gl-ES.json":()=>import("./locales/gl-ES-HMX3MZ6V.js"),"./locales/he-IL.json":()=>import("./locales/he-IL-6SHJWFNN.js"),"./locales/hi-IN.json":()=>import("./locales/hi-IN-IWLTKZ5I.js"),"./locales/hu-HU.json":()=>import("./locales/hu-HU-A5ZG7DT2.js"),"./locales/id-ID.json":()=>import("./locales/id-ID-SAP4L64H.js"),"./locales/it-IT.json":()=>import("./locales/it-IT-JPQ66NNP.js"),"./locales/ja-JP.json":()=>import("./locales/ja-JP-DBVTYXUO.js"),"./locales/kaa.json":()=>import("./locales/kaa-6HZHGXH3.js"),"./locales/kab-KAB.json":()=>import("./locales/kab-KAB-ZGHBKWFO.js"),"./locales/kk-KZ.json":()=>import("./locales/kk-KZ-P5N5QNE5.js"),"./locales/km-KH.json":()=>import("./locales/km-KH-HSX4SM5Z.js"),"./locales/ko-KR.json":()=>import("./locales/ko-KR-MTYHY66A.js"),"./locales/ku-TR.json":()=>import("./locales/ku-TR-6OUDTVRD.js"),"./locales/lt-LT.json":()=>import("./locales/lt-LT-XHIRWOB4.js"),"./locales/lv-LV.json":()=>import("./locales/lv-LV-5QDEKY6T.js"),"./locales/mr-IN.json":()=>import("./locales/mr-IN-CRQNXWMA.js"),"./locales/my-MM.json":()=>import("./locales/my-MM-5M5IBNSE.js"),"./locales/nb-NO.json":()=>import("./locales/nb-NO-T6EIAALU.js"),"./locales/nl-NL.json":()=>import("./locales/nl-NL-IS3SIHDZ.js"),"./locales/nn-NO.json":()=>import("./locales/nn-NO-6E72VCQL.js"),"./locales/oc-FR.json":()=>import("./locales/oc-FR-POXYY2M6.js"),"./locales/pa-IN.json":()=>import("./locales/pa-IN-N4M65BXN.js"),"./locales/percentages.json":()=>import("./locales/percentages-BXMCSKIN.js"),"./locales/pl-PL.json":()=>import("./locales/pl-PL-T2D74RX3.js"),"./locales/pt-BR.json":()=>import("./locales/pt-BR-5N22H2LF.js"),"./locales/pt-PT.json":()=>import("./locales/pt-PT-UZXXM6DQ.js"),"./locales/ro-RO.json":()=>import("./locales/ro-RO-JPDTUUEW.js"),"./locales/ru-RU.json":()=>import("./locales/ru-RU-B4JR7IUQ.js"),"./locales/si-LK.json":()=>import("./locales/si-LK-N5RQ5JYF.js"),"./locales/sk-SK.json":()=>import("./locales/sk-SK-C5VTKIMK.js"),"./locales/sl-SI.json":()=>import("./locales/sl-SI-NN7IZMDC.js"),"./locales/sv-SE.json":()=>import("./locales/sv-SE-XGPEYMSR.js"),"./locales/ta-IN.json":()=>import("./locales/ta-IN-2NMHFXQM.js"),"./locales/th-TH.json":()=>import("./locales/th-TH-HPSO5L25.js"),"./locales/tr-TR.json":()=>import("./locales/tr-TR-DEFEU3FU.js"),"./locales/uk-UA.json":()=>import("./locales/uk-UA-QMV73CPH.js"),"./locales/vi-VN.json":()=>import("./locales/vi-VN-M7AON7JQ.js"),"./locales/zh-CN.json":()=>import("./locales/zh-CN-LNUGB5OW.js"),"./locales/zh-HK.json":()=>import("./locales/zh-HK-E62DVLB3.js"),"./locales/zh-TW.json":()=>import("./locales/zh-TW-RAJ6MFWO.js")}),Cp={code:"en",label:"English"},Ip=[Cp,...[{code:"ar-SA",label:"العربية",rtl:!0},{code:"bg-BG",label:"Български"},{code:"ca-ES",label:"Català"},{code:"cs-CZ",label:"Česky"},{code:"de-DE",label:"Deutsch"},{code:"el-GR",label:"Ελληνικά"},{code:"es-ES",label:"Español"},{code:"eu-ES",label:"Euskara"},{code:"fa-IR",label:"فارسی",rtl:!0},{code:"fi-FI",label:"Suomi"},{code:"fr-FR",label:"Français"},{code:"gl-ES",label:"Galego"},{code:"he-IL",label:"עברית",rtl:!0},{code:"hi-IN",label:"हिन्दी"},{code:"hu-HU",label:"Magyar"},{code:"id-ID",label:"Bahasa Indonesia"},{code:"it-IT",label:"Italiano"},{code:"ja-JP",label:"日本語"},{code:"kab-KAB",label:"Taqbaylit"},{code:"kk-KZ",label:"Қазақ тілі"},{code:"ko-KR",label:"한국어"},{code:"ku-TR",label:"Kurdî"},{code:"lt-LT",label:"Lietuvių"},{code:"lv-LV",label:"Latviešu"},{code:"my-MM",label:"Burmese"},{code:"nb-NO",label:"Norsk bokmål"},{code:"nl-NL",label:"Nederlands"},{code:"nn-NO",label:"Norsk nynorsk"},{code:"oc-FR",label:"Occitan"},{code:"pa-IN",label:"ਪੰਜਾਬੀ"},{code:"pl-PL",label:"Polski"},{code:"pt-BR",label:"Português Brasileiro"},{code:"pt-PT",label:"Português"},{code:"ro-RO",label:"Română"},{code:"ru-RU",label:"Русский"},{code:"sk-SK",label:"Slovenčina"},{code:"sv-SE",label:"Svenska"},{code:"sl-SI",label:"Slovenščina"},{code:"tr-TR",label:"Türkçe"},{code:"uk-UA",label:"Українська"},{code:"zh-CN",label:"简体中文"},{code:"zh-TW",label:"繁體中文"},{code:"vi-VN",label:"Tiếng Việt"},{code:"mr-IN",label:"मराठी"}].filter((e=>Sc[e.code]>=85)).sort(((e,t)=>e.label>t.label?1:-1))],kp="__test__";vc.DEV&&Ip.unshift({code:kp,label:"test language"},{code:`${kp}.rtl`,label:"‪test language (rtl)‬",rtl:!0});var Tp=Cp,Mp={},jp=async e=>{if(Tp=e,document.documentElement.dir=Tp.rtl?"rtl":"ltr",document.documentElement.lang=Tp.code,e.code.startsWith(kp))Mp={};else try{Mp=await Sp(`./locales/${Tp.code}.json`)}catch(t){console.error(`Failed to load language ${e.code}:`,t.message),Mp=wc}wp.set(Ap,e.code)},Dp=()=>Tp,Lp=(e,t)=>{for(let s=0;s<t.length;++s){let n=t[s];if(void 0===e[n])return;e=e[n]}if("string"==typeof e)return e},Np=(e,t,s)=>{if(Tp.code.startsWith(kp))return`‪[[${t?`${e}(${JSON.stringify(t).slice(1,-1)})`:e}]]‬`;let n=e.split("."),i=Lp(Mp,n)||Lp(wc,n)||s;if(void 0===i){let t=`Can't find translation for ${e}`;return console.warn(t),""}if(t)for(let e in t)i=i.replace(`{{${e}}}`,String(t[e]));return i},Ap=Gc(Cp.code),_p=()=>{let e=Ep(Ap);return{t:Np,langCode:e}},Pp=({size:e="1em",circleWidth:t=8,synchronized:s=!1,className:n=""})=>{let i=-Tc.useRef(Date.now()).current%1600;return gp.exports.jsx("div",{className:`Spinner ${n}`,children:gp.exports.jsx("svg",{viewBox:"0 0 100 100",style:{width:e,height:e,"--spinner-delay":s?`${i}ms`:0},children:gp.exports.jsx("circle",{cx:"50",cy:"50",r:50-t/2,strokeWidth:t,fill:"none",strokeMiterlimit:"10"})})})},Rp=({delay:e,theme:t})=>{let[s,n]=Mc(!!e);return Dc((()=>{if(!e)return;let t=setTimeout((()=>{n(!1)}),e);return()=>clearTimeout(t)}),[e]),s?null:gp.exports.jsxs("div",{className:Vc("LoadingMessage",{"LoadingMessage--dark":t===X.DARK}),children:[gp.exports.jsx("div",{children:gp.exports.jsx(Pp,{})}),gp.exports.jsx("div",{className:"LoadingMessage-text",children:Np("labels.loadingScene")})]})},Op=e=>{let[t,s]=Mc(!0);return Dc((()=>{let t=Ip.find((t=>t.code===e.langCode))||Cp;(async()=>{await jp(t),s(!1)})()}),[e.langCode]),t?gp.exports.jsx(Rp,{theme:e.theme}):e.children},Fp=Tc.forwardRef((({size:e="medium",visible:t=!0,className:s="",...n},i)=>{let{id:a}=ev(),l=Tc.useRef(null);Tc.useImperativeHandle(i,(()=>l.current));let r=`ToolIcon_size_${e}`,[o,d]=Mc(!1),c=jc(!0),p=async e=>{let t="onClick"in n&&n.onClick?.(e);if(Tt(t))try{d(!0),await t}catch(e){if(!(e instanceof Mt))throw e;console.warn(e)}finally{c.current&&d(!1)}};Dc((()=>(c.current=!0,()=>{c.current=!1})),[]);let h=jc(null);if("button"===n.type||"icon"===n.type||"submit"===n.type){let e="icon"===n.type?"button":n.type;return gp.exports.jsxs("button",{className:Vc("ToolIcon_type_button",r,s,t&&!n.hidden?"ToolIcon_type_button--show":"ToolIcon_type_button--hide",{ToolIcon:!n.hidden,"ToolIcon--selected":n.selected,"ToolIcon--plain":"icon"===n.type}),style:n.style,"data-testid":n["data-testid"],hidden:n.hidden,title:n.title,"aria-label":n["aria-label"],type:e,onClick:p,ref:l,disabled:o||n.isLoading||!!n.disabled,children:[(n.icon||n.label)&&gp.exports.jsxs("div",{className:"ToolIcon__icon","aria-hidden":"true","aria-disabled":!!n.disabled,children:[n.icon||n.label,n.keyBindingLabel&&gp.exports.jsx("span",{className:"ToolIcon__keybinding",children:n.keyBindingLabel}),n.isLoading&&gp.exports.jsx(Pp,{})]}),n.showAriaLabel&&gp.exports.jsxs("div",{className:"ToolIcon__label",children:[n["aria-label"]," ",o&&gp.exports.jsx(Pp,{})]}),n.children]})}return gp.exports.jsxs("label",{className:Vc("ToolIcon",s),title:n.title,onPointerDown:e=>{h.current=e.pointerType||null,n.onPointerDown?.({pointerType:e.pointerType||null})},onPointerUp:()=>{requestAnimationFrame((()=>{h.current=null}))},children:[gp.exports.jsx("input",{className:`ToolIcon_type_radio ${r}`,type:"radio",name:n.name,"aria-label":n["aria-label"],"aria-keyshortcuts":n["aria-keyshortcuts"],"data-testid":n["data-testid"],id:`${a}-${n.id}`,onChange:()=>{n.onChange?.({pointerType:h.current})},checked:n.checked,ref:l}),gp.exports.jsxs("div",{className:"ToolIcon__icon",children:[n.icon,n.keyBindingLabel&&gp.exports.jsx("span",{className:"ToolIcon__keybinding",children:n.keyBindingLabel})]})]})}));Fp.displayName="ToolButton";var Bp=(e,t)=>{if(e.editingGroupId){let s=Gt(At(t),e.editingGroupId);if(s.length)return{...e,selectedElementIds:{[s[0].id]:!0}}}return e},zp=e({name:"deleteSelectedElements",label:"labels.delete",icon:jt,trackEvent:{category:"element",action:"delete"},perform:(e,t,s,n)=>{if(t.editingLinearElement){let{elementId:s,selectedPointsIndices:i,startBindingElement:a,endBindingElement:l}=t.editingLinearElement,r=n.scene.getNonDeletedElementsMap(),o=ze.getElement(s,r);if(!o||null==i)return!1;if(o.points.length<2){let s=e.map((e=>e.id===o.id?Dt(e,{isDeleted:!0}):e));return{elements:s,appState:{...Bp(t,s),editingLinearElement:null},captureUpdate:Lt.IMMEDIATELY}}let d={startBindingElement:i?.includes(0)?null:a,endBindingElement:i?.includes(o.points.length-1)?null:l};return ze.deletePoints(o,i),{elements:e,appState:{...t,editingLinearElement:{...t.editingLinearElement,...d,selectedPointsIndices:i?.[0]>0?[i[0]-1]:[0]}},captureUpdate:Lt.IMMEDIATELY}}let{elements:i,appState:a}=((e,t,s)=>{let n=new Set(S(e.filter((e=>it(e))),t).map((e=>e.id))),i={},a=s.scene.getNonDeletedElementsMap(),l=new Set;for(let t of n){let s=$t(e,t);for(let e of s)if(!l.has(e.id)){if(Zt(e)){let t=Xt(e,a);t&&(i[t.id]=!0)}else i[e.id]=!0;l.add(e.id)}}let r=!0,o=e.map((e=>{if(t.selectedElementIds[e.id]){let t=Zt(e)?Xt(e,a):null;return e.frameId&&n.has(e.frameId)?(r=!1,i[e.id]=!0,e):t?.frameId&&n.has(t?.frameId)?e:(e.boundElements&&e.boundElements.forEach((t=>{let n=s.scene.getNonDeletedElementsMap().get(t.id);n&&V(n)&&(He(n,{startBinding:e.id===n.startBinding?.elementId?null:n.startBinding,endBinding:e.id===n.endBinding?.elementId?null:n.endBinding}),He(n,{points:n.points}))})),Dt(e,{isDeleted:!0}))}return e.frameId&&n.has(e.frameId)?(r=!1,Zt(e)||(i[e.id]=!0),Dt(e,{frameId:null})):Zt(e)&&t.selectedElementIds[e.containerId]?Dt(e,{isDeleted:!0}):e})),d=t.editingGroupId;if(r&&t.editingGroupId){let e=Gt(o,t.editingGroupId).filter((e=>!e.isDeleted));if(e.length>1)e[0]&&(i[e[0].id]=!0);else{d=null,e[0]&&(i[e[0].id]=!0);let s=e[0];if(s){let e=s.groupIds.findIndex((e=>e===t.editingGroupId)),n=s.groupIds[e+1];if(n){let e=Gt(o,n).filter((e=>!e.isDeleted));e.length>1&&(d=n,e.forEach((e=>{i[e.id]=!0})))}}}}return{elements:o,appState:{...t,...De({selectedElementIds:i,editingGroupId:d},o,t,null)}}})(e,t,n);return Nt(i,i.filter((e=>e.isDeleted))),a=Bp(a,i),{elements:i,appState:{...a,activeTool:_e(t,{type:"selection"}),multiElement:null,activeEmbeddable:null},captureUpdate:je(At(e),t)?Lt.IMMEDIATELY:Lt.EVENTUALLY}},keyTest:(e,t,s)=>(e.key===j.BACKSPACE||e.key===j.DELETE)&&!e[j.CTRL_OR_CMD],PanelComponent:({elements:e,appState:t,updateData:s})=>gp.exports.jsx(Fp,{type:"button",icon:jt,title:Np("labels.delete"),"aria-label":Np("labels.delete"),onClick:()=>s(null),visible:je(At(e),t)})}),Up=(e,t)=>e.frameId===t||e.id===t,Hp=(e,t,s)=>{let n=[],i=[],a=null,l=-1,r=Ht(s||S(e,t,{includeBoundTextElement:!0,includeElementsInFrames:!0}));for(;++l<e.length;){let t=e[l];r.get(t.id)?(i.length&&(n=n.concat(i),i=[]),n.push(l),a=l+1):t.isDeleted&&a===l?(a=l+1,i.push(l)):i=[]}return n},Yp=(e,t,s)=>{if("containerId"in e&&e.containerId){let n=Q.getScene(e).getElement(e.containerId);if(n)return"left"===s?Math.min(t.indexOf(n),t.indexOf(e)):Math.max(t.indexOf(n),t.indexOf(e))}else{let n=e.boundElements?.find((e=>"arrow"!==e.type))?.id;if(n){let i=Q.getScene(e).getElement(n);if(i)return"left"===s?Math.min(t.indexOf(i),t.indexOf(e)):Math.max(t.indexOf(i),t.indexOf(e))}}},Gp=(e,t,s,n,i)=>{let a=t[s],l=t=>!t.isDeleted&&(i?t.frameId===i:!e.editingGroupId||t.groupIds.includes(e.editingGroupId)),r="left"===n?Vt(t,(e=>l(e)),Math.max(0,s-1)):zd(t,(e=>l(e)),s+1),o=t[r];if(!o)return-1;if(e.editingGroupId){if(a?.groupIds.join("")===o?.groupIds.join(""))return Yp(o,t,n)??r;if(!o?.groupIds.includes(e.editingGroupId))return-1}if(!i&&(o.frameId||it(o))){let e=((e,t)=>{let s=-1,n=-1;return e.forEach(((e,i)=>{Up(e,t)&&(-1===s&&(s=i),n=i)})),-1===s?[]:e.slice(s,n+1)})(t,o.frameId||o.id);return"left"===n?t.indexOf(e[0]):t.indexOf(e[e.length-1])}if(!o.groupIds.length)return Yp(o,t,n)??r;let d=e.editingGroupId?o.groupIds[o.groupIds.indexOf(e.editingGroupId)-1]:o.groupIds[o.groupIds.length-1],c=Gt(t,d);return c.length?"left"===n?t.indexOf(c[0]):t.indexOf(c[c.length-1]):r},$p=(e,t)=>t.reduce(((t,s)=>{let n=e[s];return t.set(n.id,n),t}),new Map),Vp=(e,t,s)=>{let n=Hp(e,t),i=$p(e,n),a=(e=>{let t=0;return e.reduce(((s,n,i)=>(i>0&&e[i-1]!==n-1&&(t=++t),(s[t]||(s[t]=[])).push(n),s)),[])})(n);"right"===s&&(a=a.reverse());let l=new Set(n.filter((t=>it(e[t]))).map((t=>e[t].id)));return a.forEach(((n,i)=>{let a=n[0],r=n[n.length-1],o="left"===s?a:r,d=n.some((t=>{let s=e[t];return s.frameId&&l.has(s.frameId)}))?null:e[o]?.frameId,c=Gp(t,e,o,s,d);if(-1===c||o===c)return;let p="left"===s?e.slice(0,c):e.slice(0,a),h=e.slice(a,r+1),m="left"===s?e.slice(c,a):e.slice(r+1,c+1),u="left"===s?e.slice(r+1):e.slice(c+1);e="left"===s?[...p,...h,...m,...u]:[...p,...m,...h,...u]})),An(e,i),e},Wp=(e,t,s,n,i)=>{let a,l,r=Hp(e,t,i),o=$p(e,r),d=[];if("left"===s){if(n)a=zd(e,(e=>Up(e,n)));else if(t.editingGroupId){let s=Gt(e,t.editingGroupId);if(!s.length)return e;a=e.indexOf(s[0])}else a=0;l=r[r.length-1]}else{if(n)l=Vt(e,(e=>Up(e,n)));else if(t.editingGroupId){let s=Gt(e,t.editingGroupId);if(!s.length)return e;l=e.indexOf(s[s.length-1])}else l=e.length-1;a=r[0]}-1===a&&(a=0);for(let t=a;t<l+1;t++)r.includes(t)||d.push(e[t]);let c=Array.from(o.values()),p=e.slice(0,a),h=e.slice(l+1),m="left"===s?[...p,...c,...d,...h]:[...p,...d,...c,...h];return An(m,o),m};function Kp(e,t,s,n){let i=Ht(S(e,t,{includeBoundTextElement:!0,includeElementsInFrames:!0})),a={regularElements:[],frameChildren:new Map},l=new Set;for(let t of e)i.has(t.id)&&it(t)&&l.add(t.id);for(let t of e)if(i.has(t.id))if(it(t)||t.frameId&&l.has(t.frameId))a.regularElements.push(t);else if(t.frameId){let e=a.frameChildren.get(t.frameId)||[];e.push(t),a.frameChildren.set(t.frameId,e)}else a.regularElements.push(t);let r=e,o=Array.from(a.frameChildren.entries());for(let[i,a]of o)r=n(e,t,s,i,a);return n(r,t,s,null,a.regularElements)}var Zp=(e,t)=>Vp(e,t,"left"),Xp=(e,t)=>Vp(e,t,"right"),qp=(e,t)=>Kp(e,t,"left",Wp),Qp=(e,t)=>Kp(e,t,"right",Wp),Jp=e({name:"sendBackward",label:"labels.sendBackward",keywords:["move down","zindex","layer"],icon:_t,trackEvent:{category:"element"},perform:(e,t)=>({elements:Zp(e,t),appState:t,captureUpdate:Lt.IMMEDIATELY}),keyPriority:40,keyTest:e=>e[j.CTRL_OR_CMD]&&!e.shiftKey&&e.code===Pt.BRACKET_LEFT,PanelComponent:({updateData:e,appState:t})=>gp.exports.jsx("button",{type:"button",className:"zIndexButton",onClick:()=>e(null),title:`${Np("labels.sendBackward")} — ${x("CtrlOrCmd+[")}`,children:_t})}),eh=e({name:"bringForward",label:"labels.bringForward",keywords:["move up","zindex","layer"],icon:Rt,trackEvent:{category:"element"},perform:(e,t)=>({elements:Xp(e,t),appState:t,captureUpdate:Lt.IMMEDIATELY}),keyPriority:40,keyTest:e=>e[j.CTRL_OR_CMD]&&!e.shiftKey&&e.code===Pt.BRACKET_RIGHT,PanelComponent:({updateData:e,appState:t})=>gp.exports.jsx("button",{type:"button",className:"zIndexButton",onClick:()=>e(null),title:`${Np("labels.bringForward")} — ${x("CtrlOrCmd+]")}`,children:Rt})}),th=e({name:"sendToBack",label:"labels.sendToBack",keywords:["move down","zindex","layer"],icon:Ot,trackEvent:{category:"element"},perform:(e,t)=>({elements:qp(e,t),appState:t,captureUpdate:Lt.IMMEDIATELY}),keyTest:e=>f?e[j.CTRL_OR_CMD]&&e.altKey&&e.code===Pt.BRACKET_LEFT:e[j.CTRL_OR_CMD]&&e.shiftKey&&e.code===Pt.BRACKET_LEFT,PanelComponent:({updateData:e,appState:t})=>gp.exports.jsx("button",{type:"button",className:"zIndexButton",onClick:()=>e(null),title:`${Np("labels.sendToBack")} — ${x(f?"CtrlOrCmd+Alt+[":"CtrlOrCmd+Shift+[")}`,children:Ot})}),sh=e({name:"bringToFront",label:"labels.bringToFront",keywords:["move up","zindex","layer"],icon:Ft,trackEvent:{category:"element"},perform:(e,t)=>({elements:Qp(e,t),appState:t,captureUpdate:Lt.IMMEDIATELY}),keyTest:e=>f?e[j.CTRL_OR_CMD]&&e.altKey&&e.code===Pt.BRACKET_RIGHT:e[j.CTRL_OR_CMD]&&e.shiftKey&&e.code===Pt.BRACKET_RIGHT,PanelComponent:({updateData:e,appState:t})=>gp.exports.jsx("button",{type:"button",className:"zIndexButton",onClick:t=>e(null),title:`${Np("labels.bringToFront")} — ${x(f?"CtrlOrCmd+Alt+]":"CtrlOrCmd+Shift+]")}`,children:Ft})}),nh=e({name:"selectAll",label:"labels.selectAll",icon:Bt,trackEvent:{category:"canvas"},viewMode:!1,perform:(e,t,s,n)=>{if(t.editingLinearElement)return!1;let i=e.filter((e=>!(e.isDeleted||tt(e)&&e.containerId||e.locked))).reduce(((e,t)=>(e[t.id]=!0,e)),{});return{appState:{...t,...De({editingGroupId:null,selectedElementIds:i},At(e),t,n),selectedLinearElement:1===Object.keys(i).length&&zt(e[0])?new ze(e[0]):null},captureUpdate:Lt.IMMEDIATELY}},keyTest:e=>e[j.CTRL_OR_CMD]&&e.key===j.A}),ih=e=>(e=>{let t=Go(e),s=e.slice(),n=new Set;return s.forEach(((e,i)=>{e&&(e.boundElements?.length?(n.add(e),s[i]=null,e.boundElements.forEach((e=>{let i=t.get(e.id);i&&"text"===e.type&&(n.add(i[0]),s[i[1]]=null)}))):"text"===e.type&&e.containerId&&t.get(e.containerId)?.[0].boundElements?.find((t=>t.id===e.id))||(n.add(e),s[i]=null))})),n.size!==e.length?(console.error("normalizeBoundElementsOrder: lost some elements... bailing!"),e):[...n]})((e=>{let t=e.slice(),s=new Set,n=e=>{let t=e[0]?.groupIds?.join(""),s=[e[0]],i=[];for(let n of e.slice(1))n.groupIds?.join("")===t?s.push(n):i.push(n);return i.length?[...s,...n(i)]:s},i=new Map;return t.forEach(((e,a)=>{if(!i.has(e.id))if(e.groupIds?.length){let l=e.groupIds[e.groupIds.length-1],r=t.slice(a).filter((e=>{let t=e?.groupIds?.some((e=>e===l));return t&&i.set(e.id,!0),t}));for(let e of n(r))s.add(e)}else s.add(e)})),s.size!==e.length?(console.error("normalizeGroupElementOrder: lost some elements... bailing!"),e):[...s]})(e)),ah=e({name:"duplicateSelection",label:"labels.duplicateSelection",icon:Ut,trackEvent:{category:"element"},perform:(e,t,s,n)=>{if(t.editingLinearElement)try{return{elements:e,appState:ze.duplicateSelectedPoints(t,n.scene.getNonDeletedElementsMap()),captureUpdate:Lt.IMMEDIATELY}}catch{return!1}let i=rh(e,t);if(n.props.onDuplicate&&i.elements){let t=n.props.onDuplicate(i.elements,e);t&&(i.elements=t)}return{...i,captureUpdate:Lt.IMMEDIATELY}},keyTest:e=>e[j.CTRL_OR_CMD]&&e.key===j.D,PanelComponent:({elements:e,appState:t,updateData:s})=>gp.exports.jsx(Fp,{type:"button",icon:Ut,title:`${Np("labels.duplicateSelection")} — ${x("CtrlOrCmd+D")}`,"aria-label":Np("labels.duplicateSelection"),onClick:()=>s(null),visible:je(At(e),t)})}),rh=(e,t)=>{let s=new Map,n=[],i=[],a=new Map,l=new Map,r=Ht(e),o=e=>{let r=Rr(e).reduce(((e,r)=>{if(c.has(r.id))return e;c.set(r.id,!0);let o=Or(t.editingGroupId,s,r,{x:r.x+Fr/2,y:r.y+Fr/2});return c.set(o.id,!0),l.set(o.id,o),a.set(r.id,o.id),i.push(r),n.push(o),e.push(o),e}),[]);return Array.isArray(e)?r:r[0]||null};e=ih(e);let d=Ht(S(e,t,{includeBoundTextElement:!0,includeElementsInFrames:!0})),c=new Map,p=e.slice(),h=(e,t)=>{ia(-1!==e,"targetIndex === -1 "),(Array.isArray(t)||t)&&p.splice(e+1,0,...Rr(t))},m=new Set(e.filter((e=>d.has(e.id)&&it(e))).map((e=>e.id)));for(let s of e){if(c.has(s.id)||!d.has(s.id))continue;let n=Yt(t,s);if(n){let t=Gt(e,n).flatMap((t=>it(t)?[...$t(e,t.id),t]:[t]));h(Vt(p,(e=>e.groupIds?.includes(n))),o(t))}else if(!s.frameId||!m.has(s.frameId)){if(it(s)){let t=s.id,n=$t(e,t);h(Vt(p,(e=>e.frameId===t||e.id===t)),o([...n,s]));continue}if(Wt(s)){let e=Kt(s,r),t=Vt(p,(e=>e.id===s.id||"containerId"in e&&e.containerId===s.id));h(t,o(e?[s,e]:s));continue}if(Zt(s)){let e=Xt(s,r),t=Vt(p,(t=>t.id===s.id||t.id===e?.id));h(t,o(e?[e,s]:s));continue}h(Vt(p,(e=>e.id===s.id)),o(s))}}qt(p,i,a),Qt(p,i,a),Jt(p,i,a);let u=es(n);return{elements:p,appState:{...t,...De({editingGroupId:t.editingGroupId,selectedElementIds:u.reduce(((e,t)=>(Zt(t)||(e[t.id]=!0),e)),{})},At(p),t,null)}}},oh=new Set(["command_palette","export"]),dh=(e,t,s,n)=>{try{if(typeof window>"u"||vc.VITE_WORKER_ID||"true"!==vc.VITE_APP_ENABLE_TRACKING||!oh.has(e)||vc.DEV)return;vc.PROD||console.info("trackEvent",{category:e,action:t,label:s,value:n}),window.sa_event&&window.sa_event(t,{category:e,label:s,value:n})}catch(e){console.error("error during analytics",e)}},ch=Lc(((e,t)=>{let{title:s,className:n,testId:i,active:a,standalone:l,icon:r,onClick:o}=e;return gp.exports.jsx("button",{type:"button",ref:t,title:s,"data-testid":i,className:Vc(n,{standalone:l,active:a}),onClick:o,children:r},s)})),ph=e=>gp.exports.jsx("div",{className:"buttonList",children:e.options.map((t=>"button"===e.type?gp.exports.jsx(ch,{icon:t.icon,title:t.text,testId:t.testId,active:t.active??e.value===t.value,onClick:s=>e.onClick(t.value,s)},t.text):gp.exports.jsxs("label",{className:Vc({active:e.value===t.value}),title:t.text,children:[gp.exports.jsx("input",{type:"radio",name:e.group,onChange:()=>e.onChange(t.value),checked:e.value===t.value,"data-testid":t.testId}),t.icon]},t.text)))}),hh=({onChange:e,type:t,activeColor:s,topPicks:n})=>{let i;return"elementStroke"===t&&(i=ns),"elementBackground"===t&&(i=as),"canvasBackground"===t&&(i=Us),n&&(i=n),i?gp.exports.jsx("div",{className:"color-picker__top-picks",children:i.map((t=>gp.exports.jsx("button",{className:Vc("color-picker__button",{active:t===s,"is-transparent":"transparent"===t||!t}),style:{"--swatch-color":t},type:"button",title:t,onClick:()=>e(t),"data-testid":`color-top-pick-${t}`,children:gp.exports.jsx("div",{className:"color-picker__button-outline"})},t)))}):(console.error("Invalid type for TopPicks"),null)},gh=()=>gp.exports.jsx("div",{style:{width:1,height:"1rem",backgroundColor:"var(--default-border-color)",margin:"0 auto"}}),fh=({palette:e,color:t})=>{for(let[s,n]of Object.entries(e))if(Array.isArray(n)){let e=n.indexOf(t);if(e>-1)return{colorName:s,shade:e}}else if(n===t)return{colorName:s,shade:null};return null},bh=[["q","w","e","r","t"],["a","s","d","f","g"],["z","x","c","v","b"]].flat(),Eh=({color:e,palette:t})=>!Object.values(t).flat().includes(e),yh=Gc(null),wh=(e,t,s)=>(299*e+587*t+114*s)/1e3>=160?"black":"white",Sh=(e,t)=>{if(t){let t=(new Option).style;if(t.color=e,t.color){let e=t.color.replace(/^(rgb|rgba)\(/,"").replace(/\)$/,"").replace(/\s/g,"").split(","),s=parseInt(e[0]),n=parseInt(e[1]),i=parseInt(e[2]);return wh(s,n,i)}}if("transparent"===e)return"black";let s=parseInt(e.substring(1,3),16),n=parseInt(e.substring(3,5),16),i=parseInt(e.substring(5,7),16);return wh(s,n,i)},Ch=({color:e,keyLabel:t,isCustomColor:s=!1,isShade:n=!1})=>gp.exports.jsxs("div",{className:"color-picker__button__hotkey-label",style:{color:Sh(e,s)},children:[n&&"⇧",t]}),Ih=({hex:e,onChange:t,palette:s})=>{let n=fh({color:e||"transparent",palette:s}),[i,a]=fp(yh),l=jc(null);if(Dc((()=>{l.current&&"shades"===i&&l.current.focus()}),[n,i]),n){let{colorName:e,shade:r}=n,o=s[e];if(Array.isArray(o))return gp.exports.jsx("div",{className:"color-picker-content--default shades",children:o.map(((s,n)=>gp.exports.jsxs("button",{ref:n===r&&"shades"===i?l:void 0,tabIndex:-1,type:"button",className:Vc("color-picker__button color-picker__button--large",{active:n===r}),"aria-label":"Shade",title:`${e} - ${n+1}`,style:s?{"--swatch-color":s}:void 0,onClick:()=>{t(s),a("shades")},children:[gp.exports.jsx("div",{className:"color-picker__button-outline"}),gp.exports.jsx(Ch,{color:s,keyLabel:n+1,isShade:!0})]},n)))})}return gp.exports.jsxs("div",{className:"color-picker-content--default",style:{position:"relative"},tabIndex:-1,children:[gp.exports.jsx("button",{type:"button",tabIndex:-1,className:"color-picker__button color-picker__button--large color-picker__button--no-focus-visible"}),gp.exports.jsx("div",{tabIndex:-1,style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:"0.75rem"},children:Np("colorPicker.noShades")})]})},Th=({palette:e,color:t,onChange:s,label:n,activeShade:i})=>{let a=fh({color:t||"transparent",palette:e}),[l,r]=fp(yh),o=jc(null);return Dc((()=>{o.current&&"baseColors"===l&&o.current.focus()}),[a?.colorName,l]),gp.exports.jsx("div",{className:"color-picker-content--default",children:Object.entries(e).map((([e,t],n)=>{let l=(Array.isArray(t)?t[i]:t)||"transparent",d=bh[n],c=Np(`colors.${e.replace(/\d+/,"")}`,null,"");return gp.exports.jsxs("button",{ref:a?.colorName===e?o:void 0,tabIndex:-1,type:"button",className:Vc("color-picker__button color-picker__button--large",{active:a?.colorName===e,"is-transparent":"transparent"===l||!l}),onClick:()=>{s(l),r("baseColors")},title:`${c}${l.startsWith("#")?` ${l}`:""} — ${d}`,"aria-label":`${c} — ${d}`,style:l?{"--swatch-color":l}:void 0,"data-testid":`color-${e}`,children:[gp.exports.jsx("div",{className:"color-picker__button-outline"}),gp.exports.jsx(Ch,{color:l,keyLabel:d})]},e)}))})},Dh=({colors:e,color:t,onChange:s,label:n})=>{let[i,a]=fp(yh),l=jc(null);return Dc((()=>{l.current&&l.current.focus()}),[t,i]),gp.exports.jsx("div",{className:"color-picker-content--default",children:e.map(((e,i)=>gp.exports.jsxs("button",{ref:t===e?l:void 0,tabIndex:-1,type:"button",className:Vc("color-picker__button color-picker__button--large",{active:t===e,"is-transparent":"transparent"===e||!e}),onClick:()=>{s(e),a("custom")},title:e,"aria-label":n,style:{"--swatch-color":e},children:[gp.exports.jsx("div",{className:"color-picker__button-outline"}),gp.exports.jsx(Ch,{color:e,keyLabel:i+1,isCustomColor:!0})]},i)))})},Lh=(e,t,s)=>{let n=Math.ceil(s/mc);switch(t=t??-1,e){case"ArrowLeft":{let e=t-1;return e<0?s-1:e}case"ArrowRight":return(t+1)%s;case"ArrowDown":{let e=t+mc;return e>=s?t%mc:e}case"ArrowUp":{let e=t-mc,i=e<0?mc*n+e:e;return i>=s?void 0:i}}},Nh=({event:e,activeColorPickerSection:t,palette:s,color:n,onChange:i,customColors:a,setActiveColorPickerSection:l,updateData:r,activeShade:o,onEyeDropperToggle:d,onEscape:c})=>{if(e[j.CTRL_OR_CMD])return!1;if(e.key===j.ESCAPE)return c(e),!0;if(e.key===j.ALT)return d(!0),!0;if(e.key===j.I)return d(),!0;let p=fh({color:n,palette:s});if(e.key===j.TAB){let r={custom:!!a.length,baseColors:!0,shades:null!=p?.shade,hex:!0},o=Object.entries(r).reduce(((e,[t,s])=>(s&&e.push(t),e)),[]),d=o.indexOf(t),c=e.shiftKey?-1:1,h=o[d+c>o.length-1?0:d+c<0?o.length-1:d+c];return h&&l(h),"custom"===h?i(a[0]):"baseColors"===h&&(Object.entries(s).find((([e,t])=>Array.isArray(t)?t.includes(n):t===n?e:null))||i(re.black)),e.preventDefault(),e.stopPropagation(),!0}if((({e:e,colorObj:t,onChange:s,palette:n,customColors:i,setActiveColorPickerSection:a,activeShade:l})=>{if(null!=t?.shade&&["Digit1","Digit2","Digit3","Digit4","Digit5"].includes(e.code)&&e.shiftKey){let i=Number(e.code.slice(-1))-1;return s(n[t.colorName][i]),a("shades"),!0}if(["1","2","3","4","5"].includes(e.key)&&i[Number(e.key)-1])return s(i[Number(e.key)-1]),a("custom"),!0;if(bh.includes(e.key)){let t=bh.indexOf(e.key),i=n[Object.keys(n)[t]];return s(Array.isArray(i)?i[l]:i),a("baseColors"),!0}return!1})({e:e,colorObj:p,onChange:i,palette:s,customColors:a,setActiveColorPickerSection:l,activeShade:o}))return!0;if("shades"===t&&p){let{shade:t}=p,n=Lh(e.key,t,mc);if(void 0!==n)return i(s[p.colorName][n]),!0}if("baseColors"===t&&p){let{colorName:t}=p,n=Object.keys(s),a=n.indexOf(t),l=Lh(e.key,a,n.length);if(void 0!==l){let e=s[n[l]];return i(Array.isArray(e)?e[o]:e),!0}}if("custom"===t){let t=a.indexOf(n),s=Lh(e.key,t,a.length);if(void 0!==s){return i(a[s]),!0}}return!1},_h=({children:e})=>gp.exports.jsx("div",{className:"color-picker__heading",children:e}),Ph=({color:e,onChange:t,label:s,type:n,elements:i,palette:a,updateData:l,children:r,onEyeDropperToggle:o,onEscape:d})=>{let[c]=Tc.useState((()=>"canvasBackground"===n?[]:((e,t,s)=>{let n={elementBackground:"backgroundColor",elementStroke:"strokeColor"},i=e.filter((e=>{if(e.isDeleted)return!1;let i=e[n[t]];return Eh({color:i,palette:s})})),a=new Map;return i.forEach((e=>{let s=e[n[t]];a.has(s)?a.set(s,a.get(s)+1):a.set(s,1)})),[...a.entries()].sort(((e,t)=>t[1]-e[1])).map((e=>e[0])).slice(0,dc)})(i,n,a))),[p,h]=fp(yh),m=fh({color:e,palette:a});Dc((()=>{if(!p){let t=Eh({color:e,palette:a}),s=t&&!c.includes(e);h(s?"hex":t?"custom":null!=m?.shade?"shades":"baseColors")}}),[p,e,a,h,m,c]);let[u,g]=Mc(m?.shade??("elementBackground"===n?Ud:Hd));Dc((()=>{null!=m?.shade&&g(m.shade);let e=e=>{e.key===j.ALT&&o(!1)};return document.addEventListener("keyup",e,{capture:!0}),()=>{document.removeEventListener("keyup",e,{capture:!0})}}),[m,o]);let x=Tc.useRef(null);return gp.exports.jsx("div",{role:"dialog","aria-modal":"true","aria-label":Np("labels.colorPicker"),children:gp.exports.jsxs("div",{ref:x,onKeyDown:s=>{Nh({event:s,activeColorPickerSection:p,palette:a,color:e,onChange:t,onEyeDropperToggle:o,customColors:c,setActiveColorPickerSection:h,updateData:l,activeShade:u,onEscape:d})&&(s.preventDefault(),s.stopPropagation())},className:"color-picker-content properties-content",tabIndex:-1,children:[!!c.length&&gp.exports.jsxs("div",{children:[gp.exports.jsx(_h,{children:Np("colorPicker.mostUsedCustomColors")}),gp.exports.jsx(Dh,{colors:c,color:e,label:Np("colorPicker.mostUsedCustomColors"),onChange:t})]}),gp.exports.jsxs("div",{children:[gp.exports.jsx(_h,{children:Np("colorPicker.colors")}),gp.exports.jsx(Th,{color:e,label:s,palette:a,onChange:t,activeShade:u})]}),gp.exports.jsxs("div",{children:[gp.exports.jsx(_h,{children:Np("colorPicker.shades")}),gp.exports.jsx(Ih,{hex:e,onChange:t,palette:a})]}),r]})})},Rh=Tc.createContext(null),Oh=()=>Tc.useContext(Rh),Fh=e=>{let[t,s]=Mc(null),n=Jy(),{theme:i}=Oh(),{container:a}=ev();return Rc((()=>{t&&(t.className="",t.classList.add("excalidraw",...e?.className?.split(/\s+/)||[]),t.classList.toggle("excalidraw--mobile",n.editor.isMobile),t.classList.toggle("theme--dark",i===X.DARK))}),[t,i,n.editor.isMobile,e?.className]),Rc((()=>{let t=e?.parentSelector?a?.querySelector(e.parentSelector):document.body;if(!t)return;let n=document.createElement("div");return t.appendChild(n),s(n),()=>{t.removeChild(n)}}),[a,e?.parentSelector]),t};function Bh(e,t,s){Dc((()=>{function n(n){let i=n;if(!e.current)return;let a=s?.(i,e.current);return!0!==a?!1===a?t(i):void(e.current.contains(i.target)||!document.documentElement.contains(i.target)||i.target.closest("[data-radix-portal]")||i.target===document.documentElement&&"none"===document.body.style.pointerEvents||i.target.closest("[data-prevent-outside-click]")||t(i)):void 0}return document.addEventListener("pointerdown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("pointerdown",n),document.removeEventListener("touchstart",n)}}),[e,t,s])}var zh=e=>{let t=jc(e);return Object.assign(t.current,e),t.current},Uh=Gc(null),Hh=({onCancel:e,onChange:t,onSelect:s,colorPickerType:n})=>{let i=Fh({className:"excalidraw-eye-dropper-backdrop",parentSelector:".excalidraw-eye-dropper-container"}),a=Oh(),l=tv(),r=qy(),o=S(l,a),d=zh({app:r,onCancel:e,onChange:t,onSelect:s,selectedElements:o}),{container:c}=ev();Dc((()=>{let e=p.current;if(!e||!r.canvas||!i)return;let t=!1,s=r.canvas.getContext("2d"),l=({clientX:e,clientY:t})=>{let n=s.getImageData((e-a.offsetLeft)*window.devicePixelRatio,(t-a.offsetTop)*window.devicePixelRatio,1,1).data;return Yd(n[0],n[1],n[2])},o=({clientX:s,clientY:i,altKey:a})=>{e.style.top=`${i+20}px`,e.style.left=`${s+20}px`;let r=l({clientX:s,clientY:i});t&&d.onChange(n,r,d.selectedElements,{altKey:a}),e.style.background=r},h=()=>{d.onCancel()},m=e=>{t=!0,e.stopImmediatePropagation()},u=e=>{t=!1,c?.focus(),e.stopImmediatePropagation(),e.preventDefault(),((e,t)=>{d.onSelect(e,t)})(l(e),e)},g=e=>{e.key===j.ESCAPE&&(e.preventDefault(),e.stopImmediatePropagation(),h())};return i.tabIndex=-1,i.focus(),o({clientX:d.app.lastViewportPosition.x,clientY:d.app.lastViewportPosition.y,altKey:!1}),i.addEventListener("keydown",g),i.addEventListener("pointerdown",m),i.addEventListener("pointerup",u),window.addEventListener("pointermove",o,{passive:!0}),window.addEventListener("blur",h),()=>{t=!1,i.removeEventListener("keydown",g),i.removeEventListener("pointerdown",m),i.removeEventListener("pointerup",u),window.removeEventListener("pointermove",o),window.removeEventListener("blur",h)}}),[d,r.canvas,i,n,c,a.offsetLeft,a.offsetTop]);let p=jc(null);return Bh(p,(()=>{e()}),(e=>!!e.target.closest(".excalidraw-eye-dropper-trigger, .excalidraw-eye-dropper-backdrop"))),i?Zc(gp.exports.jsx("div",{ref:p,className:"excalidraw-eye-dropper-preview"}),i):null},Yh=({color:e,onChange:t,label:s,colorPickerType:n})=>{let i=Jy(),[a,l]=Mc(e),[r,o]=fp(yh);Dc((()=>{l(e)}),[e]);let d=Ac((e=>{let s=e.toLowerCase(),n=Kh(s);n&&t(n),l(s)}),[t]),c=jc(null),p=jc(null);Dc((()=>{c.current&&c.current.focus()}),[r]);let[h,m]=fp(Uh);return Dc((()=>()=>{m(null)}),[m]),gp.exports.jsxs("div",{className:"color-picker__input-label",children:[gp.exports.jsx("div",{className:"color-picker__input-hash",children:"#"}),gp.exports.jsx("input",{ref:"hex"===r?c:void 0,style:{border:0,padding:0},spellCheck:!1,className:"color-picker-input","aria-label":s,onChange:e=>{d(e.target.value)},value:(a||"").replace(/^#/,""),onBlur:()=>{l(e)},tabIndex:-1,onFocus:()=>o("hex"),onKeyDown:e=>{e.key!==j.TAB&&(e.key===j.ESCAPE&&p.current?.focus(),e.stopPropagation())}}),!i.editor.isMobile&&gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsx("div",{style:{width:"1px",height:"1.25rem",backgroundColor:"var(--default-border-color)"}}),gp.exports.jsx("div",{ref:p,className:Vc("excalidraw-eye-dropper-trigger",{selected:h}),onClick:()=>m((e=>e?null:{keepOpenOnAlt:!1,onSelect:e=>t(e),colorPickerType:n})),title:`${Np("labels.eyeDropper")} — ${j.I.toLocaleUpperCase()} or ${x("Alt")} `,children:Gd})]})]})},Gh=Tc.forwardRef((({children:e,padding:t,className:s,style:n},i)=>gp.exports.jsx("div",{className:Vc("Island",s),style:{"--padding":t,...n},ref:i,children:e}))),Vh=Tc.forwardRef((({className:e,container:s,children:n,style:i,onClose:a,onKeyDown:l,onFocusOutside:r,onPointerLeave:o,onPointerDownOutside:d},c)=>{let p=Jy();return gp.exports.jsx(Jc,{container:s,children:gp.exports.jsxs(ep,{ref:c,className:Vc("focus-visible-none",e),"data-prevent-outside-click":!0,side:p.editor.isMobile&&!p.viewport.isLandscape?"bottom":"right",align:p.editor.isMobile&&!p.viewport.isLandscape?"center":"start",alignOffset:-16,sideOffset:20,style:{zIndex:"var(--zIndex-popup)"},onPointerLeave:o,onKeyDown:l,onFocusOutside:r,onPointerDownOutside:d,onCloseAutoFocus:e=>{e.stopPropagation(),e.preventDefault(),s&&!t(document.activeElement)&&s.focus(),a()},children:[gp.exports.jsx(Gh,{padding:3,style:i,children:n}),gp.exports.jsx(tp,{width:20,height:10,style:{fill:"var(--popup-bg-color)",filter:"drop-shadow(rgba(0, 0, 0, 0.05) 0px 3px 2px)"}})]})})})),Wh=e=>{let t=(new Option).style;return t.color=e,!!t.color},Kh=e=>jl(e)?e:Wh(`#${e}`)?`#${e}`:Wh(e)?e:null,Zh=({type:e,color:t,onChange:s,label:n,elements:i,palette:a=re,updateData:l})=>{let{container:r}=ev(),[,o]=fp(yh),[d,c]=fp(Uh),p=gp.exports.jsxs("div",{children:[gp.exports.jsx(_h,{children:Np("colorPicker.hexCode")}),gp.exports.jsx(Yh,{color:t,label:n,onChange:e=>{s(e)},colorPickerType:e})]}),h=jc(null);return gp.exports.jsx(Vh,{container:r,style:{maxWidth:"13rem"},onFocusOutside:e=>{h.current?.querySelector(".color-picker-content")?.focus(),e.preventDefault()},onPointerDownOutside:e=>{d&&e.preventDefault()},onClose:()=>{l({openPopup:null}),o(null)},children:a?gp.exports.jsx(Ph,{palette:a,color:t,onChange:e=>{s(e)},onEyeDropperToggle:t=>{c((n=>t?((n=n||{keepOpenOnAlt:!0,onSelect:s,colorPickerType:e}).keepOpenOnAlt=!0,n):!1===t||n?null:{keepOpenOnAlt:!1,onSelect:s,colorPickerType:e}))},onEscape:e=>{d?c(null):l({openPopup:null})},label:n,type:e,elements:i,updateData:l,children:p}):p})},Xh=({label:e,color:t,type:s})=>gp.exports.jsx(np,{type:"button",className:Vc("color-picker__button active-color properties-trigger",{"is-transparent":"transparent"===t||!t}),"aria-label":e,style:t?{"--swatch-color":t}:void 0,title:Np("elementStroke"===s?"labels.showStroke":"labels.showBackground"),children:gp.exports.jsx("div",{className:"color-picker__button-outline"})}),qh=({type:e,color:t,onChange:s,label:n,elements:i,palette:a=re,topPicks:l,updateData:r,appState:o})=>gp.exports.jsx("div",{children:gp.exports.jsxs("div",{role:"dialog","aria-modal":"true",className:"color-picker-container",children:[gp.exports.jsx(hh,{activeColor:t,onChange:s,type:e,topPicks:l}),gp.exports.jsx(gh,{}),gp.exports.jsxs(sp,{open:o.openPopup===e,onOpenChange:t=>{r({openPopup:t?e:null})},children:[gp.exports.jsx(Xh,{color:t,label:n,type:e}),o.openPopup===e&&gp.exports.jsx(Zh,{type:e,color:t,onChange:s,label:n,elements:i,palette:a,updateData:r})]})]})}),Qh=({icon:e})=>gp.exports.jsx("span",{style:{width:"1em",margin:"0 0.5ex 0 0.5ex",display:"inline-block",lineHeight:0,verticalAlign:"middle"},children:e}),em=({label:e,open:t,openTrigger:s,children:n,className:i})=>gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsxs("div",{style:{cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center"},className:i,onClick:s,children:[e,gp.exports.jsx(Qh,{icon:t?Br:zr})]}),t&&gp.exports.jsx("div",{style:{display:"flex",flexDirection:"column"},children:n})]}),tm=Gc(!1);function sm({options:e,value:t,label:s,onChange:n,onClose:i,numberOfOptionsToAlwaysShow:a=e.length}){let l=Jy(),[r,o]=fp(tm),d=Tc.useMemo((()=>e.slice(0,a)),[e,a]),c=Tc.useMemo((()=>e.slice(a)),[e,a]);Dc((()=>{d.some((e=>e.value===t))||o(!0)}),[t,d,o]);let p=e=>gp.exports.jsx("div",{className:"picker-content",children:e.map(((e,s)=>gp.exports.jsxs("button",{type:"button",className:Vc("picker-option",{active:t===e.value}),onClick:t=>{n(e.value)},title:`${e.text} ${e.keyBinding&&`— ${e.keyBinding.toUpperCase()}`}`,"aria-label":e.text||"none","aria-keyshortcuts":e.keyBinding||void 0,ref:s=>{t===e.value&&setTimeout((()=>{s?.focus()}),0)},children:[e.icon,e.keyBinding&&gp.exports.jsx("span",{className:"picker-keybinding",children:e.keyBinding})]},e.text)))});return gp.exports.jsx(ep,{side:l.editor.isMobile&&!l.viewport.isLandscape?"top":"bottom",align:"start",sideOffset:12,style:{zIndex:"var(--zIndex-popup)"},onKeyDown:s=>{let l=e.find((e=>e.keyBinding===s.key.toLowerCase()));if(s.metaKey||s.altKey||s.ctrlKey||!l)if(s.key===j.TAB){let i=e.findIndex((e=>e.value===t)),a=s.shiftKey?(e.length+i-1)%e.length:(i+1)%e.length;n(e[a].value)}else if(gl(s.key)){let i=Dp().rtl,l=e.findIndex((e=>e.value===t));if(-1!==l){let t=e.length,r=l;switch(s.key){case i?j.ARROW_LEFT:j.ARROW_RIGHT:r=(l+1)%t;break;case i?j.ARROW_RIGHT:j.ARROW_LEFT:r=(t+l-1)%t;break;case j.ARROW_DOWN:r=(l+(a??1))%t;break;case j.ARROW_UP:r=(t+l-(a??1))%t}n(e[r].value)}s.preventDefault()}else(s.key===j.ESCAPE||s.key===j.ENTER)&&(s.preventDefault(),i());else n(l.value),s.preventDefault();s.nativeEvent.stopImmediatePropagation(),s.stopPropagation()},children:gp.exports.jsxs("div",{className:"picker",role:"dialog","aria-modal":"true","aria-label":s,children:[p(d),c.length>0&&gp.exports.jsx(em,{label:Np("labels.more_options"),open:r,openTrigger:()=>{o((e=>!e))},className:"picker-collapsible",children:p(c)})]})})}function nm({value:e,label:t,options:s,onChange:n,group:i="",numberOfOptionsToAlwaysShow:a}){let[l,r]=Tc.useState(!1),o=Tc.useRef(null);return gp.exports.jsx("div",{children:gp.exports.jsxs(sp,{open:l,onOpenChange:e=>r(e),children:[gp.exports.jsx(np,{name:i,type:"button","aria-label":t,onClick:()=>r(!l),ref:o,className:l?"active":"",children:s.find((t=>t.value===e))?.icon}),l&&gp.exports.jsx(sm,{options:s,value:e,label:t,onChange:n,onClose:()=>{r(!1)},numberOfOptionsToAlwaysShow:a})]})})}var im=Tc.forwardRef((({className:e,placeholder:t,onChange:n},i)=>gp.exports.jsxs("div",{className:Vc("QuickSearch__wrapper",e),children:[s,gp.exports.jsx("input",{ref:i,className:"QuickSearch__input",type:"text",placeholder:t,onChange:e=>n(e.target.value.trim().toLowerCase())})]}))),am=({className:e,placeholder:t,children:s})=>{let n=!zc.count(s);return gp.exports.jsx("div",{className:Vc("ScrollableList__wrapper",e),role:"menu",children:n?gp.exports.jsx("div",{className:"empty",children:t}):s})},lm=({children:e,className:t="",style:s,title:n})=>gp.exports.jsxs("div",{className:`dropdown-menu-group ${t}`,style:s,children:[n&&gp.exports.jsx("p",{className:"dropdown-menu-group-title",children:n}),e]}),rm=lm;lm.displayName="DropdownMenuGroup";var om=Tc.createContext({}),dm=(e="",t=!1,s=!1)=>`dropdown-menu-item dropdown-menu-item-base ${e}\n  ${t?"dropdown-menu-item--selected":""} ${s?"dropdown-menu-item--hovered":""}`.trim(),cm=(e,t)=>{let s=Bc(om);return Hi(e,(e=>{let n=new CustomEvent("menu.itemSelect",{bubbles:!0,cancelable:!0});t?.(n),n.defaultPrevented||s.onSelect?.(n)}))},pm=({textStyle:e,icon:t,shortcut:s,children:n})=>{let i=Jy();return gp.exports.jsxs(gp.exports.Fragment,{children:[t&&gp.exports.jsx("div",{className:"dropdown-menu-item__icon",children:t}),gp.exports.jsx("div",{style:e,className:"dropdown-menu-item__text",children:n}),s&&!i.editor.isMobile&&gp.exports.jsx("div",{className:"dropdown-menu-item__shortcut",children:s})]})},hm=({icon:e,value:t,order:s,children:n,shortcut:i,className:a,hovered:l,selected:r,textStyle:o,onSelect:d,onClick:c,...p})=>{let h=cm(c,d),m=jc(null);return Dc((()=>{l&&(0===s?m.current?.scrollIntoView({block:"end"}):m.current?.scrollIntoView({block:"nearest"}))}),[l,s]),gp.exports.jsx("button",{...p,ref:m,value:t,onClick:h,className:dm(a,r,l),title:p.title??p["aria-label"],children:gp.exports.jsx(pm,{textStyle:o,icon:e,shortcut:i,children:n})})};hm.displayName="DropdownMenuItem";var mm="green",um="red",gm="blue",xm=({type:e=gm,children:t})=>{let{theme:s}=sv(),n={display:"inline-flex",marginLeft:"auto",padding:"2px 4px",borderRadius:6,fontSize:9,fontFamily:"Cascadia, monospace",border:s===X.LIGHT?"1.5px solid white":"none"};switch(e){case mm:Object.assign(n,{backgroundColor:"var(--background-color-badge)",color:"var(--color-badge)"});break;case um:Object.assign(n,{backgroundColor:"pink",color:"darkred"});break;default:Object.assign(n,{background:"var(--color-promo)",color:"var(--color-surface-lowest)"})}return gp.exports.jsx("div",{className:"DropDownMenuItemBadge",style:n,children:t})};xm.displayName="DropdownMenuItemBadge",hm.Badge=xm;var fm=hm,bm=Tc.memo((({selectedFontFamily:e,hoveredFontFamily:t,onSelect:s,onHover:r,onLeave:o,onOpen:d,onClose:c})=>{let{container:p}=ev(),{fonts:h}=qy(),{showDeprecatedFonts:m}=Qy(),[u,g]=Mc(""),x=jc(null),f=Nc((()=>Array.from(n.registered.entries()).filter((([e,{metadata:t}])=>!t.serverSide&&!t.fallback)).map((([e,{metadata:t,fontFaces:s}])=>{let n={value:e,icon:t.icon??i,text:s[0]?.fontFace?.family??"Unknown"};return t.deprecated&&Object.assign(n,{deprecated:t.deprecated,badge:{type:um,placeholder:Np("fontList.badge.old")}}),n})).sort(((e,t)=>e.text.toLowerCase()>t.text.toLowerCase()?1:-1))),[]),b=Nc((()=>new Set(h.getSceneFamilies())),[e]),E=Nc((()=>f.filter((e=>b.has(e.value)))),[f,b]),y=Nc((()=>f.filter((e=>!b.has(e.value)&&(m||!e.deprecated)))),[f,b,m]),v=Nc((()=>a([...E,...y].filter((e=>e.text?.toLowerCase().includes(u))))),[E,y,u]),w=Nc((()=>{let s;return t?s=v.find((e=>e.value===t)):e&&(s=v.find((t=>t.value===e))),!s&&u&&(v[0]?.value?r(v[0].value):o()),s}),[t,e,u,v,r,o]),S=Ac((e=>{(({event:e,inputRef:t,hoveredFont:s,filteredFonts:n,onClose:i,onSelect:a,onHover:l})=>!e[j.CTRL_OR_CMD]&&e.shiftKey&&e.key.toLowerCase()===j.F?(t.current?.focus(),!0):e.key===j.ESCAPE?(i(),!0):e.key===j.ENTER?(s?.value&&a(s.value),!0):e.key===j.ARROW_DOWN?(s?.next?l(s.next.value):n[0]?.value&&l(n[0].value),!0):e.key===j.ARROW_UP?(s?.prev?l(s.prev.value):n[n.length-1]?.value&&l(n[n.length-1].value),!0):void 0)({event:e,inputRef:x,hoveredFont:w,filteredFonts:v,onSelect:s,onHover:r,onClose:c})&&(e.preventDefault(),e.stopPropagation())}),[w,v,s,r,c]);Dc((()=>(d(),()=>{c()})),[]);let C=Nc((()=>v.filter((e=>b.has(e.value)))),[v,b]),I=Nc((()=>v.filter((e=>!b.has(e.value)))),[v,b]),k=(t,n)=>gp.exports.jsxs(fm,{icon:t.icon,value:t.value,order:n,textStyle:{fontFamily:ts({fontFamily:t.value})},hovered:t.value===w?.value,selected:t.value===e,tabIndex:t.value===e?0:-1,onClick:e=>{s(Number(e.currentTarget.value))},onMouseMove:()=>{w?.value!==t.value&&r(t.value)},children:[t.text,t.badge&&gp.exports.jsx(xm,{type:t.badge.type,children:t.badge.placeholder})]},t.value),T=[];return C.length&&T.push(gp.exports.jsx(rm,{title:Np("fontList.sceneFonts"),children:C.map(k)},"group_1")),I.length&&T.push(gp.exports.jsx(rm,{title:Np("fontList.availableFonts"),children:I.map(((e,t)=>k(e,t+C.length)))},"group_2")),gp.exports.jsxs(Vh,{className:"properties-content",container:p,style:{width:"15rem"},onClose:c,onPointerLeave:o,onKeyDown:S,children:[gp.exports.jsx(im,{ref:x,placeholder:Np("quickSearch.placeholder"),onChange:l(g,20)}),gp.exports.jsx(am,{className:"dropdown-menu fonts manual-hover",placeholder:Np("fontList.empty"),children:T.length?T:null})]})}),((e,t)=>e.selectedFontFamily===t.selectedFontFamily&&e.hoveredFontFamily===t.hoveredFontFamily)),Em=({selectedFontFamily:e})=>{let t=Nc((()=>!(!e||wm(e))),[e]);return gp.exports.jsx(np,{asChild:!0,children:gp.exports.jsx("div",{children:gp.exports.jsx(ch,{standalone:!0,icon:ss,title:Np("labels.showFonts"),className:"properties-trigger",testId:"font-family-show-fonts",active:t,onClick:()=>{}})})})},ym=[{value:r.Excalifont,icon:o,text:Np("labels.handDrawn"),testId:"font-family-hand-drawn"},{value:r.Nunito,icon:i,text:Np("labels.normal"),testId:"font-family-normal"},{value:r["Comic Shanns"],icon:d,text:Np("labels.code"),testId:"font-family-code"}],vm=new Set(ym.map((e=>e.value))),wm=e=>!!e&&vm.has(e),Sm=Tc.memo((({isOpened:e,selectedFontFamily:t,hoveredFontFamily:s,onSelect:n,onHover:i,onLeave:a,onPopupChange:l})=>{let r=Nc((()=>ym),[]),o=Ac((e=>{e&&n(e)}),[n]);return gp.exports.jsxs("div",{role:"dialog","aria-modal":"true",className:"FontPicker__container",children:[gp.exports.jsx(ph,{type:"button",options:r,value:t,onClick:o}),gp.exports.jsx(gh,{}),gp.exports.jsxs(sp,{open:e,onOpenChange:l,children:[gp.exports.jsx(Em,{selectedFontFamily:t}),e&&gp.exports.jsx(bm,{selectedFontFamily:t,hoveredFontFamily:s,onSelect:o,onHover:i,onLeave:a,onOpen:()=>l(!0),onClose:()=>l(!1)})]})]})}),((e,t)=>e.isOpened===t.isOpened&&e.selectedFontFamily===t.selectedFontFamily&&e.hoveredFontFamily===t.hoveredFontFamily)),Cm=({updateData:e,appState:t,elements:s,testId:n})=>{let i=Tc.useRef(null),a=Tc.useRef(null),l=km(s,t,(e=>e.opacity),!0,t.currentItemOpacity);return Dc((()=>{if(i.current&&a.current){let e=i.current,t=a.current,s=e.offsetWidth,n=15,r=l/100*(s-n)+n/2;t.style.left=`${r}px`,e.style.background=`linear-gradient(to right, var(--color-slider-track) 0%, var(--color-slider-track) ${l}%, var(--button-bg) ${l}%, var(--button-bg) 100%)`}}),[l]),gp.exports.jsxs("label",{className:"control-label",children:[Np("labels.opacity"),gp.exports.jsxs("div",{className:"range-wrapper",children:[gp.exports.jsx("input",{ref:i,type:"range",min:"0",max:"100",step:"10",onChange:t=>{e(+t.target.value)},value:l,className:"range-input","data-testid":n}),gp.exports.jsx("div",{className:"value-bubble",ref:a,children:0!==l?l:null}),gp.exports.jsx("div",{className:"zero-label",children:"0"})]})]})},Im=(e,t,s,n=!1)=>{let i=Ht(S(e,t,{includeBoundTextElement:n}));return e.map((e=>i.get(e.id)||e.id===t.editingTextElement?.id?s(e):e))},km=function(e,t,s,n,i){let a=t.editingTextElement,l=At(e),r=null;return a&&(r=s(a)),r||(r=je(l,t)?Ur(!0===n?l:l.filter((e=>n(e))),t,s)??("function"==typeof i?i(!0):i):"function"==typeof i?i(!1):i),r},Tm=(e,t,s,n,i)=>{let a=new Set,l=Im(e,t,(e=>{if(tt(e)){let t=n(e);a.add(t);let i=Dt(e,{fontSize:t});return Is(i,s.scene.getContainerElement(e),s.scene.getNonDeletedElementsMap()),i=((e,t)=>Zt(t)||!t.autoResize?t:He(t,{x:"left"===e.textAlign?e.x:e.x+(e.width-t.width)/("center"===e.textAlign?2:1),y:e.y+(e.height-t.height)/2},!1))(e,i),i}return e}),!0),r=Ht(l);return S(e,t,{includeBoundTextElement:!0}).forEach((e=>{tt(e)&&yl(e,r)})),{elements:l,appState:{...t,currentItemFontSize:1===a.size?[...a][0]:i??t.currentItemFontSize},captureUpdate:Lt.IMMEDIATELY}};e({name:"changeStrokeColor",label:"labels.stroke",trackEvent:!1,perform:(e,t,s)=>({...s.currentItemStrokeColor&&{elements:Im(e,t,(e=>Yi(e.type)?Dt(e,{strokeColor:s.currentItemStrokeColor}):e),!0)},appState:{...t,...s},captureUpdate:s.currentItemStrokeColor?Lt.IMMEDIATELY:Lt.EVENTUALLY}),PanelComponent:({elements:e,appState:t,updateData:s,appProps:n})=>gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsx("h3",{"aria-hidden":"true",children:Np("labels.stroke")}),gp.exports.jsx(qh,{topPicks:ns,palette:is,type:"elementStroke",label:Np("labels.stroke"),color:km(e,t,(e=>e.strokeColor),!0,t.currentItemStrokeColor),onChange:e=>s({currentItemStrokeColor:e}),elements:e,appState:t,updateData:s})]})}),e({name:"changeBackgroundColor",label:"labels.changeBackground",trackEvent:!1,perform:(e,t,s)=>({...s.currentItemBackgroundColor&&{elements:Im(e,t,(e=>Dt(e,{backgroundColor:s.currentItemBackgroundColor})))},appState:{...t,...s},captureUpdate:s.currentItemBackgroundColor?Lt.IMMEDIATELY:Lt.EVENTUALLY}),PanelComponent:({elements:e,appState:t,updateData:s,appProps:n})=>gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsx("h3",{"aria-hidden":"true",children:Np("labels.background")}),gp.exports.jsx(qh,{topPicks:as,palette:ls,type:"elementBackground",label:Np("labels.background"),color:km(e,t,(e=>e.backgroundColor),!0,t.currentItemBackgroundColor),onChange:e=>s({currentItemBackgroundColor:e}),elements:e,appState:t,updateData:s})]})}),e({name:"changeFillStyle",label:"labels.fill",trackEvent:!1,perform:(e,t,s,n)=>(dh("element","changeFillStyle",`${s} (${n.device.editor.isMobile?"mobile":"desktop"})`),{elements:Im(e,t,(e=>Dt(e,{fillStyle:s}))),appState:{...t,currentItemFillStyle:s},captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s})=>{let n=S(e,t),i=n.length>0&&n.every((e=>"zigzag"===e.fillStyle));return gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.fill")}),gp.exports.jsx(ph,{type:"button",options:[{value:"hachure",text:`${Np(i?"labels.zigzag":"labels.hachure")} (${x("Alt-Click")})`,icon:i?rs:os,active:!!i||void 0,testId:"fill-hachure"},{value:"cross-hatch",text:Np("labels.crossHatch"),icon:ds,testId:"fill-cross-hatch"},{value:"solid",text:Np("labels.solid"),icon:cs,testId:"fill-solid"}],value:km(e,t,(e=>e.fillStyle),(e=>e.hasOwnProperty("fillStyle")),(e=>e?null:t.currentItemFillStyle)),onClick:(e,t)=>{let i=t.altKey&&"hachure"===e&&n.every((e=>"hachure"===e.fillStyle))?"zigzag":e;s(i)}})]})}}),e({name:"changeStrokeWidth",label:"labels.strokeWidth",trackEvent:!1,perform:(e,t,s)=>({elements:Im(e,t,(e=>Dt(e,{strokeWidth:s}))),appState:{...t,currentItemStrokeWidth:s},captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s})=>gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.strokeWidth")}),gp.exports.jsx(ph,{group:"stroke-width",options:[{value:ps.thin,text:Np("labels.thin"),icon:hs,testId:"strokeWidth-thin"},{value:ps.bold,text:Np("labels.bold"),icon:ms,testId:"strokeWidth-bold"},{value:ps.extraBold,text:Np("labels.extraBold"),icon:us,testId:"strokeWidth-extraBold"}],value:km(e,t,(e=>e.strokeWidth),(e=>e.hasOwnProperty("strokeWidth")),(e=>e?null:t.currentItemStrokeWidth)),onChange:e=>s(e)})]})}),e({name:"changeSloppiness",label:"labels.sloppiness",trackEvent:!1,perform:(e,t,s)=>({elements:Im(e,t,(e=>Dt(e,{seed:Hr(),roughness:s}))),appState:{...t,currentItemRoughness:s},captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s})=>gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.sloppiness")}),gp.exports.jsx(ph,{group:"sloppiness",options:[{value:0,text:Np("labels.architect"),icon:gs},{value:1,text:Np("labels.artist"),icon:xs},{value:2,text:Np("labels.cartoonist"),icon:fs}],value:km(e,t,(e=>e.roughness),(e=>e.hasOwnProperty("roughness")),(e=>e?null:t.currentItemRoughness)),onChange:e=>s(e)})]})}),e({name:"changeStrokeStyle",label:"labels.strokeStyle",trackEvent:!1,perform:(e,t,s)=>({elements:Im(e,t,(e=>Dt(e,{strokeStyle:s}))),appState:{...t,currentItemStrokeStyle:s},captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s})=>gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.strokeStyle")}),gp.exports.jsx(ph,{group:"strokeStyle",options:[{value:"solid",text:Np("labels.strokeStyle_solid"),icon:hs},{value:"dashed",text:Np("labels.strokeStyle_dashed"),icon:bs},{value:"dotted",text:Np("labels.strokeStyle_dotted"),icon:Es}],value:km(e,t,(e=>e.strokeStyle),(e=>e.hasOwnProperty("strokeStyle")),(e=>e?null:t.currentItemStrokeStyle)),onChange:e=>s(e)})]})}),e({name:"changeOpacity",label:"labels.opacity",trackEvent:!1,perform:(e,t,s)=>({elements:Im(e,t,(e=>Dt(e,{opacity:s})),!0),appState:{...t,currentItemOpacity:s},captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s})=>gp.exports.jsx(Cm,{updateData:s,elements:e,appState:t,testId:"opacity"})}),e({name:"changeFontSize",label:"labels.fontSize",trackEvent:!1,perform:(e,t,s,n)=>Tm(e,t,n,(()=>s),s),PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.fontSize")}),gp.exports.jsx(ph,{group:"font-size",options:[{value:16,text:Np("labels.small"),icon:ys,testId:"fontSize-small"},{value:20,text:Np("labels.medium"),icon:vs,testId:"fontSize-medium"},{value:28,text:Np("labels.large"),icon:ws,testId:"fontSize-large"},{value:36,text:Np("labels.veryLarge"),icon:Ss,testId:"fontSize-veryLarge"}],value:km(e,t,(e=>{if(tt(e))return e.fontSize;let t=Kt(e,n.scene.getNonDeletedElementsMap());return t?t.fontSize:null}),(e=>tt(e)||null!==Kt(e,n.scene.getNonDeletedElementsMap())),(e=>e?null:t.currentItemFontSize||vn)),onChange:e=>s(e)})]})});var Mm=e({name:"decreaseFontSize",label:"labels.decreaseFontSize",icon:Cs,trackEvent:!1,perform:(e,t,s,n)=>Tm(e,t,n,(e=>Math.round(1/1.1*e.fontSize))),keyTest:e=>e[j.CTRL_OR_CMD]&&e.shiftKey&&(e.key===j.CHEVRON_LEFT||e.key===j.COMMA)}),jm=e({name:"increaseFontSize",label:"labels.increaseFontSize",icon:Cs,trackEvent:!1,perform:(e,t,s,n)=>Tm(e,t,n,(e=>Math.round(1.1*e.fontSize))),keyTest:e=>e[j.CTRL_OR_CMD]&&e.shiftKey&&(e.key===j.CHEVRON_RIGHT||e.key===j.PERIOD)});e({name:"changeFontFamily",label:"labels.fontFamily",trackEvent:!1,perform:(e,t,s,i)=>{let{cachedElements:a,resetAll:l,resetContainers:o,...d}=s;if(l)return{elements:Im(e,t,(e=>{let t=a?.get(e.id);return t?Dt(e,{...t}):e}),!0),appState:{...t,...d},captureUpdate:Lt.NEVER};let c,{currentItemFontFamily:p,currentHoveredFontFamily:h}=s,m=Lt.EVENTUALLY,u=!1;if(p)c=p,m=Lt.IMMEDIATELY;else if(h){c=h,m=Lt.EVENTUALLY;let s=S(e,t,{includeBoundTextElement:!0}).filter((e=>tt(e)));if(s.length>200)u=!0;else{let e=0,t=0;for(;e<s.length&&t<5e3;){let n=s[e];t+=n?.originalText.length||0,e++}t>5e3&&(u=!0)}}let g={appState:{...t,...d},captureUpdate:m};if(c&&!u){let s=new Map,l=new Set,d=!1,m=Array.from(n.loadedFontsCache.values()),u=Object.entries(r).find((([e,t])=>t===c))?.[0];h&&u&&m.some((e=>e.startsWith(u)))&&(d=!0),Object.assign(g,{elements:Im(e,t,(e=>{if(tt(e)&&(e.fontFamily!==c||p)){let t=Dt(e,{fontFamily:c,lineHeight:Ke(c)}),n=a?.get(e.containerId||"")||{},r=i.scene.getContainerElement(e);return o&&r&&n&&He(r,{...n},!1),d||(l=new Set([...l,...Array.from(t.originalText)])),s.set(t,r),t}return e}),!0)});let x=`10px ${ts({fontFamily:c})}`,f=Array.from(l.values()).join();if(d||window.document.fonts.check(x,f))for(let[e,t]of s)Is(e,t,i.scene.getNonDeletedElementsMap(),!1);else window.document.fonts.load(x,f).then((e=>{for(let[e,t]of s){let s=i.scene.getElement(e.id),n=t?i.scene.getElement(t.id):null;s&&Is(s,n,i.scene.getNonDeletedElementsMap(),!1)}i.fonts.onLoaded(e)}))}return g},PanelComponent:({elements:e,appState:t,app:s,updateData:n})=>{let i=jc(new Map),a=jc(null),[l,r]=Mc({}),o=jc(!0),d=Nc((()=>{let n=(e,s)=>km(e,t,(e=>{if(tt(e))return e.fontFamily;let t=Kt(e,s);return t?t.fontFamily:null}),(e=>tt(e)||null!==Kt(e,s)),(e=>e?null:t.currentItemFontFamily||wn));return"fontFamily"===l.openPopup&&"fontFamily"===t.openPopup?n(Array.from(i.current?.values()??[]),i.current):l.openPopup||"fontFamily"===t.openPopup?a.current:n(e,s.scene.getNonDeletedElementsMap())}),[l.openPopup,t,e,s.scene]);return Dc((()=>{a.current=d}),[d]),Dc((()=>{Object.keys(l).length&&(n(l),r({}))}),[l]),Dc((()=>(o.current=!1,()=>{o.current=!0})),[]),gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.fontFamily")}),gp.exports.jsx(Sm,{isOpened:"fontFamily"===t.openPopup,selectedFontFamily:d,hoveredFontFamily:t.currentHoveredFontFamily,onSelect:e=>{r({openPopup:null,currentHoveredFontFamily:null,currentItemFontFamily:e}),i.current.clear()},onHover:e=>{r({currentHoveredFontFamily:e,cachedElements:new Map(i.current),resetContainers:!0})},onLeave:()=>{r({currentHoveredFontFamily:null,cachedElements:new Map(i.current),resetAll:!0})},onPopupChange:a=>{if(a){i.current.clear();let{editingTextElement:n}=t;if("text"===n?.type){let e=s.scene.getElement(n.id);i.current.set(n.id,Dt(e||n,{},!0))}else{let s=S(e,t,{includeBoundTextElement:!0});for(let e of s)i.current.set(e.id,Dt(e,{},!0))}r({openPopup:"fontFamily"})}else{let e={openPopup:null,currentHoveredFontFamily:null,cachedElements:new Map(i.current),resetAll:!0};o.current?n({...l,...e}):r(e),i.current.clear()}}})]})}}),e({name:"changeTextAlign",label:"Change text alignment",trackEvent:!1,perform:(e,t,s,n)=>({elements:Im(e,t,(e=>{if(tt(e)){let t=Dt(e,{textAlign:s});return Is(t,n.scene.getContainerElement(e),n.scene.getNonDeletedElementsMap()),t}return e}),!0),appState:{...t,currentItemTextAlign:s},captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>{let i=n.scene.getNonDeletedElementsMap();return gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.textAlign")}),gp.exports.jsx(ph,{group:"text-align",options:[{value:"left",text:Np("labels.left"),icon:ks,testId:"align-left"},{value:"center",text:Np("labels.center"),icon:Ts,testId:"align-horizontal-center"},{value:"right",text:Np("labels.right"),icon:Ms,testId:"align-right"}],value:km(e,t,(e=>{if(tt(e))return e.textAlign;let t=Kt(e,i);return t?t.textAlign:null}),(e=>tt(e)||null!==Kt(e,i)),(e=>e?null:t.currentItemTextAlign)),onChange:e=>s(e)})]})}}),e({name:"changeVerticalAlign",label:"Change vertical alignment",trackEvent:{category:"element"},perform:(e,t,s,n)=>({elements:Im(e,t,(e=>{if(tt(e)){let t=Dt(e,{verticalAlign:s});return Is(t,n.scene.getContainerElement(e),n.scene.getNonDeletedElementsMap()),t}return e}),!0),appState:{...t},captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsx("fieldset",{children:gp.exports.jsx(ph,{group:"text-align",options:[{value:js.TOP,text:Np("labels.alignTop"),icon:gp.exports.jsx(Ds,{theme:t.theme}),testId:"align-top"},{value:js.MIDDLE,text:Np("labels.centerVertically"),icon:gp.exports.jsx(Ls,{theme:t.theme}),testId:"align-middle"},{value:js.BOTTOM,text:Np("labels.alignBottom"),icon:gp.exports.jsx(Ns,{theme:t.theme}),testId:"align-bottom"}],value:km(e,t,(e=>{if(tt(e)&&e.containerId)return e.verticalAlign;let t=Kt(e,n.scene.getNonDeletedElementsMap());return t?t.verticalAlign:null}),(e=>tt(e)||null!==Kt(e,n.scene.getNonDeletedElementsMap())),(e=>e?null:js.MIDDLE)),onChange:e=>s(e)})})}),e({name:"changeRoundness",label:"Change edge roundness",trackEvent:!1,perform:(e,t,s)=>({elements:Im(e,t,(e=>V(e)?e:Dt(e,{roundness:"round"===s?{type:Et(e.type)?yt.ADAPTIVE_RADIUS:yt.PROPORTIONAL_RADIUS}:null}))),appState:{...t,currentItemRoundness:s},captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s})=>{let n=As(At(e),t).some((e=>e.roundness?.type===yt.LEGACY));return gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.edges")}),gp.exports.jsx(ph,{group:"edges",options:[{value:"sharp",text:Np("labels.sharp"),icon:_s},{value:"round",text:Np("labels.round"),icon:Ps}],value:km(e,t,(e=>n?null:e.roundness?"round":"sharp"),(e=>!ut(e)&&e.hasOwnProperty("roundness")),(e=>e?null:t.currentItemRoundness)),onChange:e=>s(e)})]})}});var Dm=e=>[{value:null,text:Np("labels.arrowhead_none"),keyBinding:"q",icon:Yr},{value:"arrow",text:Np("labels.arrowhead_arrow"),keyBinding:"w",icon:gp.exports.jsx(Gr,{flip:e})},{value:"triangle",text:Np("labels.arrowhead_triangle"),icon:gp.exports.jsx($r,{flip:e}),keyBinding:"e"},{value:"triangle_outline",text:Np("labels.arrowhead_triangle_outline"),icon:gp.exports.jsx(Vr,{flip:e}),keyBinding:"r"},{value:"circle",text:Np("labels.arrowhead_circle"),keyBinding:"a",icon:gp.exports.jsx(Wr,{flip:e})},{value:"circle_outline",text:Np("labels.arrowhead_circle_outline"),keyBinding:"s",icon:gp.exports.jsx(Kr,{flip:e})},{value:"diamond",text:Np("labels.arrowhead_diamond"),icon:gp.exports.jsx(Zr,{flip:e}),keyBinding:"d"},{value:"diamond_outline",text:Np("labels.arrowhead_diamond_outline"),icon:gp.exports.jsx(Xr,{flip:e}),keyBinding:"f"},{value:"bar",text:Np("labels.arrowhead_bar"),keyBinding:"z",icon:gp.exports.jsx(qr,{flip:e})},{value:"crowfoot_one",text:Np("labels.arrowhead_crowfoot_one"),icon:gp.exports.jsx(Qr,{flip:e}),keyBinding:"c"},{value:"crowfoot_many",text:Np("labels.arrowhead_crowfoot_many"),icon:gp.exports.jsx(Jr,{flip:e}),keyBinding:"x"},{value:"crowfoot_one_or_many",text:Np("labels.arrowhead_crowfoot_one_or_many"),icon:gp.exports.jsx(eo,{flip:e}),keyBinding:"v"}];e({name:"changeArrowhead",label:"Change arrowheads",trackEvent:!1,perform:(e,t,s)=>({elements:Im(e,t,(e=>{if(zt(e)){let{position:t,type:n}=s;if("start"===t)return Dt(e,{startArrowhead:n});if("end"===t)return Dt(e,{endArrowhead:n})}return e})),appState:{...t,["start"===s.position?"currentItemStartArrowhead":"currentItemEndArrowhead"]:s.type},captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s})=>{let n=Dp().rtl;return gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.arrowheads")}),gp.exports.jsxs("div",{className:"iconSelectList buttonList",children:[gp.exports.jsx(nm,{label:"arrowhead_start",options:Dm(!n),value:km(e,t,(e=>zt(e)&&Rs(e.type)?e.startArrowhead:t.currentItemStartArrowhead),!0,t.currentItemStartArrowhead),onChange:e=>s({position:"start",type:e}),numberOfOptionsToAlwaysShow:4}),gp.exports.jsx(nm,{label:"arrowhead_end",group:"arrowheads",options:Dm(!!n),value:km(e,t,(e=>zt(e)&&Rs(e.type)?e.endArrowhead:t.currentItemEndArrowhead),!0,t.currentItemEndArrowhead),onChange:e=>s({position:"end",type:e}),numberOfOptionsToAlwaysShow:4})]})]})}}),e({name:"changeArrowType",label:"Change arrow types",trackEvent:!1,perform:(e,t,s,n)=>{let i=Im(e,t,(i=>{if(!ut(i))return i;let a=Dt(i,{roundness:s===Os.round?{type:yt.PROPORTIONAL_RADIUS}:null,elbowed:s===Os.elbow,points:s===Os.elbow||i.elbowed?[i.points[0],i.points[i.points.length-1]]:i.points});if(V(a)){let s=n.scene.getNonDeletedElementsMap();n.dismissLinearEditor();let i=ze.getPointAtIndexGlobalCoordinates(a,0,s),l=ze.getPointAtIndexGlobalCoordinates(a,-1,s),r=!a.startBinding&&Zl(Be(i),e,s,t.zoom,!1,!0),o=!a.endBinding&&Zl(Be(l),e,s,t.zoom,!1,!0),d=r||a.startBinding&&s.get(a.startBinding.elementId),c=o||a.endBinding&&s.get(a.endBinding.elementId),p=r?to(a,r,"start"):i,h=o?to(a,o,"end"):l;r&&so(a,r,"start",s),o&&so(a,o,"end",s),He(a,{points:[p,h].map((e=>an(e[0]-a.x,e[1]-a.y))),...d&&a.startBinding?{startBinding:{...a.startBinding,...no(a,d,"start")}}:{},...c&&a.endBinding?{endBinding:{...a.endBinding,...no(a,c,"end")}}:{}}),ze.updateEditorMidPointsCache(a,s,n.state)}return a})),a={...t,currentItemArrowType:s},l=t.selectedLinearElement?.elementId;if(l){let e=i.find((e=>e.id===l));e&&(a.selectedLinearElement=new ze(e))}return{elements:i,appState:a,captureUpdate:Lt.IMMEDIATELY}},PanelComponent:({elements:e,appState:t,updateData:s})=>gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.arrowtypes")}),gp.exports.jsx(ph,{group:"arrowtypes",options:[{value:Os.sharp,text:Np("labels.arrowtype_sharp"),icon:Fs,testId:"sharp-arrow"},{value:Os.round,text:Np("labels.arrowtype_round"),icon:Bs,testId:"round-arrow"},{value:Os.elbow,text:Np("labels.arrowtype_elbowed"),icon:zs,testId:"elbow-arrow"}],value:km(e,t,(e=>ut(e)?e.elbowed?Os.elbow:e.roundness?Os.round:Os.sharp:null),(e=>ut(e)),(e=>e?null:t.currentItemArrowType)),onChange:e=>s(e)})]})});var Lm=({viewportX:e,viewportY:t,nextZoom:s},n)=>{let i=e-n.offsetLeft,a=t-n.offsetTop,l=n.zoom.value;return{scrollX:n.scrollX+(i-i/l)+-(i-i/s),scrollY:n.scrollY+(a-a/l)+-(a-a/s),zoom:{value:s}}},Nm=()=>{let e=document.querySelector(".excalidraw-tooltip");if(e)return e;let t=document.createElement("div");return document.body.appendChild(t),t.classList.add("excalidraw-tooltip"),t},Am=(e,t,s="bottom")=>{let n,i=e.getBoundingClientRect(),a=window.innerWidth,l=window.innerHeight,r=t.left+t.width/2-i.width/2;r<0?r=5:r+i.width>=a&&(r=a-i.width-5),"bottom"===s?(n=t.top+t.height+5,n+i.height>=l&&(n=t.top-i.height-5)):(n=t.top-i.height-5,n<0&&(n=t.top+t.height+5)),Object.assign(e.style,{top:`${n}px`,left:`${r}px`})},_m=({children:e,label:t,long:s=!1,style:n,disabled:i})=>(Dc((()=>()=>Nm().classList.remove("excalidraw-tooltip--visible")),[]),i?null:gp.exports.jsx("div",{className:"excalidraw-tooltip-wrapper",onPointerEnter:e=>((e,t,s,n)=>{t.classList.add("excalidraw-tooltip--visible"),t.style.minWidth=n?"50ch":"10ch",t.style.maxWidth=n?"50ch":"15ch",t.textContent=s;let i=e.getBoundingClientRect();Am(t,i)})(e.currentTarget,Nm(),t,s),onPointerLeave:()=>Nm().classList.remove("excalidraw-tooltip--visible"),style:n,children:e}));e({name:"changeViewBackgroundColor",label:"labels.canvasBackground",paletteName:"Change canvas background color",trackEvent:!1,predicate:(e,t,s,n)=>!!n.props.UIOptions.canvasActions.changeViewBackgroundColor&&!t.viewModeEnabled,perform:(e,t,s)=>({appState:{...t,...s},captureUpdate:s.viewBackgroundColor?Lt.IMMEDIATELY:Lt.EVENTUALLY}),PanelComponent:({elements:e,appState:t,updateData:s,appProps:n})=>gp.exports.jsx(qh,{palette:null,topPicks:Us,label:Np("labels.canvasBackground"),type:"canvasBackground",color:t.viewBackgroundColor,onChange:e=>s({viewBackgroundColor:e}),"data-testid":"canvas-background-picker",elements:e,appState:t,updateData:s})});var Pm=e({name:"clearCanvas",label:"labels.clearCanvas",paletteName:"Clear canvas",icon:jt,trackEvent:{category:"canvas"},predicate:(e,t,s,n)=>!!n.props.UIOptions.canvasActions.clearCanvas&&!t.viewModeEnabled&&"elementLinkSelector"!==t.openDialog?.name,perform:(e,t,s,n)=>(n.imageCache.clear(),{elements:e.map((e=>Dt(e,{isDeleted:!0}))),appState:{...K(),files:{},theme:t.theme,penMode:t.penMode,penDetected:t.penDetected,exportBackground:t.exportBackground,exportEmbedScene:t.exportEmbedScene,gridSize:t.gridSize,gridStep:t.gridStep,gridModeEnabled:t.gridModeEnabled,stats:t.stats,pasteDialog:t.pasteDialog,activeTool:"image"===t.activeTool.type?{...t.activeTool,type:"selection"}:t.activeTool},captureUpdate:Lt.IMMEDIATELY})}),Rm=e({name:"zoomIn",label:"buttons.zoomIn",viewMode:!0,icon:Hs,trackEvent:{category:"canvas"},perform:(e,t,s,n)=>({appState:{...t,...Lm({viewportX:t.width/2+t.offsetLeft,viewportY:t.height/2+t.offsetTop,nextZoom:Ys(t.zoom.value+Gs)},t),userToFollow:null},captureUpdate:Lt.EVENTUALLY}),PanelComponent:({updateData:e,appState:t})=>gp.exports.jsx(Fp,{type:"button",className:"zoom-in-button zoom-button",icon:Hs,title:`${Np("buttons.zoomIn")} — ${x("CtrlOrCmd++")}`,"aria-label":Np("buttons.zoomIn"),disabled:t.zoom.value>=$s,onClick:()=>{e(null)}}),keyTest:e=>(e.code===Pt.EQUAL||e.code===Pt.NUM_ADD)&&(e[j.CTRL_OR_CMD]||e.shiftKey)}),Om=e({name:"zoomOut",label:"buttons.zoomOut",icon:Vs,viewMode:!0,trackEvent:{category:"canvas"},perform:(e,t,s,n)=>({appState:{...t,...Lm({viewportX:t.width/2+t.offsetLeft,viewportY:t.height/2+t.offsetTop,nextZoom:Ys(t.zoom.value-Gs)},t),userToFollow:null},captureUpdate:Lt.EVENTUALLY}),PanelComponent:({updateData:e,appState:t})=>gp.exports.jsx(Fp,{type:"button",className:"zoom-out-button zoom-button",icon:Vs,title:`${Np("buttons.zoomOut")} — ${x("CtrlOrCmd+-")}`,"aria-label":Np("buttons.zoomOut"),disabled:t.zoom.value<=Ws,onClick:()=>{e(null)}}),keyTest:e=>(e.code===Pt.MINUS||e.code===Pt.NUM_SUBTRACT)&&(e[j.CTRL_OR_CMD]||e.shiftKey)}),Fm=e({name:"resetZoom",label:"buttons.resetZoom",icon:Ks,viewMode:!0,trackEvent:{category:"canvas"},perform:(e,t,s,n)=>({appState:{...t,...Lm({viewportX:t.width/2+t.offsetLeft,viewportY:t.height/2+t.offsetTop,nextZoom:Ys(1)},t),userToFollow:null},captureUpdate:Lt.EVENTUALLY}),PanelComponent:({updateData:e,appState:t})=>gp.exports.jsx(_m,{label:Np("buttons.resetZoom"),style:{height:"100%"},children:gp.exports.jsxs(Fp,{type:"button",className:"reset-zoom-button zoom-button",title:Np("buttons.resetZoom"),"aria-label":Np("buttons.resetZoom"),onClick:()=>{e(null)},children:[(100*t.zoom.value).toFixed(0),"%"]})}),keyTest:e=>(e.code===Pt.ZERO||e.code===Pt.NUM_ZERO)&&(e[j.CTRL_OR_CMD]||e.shiftKey)}),Bm=({bounds:e,appState:t,canvasOffsets:s,fitToViewport:n=!1,viewportZoomFactor:i=1,minZoom:a=-1/0,maxZoom:l=1/0})=>{i=$o(i,Ws,$s);let r,[o,d,c,p]=e,h=(o+c)/2,m=(d+p)/2,u=s?.left??0,g=s?.top??0,x=s?.right??0,f=s?.bottom??0,b=t.width-u-x,E=t.height-g-f;if(n){let e=c-o,t=p-d;r=Math.min(b/e,E/t)*i}else r=((e,t,s=1)=>{let[n,i,a,l]=e,r=a-n,o=t.width/r,d=l-i,c=t.height/d,p=Math.min(o,c)*$o(s,.1,1);return Math.min(p,1)})(e,{width:b,height:E},i);let y=Ys($o(Vo(r,Gs,"floor"),a,l)),v=Wo({scenePoint:{x:h,y:m},viewportDimensions:{width:t.width,height:t.height},offsets:s,zoom:{value:y}});return{appState:{...t,scrollX:v.scrollX,scrollY:v.scrollY,zoom:{value:y}},captureUpdate:Lt.EVENTUALLY}},zm=({canvasOffsets:e,targetElements:t,appState:s,fitToViewport:n,viewportZoomFactor:i,minZoom:a,maxZoom:l})=>{let r=xt(At(t));return Bm({canvasOffsets:e,bounds:r,appState:s,fitToViewport:n,viewportZoomFactor:i,minZoom:a,maxZoom:l})};e({name:"zoomToFitSelectionInViewport",label:"labels.zoomToFitViewport",icon:Zs,trackEvent:{category:"canvas"},perform:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t);return zm({targetElements:i.length?i:e,appState:{...t,userToFollow:null},fitToViewport:!1,canvasOffsets:n.getEditorUIOffsets()})},keyTest:e=>e.code===Pt.TWO&&e.shiftKey&&!e.altKey&&!e[j.CTRL_OR_CMD]}),e({name:"zoomToFitSelection",label:"helpDialog.zoomToSelection",icon:Zs,trackEvent:{category:"canvas"},perform:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t);return zm({targetElements:i.length?i:e,appState:{...t,userToFollow:null},fitToViewport:!0,canvasOffsets:n.getEditorUIOffsets()})},keyTest:e=>e.code===Pt.THREE&&e.shiftKey&&!e.altKey&&!e[j.CTRL_OR_CMD]}),e({name:"zoomToFit",label:"helpDialog.zoomToFit",icon:Zs,viewMode:!0,trackEvent:{category:"canvas"},perform:(e,t,s,n)=>zm({targetElements:e,appState:{...t,userToFollow:null},fitToViewport:!1,canvasOffsets:n.getEditorUIOffsets()}),keyTest:e=>e.code===Pt.ONE&&e.shiftKey&&!e.altKey&&!e[j.CTRL_OR_CMD]});var Um=e({name:"toggleTheme",label:(e,t)=>t.theme===X.DARK?"buttons.lightMode":"buttons.darkMode",keywords:["toggle","dark","light","mode","theme"],icon:e=>e.theme===X.LIGHT?Xs:qs,viewMode:!0,trackEvent:{category:"canvas"},perform:(e,t,s)=>({appState:{...t,theme:s||(t.theme===X.LIGHT?X.DARK:X.LIGHT)},captureUpdate:Lt.EVENTUALLY}),keyTest:e=>e.altKey&&e.shiftKey&&e.code===Pt.D,predicate:(e,t,s,n)=>!!n.props.UIOptions.canvasActions.toggleTheme});e({name:"toggleEraserTool",label:"toolBar.eraser",trackEvent:{category:"toolbar"},perform:(e,t)=>{let s;return s=Ae(t)?_e(t,{...t.activeTool.lastActiveTool||{type:"selection"},lastActiveToolBeforeEraser:null}):_e(t,{type:"eraser",lastActiveToolBeforeEraser:t.activeTool}),{appState:{...t,selectedElementIds:{},selectedGroupIds:{},activeEmbeddable:null,activeTool:s},captureUpdate:Lt.IMMEDIATELY}},keyTest:e=>e.key===j.E});var Hm=e({name:"toggleHandTool",label:"toolBar.hand",paletteName:"Toggle hand tool",trackEvent:{category:"toolbar"},icon:Qs,viewMode:!1,perform:(e,t,s,n)=>{let i;return Js(t)?i=_e(t,{...t.activeTool.lastActiveTool||{type:"selection"},lastActiveToolBeforeEraser:null}):(i=_e(t,{type:"hand",lastActiveToolBeforeEraser:t.activeTool}),gt(n.interactiveCanvas,en.GRAB)),{appState:{...t,selectedElementIds:{},selectedGroupIds:{},activeEmbeddable:null,activeTool:i},captureUpdate:Lt.IMMEDIATELY}},keyTest:e=>!e.altKey&&!e[j.CTRL_OR_CMD]&&e.key===j.H}),Ym=e({name:"finalize",label:"",trackEvent:!1,perform:(e,t,s,n)=>{let{interactiveCanvas:i,focusContainer:a,scene:l}=n,r=l.getNonDeletedElementsMap();if(t.editingLinearElement){let{elementId:s,startBindingElement:n,endBindingElement:i}=t.editingLinearElement,a=ze.getElement(s,r);if(a)return Oe(a)&&tn(a,n,i,r,l),{elements:a.points.length<2||sn(a)?e.filter((e=>e.id!==a.id)):void 0,appState:{...t,cursorButton:"up",editingLinearElement:null},captureUpdate:Lt.IMMEDIATELY}}let o=e,d=t.pendingImageElementId&&l.getElement(t.pendingImageElementId);d&&He(d,{isDeleted:!0},!1),window.document.activeElement instanceof HTMLElement&&a();let c,p=t.multiElement?t.multiElement:"freedraw"===t.newElement?.type?t.newElement:null;if(p){if("freedraw"!==p.type&&"touch"!==t.lastPointerDownWith){let{points:e,lastCommittedPoint:t}=p;(!t||e[e.length-1]!==t)&&He(p,{points:p.points.slice(0,-1)})}sn(p)&&(o=o.filter((e=>e.id!==p.id)));let s=nn(p.points,t.zoom.value);if(("line"===p.type||"freedraw"===p.type)&&s){let e=p.points,t=e[0];He(p,{points:e.map(((s,n)=>n===e.length-1?an(t[0],t[1]):s))})}if(Oe(p)&&!s&&p.points.length>1){let[s,n]=ze.getPointAtIndexGlobalCoordinates(p,-1,Ht(e));Fe(p,t,{x:s,y:n},r,e)}}return(!t.activeTool.locked&&"freedraw"!==t.activeTool.type||!p)&&ln(i),c="eraser"===t.activeTool.type?_e(t,{...t.activeTool.lastActiveTool||{type:"selection"},lastActiveToolBeforeEraser:null}):_e(t,{type:"selection"}),{elements:o,appState:{...t,cursorButton:"up",activeTool:(t.activeTool.locked||"freedraw"===t.activeTool.type)&&p?t.activeTool:c,activeEmbeddable:null,newElement:null,selectionElement:null,multiElement:null,editingTextElement:null,startBoundElement:null,suggestedBindings:[],selectedElementIds:p&&!t.activeTool.locked&&"freedraw"!==t.activeTool.type?{...t.selectedElementIds,[p.id]:!0}:t.selectedElementIds,selectedLinearElement:p&&zt(p)?new ze(p):t.selectedLinearElement,pendingImageElementId:null},captureUpdate:Lt.IMMEDIATELY}},keyTest:(e,t)=>e.key===j.ESCAPE&&(null!==t.editingLinearElement||!t.newElement&&null===t.multiElement)||(e.key===j.ESCAPE||e.key===j.ENTER)&&null!==t.multiElement,PanelComponent:({appState:e,updateData:t,data:s})=>gp.exports.jsx(Fp,{type:"button",icon:rn,title:Np("buttons.done"),"aria-label":Np("buttons.done"),onClick:t,visible:null!=e.multiElement,size:s?.size||"medium",style:{pointerEvents:"all"}})}),Gm=e=>{let{id:t}=ev(),[s,n]=Mc(e.value);return gp.exports.jsxs("div",{className:"ProjectName",children:[gp.exports.jsx("label",{className:"ProjectName-label",htmlFor:"filename",children:`${e.label}:`}),gp.exports.jsx("input",{type:"text",className:"TextInput",onBlur:t=>{e.ignoreFocus||Ko(t.target);let s=t.target.value;s!==e.value&&e.onChange(s)},onKeyDown:e=>{if(e.key===j.ENTER){if(e.preventDefault(),e.nativeEvent.isComposing||229===e.keyCode)return;e.currentTarget.blur()}},id:`${t}-filename`,value:s,onChange:e=>n(e.target.value)})]})},$m=e=>{let t=e.title||(e.value===X.DARK?Np("buttons.lightMode"):Np("buttons.darkMode"));return gp.exports.jsx(Fp,{type:"icon",icon:e.value===X.LIGHT?Vm.MOON:Vm.SUN,title:t,"aria-label":t,onClick:()=>e.onChange(e.value===X.DARK?X.LIGHT:X.DARK),"data-testid":"toggle-dark-mode"})},Vm={SUN:gp.exports.jsx("svg",{width:"512",height:"512",className:"rtl-mirror",viewBox:"0 0 512 512",children:gp.exports.jsx("path",{fill:"currentColor",d:"M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"})}),MOON:gp.exports.jsx("svg",{width:"512",height:"512",className:"rtl-mirror",viewBox:"0 0 512 512",children:gp.exports.jsx("path",{fill:"currentColor",d:"M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"})})},Wm=(e,{selectedElementIds:t},s)=>{e=At(e);let n=s&&je(e,{selectedElementIds:t}),i=null,a=n?S(e,{selectedElementIds:t},{includeBoundTextElement:!0}):e;return n&&(1===a.length&&it(a[0])?(i=a[0],a=ye(e,i)):a.length>1&&(a=S(e,{selectedElementIds:t},{includeBoundTextElement:!0,includeElementsInFrames:!0}))),{exportingFrame:i,exportedElements:io(a)}},Km=async(e,t,s,n,{exportBackground:i,exportPadding:a=ho,viewBackgroundColor:l,name:r=s.name||mo,fileHandle:o=null,exportingFrame:d=null})=>{if(0===t.length)throw new Error(Np("alerts.cannotExportEmptyCanvas"));if("svg"===e||"clipboard-svg"===e){let c=ao(t,{exportBackground:i,exportWithDarkMode:s.exportWithDarkMode,viewBackgroundColor:l,exportPadding:a,exportScale:s.exportScale,exportEmbedScene:s.exportEmbedScene&&"svg"===e},n,{exportingFrame:d});if("svg"===e)return lo(c.then((e=>new Blob([e.outerHTML],{type:Fi.svg}))),{description:"Export to SVG",name:r,extension:s.exportEmbedScene?"excalidraw.svg":"svg",mimeTypes:[dr.svg],fileHandle:o});if("clipboard-svg"===e){let e=await c.then((e=>e.outerHTML));try{await ve(e)}catch{throw new Error(Np("errors.copyToSystemClipboardFailed"))}return}}let c=ro(t,s,n,{exportBackground:i,viewBackgroundColor:l,exportPadding:a,exportingFrame:d});if("png"===e){let e=oo(c);return s.exportEmbedScene&&(e=e.then((e=>import("./data/image-7KUKJ7J4.js").then((({encodePngMetadata:i})=>i({blob:e,metadata:co(t,s,n,"local")})))))),lo(e,{description:"Export to PNG",name:r,extension:s.exportEmbedScene?"excalidraw.png":"png",mimeTypes:[dr.png],fileHandle:o})}if("clipboard"!==e)throw new Error("Unsupported export type");try{let e=oo(c);await po(e)}catch(e){throw console.warn(e),"CANVAS_POSSIBLY_TOO_BIG"===e.name?new Error(Np("canvasError.canvasTooBig")):ai&&"TypeError"===e.name?new Error(`${Np("alerts.couldNotCopyToClipboard")}\n\n${Np("hints.firefox_clipboard_write")}`):new Error(Np("alerts.couldNotCopyToClipboard"))}},Zm=({children:e,checked:t,onChange:s,className:n})=>gp.exports.jsxs("div",{className:Vc("Checkbox",n,{"is-checked":t}),onClick:e=>{s(!t,e),e.currentTarget.querySelector(".Checkbox-box").focus()},children:[gp.exports.jsx("button",{type:"button",className:"Checkbox-box",role:"checkbox","aria-checked":t,children:on}),gp.exports.jsx("div",{className:"Checkbox-label",children:e})]}),Xm=e({name:"changeProjectName",label:"labels.fileTitle",trackEvent:!1,perform:(e,t,s)=>({appState:{...t,name:s},captureUpdate:Lt.EVENTUALLY}),PanelComponent:({appState:e,updateData:t,appProps:s,data:n,app:i})=>gp.exports.jsx(Gm,{label:Np("labels.fileTitle"),value:i.getName(),onChange:e=>t(e),ignoreFocus:n?.ignoreFocus??!1})}),qm=e({name:"changeExportScale",label:"imageExportDialog.scale",trackEvent:{category:"export",action:"scale"},perform:(e,t,s)=>({appState:{...t,exportScale:s},captureUpdate:Lt.EVENTUALLY}),PanelComponent:({elements:e,appState:t,updateData:s})=>{let n=At(e),i=je(n,t)?S(n,t):n;return gp.exports.jsx(gp.exports.Fragment,{children:dn.map((e=>{let[n,a]=cn(i,ho,e),l=`${Np("imageExportDialog.label.scale")} ${e}x (${n}x${a})`;return gp.exports.jsx(Fp,{size:"small",type:"radio",icon:`${e}x`,name:"export-canvas-scale",title:l,"aria-label":l,id:"export-canvas-scale",checked:e===t.exportScale,onChange:()=>s(e)},e)}))})}}),Qm=e({name:"changeExportBackground",label:"imageExportDialog.label.withBackground",trackEvent:{category:"export",action:"toggleBackground"},perform:(e,t,s)=>({appState:{...t,exportBackground:s},captureUpdate:Lt.EVENTUALLY}),PanelComponent:({appState:e,updateData:t})=>gp.exports.jsx(Zm,{checked:e.exportBackground,onChange:e=>t(e),children:Np("imageExportDialog.label.withBackground")})}),Jm=e({name:"changeExportEmbedScene",label:"imageExportDialog.tooltip.embedScene",trackEvent:{category:"export",action:"embedScene"},perform:(e,t,s)=>({appState:{...t,exportEmbedScene:s},captureUpdate:Lt.EVENTUALLY}),PanelComponent:({appState:e,updateData:t})=>gp.exports.jsxs(Zm,{checked:e.exportEmbedScene,onChange:e=>t(e),children:[Np("imageExportDialog.label.embedScene"),gp.exports.jsx(_m,{label:Np("imageExportDialog.tooltip.embedScene"),long:!0,children:gp.exports.jsx("div",{className:"excalidraw-tooltip-icon",children:pn})})]})}),eu=e({name:"saveToActiveFile",label:"buttons.save",icon:hn,trackEvent:{category:"export"},predicate:(e,t,s,n)=>!!n.props.UIOptions.canvasActions.saveToActiveFile&&!!t.fileHandle&&!t.viewModeEnabled,perform:async(e,t,s,n)=>{let i=!!t.fileHandle;try{let{fileHandle:s}=mn(t.fileHandle)?await(async(e,t,s,n)=>{let{exportBackground:i,viewBackgroundColor:a,fileHandle:l}=t,r=uo(l);if(!l||!go(r))throw new Error("fileHandle should exist and should be of type svg or png when resaving");t={...t,exportEmbedScene:!0};let{exportedElements:o,exportingFrame:d}=Wm(e,t,!1);return await Km(r,o,t,s,{exportBackground:i,viewBackgroundColor:a,name:n,fileHandle:l,exportingFrame:d}),{fileHandle:l}})(e,t,n.files,n.getName()):await un(e,t,n.files,n.getName());return{captureUpdate:Lt.EVENTUALLY,appState:{...t,fileHandle:s,toast:i?{message:s?.name?Np("toast.fileSavedToFilename").replace("{filename}",`"${s.name}"`):Np("toast.fileSaved")}:null}}}catch(e){return"AbortError"!==e?.name?console.error(e):console.warn(e),{captureUpdate:Lt.EVENTUALLY}}},keyTest:e=>e.key===j.S&&e[j.CTRL_OR_CMD]&&!e.shiftKey}),tu=e({name:"saveFileToDisk",label:"exportDialog.disk_title",icon:hn,viewMode:!0,trackEvent:{category:"export"},perform:async(e,t,s,n)=>{try{let{fileHandle:s}=await un(e,{...t,fileHandle:null},n.files,n.getName());return{captureUpdate:Lt.EVENTUALLY,appState:{...t,openDialog:null,fileHandle:s,toast:{message:Np("toast.fileSaved")}}}}catch(e){return"AbortError"!==e?.name?console.error(e):console.warn(e),{captureUpdate:Lt.EVENTUALLY}}},keyTest:e=>e.key===j.S&&e.shiftKey&&e[j.CTRL_OR_CMD],PanelComponent:({updateData:e})=>gp.exports.jsx(Fp,{type:"button",icon:gn,title:Np("buttons.saveAs"),"aria-label":Np("buttons.saveAs"),showAriaLabel:Jy().editor.isMobile,hidden:!up,onClick:()=>e(null),"data-testid":"save-as-button"})}),su=e({name:"loadScene",label:"buttons.load",trackEvent:{category:"export"},predicate:(e,t,s,n)=>!!n.props.UIOptions.canvasActions.loadScene&&!t.viewModeEnabled,perform:async(e,t,s,n)=>{try{let{elements:s,appState:n,files:i}=await xn(t,e);return{elements:s,appState:n,files:i,captureUpdate:Lt.IMMEDIATELY}}catch(s){return"AbortError"===s?.name?(console.warn(s),!1):{elements:e,appState:{...t,errorMessage:s.message},files:n.files,captureUpdate:Lt.EVENTUALLY}}},keyTest:e=>e[j.CTRL_OR_CMD]&&e.key===j.O}),nu=e({name:"exportWithDarkMode",label:"imageExportDialog.label.darkMode",trackEvent:{category:"export",action:"toggleTheme"},perform:(e,t,s)=>({appState:{...t,exportWithDarkMode:s},captureUpdate:Lt.EVENTUALLY}),PanelComponent:({appState:e,updateData:t})=>gp.exports.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"-45px",marginBottom:"10px"},children:gp.exports.jsx($m,{value:e.exportWithDarkMode?X.DARK:X.LIGHT,onChange:e=>{t(e===X.DARK)},title:Np("imageExportDialog.label.darkMode")})})}),iu="{}",au=e({name:"copyStyles",label:"labels.copyStyles",icon:fn,trackEvent:{category:"element"},perform:(e,t,s,n)=>{let i=[],a=e.find((e=>t.selectedElementIds[e.id]));if(i.push(a),a&&Wt(a)){let e=Kt(a,n.scene.getNonDeletedElementsMap());i.push(e)}return a&&(iu=JSON.stringify(i)),{appState:{...t,toast:{message:Np("toast.copyStyles")}},captureUpdate:Lt.EVENTUALLY}},keyTest:e=>e[j.CTRL_OR_CMD]&&e.altKey&&e.code===Pt.C}),lu=e({name:"pasteStyles",label:"labels.pasteStyles",icon:fn,trackEvent:{category:"element"},perform:(e,t,s,n)=>{let i=JSON.parse(iu),a=i[0],l=i[1];if(!bn(a))return{elements:e,captureUpdate:Lt.EVENTUALLY};let r=S(e,t,{includeBoundTextElement:!0}),o=r.map((e=>e.id));return{elements:e.map((e=>{if(o.includes(e.id)){let t=a;if(tt(e)&&e.containerId&&(t=l),!t)return e;let s=Dt(e,{backgroundColor:t?.backgroundColor,strokeWidth:t?.strokeWidth,strokeColor:t?.strokeColor,strokeStyle:t?.strokeStyle,fillStyle:t?.fillStyle,opacity:t?.opacity,roughness:t?.roughness,roundness:t.roundness?En(t.roundness.type,e)?t.roundness:yn(e):null});if(tt(s)){let e=t.fontSize||vn,i=t.fontFamily||wn;s=Dt(s,{fontSize:e,fontFamily:i,textAlign:t.textAlign||$e,lineHeight:t.lineHeight||Ke(i)});let a=null;s.containerId&&(a=r.find((e=>tt(s)&&e.id===s.containerId))||null),Is(s,a,n.scene.getNonDeletedElementsMap())}return"arrow"===s.type&&ut(t)&&(s=Dt(s,{startArrowhead:t.startArrowhead,endArrowhead:t.endArrowhead})),it(e)&&(s=Dt(s,{roundness:null,backgroundColor:"transparent"})),s}return e})),captureUpdate:Lt.IMMEDIATELY}},keyTest:e=>e[j.CTRL_OR_CMD]&&e.altKey&&e.code===Pt.V});e({name:"toggleCanvasMenu",label:"buttons.menu",trackEvent:{category:"menu"},perform:(e,t)=>({appState:{...t,openMenu:"canvas"===t.openMenu?null:"canvas"},captureUpdate:Lt.EVENTUALLY}),PanelComponent:({appState:e,updateData:t})=>gp.exports.jsx(Fp,{type:"button",icon:Sn,"aria-label":Np("buttons.menu"),onClick:t,selected:"canvas"===e.openMenu})}),e({name:"toggleEditMenu",label:"buttons.edit",trackEvent:{category:"menu"},perform:(e,t)=>({appState:{...t,openMenu:"shape"===t.openMenu?null:"shape"},captureUpdate:Lt.EVENTUALLY}),PanelComponent:({elements:e,appState:t,updateData:s})=>gp.exports.jsx(Fp,{visible:Cn(t,At(e)),type:"button",icon:In,"aria-label":Np("buttons.edit"),onClick:s,selected:"shape"===t.openMenu})});var ru=e({name:"toggleShortcuts",label:"welcomeScreen.defaults.helpHint",icon:kn,viewMode:!0,trackEvent:{category:"menu",action:"toggleHelpDialog"},perform:(e,t,s,{focusContainer:n})=>("help"===t.openDialog?.name&&n(),{appState:{...t,openDialog:"help"===t.openDialog?.name?null:{name:"help"}},captureUpdate:Lt.EVENTUALLY}),keyTest:e=>e.key===j.QUESTION_MARK}),ou=(e,t,s)=>{let n=s.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0});return n.length>=2&&!(e=>{if(e.length>=2){let t=e[0].groupIds;for(let s of t)if(e.reduce(((e,t)=>e&&Ct(t,s)),!0))return!0}return!1})(n)&&!U(n)},du=e({name:"group",label:"labels.group",icon:e=>gp.exports.jsx(Tn,{theme:e.theme}),trackEvent:{category:"element"},perform:(e,t,s,n)=>{let i=Mn(n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0}));if(i.length<2)return{appState:t,elements:e,captureUpdate:Lt.EVENTUALLY};let a=jn(t);if(1===a.length){let s=a[0],n=new Set(Gt(e,s).map((e=>e.id))),l=new Set(i.map((e=>e.id)));if(new Set([...Array.from(n),...Array.from(l)]).size===n.size)return{appState:t,elements:e,captureUpdate:Lt.EVENTUALLY}}let l=[...e];new Set(i.map((e=>e.frameId))).size>1&&Dn(i).forEach(((e,t)=>{Ln(e,n.scene.getNonDeletedElementsMap())}));let r=m(),o=Ht(i);l=l.map((e=>o.get(e.id)?Dt(e,{groupIds:Nn(e.groupIds,r,t.editingGroupId)}):e));let d=Gt(l,r),c=d[d.length-1],p=l.lastIndexOf(c),h=l.slice(p+1),u=l.slice(0,p).filter((e=>!Ct(e,r))),g=An([...u,...d,...h],Ht(d));return{appState:{...t,..._n(r,{...t,selectedGroupIds:{}},At(l))},elements:g,captureUpdate:Lt.IMMEDIATELY}},predicate:(e,t,s,n)=>ou(0,t,n),keyTest:e=>!e.shiftKey&&e[j.CTRL_OR_CMD]&&e.key===j.G,PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsx(Fp,{hidden:!ou(0,t,n),type:"button",icon:gp.exports.jsx(Tn,{theme:t.theme}),onClick:()=>s(null),title:`${Np("labels.group")} — ${x("CtrlOrCmd+G")}`,"aria-label":Np("labels.group"),visible:je(At(e),t)})}),cu=e({name:"ungroup",label:"labels.ungroup",icon:e=>gp.exports.jsx(Pn,{theme:e.theme}),trackEvent:{category:"element"},perform:(e,t,s,n)=>{let i=jn(t),a=Ht(e);if(0===i.length)return{appState:t,elements:e,captureUpdate:Lt.EVENTUALLY};let l=[...e],r=[];l=l.map((e=>{Zt(e)&&r.push(e.id);let s=Rn(e.groupIds,t.selectedGroupIds);return s.length===e.groupIds.length?e:Dt(e,{groupIds:s})}));let o=De(t,At(l),t,null),d=n.scene.getSelectedElements(t),c=new Set(d.filter((e=>e.frameId)).map((e=>e.frameId)));return On(e).filter((e=>c.has(e.id))).forEach((e=>{e&&(l=Fn(l,Bn(l,e,t,a),e,n))})),o.selectedElementIds=Object.entries(o.selectedElementIds).reduce(((e,[t,s])=>(s&&!r.includes(t)&&(e[t]=!0),e)),{}),{appState:{...t,...o},elements:l,captureUpdate:Lt.IMMEDIATELY}},keyTest:e=>e.shiftKey&&e[j.CTRL_OR_CMD]&&e.key===j.G.toUpperCase(),predicate:(e,t)=>jn(t).length>0,PanelComponent:({elements:e,appState:t,updateData:s})=>gp.exports.jsx(Fp,{type:"button",hidden:0===jn(t).length,icon:gp.exports.jsx(Pn,{theme:t.theme}),onClick:()=>s(null),title:`${Np("labels.ungroup")} — ${x("CtrlOrCmd+Shift+G")}`,"aria-label":Np("labels.ungroup"),visible:je(At(e),t)})}),pu=(e,t,s,n,i,a,l)=>{e.beginPath(),e.moveTo(t+a,s),e.lineTo(t+n-a,s),e.quadraticCurveTo(t+n,s,t+n,s+a),e.lineTo(t+n,s+i-a),e.quadraticCurveTo(t+n,s+i,t+n-a,s+i),e.lineTo(t+a,s+i),e.quadraticCurveTo(t,s+i,t,s+i-a),e.lineTo(t,s+a),e.quadraticCurveTo(t,s,t+a,s),e.closePath(),e.fill(),l&&(e.strokeStyle=l),e.stroke()};var hu=(e,t)=>`hsl(${Math.abs(function(e){let t=0;if(0===e.length)return t;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s);return t}(t?.id||e))%37*10}, 100%, 83%)`,mu=({color:e,onClick:t,name:s,src:n,className:i})=>{let a=(e=>{let t=e?.trim()?.codePointAt(0);return(t?String.fromCodePoint(t):"?").toUpperCase()})(s),[l,r]=Mc(!1),o=!l&&n,d=o?void 0:{background:e};return gp.exports.jsx("div",{className:Vc("Avatar",i),style:d,onClick:t,children:o?gp.exports.jsx("img",{className:"Avatar-img",src:n,alt:a,referrerPolicy:"no-referrer",onError:()=>r(!0)}):a})};e({name:"goToCollaborator",label:"Go to a collaborator",viewMode:!0,trackEvent:{category:"collab"},perform:(e,t,s)=>!s.socketId||t.userToFollow?.socketId===s.socketId||s.isCurrentUser?{appState:{...t,userToFollow:null},captureUpdate:Lt.EVENTUALLY}:{appState:{...t,userToFollow:{socketId:s.socketId,username:s.username||""},openMenu:"canvas"===t.openMenu?null:t.openMenu},captureUpdate:Lt.EVENTUALLY},PanelComponent:({updateData:e,data:t,appState:s})=>{let{socketId:n,collaborator:i,withName:a,isBeingFollowed:l}=t,r=hu(n,i),o=Vc({"is-followed":l,"is-current-user":!0===i.isCurrentUser,"is-speaking":i.isSpeaking,"is-in-call":i.isInCall,"is-muted":i.isMuted}),d=i.isInCall?i.isSpeaking?gp.exports.jsxs("div",{className:"UserList__collaborator-status-icon-speaking-indicator",title:Np("userList.hint.isSpeaking"),children:[gp.exports.jsx("div",{}),gp.exports.jsx("div",{}),gp.exports.jsx("div",{})]}):i.isMuted?gp.exports.jsx("div",{className:"UserList__collaborator-status-icon-microphone-muted",title:Np("userList.hint.micMuted"),children:zn}):gp.exports.jsx("div",{title:Np("userList.hint.inCall"),children:Un}):null;return a?gp.exports.jsxs("div",{className:`dropdown-menu-item dropdown-menu-item-base UserList__collaborator ${o}`,style:{"--avatar-size":"1.5rem"},onClick:()=>e(i),children:[gp.exports.jsx(mu,{color:r,onClick:()=>{},name:i.username||"",src:i.avatarUrl,className:o}),gp.exports.jsx("div",{className:"UserList__collaborator-name",children:i.username}),gp.exports.jsxs("div",{className:"UserList__collaborator-status-icons","aria-hidden":!0,children:[l&&gp.exports.jsx("div",{className:"UserList__collaborator-status-icon-is-followed",title:Np("userList.hint.followStatus"),children:g}),d]})]}):gp.exports.jsxs("div",{className:`UserList__collaborator UserList__collaborator--avatar-only ${o}`,children:[gp.exports.jsx(mu,{color:r,onClick:()=>{e(i)},name:i.username||"",src:i.avatarUrl,className:o}),d&&gp.exports.jsx("div",{className:"UserList__collaborator-status-icon",children:d})]})}});var uu=e({name:"addToLibrary",trackEvent:{category:"element"},perform:(e,t,s,n)=>{let i=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0});for(let e of h)if(i.some((t=>t.type===e)))return{captureUpdate:Lt.EVENTUALLY,appState:{...t,errorMessage:Np(`errors.libraryElementTypeError.${e}`)}};return n.library.getLatestLibrary().then((e=>n.library.setLibrary([{id:m(),status:"unpublished",elements:i.map(bt),created:Date.now()},...e]))).then((()=>({captureUpdate:Lt.EVENTUALLY,appState:{...t,toast:{message:Np("toast.addedToLibrary")}}}))).catch((e=>({captureUpdate:Lt.EVENTUALLY,appState:{...t,errorMessage:e.message}})))},label:"labels.addToLibrary"}),gu=(e,t,{axis:s,position:n})=>{let i=Jn(e),[a,l]="x"===s?["minX","maxX"]:["minY","maxY"],r={x:0,y:0};return"start"===n?{...r,[s]:t[a]-i[a]}:"end"===n?{...r,[s]:t[l]-i[l]}:{...r,[s]:(t[a]+t[l])/2-(i[a]+i[l])/2}},xu=(e,t)=>{let s=t.scene.getSelectedElements(e);return s.length>1&&!s.some((e=>it(e)))},fu=(e,t,s,n)=>{let i=((e,t,s,n)=>{let i=Zo(e,t),a=Jn(e);return i.flatMap((e=>{let t=gu(e,a,s);return e.map((s=>{let i=He(s,{x:s.x+t.x,y:s.y+t.y});return yl(s,n.getNonDeletedElementsMap(),{simultaneouslyUpdated:e}),i}))}))})(s.scene.getSelectedElements(t),Ht(e),n,s.scene),a=Ht(i);return qn(e.map((e=>a.get(e.id)||e)),t,s)};e({name:"alignTop",label:"labels.alignTop",icon:Hn,trackEvent:{category:"element"},predicate:(e,t,s,n)=>xu(t,n),perform:(e,t,s,n)=>({appState:t,elements:fu(e,t,n,{position:"start",axis:"y"}),captureUpdate:Lt.IMMEDIATELY}),keyTest:e=>e[j.CTRL_OR_CMD]&&e.shiftKey&&e.key===j.ARROW_UP,PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsx(Fp,{hidden:!xu(t,n),type:"button",icon:Hn,onClick:()=>s(null),title:`${Np("labels.alignTop")} — ${x("CtrlOrCmd+Shift+Up")}`,"aria-label":Np("labels.alignTop"),visible:je(At(e),t)})}),e({name:"alignBottom",label:"labels.alignBottom",icon:Yn,trackEvent:{category:"element"},predicate:(e,t,s,n)=>xu(t,n),perform:(e,t,s,n)=>({appState:t,elements:fu(e,t,n,{position:"end",axis:"y"}),captureUpdate:Lt.IMMEDIATELY}),keyTest:e=>e[j.CTRL_OR_CMD]&&e.shiftKey&&e.key===j.ARROW_DOWN,PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsx(Fp,{hidden:!xu(t,n),type:"button",icon:Yn,onClick:()=>s(null),title:`${Np("labels.alignBottom")} — ${x("CtrlOrCmd+Shift+Down")}`,"aria-label":Np("labels.alignBottom"),visible:je(At(e),t)})}),e({name:"alignLeft",label:"labels.alignLeft",icon:Gn,trackEvent:{category:"element"},predicate:(e,t,s,n)=>xu(t,n),perform:(e,t,s,n)=>({appState:t,elements:fu(e,t,n,{position:"start",axis:"x"}),captureUpdate:Lt.IMMEDIATELY}),keyTest:e=>e[j.CTRL_OR_CMD]&&e.shiftKey&&e.key===j.ARROW_LEFT,PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsx(Fp,{hidden:!xu(t,n),type:"button",icon:Gn,onClick:()=>s(null),title:`${Np("labels.alignLeft")} — ${x("CtrlOrCmd+Shift+Left")}`,"aria-label":Np("labels.alignLeft"),visible:je(At(e),t)})}),e({name:"alignRight",label:"labels.alignRight",icon:$n,trackEvent:{category:"element"},predicate:(e,t,s,n)=>xu(t,n),perform:(e,t,s,n)=>({appState:t,elements:fu(e,t,n,{position:"end",axis:"x"}),captureUpdate:Lt.IMMEDIATELY}),keyTest:e=>e[j.CTRL_OR_CMD]&&e.shiftKey&&e.key===j.ARROW_RIGHT,PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsx(Fp,{hidden:!xu(t,n),type:"button",icon:$n,onClick:()=>s(null),title:`${Np("labels.alignRight")} — ${x("CtrlOrCmd+Shift+Right")}`,"aria-label":Np("labels.alignRight"),visible:je(At(e),t)})}),e({name:"alignVerticallyCentered",label:"labels.centerVertically",icon:Vn,trackEvent:{category:"element"},predicate:(e,t,s,n)=>xu(t,n),perform:(e,t,s,n)=>({appState:t,elements:fu(e,t,n,{position:"center",axis:"y"}),captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsx(Fp,{hidden:!xu(t,n),type:"button",icon:Vn,onClick:()=>s(null),title:Np("labels.centerVertically"),"aria-label":Np("labels.centerVertically"),visible:je(At(e),t)})}),e({name:"alignHorizontallyCentered",label:"labels.centerHorizontally",icon:Wn,trackEvent:{category:"element"},predicate:(e,t,s,n)=>xu(t,n),perform:(e,t,s,n)=>({appState:t,elements:fu(e,t,n,{position:"center",axis:"x"}),captureUpdate:Lt.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsx(Fp,{hidden:!xu(t,n),type:"button",icon:Wn,onClick:()=>s(null),title:Np("labels.centerHorizontally"),"aria-label":Np("labels.centerHorizontally"),visible:je(At(e),t)})});var bu=(e,t)=>{let s=t.scene.getSelectedElements(e);return s.length>1&&!s.some((e=>it(e)))},Eu=(e,t,s,n)=>{let i=((e,t,s)=>{let[n,i,a,l]="x"===s.axis?["minX","midX","maxX","width"]:["minY","midY","maxY","height"],r=Jn(e),o=Zo(e,t).map((e=>[e,Jn(e)])).sort(((e,t)=>e[1][i]-t[1][i])),d=0;for(let e of o)d+=e[1][l];let c=(r[l]-d)/(o.length-1);if(c<0){let e=o.findIndex((e=>e[1][n]===r[n])),t=o.findIndex((e=>e[1][a]===r[a])),l=(o[t][1][i]-o[e][1][i])/(o.length-1),d=o[e][1][i];return o.flatMap((([n,a],r)=>{let o={x:0,y:0};return r!==e&&r!==t&&(d+=l,o[s.axis]=d-a[i]),n.map((e=>Dt(e,{x:e.x+o.x,y:e.y+o.y})))}))}let p=r[n];return o.flatMap((([e,t])=>{let i={x:0,y:0};return i[s.axis]=p-t[n],p+=c,p+=t[l],e.map((e=>Dt(e,{x:e.x+i.x,y:e.y+i.y})))}))})(s.scene.getSelectedElements(t),s.scene.getNonDeletedElementsMap(),n),a=Ht(i);return qn(e.map((e=>a.get(e.id)||e)),t,s)};e({name:"distributeHorizontally",label:"labels.distributeHorizontally",trackEvent:{category:"element"},perform:(e,t,s,n)=>({appState:t,elements:Eu(e,t,n,{space:"between",axis:"x"}),captureUpdate:Lt.IMMEDIATELY}),keyTest:e=>!e[j.CTRL_OR_CMD]&&e.altKey&&e.code===Pt.H,PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsx(Fp,{hidden:!bu(t,n),type:"button",icon:Kn,onClick:()=>s(null),title:`${Np("labels.distributeHorizontally")} — ${x("Alt+H")}`,"aria-label":Np("labels.distributeHorizontally"),visible:je(At(e),t)})}),e({name:"distributeVertically",label:"labels.distributeVertically",trackEvent:{category:"element"},perform:(e,t,s,n)=>({appState:t,elements:Eu(e,t,n,{space:"between",axis:"y"}),captureUpdate:Lt.IMMEDIATELY}),keyTest:e=>!e[j.CTRL_OR_CMD]&&e.altKey&&e.code===Pt.V,PanelComponent:({elements:e,appState:t,updateData:s,app:n})=>gp.exports.jsx(Fp,{hidden:!bu(t,n),type:"button",icon:Zn,onClick:()=>s(null),title:`${Np("labels.distributeVertically")} — ${x("Alt+V")}`,"aria-label":Np("labels.distributeVertically"),visible:je(At(e),t)})});var yu=e({name:"flipHorizontal",label:"labels.flipHorizontal",icon:Xn,trackEvent:{category:"element"},perform:(e,t,s,n)=>({elements:qn(wu(e,n.scene.getNonDeletedElementsMap(),t,"horizontal",n),t,n),appState:t,captureUpdate:Lt.IMMEDIATELY}),keyTest:e=>e.shiftKey&&e.code===Pt.H}),vu=e({name:"flipVertical",label:"labels.flipVertical",icon:Qn,trackEvent:{category:"element"},perform:(e,t,s,n)=>({elements:qn(wu(e,n.scene.getNonDeletedElementsMap(),t,"vertical",n),t,n),appState:t,captureUpdate:Lt.IMMEDIATELY}),keyTest:e=>e.shiftKey&&e.code===Pt.V&&!e[j.CTRL_OR_CMD]}),wu=(e,t,s,n,i)=>{let a=S(At(e),s,{includeBoundTextElement:!0,includeElementsInFrames:!0}),l=Su(a,t,s,n,i),r=Ht(l);return e.map((e=>r.get(e.id)||e))},Su=(e,t,s,n,i)=>{if(e.every((e=>ut(e)&&(e.startBinding||e.endBinding))))return e.map((e=>{let t=e;return Dt(t,{startArrowhead:t.endArrowhead,endArrowhead:t.startArrowhead})}));let{midX:a,midY:l}=Jn(e);ei(e,t,"nw",i.scene,new Map(Array.from(t.values()).map((e=>[e.id,bt(e)]))),{flipByX:"horizontal"===n,flipByY:"vertical"===n,shouldResizeFromCenter:!0,shouldMaintainAspectRatio:!0}),si(e.filter(zt),t,i.scene.getNonDeletedElements(),i.scene,Re(s),[],s.zoom);let{elbowArrows:r,otherElements:o}=e.reduce(((e,t)=>V(t)?{...e,elbowArrows:e.elbowArrows.concat(t)}:{...e,otherElements:e.otherElements.concat(t)}),{elbowArrows:[],otherElements:[]}),{midX:d,midY:c}=Jn(e),[p,h]=[a-d,l-c];return o.forEach((e=>He(e,{x:e.x+p,y:e.y+h}))),r.forEach((e=>He(e,{x:e.x+p,y:e.y+h}))),e},Cu=e({name:"copy",label:"labels.copy",icon:Ut,trackEvent:{category:"element"},perform:async(e,t,s,n)=>{let i=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0});try{await ni(i,n.files,s)}catch(e){return{captureUpdate:Lt.EVENTUALLY,appState:{...t,errorMessage:e.message}}}return{captureUpdate:Lt.EVENTUALLY}},keyTest:void 0}),Iu=e({name:"paste",label:"labels.paste",trackEvent:{category:"element"},perform:async(e,t,s,n)=>{let i;try{i=await ii()}catch(e){return"AbortError"!==e.name&&"NotAllowedError"!==e.name&&(console.error(`actionPaste ${e.name}: ${e.message}`),ai?{captureUpdate:Lt.EVENTUALLY,appState:{...t,errorMessage:Np("hints.firefox_clipboard_write")}}:{captureUpdate:Lt.EVENTUALLY,appState:{...t,errorMessage:Np("errors.asyncPasteFailedOnRead")}})}try{n.pasteFromClipboard(li({types:i}))}catch(e){return console.error(e),{captureUpdate:Lt.EVENTUALLY,appState:{...t,errorMessage:Np("errors.asyncPasteFailedOnParse")}}}return{captureUpdate:Lt.EVENTUALLY}},keyTest:void 0}),ku=e({name:"cut",label:"labels.cut",icon:oi,trackEvent:{category:"element"},perform:(e,t,s,n)=>(Cu.perform(e,t,s,n),zp.perform(e,t,null,n)),keyTest:e=>e[j.CTRL_OR_CMD]&&e.key===j.X}),Tu=e({name:"copyAsSvg",label:"labels.copyAsSvg",icon:di,trackEvent:{category:"element"},perform:async(e,t,s,n)=>{if(!n.canvas)return{captureUpdate:Lt.EVENTUALLY};let{exportedElements:i,exportingFrame:a}=Wm(e,t,!0);try{await Km("clipboard-svg",i,t,n.files,{...t,exportingFrame:a,name:n.getName()});let e=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0});return{appState:{toast:{message:Np("toast.copyToClipboardAsSvg",{exportSelection:e.length?Np("toast.selection"):Np("toast.canvas"),exportColorScheme:t.exportWithDarkMode?Np("buttons.darkMode"):Np("buttons.lightMode")})}},captureUpdate:Lt.EVENTUALLY}}catch(e){return console.error(e),{appState:{errorMessage:e.message},captureUpdate:Lt.EVENTUALLY}}},predicate:e=>ci&&e.length>0,keywords:["svg","clipboard","copy"]}),Mu=e({name:"copyAsPng",label:"labels.copyAsPng",icon:hi,trackEvent:{category:"element"},perform:async(e,t,s,n)=>{if(!n.canvas)return{captureUpdate:Lt.EVENTUALLY};let i=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0}),{exportedElements:a,exportingFrame:l}=Wm(e,t,!0);try{return await Km("clipboard",a,t,n.files,{...t,exportingFrame:l,name:n.getName()}),{appState:{...t,toast:{message:Np("toast.copyToClipboardAsPng",{exportSelection:i.length?Np("toast.selection"):Np("toast.canvas"),exportColorScheme:t.exportWithDarkMode?Np("buttons.darkMode"):Np("buttons.lightMode")})}},captureUpdate:Lt.EVENTUALLY}}catch(e){return console.error(e),{appState:{...t,errorMessage:e.message},captureUpdate:Lt.EVENTUALLY}}},predicate:e=>mi&&e.length>0,keyTest:e=>e.code===Pt.C&&e.altKey&&e.shiftKey,keywords:["png","clipboard","copy"]}),ju=e({name:"copyText",label:"labels.copyText",trackEvent:{category:"element"},perform:(e,t,s,n)=>{let i=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0});try{ve(gi(i))}catch{throw new Error(Np("errors.copyToSystemClipboardFailed"))}return{captureUpdate:Lt.EVENTUALLY}},predicate:(e,t,s,n)=>ci&&n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0}).some(tt),keywords:["text","clipboard","copy"]}),Du=e({name:"gridMode",icon:xi,keywords:["snap"],label:"labels.toggleGrid",viewMode:!0,trackEvent:{category:"canvas",predicate:e=>e.gridModeEnabled},perform(e,t){return{appState:{...t,gridModeEnabled:!this.checked(t),objectsSnapModeEnabled:!1},captureUpdate:Lt.EVENTUALLY}},checked:e=>e.gridModeEnabled,predicate:(e,t,s)=>void 0===s.gridModeEnabled,keyTest:e=>e[j.CTRL_OR_CMD]&&e.code===Pt.QUOTE}),Lu=e({name:"zenMode",label:"buttons.zenMode",icon:fi,paletteName:"Toggle zen mode",viewMode:!0,trackEvent:{category:"canvas",predicate:e=>!e.zenModeEnabled},perform(e,t){return{appState:{...t,zenModeEnabled:!this.checked(t)},captureUpdate:Lt.EVENTUALLY}},checked:e=>e.zenModeEnabled,predicate:(e,t,s)=>typeof s.zenModeEnabled>"u",keyTest:e=>!e[j.CTRL_OR_CMD]&&e.altKey&&e.code===Pt.Z}),Nu=e({name:"objectsSnapMode",label:"buttons.objectsSnapMode",icon:bi,viewMode:!1,trackEvent:{category:"canvas",predicate:e=>!e.objectsSnapModeEnabled},perform(e,t){return{appState:{...t,objectsSnapModeEnabled:!this.checked(t),gridModeEnabled:!1},captureUpdate:Lt.EVENTUALLY}},checked:e=>e.objectsSnapModeEnabled,predicate:(e,t,s)=>typeof s.objectsSnapModeEnabled>"u",keyTest:e=>!e[j.CTRL_OR_CMD]&&e.altKey&&e.code===Pt.S}),Au=e({name:"stats",label:"stats.fullTitle",icon:Ei,paletteName:"Toggle stats",viewMode:!0,trackEvent:{category:"menu"},keywords:["edit","attributes","customize"],perform(e,t){return{appState:{...t,stats:{...t.stats,open:!this.checked(t)}},captureUpdate:Lt.EVENTUALLY}},checked:e=>e.stats.open,keyTest:e=>!e[j.CTRL_OR_CMD]&&e.altKey&&e.code===Pt.SLASH}),_u=e({name:"unbindText",label:"labels.unbindText",trackEvent:{category:"element"},predicate:(e,t,s,n)=>n.scene.getSelectedElements(t).some((e=>Wt(e))),perform:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t),a=n.scene.getNonDeletedElementsMap();return i.forEach((e=>{let t=Kt(e,a);if(t){let{width:s,height:n}=qe(t.originalText,We(t),t.lineHeight),i=yi(e.id);wi(e.id);let{x:l,y:r}=Si(e,t,a);He(t,{containerId:null,width:s,height:n,text:t.originalText,x:l,y:r}),He(e,{boundElements:e.boundElements?.filter((e=>e.id!==t.id)),height:i||e.height})}})),{elements:e,appState:t,captureUpdate:Lt.IMMEDIATELY}}}),Pu=e({name:"bindText",label:"labels.bindText",trackEvent:{category:"element"},predicate:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t);if(2===i.length){let e,t=tt(i[0])||tt(i[1]);if(ht(i[0])?e=i[0]:ht(i[1])&&(e=i[1]),t&&e&&null===Kt(e,n.scene.getNonDeletedElementsMap()))return!0}return!1},perform:(e,t,s,n)=>{let i,a,l=n.scene.getSelectedElements(t);tt(l[0])&&ht(l[1])?(i=l[0],a=l[1]):(i=l[1],a=l[0]),He(i,{containerId:a.id,verticalAlign:js.MIDDLE,textAlign:Ci.CENTER,autoResize:!0}),He(a,{boundElements:(a.boundElements||[]).concat({type:"text",id:i.id})});let r=a.height;return Is(i,a,n.scene.getNonDeletedElementsMap()),Ii(a.id,r),{elements:Ru(e,a,i),appState:{...t,selectedElementIds:{[a.id]:!0}},captureUpdate:Lt.IMMEDIATELY}}}),Ru=(e,t,s)=>{let n=e.slice(),i=n.findIndex((e=>e.id===s.id));n.splice(i,1);let a=n.findIndex((e=>e.id===t.id));return n.splice(a+1,0,s),An(n,Ht([t,s])),n},Ou=(e,t,s)=>{let n=e.slice(),i=n.findIndex((e=>e.id===t.id));n.splice(i,1);let a=n.findIndex((e=>e.id===s.id));return n.splice(a,0,t),An(n,Ht([t,s])),n},Fu=e({name:"wrapTextInContainer",label:"labels.createContainerFromText",trackEvent:{category:"element"},predicate:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t),a=i.every((e=>tt(e)));return i.length>0&&a},perform:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t),a=e.slice(),l={};for(let e of i)if(tt(e)){let s=ki({type:"rectangle",backgroundColor:t.currentItemBackgroundColor,boundElements:[...e.boundElements||[],{id:e.id,type:"text"}],angle:e.angle,fillStyle:t.currentItemFillStyle,strokeColor:t.currentItemStrokeColor,roughness:t.currentItemRoughness,strokeWidth:t.currentItemStrokeWidth,strokeStyle:t.currentItemStrokeStyle,roundness:"round"===t.currentItemRoundness?{type:Et("rectangle")?yt.ADAPTIVE_RADIUS:yt.PROPORTIONAL_RADIUS}:null,opacity:100,locked:!1,x:e.x-Ti,y:e.y-Ti,width:Mi(e.width,"rectangle"),height:Mi(e.height,"rectangle"),groupIds:e.groupIds,frameId:e.frameId});if(e.boundElements?.length){let t=e.boundElements.filter((e=>"arrow"===e.type)).map((e=>e.id));a.filter((e=>t.includes(e.id))).forEach((t=>{let n=t.startBinding,i=t.endBinding;n?.elementId===e.id&&(n={...n,elementId:s.id}),i?.elementId===e.id&&(i={...i,elementId:s.id}),(n||i)&&He(t,{startBinding:n,endBinding:i},!1)}))}He(e,{containerId:s.id,verticalAlign:js.MIDDLE,boundElements:null,textAlign:Ci.CENTER,autoResize:!0},!1),Is(e,s,n.scene.getNonDeletedElementsMap()),a=Ou([...a,s],s,e),l[s.id]=!0}return{elements:a,appState:{...t,selectedElementIds:l},captureUpdate:Lt.IMMEDIATELY}}}),Bu=!1,zu=new Map,Uu=({element:e,elementsMap:t,setAppState:s,onLinkOpen:n,setToast:i,updateEmbedValidationStatus:a})=>{let l=sv(),r=Qy(),d=Jy(),c=e.link||"",[p,h]=Mc(c),m=jc(null),u="editor"===l.showHyperlinkPopup,g=Ac((()=>{if(!m.current)return;let t=ji(m.current.value)||null;if(!e.link&&t&&dh("hyperlink","create"),ne(e)){if(l.activeEmbeddable?.element===e&&s({activeEmbeddable:null}),!t)return He(e,{link:null}),void a(e,!1);if(Di(t,r.validateEmbeddable)){let{width:s,height:n}=e,l=oe(t);l?.error instanceof URIError&&i({message:Np("toast.unrecognizedLinkFormat"),closable:!0});let r=l?l.intrinsicSize.w/l.intrinsicSize.h:1,o=zu.get(e.id)!==e.link;He(e,{...o?{width:"video"===l?.type?s>n?s:n*r:s,height:"video"===l?.type&&s>n?s/r:n}:{},link:t}),a(e,!0),zu.has(e.id)&&zu.delete(e.id)}else t&&i({message:Np("toast.unableToEmbed"),closable:!0}),e.link&&zu.set(e.id,e.link),He(e,{link:t}),a(e,!1)}else He(e,{link:t})}),[e,i,r.validateEmbeddable,l.activeEmbeddable,s,a]);Rc((()=>()=>{g()}),[g]),Dc((()=>{u&&m?.current&&!d.viewport.isMobile&&!d.isTouchScreen&&m.current.select()}),[u,d.viewport.isMobile,d.isTouchScreen]),Dc((()=>{let n=null,i=i=>{u||(n&&clearTimeout(n),Wu(e,t,l,an(i.clientX,i.clientY))&&(n=window.setTimeout((()=>{s({showHyperlinkPopup:!1})}),500)))};return window.addEventListener("pointermove",i,!1),()=>{window.removeEventListener("pointermove",i,!1),n&&clearTimeout(n)}}),[l,e,u,s,t]);let x=Ac((()=>{dh("hyperlink","delete"),He(e,{link:null}),s({showHyperlinkPopup:!1})}),[s,e]),{x:f,y:b}=Hu(e,l,t);return l.contextMenu||l.selectedElementsAreBeingDragged||l.resizingElement||l.isRotating||l.openMenu||l.viewModeEnabled?null:gp.exports.jsxs("div",{className:"excalidraw-hyperlinkContainer",style:{top:`${b}px`,left:`${f}px`,width:380,padding:5},children:[u?gp.exports.jsx("input",{className:Vc("excalidraw-hyperlinkContainer-input"),placeholder:Np("labels.link.hint"),ref:m,value:p,onChange:e=>h(e.target.value),autoFocus:!0,onKeyDown:e=>{e.stopPropagation(),e[j.CTRL_OR_CMD]&&e.key===j.K&&e.preventDefault(),(e.key===j.ENTER||e.key===j.ESCAPE)&&(g(),s({showHyperlinkPopup:"info"}))}}):e.link?gp.exports.jsx("a",{href:ji(e.link||""),className:"excalidraw-hyperlinkContainer-link",target:Li(e.link)?"_self":"_blank",onClick:t=>{if(e.link&&n){let s=Ni("excalidraw-link",t.nativeEvent);n({...e,link:ji(e.link)},s),s.defaultPrevented&&t.preventDefault()}},rel:"noopener noreferrer",children:e.link}):gp.exports.jsx("div",{className:"excalidraw-hyperlinkContainer-link",children:Np("labels.link.empty")}),gp.exports.jsxs("div",{className:"excalidraw-hyperlinkContainer__buttons",children:[!u&&gp.exports.jsx(Fp,{type:"button",title:Np("buttons.edit"),"aria-label":Np("buttons.edit"),label:Np("buttons.edit"),onClick:()=>{dh("hyperlink","edit","popup-ui"),s({showHyperlinkPopup:"editor"})},className:"excalidraw-hyperlinkContainer--edit",icon:o}),gp.exports.jsx(Fp,{type:"button",title:Np("labels.linkToElement"),"aria-label":Np("labels.linkToElement"),label:Np("labels.linkToElement"),onClick:()=>{s({openDialog:{name:"elementLinkSelector",sourceElementId:e.id}})},icon:Ai}),c&&!ne(e)&&gp.exports.jsx(Fp,{type:"button",title:Np("buttons.remove"),"aria-label":Np("buttons.remove"),label:Np("buttons.remove"),onClick:x,className:"excalidraw-hyperlinkContainer--remove",icon:jt})]})]})},Hu=(e,t,s)=>{let[n,i]=mt(e,s),{x:a,y:l}=ie({sceneX:n+e.width/2,sceneY:i},t);return{x:a-t.offsetLeft-190,y:l-t.offsetTop-85}},Yu=(e,t)=>{let s=S(e,t);return ne(s[0])?"labels.link.editEmbed":s[0]?.link?"labels.link.edit":"labels.link.create"},Gu=null,$u=(e,t,s)=>{if(!e.link)return;let n=Nm();n.classList.add("excalidraw-tooltip--visible"),n.style.maxWidth="20rem",n.textContent=Wa(e.link)?Np("labels.link.goToElement"):e.link;let[i,a,l,r]=mt(e,s),[o,d,c,p]=fo([i,a,l,r],e.angle,t),h=ie({sceneX:o,sceneY:d},t);Am(n,{left:h.x,top:h.y,width:c,height:p},"top"),dh("hyperlink","tooltip","link-icon"),Bu=!0},Vu=()=>{Gu&&clearTimeout(Gu),Bu&&(Bu=!1,Nm().classList.remove("excalidraw-tooltip--visible"))},Wu=(e,t,s,[n,i])=>{let{x:a,y:l}=Ge({clientX:n,clientY:i},s),r=15/s.zoom.value;if(bo(a,l,e,t))return!1;let[o,d,c]=mt(e,t);if(a>=o&&a<=c&&l>=d-85&&l<=d)return!1;let{x:p,y:h}=Hu(e,s,t);return!(n>=p-r&&n<=p+380+10+r&&i>=h-r&&i<=h+r+10+42)},Ku=e({name:"hyperlink",label:(e,t)=>Yu(e,t),icon:_i,perform:(e,t)=>"editor"!==t.showHyperlinkPopup&&{elements:e,appState:{...t,showHyperlinkPopup:"editor",openMenu:null},captureUpdate:Lt.IMMEDIATELY},trackEvent:{category:"hyperlink",action:"click"},keyTest:e=>e[j.CTRL_OR_CMD]&&e.key===j.K,predicate:(e,t)=>1===S(e,t).length,PanelComponent:({elements:e,appState:t,updateData:s})=>{let n=S(e,t);return gp.exports.jsx(Fp,{type:"button",icon:_i,"aria-label":Np(Yu(e,t)),title:`${ne(e[0])?Np("labels.link.labelEmbed"):Np("labels.link.label")} - ${x("CtrlOrCmd+K")}`,onClick:()=>s(null),selected:1===n.length&&!!n[0].link})}}),Zu=e=>e.every((e=>!e.locked)),Xu=e({name:"toggleElementLock",label:(e,t,s)=>{let n=s.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!1});return 1!==n.length||it(n[0])?Zu(n)?"labels.elementLock.lockAll":"labels.elementLock.unlockAll":n[0].locked?"labels.elementLock.unlock":"labels.elementLock.lock"},icon:(e,t)=>{let s=S(t,e);return Zu(s)?k:M},trackEvent:{category:"element"},predicate:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t);return i.length>0&&!i.some((e=>e.locked&&e.frameId))},perform:(e,t,s,n)=>{let i=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0});if(!i.length)return!1;let a=Zu(i),l=Ht(i);return{elements:e.map((e=>l.has(e.id)?Dt(e,{locked:a}):e)),appState:{...t,selectedLinearElement:a?null:t.selectedLinearElement},captureUpdate:Lt.IMMEDIATELY}},keyTest:(e,t,s,n)=>e.key.toLocaleLowerCase()===j.L&&e[j.CTRL_OR_CMD]&&e.shiftKey&&n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!1}).length>0}),qu=e({name:"unlockAllElements",paletteName:"Unlock all elements",trackEvent:{category:"canvas"},viewMode:!1,icon:M,predicate:(e,t)=>0===S(e,t).length&&e.some((e=>e.locked)),perform:(e,t)=>{let s=e.filter((e=>e.locked));return{elements:e.map((e=>e.locked?Dt(e,{locked:!1}):e)),appState:{...t,selectedElementIds:Object.fromEntries(s.map((e=>[e.id,!0])))},captureUpdate:Lt.IMMEDIATELY}},label:"labels.elementLock.unlockAll"}),Qu=e=>{let{closeOnClickOutside:t=!0}=e,s=Fh({className:"excalidraw-modal-container"}),n=jc(document.body.classList.contains("excalidraw-animations-disabled"));if(!s)return null;return Zc(gp.exports.jsxs("div",{className:Vc("Modal",e.className,{"animations-disabled":n.current}),role:"dialog","aria-modal":"true",onKeyDown:t=>{t.key===j.ESCAPE&&(t.nativeEvent.stopImmediatePropagation(),t.stopPropagation(),e.onCloseRequest())},"aria-labelledby":e.labelledBy,"data-prevent-outside-click":!0,children:[gp.exports.jsx("div",{className:"Modal__background",onClick:t?e.onCloseRequest:void 0}),gp.exports.jsx("div",{className:"Modal__content",style:{"--max-width":`${e.maxWidth}px`},tabIndex:0,children:e.children})]}),s)},Ju=Gc(new Map),eg=async e=>await Eo({elements:e,appState:{exportBackground:!1,viewBackgroundColor:re.white},files:null,renderEmbeddables:!1,skipInliningFonts:!0}),tg=()=>{let[e]=fp(Ju);return{clearLibraryCache:()=>e.clear(),deleteItemsFromLibraryCache:t=>{t.forEach((t=>e.delete(t)))},svgCache:e}},sg=new c,ng=Gc({status:"loaded",isInitialized:!1,libraryItems:[]}),ig=e=>io(e),ag=(e,t)=>!e.find((e=>e.elements.length===t.elements.length&&e.elements.every(((e,s)=>e.id===t.elements[s].id&&e.versionNonce===t.elements[s].versionNonce)))),lg=(e,t)=>{let s=[];for(let n of t)ag(e,n)&&s.push(n);return[...s,...e]},rg=class{constructor(e){Cc(this,"currLibraryItems",[]),Cc(this,"prevLibraryItems",ig(this.currLibraryItems)),Cc(this,"app"),Cc(this,"updateQueue",[]),Cc(this,"getLastUpdateTask",(()=>this.updateQueue[this.updateQueue.length-1])),Cc(this,"notifyListeners",(()=>{if(this.updateQueue.length>0)wp.set(ng,(e=>({status:"loading",libraryItems:this.currLibraryItems,isInitialized:e.isInitialized})));else{wp.set(ng,{status:"loaded",libraryItems:this.currLibraryItems,isInitialized:!0});try{let e=this.prevLibraryItems;this.prevLibraryItems=ig(this.currLibraryItems);let t=ig(this.currLibraryItems);this.app.props.onLibraryChange?.(t),sg.trigger(((e,t)=>{let s=Ht(t),n={deletedItems:new Map,addedItems:new Map};for(let t of e)s.has(t.id)||n.deletedItems.set(t.id,t);let i=Ht(e);for(let e of t)i.has(e.id)||n.addedItems.set(e.id,e);return n})(e,t),t)}catch(e){console.error(e)}}})),Cc(this,"destroy",(()=>{this.updateQueue=[],this.currLibraryItems=[],wp.set(Ju,new Map)})),Cc(this,"resetLibrary",(()=>this.setLibrary([]))),Cc(this,"getLatestLibrary",(()=>new Promise((async e=>{try{let t=await(this.getLastUpdateTask()||this.currLibraryItems);this.updateQueue.length>0?e(this.getLatestLibrary()):e(ig(t))}catch{return e(this.currLibraryItems)}})))),Cc(this,"updateLibrary",(async({libraryItems:e,prompt:t=!1,merge:s=!1,openLibraryMenu:n=!1,defaultStatus:i="unpublished"})=>(n&&this.app.setState({openSidebar:{name:v.name,tab:yo}}),this.setLibrary((()=>new Promise((async(n,a)=>{try{let l,r=await("function"!=typeof e||e instanceof Blob?e:e(this.currLibraryItems));l=r instanceof Blob?await vo(r,i):wo(r,i),!t||window.confirm(Np("alerts.confirmAddLibrary",{numShapes:l.length}))?(t&&this.app.focusContainer(),n(s?lg(this.currLibraryItems,l):l)):a(new Mt)}catch(e){a(e)}}))))))),Cc(this,"setLibrary",(e=>{let t=new Promise((async(t,s)=>{try{await this.getLastUpdateTask(),"function"==typeof e&&(e=e(this.currLibraryItems)),this.currLibraryItems=ig(await e),t(this.currLibraryItems)}catch(e){s(e)}})).catch((e=>{if("AbortError"===e.name)return console.warn("Library update aborted by user"),this.currLibraryItems;throw e})).finally((()=>{this.updateQueue=this.updateQueue.filter((e=>e!==t)),this.notifyListeners()}));return this.updateQueue.push(t),this.notifyListeners(),t})),this.app=e}},og=e=>{let t=Math.ceil(Math.sqrt(e.length)),s=[],n=s=>e.slice(s*t,s*t+t).reduce(((e,t)=>{let{height:s}=Jn(t.elements);return Math.max(e,s)}),0),i=s=>{let n=0,i=0,a=0;for(let l of e){if(n%t==0&&(i=0),i===s){let{width:e}=Jn(l.elements);a=Math.max(a,e)}n++,i++}return a},a=0,l=0,r=0,o=0,d=0,c=0,p=0;for(let h of e){d&&d%t==0&&(l+=r+50,a=0,c=0,p++),0===c&&(r=n(p)),o=i(c);let{minX:e,minY:m,width:u,height:g}=Jn(h.elements),x=(o-u)/2,f=(r-g)/2;s.push(...h.elements.map((t=>({...t,x:t.x+a+x-e,y:t.y+l+f-m})))),a+=o+50,d++,c++}return s},dg=class e{constructor(e){Cc(this,"adapter"),this.adapter=e}static async getLibraryItems(t,s,n=!0){let i=()=>new Promise((async(e,n)=>{try{let n=await t.load({source:s});e(wo(n?.libraryItems||[],"published"))}catch(e){n(e)}}));return n?e.queue.push(i):i()}getLibraryItems(t){return e.getLibraryItems(this.adapter,t,!1)}};Cc(dg,"queue",new class{constructor(){Cc(this,"jobs",[]),Cc(this,"running",!1)}tick(){if(this.running)return;let e=this.jobs.shift();e?(this.running=!0,e.promise.resolve(Pi(e.jobFactory,...e.args).finally((()=>{this.running=!1,this.tick()})))):this.running=!1}push(e,...t){let s=Ri();return this.jobs.push({jobFactory:e,promise:s,args:t}),this.tick(),s}}),Cc(dg,"run",(async(e,t)=>{let s=new dg(e);return dg.queue.push((()=>t(s)))}));var cg=Lc((({children:e,gap:t,align:s,justifyContent:n,className:i,style:a},l)=>gp.exports.jsx("div",{className:Vc("Stack Stack_horizontal",i),style:{"--gap":t,alignItems:s,justifyContent:n,...a},ref:l,children:e}))),pg=Lc((({children:e,gap:t,align:s,justifyContent:n,className:i,style:a},l)=>gp.exports.jsx("div",{className:Vc("Stack Stack_vertical",i),style:{"--gap":t,justifyItems:s,justifyContent:n,...a},ref:l,children:e}))),hg={Row:cg,Col:pg},mg=({theme:e,id:t,libraryReturnUrl:s})=>{let n=s||window.location.origin+window.location.pathname;return gp.exports.jsx("a",{className:"library-menu-browse-button",href:`${vc.VITE_APP_LIBRARY_URL}?target=${window.name||"_blank"}&referrer=${n}&useHash=true&token=${t}&theme=${e}&version=${Xo.excalidrawLibrary}`,target:"_excalidraw_libraries",children:Np("labels.libraries")})},ug=({libraryReturnUrl:e,theme:t,id:s,style:n,children:i,className:a})=>gp.exports.jsxs("div",{className:Vc("library-menu-control-buttons",a),style:n,children:[gp.exports.jsx(mg,{id:s,libraryReturnUrl:e,theme:t}),i]}),gg=/({{[\w-]+}})|(<[\w-]+>)|(<\/[\w-]+>)/g,xg=/{{([\w-]+)}}/,fg=/<([\w-]+)>/,bg=/<\/([\w-]+)>/,Eg=({i18nKey:e,children:t,...s})=>{let{t:n}=_p();return Tc.createElement(Tc.Fragment,{},...((e,t)=>{let s=[{name:"",children:[]}];return e.split(gg).filter(Boolean).forEach((n=>{let i=n.match(fg),a=n.match(bg),l=n.match(xg);if(null!==i){let n=i[1];t.hasOwnProperty(n)?s.push({name:n,children:[]}):console.warn(`Trans: missed to pass in prop ${n} for interpolating ${e}`)}else if(null!==a)if(a[1]===s[s.length-1].name){let e=s.pop(),n=Tc.createElement(Tc.Fragment,{},...e.children),i=t[e.name];"function"==typeof i&&s[s.length-1].children.push(i(n))}else console.warn(`Trans: unexpected end tag ${n} for interpolating ${e}`);else if(null!==l){let n=l[1];t.hasOwnProperty(n)?s[s.length-1].children.push(t[n]):console.warn(`Trans: key ${n} not in props for interpolating ${e}`)}else s[s.length-1].children.push(n)})),1!==s.length&&console.warn(`Trans: stack not empty for interpolating ${e}`),s[0].children})(n(e),s))},yg=({label:e,onClick:t,className:s,children:n,actionType:i,type:a="button",isLoading:l,...r})=>{let o=i?`Dialog__action-button--${i}`:"";return gp.exports.jsxs("button",{className:Vc("Dialog__action-button",o,s),type:a,"aria-label":e,onClick:t,...r,children:[n&&gp.exports.jsx("div",{style:l?{visibility:"hidden"}:{},children:n}),gp.exports.jsx("div",{style:l?{visibility:"hidden"}:{},children:e}),l&&gp.exports.jsx("div",{style:{position:"absolute",inset:0},children:gp.exports.jsx(Pp,{})})]})},vg=e=>{let{onConfirm:t,onCancel:s,children:n,confirmText:i=Np("buttons.confirm"),cancelText:a=Np("buttons.cancel"),className:l="",...r}=e,o=nv(),d=bp(Vg),{container:c}=ev();return gp.exports.jsxs(Jg,{onCloseRequest:s,size:"small",...r,className:`confirm-dialog ${l}`,children:[n,gp.exports.jsxs("div",{className:"confirm-dialog-buttons",children:[gp.exports.jsx(yg,{label:a,onClick:()=>{o({openMenu:null}),d(!1),Kc((()=>{s()})),c?.focus()}}),gp.exports.jsx(yg,{label:i,onClick:()=>{o({openMenu:null}),d(!1),Kc((()=>{t()})),c?.focus()},actionType:"danger"})]})]})},wg=class{static has(e){try{return!!window.localStorage.getItem(e)}catch(e){return console.warn(`localStorage.getItem error: ${e.message}`),!1}}static get(e){try{let t=window.localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return console.warn(`localStorage.getItem error: ${e.message}`),null}}};Cc(wg,"set",((e,t)=>{try{return window.localStorage.setItem(e,JSON.stringify(t)),!0}catch(e){return console.warn(`localStorage.setItem error: ${e.message}`),!1}})),Cc(wg,"delete",(e=>{try{window.localStorage.removeItem(e)}catch(e){console.warn(`localStorage.removeItem error: ${e.message}`)}}));var Sg=({libItem:e,appState:t,index:s,onChange:n,onRemove:i})=>{let a=jc(null),l=jc(null);return Dc((()=>{let s=a.current;s&&(async()=>{let n=await Eo({elements:e.elements,appState:{...t,viewBackgroundColor:ip.white,exportBackground:!0},files:null,skipInliningFonts:!0});s.innerHTML=n.outerHTML})()}),[e.elements,t]),gp.exports.jsxs("div",{className:"single-library-item",children:["published"===e.status&&gp.exports.jsx("span",{className:"single-library-item-status",children:Np("labels.statusPublished")}),gp.exports.jsx("div",{ref:a,className:"single-library-item__svg"}),gp.exports.jsx(Fp,{"aria-label":Np("buttons.remove"),type:"button",icon:H,className:"single-library-item--remove",onClick:i.bind(null,e.id),title:Np("buttons.remove")}),gp.exports.jsxs("div",{style:{display:"flex",margin:"0.8rem 0",width:"100%",fontSize:"14px",fontWeight:500,flexDirection:"column"},children:[gp.exports.jsxs("label",{style:{display:"flex",justifyContent:"space-between",flexDirection:"column"},children:[gp.exports.jsxs("div",{style:{padding:"0.5em 0"},children:[gp.exports.jsx("span",{style:{fontWeight:500,color:ip.gray[6]},children:Np("publishDialog.itemName")}),gp.exports.jsx("span",{"aria-hidden":"true",className:"required",children:"*"})]}),gp.exports.jsx("input",{type:"text",ref:l,style:{width:"80%",padding:"0.2rem"},defaultValue:e.name,placeholder:"Item name",onChange:e=>{n(e.target.value,s)}})]}),gp.exports.jsx("span",{className:"error",children:e.error})]})]})},Cg=({onClose:e,libraryItems:t,appState:s,onSuccess:n,onError:i,updateItemsInStorage:a,onRemove:l})=>{let[r,o]=Mc({authorName:"",githubHandle:"",name:"",description:"",twitterHandle:"",website:""}),[d,c]=Mc(!1);Dc((()=>{let e=wg.get(bd.PUBLISH_LIBRARY);e&&o(e)}),[]);let[p,h]=Mc(t.slice());Dc((()=>{h(t.slice())}),[t]);let m=e=>{o({...r,[e.target.name]:e.target.value})},u=Ac((()=>{a(p),wg.set(bd.PUBLISH_LIBRARY,r),e()}),[p,e,a,r]),g=!!t.length,x=t.some((e=>"published"===e.status));return gp.exports.jsx(Jg,{onCloseRequest:u,title:Np("publishDialog.title"),className:"publish-library",children:g?gp.exports.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c(!0);let t=[],s=!1;if(p.forEach((e=>{let n="";e.name||(n=Np("publishDialog.errors.required"),s=!0),t.push({...e,error:n})})),s)return h(t),void c(!1);let a=await(async e=>{let t=Math.round(8),s=Math.max(Math.round(2),2),n=bc(e,6),i=document.createElement("canvas");i.width=128*n[0].length+(n[0].length+1)*(2*t)-2*t,i.height=128*n.length+(n.length+1)*(2*t)-2*t;let a=i.getContext("2d");a.fillStyle=ip.white,a.fillRect(0,0,i.width,i.height);for(let[n,i]of e.entries()){let e=await Xd({elements:i.elements,files:null,maxWidthOrHeight:128}),{width:l,height:r}=e,o=Math.floor(n/6)*(128+2*t),d=n%6*(128+2*t);a.drawImage(e,d+(128-l)/2+t,o+(128-r)/2+t),a.lineWidth=s,a.strokeStyle=ip.gray[4],a.strokeRect(d+t/2,o+t/2,128+t,128+t)}return await sr(new File([await oo(i)],"preview",{type:Fi.png}),{outputType:Fi.jpg,maxWidthOrHeight:5e3})})(p),l={type:Ec.excalidrawLibrary,version:Xo.excalidrawLibrary,source:yc,libraryItems:p},o=JSON.stringify(l,null,2),d=new Blob([o],{type:"application/json"}),m=new FormData;m.append("excalidrawLib",d),m.append("previewImage",a),m.append("previewImageType",a.type),m.append("title",r.name),m.append("authorName",r.authorName),m.append("githubHandle",r.githubHandle),m.append("name",r.name),m.append("description",r.description),m.append("twitterHandle",r.twitterHandle),m.append("website",r.website),fetch(`${vc.VITE_APP_LIBRARY_BACKEND}/submit`,{method:"post",body:m}).then((e=>e.ok?e.json().then((({url:e})=>{wg.delete(bd.PUBLISH_LIBRARY),n({url:e,authorName:r.authorName,items:p})})):e.json().catch((()=>{throw new Error(e.statusText||"something went wrong")})).then((t=>{throw new Error(t.message||e.statusText||"something went wrong")}))),(e=>{console.error(e),i(e),c(!1)})).catch((e=>{console.error(e),i(e),c(!1)}))},children:[gp.exports.jsx("div",{className:"publish-library-note",children:gp.exports.jsx(Eg,{i18nKey:"publishDialog.noteDescription",link:e=>gp.exports.jsx("a",{href:"https://libraries.excalidraw.com",target:"_blank",rel:"noopener noreferrer",children:e})})}),gp.exports.jsx("span",{className:"publish-library-note",children:gp.exports.jsx(Eg,{i18nKey:"publishDialog.noteGuidelines",link:e=>gp.exports.jsx("a",{href:"https://github.com/excalidraw/excalidraw-libraries#guidelines",target:"_blank",rel:"noopener noreferrer",children:e})})}),gp.exports.jsx("div",{className:"publish-library-note",children:Np("publishDialog.noteItems")}),x&&gp.exports.jsx("span",{className:"publish-library-note publish-library-warning",children:Np("publishDialog.republishWarning")}),(()=>{let e=[];return p.forEach(((t,n)=>{e.push(gp.exports.jsx("div",{className:"single-library-item-wrapper",children:gp.exports.jsx(Sg,{libItem:t,appState:s,index:n,onChange:(e,t)=>{let s=p.slice();s[t].name=e,h(s)},onRemove:l})},n))})),gp.exports.jsx("div",{className:"selected-library-items",children:e})})(),gp.exports.jsxs("div",{className:"publish-library__fields",children:[gp.exports.jsxs("label",{children:[gp.exports.jsxs("div",{children:[gp.exports.jsx("span",{children:Np("publishDialog.libraryName")}),gp.exports.jsx("span",{"aria-hidden":"true",className:"required",children:"*"})]}),gp.exports.jsx("input",{type:"text",name:"name",required:!0,value:r.name,onChange:m,placeholder:Np("publishDialog.placeholder.libraryName")})]}),gp.exports.jsxs("label",{style:{alignItems:"flex-start"},children:[gp.exports.jsxs("div",{children:[gp.exports.jsx("span",{children:Np("publishDialog.libraryDesc")}),gp.exports.jsx("span",{"aria-hidden":"true",className:"required",children:"*"})]}),gp.exports.jsx("textarea",{name:"description",rows:4,required:!0,value:r.description,onChange:m,placeholder:Np("publishDialog.placeholder.libraryDesc")})]}),gp.exports.jsxs("label",{children:[gp.exports.jsxs("div",{children:[gp.exports.jsx("span",{children:Np("publishDialog.authorName")}),gp.exports.jsx("span",{"aria-hidden":"true",className:"required",children:"*"})]}),gp.exports.jsx("input",{type:"text",name:"authorName",required:!0,value:r.authorName,onChange:m,placeholder:Np("publishDialog.placeholder.authorName")})]}),gp.exports.jsxs("label",{children:[gp.exports.jsx("span",{children:Np("publishDialog.githubUsername")}),gp.exports.jsx("input",{type:"text",name:"githubHandle",value:r.githubHandle,onChange:m,placeholder:Np("publishDialog.placeholder.githubHandle")})]}),gp.exports.jsxs("label",{children:[gp.exports.jsx("span",{children:Np("publishDialog.twitterUsername")}),gp.exports.jsx("input",{type:"text",name:"twitterHandle",value:r.twitterHandle,onChange:m,placeholder:Np("publishDialog.placeholder.twitterHandle")})]}),gp.exports.jsxs("label",{children:[gp.exports.jsx("span",{children:Np("publishDialog.website")}),gp.exports.jsx("input",{type:"text",name:"website",pattern:"https?://.+",title:Np("publishDialog.errors.website"),value:r.website,onChange:m,placeholder:Np("publishDialog.placeholder.website")})]}),gp.exports.jsx("span",{className:"publish-library-note",children:gp.exports.jsx(Eg,{i18nKey:"publishDialog.noteLicense",link:e=>gp.exports.jsx("a",{href:"https://github.com/excalidraw/excalidraw-libraries/blob/main/LICENSE",target:"_blank",rel:"noopener noreferrer",children:e})})})]}),gp.exports.jsxs("div",{className:"publish-library__buttons",children:[gp.exports.jsx(yg,{label:Np("buttons.cancel"),onClick:u,"data-testid":"cancel-clear-canvas-button"}),gp.exports.jsx(yg,{type:"submit",label:Np("buttons.submit"),actionType:"primary",isLoading:d})]})]}):gp.exports.jsx("p",{style:{padding:"1em",textAlign:"center",fontWeight:500},children:Np("publishDialog.atleastOneLibItem")})})},Ig=({className:e="",children:t,onToggle:s,title:n,...i})=>{let a=Jy(),l=Vc(`dropdown-menu-button ${e}`,"zen-mode-transition",{"dropdown-menu-button--mobile":a.editor.isMobile}).trim();return gp.exports.jsx("button",{"data-prevent-outside-click":!0,className:l,onClick:s,type:"button","data-testid":"dropdown-menu-button",title:n,...i,children:t})},kg=Ig;Ig.displayName="DropdownMenuTrigger";var Tg=()=>gp.exports.jsx("div",{style:{height:"1px",backgroundColor:"var(--default-border-color)",margin:".5rem 0"}}),Mg=Tg;Tg.displayName="DropdownMenuSeparator";var jg=({children:e,onClickOutside:t,className:s="",onSelect:n,style:i})=>{let a=Jy(),l=jc(null),r=zh({onClickOutside:t});Bh(l,(()=>{r.onClickOutside?.()})),Dc((()=>{let e=e=>{e.key===j.ESCAPE&&(e.stopImmediatePropagation(),r.onClickOutside?.())},t={capture:!0};return document.addEventListener("keydown",e,t),()=>{document.removeEventListener("keydown",e,t)}}),[r]);let o=Vc(`dropdown-menu ${s}`,{"dropdown-menu--mobile":a.editor.isMobile}).trim();return gp.exports.jsx(om.Provider,{value:{onSelect:n},children:gp.exports.jsx("div",{ref:l,className:o,style:i,"data-testid":"dropdown-menu",children:a.editor.isMobile?gp.exports.jsx(hg.Col,{className:"dropdown-menu-container",children:e}):gp.exports.jsx(Gh,{className:"dropdown-menu-container",padding:2,style:{zIndex:2},children:e})})})};jg.displayName="DropdownMenuContent";var Dg=jg,Lg=({icon:e,shortcut:t,href:s,children:n,onSelect:i,className:a="",selected:l,rel:r="noreferrer",...o})=>{let d=cm(o.onClick,i);return gp.exports.jsx("a",{...o,href:s,target:"_blank",rel:"noreferrer",className:dm(a,l),title:o.title??o["aria-label"],onClick:d,children:gp.exports.jsx(pm,{icon:e,shortcut:t,children:n})})},Ng=Lg;Lg.displayName="DropdownMenuItemLink";var Ag=({children:e,className:t="",selected:s,...n})=>gp.exports.jsx("div",{...n,className:`dropdown-menu-item-base dropdown-menu-item-custom ${t} ${s?"dropdown-menu-item--selected":""}`.trim(),children:e}),_g=({children:e,open:t})=>{let s=(e=>Tc.Children.toArray(e).find((e=>Tc.isValidElement(e)&&"string"!=typeof e.type&&e?.type.displayName&&"DropdownMenuTrigger"===e.type.displayName))||null)(e),n=(e=>Tc.Children.toArray(e).find((e=>Tc.isValidElement(e)&&"string"!=typeof e.type&&e?.type.displayName&&"DropdownMenuContent"===e.type.displayName))||null)(e);return gp.exports.jsxs(gp.exports.Fragment,{children:[s,t&&n]})};_g.Trigger=kg,_g.Content=Dg,_g.Item=fm,_g.ItemLink=Ng,_g.ItemCustom=Ag,_g.Group=rm,_g.Separator=Mg;var Pg=_g;_g.displayName="DropdownMenu";var Rg=(e,t)=>e.filter((e=>t.includes(e.id))),Og=({setAppState:e,selectedItems:t,library:s,onRemoveFromLibrary:n,resetLibrary:i,onSelectItems:a,appState:l,className:r})=>{let[o]=fp(ng),[d,c]=fp(Vg),[p,h]=Mc(!1),m=!!t.length,u=m?o.libraryItems.filter((e=>t.includes(e.id))):o.libraryItems,g=Np(m?"buttons.remove":"buttons.resetLibrary"),[x,f]=Mc(!1),[b,E]=Mc(null),y=Ac((()=>gp.exports.jsxs(Jg,{onCloseRequest:()=>E(null),title:Np("publishSuccessDialog.title"),className:"publish-library-success",size:"small",children:[gp.exports.jsx("p",{children:gp.exports.jsx(Eg,{i18nKey:"publishSuccessDialog.content",authorName:b.authorName,link:e=>gp.exports.jsx("a",{href:b?.url,target:"_blank",rel:"noopener noreferrer",children:e})})}),gp.exports.jsx(Fp,{type:"button",title:Np("buttons.close"),"aria-label":Np("buttons.close"),label:Np("buttons.close"),onClick:()=>E(null),"data-testid":"publish-library-success-close",className:"publish-library-success-close"})]})),[E,b]),v=async()=>{try{await s.updateLibrary({libraryItems:or({description:"Excalidraw library files"}),merge:!0,openLibraryMenu:!0})}catch(t){if("AbortError"===t?.name)return void console.warn(t);e({errorMessage:Np("errors.importLibraryError")})}},w=async()=>{let t=m?u:await s.getLatestLibrary();pc(t).catch(Ua).catch((t=>{e({errorMessage:t.message})}))};return gp.exports.jsxs("div",{className:Vc("library-menu-dropdown-container",r),children:[gp.exports.jsxs(Pg,{open:d,children:[gp.exports.jsx(Pg.Trigger,{onToggle:()=>c(!d),children:Kd}),gp.exports.jsxs(Pg.Content,{onClickOutside:()=>c(!1),onSelect:()=>c(!1),className:"library-menu",children:[!m&&gp.exports.jsx(Pg.Item,{onSelect:v,icon:da,"data-testid":"lib-dropdown--load",children:Np("buttons.load")}),!!u.length&&gp.exports.jsx(Pg.Item,{onSelect:w,icon:hn,"data-testid":"lib-dropdown--export",children:Np("buttons.export")}),!!u.length&&gp.exports.jsx(Pg.Item,{onSelect:()=>h(!0),icon:jt,children:g}),m&&gp.exports.jsx(Pg.Item,{icon:Zd,onSelect:()=>f(!0),"data-testid":"lib-dropdown--remove",children:Np("buttons.publishLibrary")})]})]}),t.length>0&&gp.exports.jsx("div",{className:"library-actions-counter",children:t.length}),p&&(()=>{let e=t.length?Np("alerts.removeItemsFromsLibrary",{count:t.length}):Np("alerts.resetLibrary"),s=t.length?Np("confirmDialog.removeItemsFromLib"):Np("confirmDialog.resetLibrary");return gp.exports.jsx(vg,{onConfirm:()=>{t.length?n():i(),h(!1)},onCancel:()=>{h(!1)},title:s,children:gp.exports.jsx("p",{children:e})})})(),x&&gp.exports.jsx(Cg,{onClose:()=>f(!1),libraryItems:Rg(o.libraryItems,t),appState:l,onSuccess:e=>((e,n)=>{f(!1),E({url:e.url,authorName:e.authorName});let i=n.slice();i.forEach((e=>{t.includes(e.id)&&(e.status="published")})),s.setLibrary(i)})(e,o.libraryItems),onError:e=>window.alert(e),updateItemsInStorage:()=>s.setLibrary(o.libraryItems),onRemove:e=>a(t.filter((t=>t!==e)))}),b&&y()]})},Fg=({selectedItems:e,onSelectItems:t,className:s})=>{let{library:n}=qy(),{clearLibraryCache:i,deleteItemsFromLibraryCache:a}=tg(),l=Oh(),r=nv(),[o]=fp(ng);return gp.exports.jsx(Og,{appState:l,setAppState:r,selectedItems:e,onSelectItems:t,library:n,onRemoveFromLibrary:()=>(async s=>{let i=s.filter((t=>!e.includes(t.id)));n.setLibrary(i).catch((()=>{r({errorMessage:Np("alerts.errorRemovingFromLibrary")})})),a(e),t([])})(o.libraryItems),resetLibrary:()=>{n.resetLibrary(),i()},className:s})},Bg=_c((({id:e,elements:t,isPending:s,onClick:n,selected:i,onToggle:a,onDrag:l,svgCache:r})=>{let o=jc(null),d=((e,t,s)=>{let[n,i]=Mc();return Dc((()=>{if(t)if(e){let n=s.get(e);n?i(n):(async()=>{let n=await eg(t);n.querySelector(".style-fonts")?.remove(),n&&(s.set(e,n),i(n))})()}else(async()=>{let e=await eg(t);i(e)})()}),[e,t,s,i]),n})(e,t,r);Dc((()=>{let e=o.current;if(e)return d&&(e.innerHTML=d.outerHTML),()=>{e.innerHTML=""}}),[d]);let[c,h]=Mc(!1),m=Jy().editor.isMobile,u=s&&gp.exports.jsx("div",{className:"library-unit__adder",children:p});return gp.exports.jsxs("div",{className:Vc("library-unit",{"library-unit__active":t,"library-unit--hover":t&&c,"library-unit--selected":i,"library-unit--skeleton":!d}),onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[gp.exports.jsx("div",{className:Vc("library-unit__dragger",{"library-unit__pulse":!!s}),ref:o,draggable:!!t,onClick:t||s?t=>{e&&t.shiftKey?a(e,t):n(e)}:void 0,onDragStart:t=>{e?(h(!1),l(e,t)):t.preventDefault()}}),u,e&&t&&(c||m||i)&&gp.exports.jsx(Zm,{checked:i,onChange:(t,s)=>a(e,s),className:"library-unit__checkbox"})]})})),zg=()=>gp.exports.jsx("div",{className:"library-unit library-unit--skeleton"});var Ug=Tc.useTransition||function(){return[!1,Ac((e=>e()),[])]},Hg=({children:e})=>gp.exports.jsx("div",{className:"library-menu-items-container__grid",children:e}),Yg=_c((({items:e,onItemSelectToggle:t,onItemDrag:s,isItemSelected:n,onClick:i,svgCache:a,itemsRenderedPerBatch:l})=>{let[,r]=Ug(),[o,d]=Mc(0);return Dc((()=>{o<e.length&&r((()=>{d(o+l)}))}),[o,e.length,r,l]),gp.exports.jsx(gp.exports.Fragment,{children:e.map(((e,l)=>l<o?gp.exports.jsx(Bg,{elements:e?.elements,isPending:!e?.id&&!!e?.elements,onClick:i,svgCache:a,id:e?.id,selected:n(e.id),onToggle:t,onDrag:s},e?.id??l):gp.exports.jsx(zg,{},l)))})})),Gg=Gc(0);function $g({isLoading:e,libraryItems:t,onAddToLibrary:s,onInsertLibraryItems:n,pendingElements:i,theme:a,id:l,libraryReturnUrl:r,onSelectItems:o,selectedItems:d}){let c=jc(null),p=(e=>{let[t,s]=fp(Gg);return Dc((()=>{let{current:t}=e;if(!t)return;let n=ap((()=>{let{scrollTop:e}=t;s(e)}),200);return t.addEventListener("scroll",n),()=>{n.cancel(),t.removeEventListener("scroll",n)}}),[e,s]),t})(c);Dc((()=>{p>0&&c.current?.scrollTo(0,p)}),[]);let{svgCache:h}=tg(),m=Nc((()=>t.filter((e=>"published"!==e.status))),[t]),u=Nc((()=>t.filter((e=>"published"===e.status))),[t]),g=!t.length&&!i.length,x=!i.length&&!m.length&&!u.length,[f,b]=Mc(null),E=Ac(((e,t)=>{let s=!d.includes(e),n=[...m,...u];if(s){if(t.shiftKey&&f){let t=n.findIndex((e=>e.id===f)),s=n.findIndex((t=>t.id===e));if(-1===t||-1===s)return void o([...d,e]);let i=Ht(d),a=n.reduce(((e,n,a)=>((a>=t&&a<=s||i.has(n.id))&&e.push(n.id),e)),[]);o(a)}else o([...d,e]);b(e)}else b(null),o(d.filter((t=>t!==e)))}),[f,o,u,d,m]),y=Ac((e=>{let s;return s=d.includes(e)?t.filter((e=>d.includes(e.id))):t.filter((t=>t.id===e)),s.map((e=>({...e,elements:Oi(e.elements,{randomizeSeed:!0})})))}),[t,d]),v=Ac(((e,t)=>{t.dataTransfer.setData(Fi.excalidrawlib,Bi(y(e)))}),[y]),w=Ac((e=>!!e&&d.includes(e)),[d]),S=Ac((()=>{s(i)}),[i,s]),C=Ac((e=>{e&&n(y(e))}),[y,n]),I=h.size>=t.length?64:17;return gp.exports.jsxs("div",{className:"library-menu-items-container",style:i.length||m.length||u.length?{justifyContent:"flex-start"}:{borderBottom:0},children:[!x&&gp.exports.jsx(Fg,{selectedItems:d,onSelectItems:o,className:"library-menu-dropdown-container--in-heading"}),gp.exports.jsxs(hg.Col,{className:"library-menu-items-container__items",align:"start",gap:1,style:{flex:u.length>0?1:"0 1 auto",marginBottom:0},ref:c,children:[gp.exports.jsxs(gp.exports.Fragment,{children:[!x&&gp.exports.jsx("div",{className:"library-menu-items-container__header",children:Np("labels.personalLib")}),e&&gp.exports.jsx("div",{style:{position:"absolute",top:"var(--container-padding-y)",right:"var(--container-padding-x)",transform:"translateY(50%)"},children:gp.exports.jsx(Pp,{})}),i.length||m.length?gp.exports.jsxs(Hg,{children:[i.length>0&&gp.exports.jsx(Yg,{itemsRenderedPerBatch:I,items:[{id:null,elements:i}],onItemSelectToggle:E,onItemDrag:v,onClick:S,isItemSelected:w,svgCache:h}),gp.exports.jsx(Yg,{itemsRenderedPerBatch:I,items:m,onItemSelectToggle:E,onItemDrag:v,onClick:C,isItemSelected:w,svgCache:h})]}):gp.exports.jsxs("div",{className:"library-menu-items__no-items",children:[gp.exports.jsx("div",{className:"library-menu-items__no-items__label",children:Np("library.noItems")}),gp.exports.jsx("div",{className:"library-menu-items__no-items__hint",children:u.length>0?Np("library.hint_emptyPrivateLibrary"):Np("library.hint_emptyLibrary")})]})]}),gp.exports.jsxs(gp.exports.Fragment,{children:[(u.length>0||i.length>0||m.length>0)&&gp.exports.jsx("div",{className:"library-menu-items-container__header library-menu-items-container__header--excal",children:Np("labels.excalidrawLib")}),u.length>0?gp.exports.jsx(Hg,{children:gp.exports.jsx(Yg,{itemsRenderedPerBatch:I,items:u,onItemSelectToggle:E,onItemDrag:v,onClick:C,isItemSelected:w,svgCache:h})}):m.length>0?gp.exports.jsx("div",{style:{margin:"1rem 0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",fontSize:".9rem"},children:Np("library.noItems")}):null]}),g&&gp.exports.jsx(ug,{style:{padding:"16px 0",width:"100%"},id:l,libraryReturnUrl:r,theme:a,children:gp.exports.jsx(Fg,{selectedItems:d,onSelectItems:o})})]})]})}var Vg=Gc(!1),Kg=({children:e})=>gp.exports.jsx("div",{className:"layer-ui__library",children:e}),Zg=_c((({onInsertLibraryItems:e,pendingElements:t,onAddToLibrary:s,setAppState:n,libraryReturnUrl:i,library:a,id:l,theme:r,selectedItems:o,onSelectItems:d})=>{let[c]=fp(ng),p=Ac((e=>{(async(e,t)=>{dh("element","addToLibrary","ui");for(let t of h)if(e.some((e=>e.type===t)))return n({errorMessage:Np(`errors.libraryElementTypeError.${t}`)});let i=[{status:"unpublished",elements:e,id:m(),created:Date.now()},...t];s(),a.setLibrary(i).catch((()=>{n({errorMessage:Np("alerts.errorAddingToLibrary")})}))})(e,c.libraryItems)}),[s,a,n,c.libraryItems]),u=Nc((()=>c.libraryItems),[c]);if("loading"===c.status&&!c.isInitialized)return gp.exports.jsx(Kg,{children:gp.exports.jsx("div",{className:"layer-ui__library-message",children:gp.exports.jsxs("div",{children:[gp.exports.jsx(Pp,{size:"2em"}),gp.exports.jsx("span",{children:Np("labels.libraryLoadingMessage")})]})})});let g=c.libraryItems.length>0||t.length>0;return gp.exports.jsxs(Kg,{children:[gp.exports.jsx($g,{isLoading:"loading"===c.status,libraryItems:u,onAddToLibrary:p,onInsertLibraryItems:e,pendingElements:t,id:l,libraryReturnUrl:i,theme:r,onSelectItems:d,selectedItems:o}),g&&gp.exports.jsx(ug,{className:"library-menu-control-buttons--at-bottom",style:{padding:"16px 12px 0 12px"},id:l,libraryReturnUrl:i,theme:r})]})})),Xg=(e,t)=>({elements:e,pending:S(e,{selectedElementIds:t},{includeBoundTextElement:!0,includeElementsInFrames:!0}),selectedElementIds:t}),qg=_c((()=>{let e=qy(),{onInsertElements:t}=e,s=Qy(),n=Oh(),i=nv(),[a,l]=Mc([]),r=Nc((()=>e.library),[e.library]),o=((e,t)=>{let s=tv(),[n,i]=Mc((()=>Xg(s,e.selectedElementIds))),a=jc(new Map);return Dc((()=>{for(let e of n.pending)a.current.set(e.id,e.version)}),[n.pending]),Dc((()=>{"up"===t.state.cursorButton&&"selection"===t.state.activeTool.type&&i((n=>{if(!R(n.selectedElementIds,e.selectedElementIds))return a.current.clear(),Xg(s,e.selectedElementIds);let i=t.scene.getNonDeletedElementsMap();for(let t of Object.keys(e.selectedElementIds)){let n=i.get(t)?.version;if(n&&n!==a.current.get(t))return Xg(s,e.selectedElementIds)}return n}))}),[t,t.state.cursorButton,t.state.activeTool.type,e.selectedElementIds,s]),n.pending})(n,e),d=Ac((e=>{t(og(e))}),[t]),c=Ac((()=>{i({selectedElementIds:{},selectedGroupIds:{},activeEmbeddable:null})}),[i]);return gp.exports.jsx(Zg,{pendingElements:o,onInsertLibraryItems:d,onAddToLibrary:c,setAppState:i,libraryReturnUrl:s.libraryReturnUrl,library:r,id:e.id,theme:n.theme,selectedItems:a,onSelectItems:l})}));function Qg(e){if(e&&"number"==typeof e)return e;switch(e){case"small":return 550;case"wide":return 1024;default:return 800}}var Jg=e=>{let[t,s]=(()=>{let[e,t]=Mc(null);return[e,Ac((e=>t(e)),[])]})(),[n]=Mc(document.activeElement),{id:i}=ev(),a=Jy().viewport.isMobile;Dc((()=>{if(!t)return;let s=zi(t);setTimeout((()=>{s.length>0&&!1!==e.autofocus&&(s[1]||s[0]).focus()}));let n=e=>{if(e.key===j.TAB){let s=zi(t),{activeElement:n}=document,i=s.findIndex((e=>e===n));0===i&&e.shiftKey?(s[s.length-1].focus(),e.preventDefault()):i===s.length-1&&!e.shiftKey&&(s[0].focus(),e.preventDefault())}};return t.addEventListener("keydown",n),()=>t.removeEventListener("keydown",n)}),[t,e.autofocus]);let l=nv(),r=bp(Vg),o=()=>{l({openMenu:null}),r(!1),n.focus(),e.onCloseRequest()};return gp.exports.jsx(Qu,{className:Vc("Dialog",e.className,{"Dialog--fullscreen":a}),labelledBy:"dialog-title",maxWidth:Qg(e.size),onCloseRequest:o,closeOnClickOutside:e.closeOnClickOutside,children:gp.exports.jsxs(Gh,{ref:s,children:[e.title&&gp.exports.jsx("h2",{id:`${i}-dialog-title`,className:"Dialog__title",children:gp.exports.jsx("span",{className:"Dialog__titleContent",children:e.title})}),a&&gp.exports.jsx("button",{className:"Dialog__close",onClick:o,title:Np("buttons.close"),"aria-label":Np("buttons.close"),type:"button",children:H}),gp.exports.jsx("div",{className:"Dialog__content",children:e.children})]})})},ex=({type:e="button",onSelect:t,selected:s,children:n,className:i="",...a})=>gp.exports.jsx("button",{onClick:Hi(a.onClick,(e=>{t()})),type:e,className:Vc("excalidraw-button",i,{selected:s}),...a,children:n}),tx=Lc((({onChange:e,label:t,fullWidth:s,placeholder:n,readonly:i,selectOnRender:a,onKeyDown:l,isRedacted:r=!1,icon:o,className:d,...c},p)=>{let h=jc(null);Pc(p,(()=>h.current)),Rc((()=>{a&&(h.current?.focus(),h.current?.select())}),[a]);let[m,x]=Mc(!1);return gp.exports.jsxs("div",{className:Vc("ExcTextField",d,{"ExcTextField--fullWidth":s,"ExcTextField--hasIcon":!!o}),onClick:()=>{h.current?.focus()},children:[o,t&&gp.exports.jsx("div",{className:"ExcTextField__label",children:t}),gp.exports.jsxs("div",{className:Vc("ExcTextField__input",{"ExcTextField__input--readonly":i}),children:[gp.exports.jsx("input",{className:Vc({"is-redacted":"value"in c&&c.value&&r&&!m}),readOnly:i,value:"value"in c?c.value:void 0,defaultValue:"defaultValue"in c?c.defaultValue:void 0,placeholder:n,ref:h,onChange:t=>e?.(t.target.value),onKeyDown:l}),r&&gp.exports.jsx(ex,{onSelect:()=>x(!m),style:{border:0,userSelect:"none"},children:m?u:g})]})]})})),sx={toggleTheme:[x("Shift+Alt+D")],saveScene:[x("CtrlOrCmd+S")],loadScene:[x("CtrlOrCmd+O")],clearCanvas:[x("CtrlOrCmd+Delete")],imageExport:[x("CtrlOrCmd+Shift+E")],commandPalette:[x("CtrlOrCmd+/"),x("CtrlOrCmd+Shift+P")],cut:[x("CtrlOrCmd+X")],copy:[x("CtrlOrCmd+C")],paste:[x("CtrlOrCmd+V")],copyStyles:[x("CtrlOrCmd+Alt+C")],pasteStyles:[x("CtrlOrCmd+Alt+V")],selectAll:[x("CtrlOrCmd+A")],deleteSelectedElements:[x("Delete")],duplicateSelection:[x("CtrlOrCmd+D"),x(`Alt+${Np("helpDialog.drag")}`)],sendBackward:[x("CtrlOrCmd+[")],bringForward:[x("CtrlOrCmd+]")],sendToBack:[x(f?"CtrlOrCmd+Alt+[":"CtrlOrCmd+Shift+[")],bringToFront:[x(f?"CtrlOrCmd+Alt+]":"CtrlOrCmd+Shift+]")],copyAsPng:[x("Shift+Alt+C")],group:[x("CtrlOrCmd+G")],ungroup:[x("CtrlOrCmd+Shift+G")],gridMode:[x("CtrlOrCmd+'")],zenMode:[x("Alt+Z")],objectsSnapMode:[x("Alt+S")],stats:[x("Alt+/")],addToLibrary:[],flipHorizontal:[x("Shift+H")],flipVertical:[x("Shift+V")],viewMode:[x("Alt+R")],hyperlink:[x("CtrlOrCmd+K")],toggleElementLock:[x("CtrlOrCmd+Shift+L")],resetZoom:[x("CtrlOrCmd+0")],zoomOut:[x("CtrlOrCmd+-")],zoomIn:[x("CtrlOrCmd++")],zoomToFitSelection:[x("Shift+3")],zoomToFit:[x("Shift+1")],zoomToFitSelectionInViewport:[x("Shift+2")],toggleEraserTool:[x("E")],toggleHandTool:[x("H")],setFrameAsActiveTool:[x("F")],saveFileToDisk:[x("CtrlOrCmd+S")],saveToActiveFile:[x("CtrlOrCmd+S")],toggleShortcuts:[x("?")],searchMenu:[x("CtrlOrCmd+F")],wrapSelectionInFrame:[]},nx=(e,t=0)=>{let s=sx[e];return s&&s.length>0?s[t]||s[0]:""},ix=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g"),ax=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,lx={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"E","æ":"e","Þ":"T","þ":"t","ß":"s","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"I","ĳ":"i","Œ":"E","œ":"e","ŉ":"n","ſ":"s"},rx=e=>e.replace(ax,(e=>lx[e]||e)).replace(ix,""),ox=Tc.createContext(null),dx=()=>Tc.useContext(ox),cx=$c(),px=(e,t)=>{let s=t[0]?.type||null;for(let e of t)if(e.type!==s){s=null;break}return Yi(e.activeTool.type)&&"image"!==e.activeTool.type&&"image"!==s&&"frame"!==s&&"magicframe"!==s||t.some((e=>Yi(e.type)))},hx=(e,t)=>Gi(e.activeTool.type)||t.some((e=>Gi(e.type))),mx=({appState:e,elementsMap:t,renderAction:s,app:n})=>{let i=As(t,e),a=!1;2===i.length&&(Wt(i[0])||Wt(i[1]))&&(a=!0);let l=!(!e.editingTextElement&&!e.newElement),r=Jy(),o="rtl"===document.documentElement.getAttribute("dir"),d=Gi(e.activeTool.type)&&!jl(e.currentItemBackgroundColor)||i.some((e=>Gi(e.type)&&!jl(e.backgroundColor))),c=1===i.length||a,p=!e.editingLinearElement&&1===i.length&&zt(i[0])&&!V(i[0]),h=!e.croppingElementId&&1===i.length&&B(i[0]),m=!a&&xu(e,n);return gp.exports.jsxs("div",{className:"panelColumn",children:[gp.exports.jsx("div",{children:px(e,i)&&s("changeStrokeColor")}),hx(e,i)&&gp.exports.jsx("div",{children:s("changeBackgroundColor")}),d&&s("changeFillStyle"),(qo(e.activeTool.type)||i.some((e=>qo(e.type))))&&s("changeStrokeWidth"),("freedraw"===e.activeTool.type||i.some((e=>"freedraw"===e.type)))&&s("changeStrokeShape"),(Qo(e.activeTool.type)||i.some((e=>Qo(e.type))))&&gp.exports.jsxs(gp.exports.Fragment,{children:[s("changeStrokeStyle"),s("changeSloppiness")]}),(Jo(e.activeTool.type)||i.some((e=>Jo(e.type))))&&gp.exports.jsx(gp.exports.Fragment,{children:s("changeRoundness")}),(ed(e.activeTool.type)||i.some((e=>ed(e.type))))&&gp.exports.jsx(gp.exports.Fragment,{children:s("changeArrowType")}),("text"===e.activeTool.type||i.some(tt))&&gp.exports.jsxs(gp.exports.Fragment,{children:[s("changeFontFamily"),s("changeFontSize"),("text"===e.activeTool.type||td(i,t))&&s("changeTextAlign")]}),sd(i,t)&&s("changeVerticalAlign"),(Rs(e.activeTool.type)||i.some((e=>Rs(e.type))))&&gp.exports.jsx(gp.exports.Fragment,{children:s("changeArrowhead")}),s("changeOpacity"),gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.layers")}),gp.exports.jsxs("div",{className:"buttonList",children:[s("sendToBack"),s("sendBackward"),s("bringForward"),s("bringToFront")]})]}),m&&!a&&gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.align")}),gp.exports.jsxs("div",{className:"buttonList",children:[o?gp.exports.jsxs(gp.exports.Fragment,{children:[s("alignRight"),s("alignHorizontallyCentered"),s("alignLeft")]}):gp.exports.jsxs(gp.exports.Fragment,{children:[s("alignLeft"),s("alignHorizontallyCentered"),s("alignRight")]}),i.length>2&&s("distributeHorizontally"),gp.exports.jsx("div",{style:{flexBasis:"100%",height:0}}),gp.exports.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:".5rem",marginTop:"-0.5rem"},children:[s("alignTop"),s("alignVerticallyCentered"),s("alignBottom"),i.length>2&&s("distributeVertically")]})]})]}),!l&&i.length>0&&gp.exports.jsxs("fieldset",{children:[gp.exports.jsx("legend",{children:Np("labels.actions")}),gp.exports.jsxs("div",{className:"buttonList",children:[!r.editor.isMobile&&s("duplicateSelection"),!r.editor.isMobile&&s("deleteSelectedElements"),s("group"),s("ungroup"),c&&s("hyperlink"),h&&s("cropEditor"),p&&s("toggleLinearEditor")]})]})]})},ux=({activeTool:e,appState:t,app:s,UIOptions:n})=>{let[i,a]=Mc(!1),l="frame"===e.type,r="laser"===e.type,o="embeddable"===e.type,{TTDDialogTriggerTunnel:d}=dx();return gp.exports.jsxs(gp.exports.Fragment,{children:[C.map((({value:i,icon:a,key:l,numericKey:r,fillable:o},d)=>{if(!1===n.tools?.[i])return null;let c=Np(`toolBar.${i}`),p=l&&I("string"==typeof l?l:l[0]),h=p?`${p} ${Np("helpDialog.or")} ${r}`:`${r}`;return gp.exports.jsx(Fp,{className:Vc("Shape",{fillable:o}),type:"radio",icon:a,checked:e.type===i,name:"editor-current-shape",title:`${I(c)} — ${h}`,keyBindingLabel:r||p,"aria-label":I(c),"aria-keyshortcuts":h,"data-testid":`toolbar-${i}`,onPointerDown:({pointerType:e})=>{!t.penDetected&&"pen"===e&&s.togglePenMode(!0)},onChange:({pointerType:e})=>{t.activeTool.type!==i&&dh("toolbar",i,"ui"),"image"===i?s.setActiveTool({type:i,insertOnCanvasDirectly:"mouse"!==e}):s.setActiveTool({type:i})}},i)})),gp.exports.jsx("div",{className:"App-toolbar__divider"}),gp.exports.jsxs(Pg,{open:i,children:[gp.exports.jsx(Pg.Trigger,{className:Vc("App-toolbar__extra-tools-trigger",{"App-toolbar__extra-tools-trigger--selected":l||o||r&&!s.props.isCollaborating}),onToggle:()=>a(!i),title:Np("toolBar.extraTools"),children:nd}),gp.exports.jsxs(Pg.Content,{onClickOutside:()=>a(!1),onSelect:()=>a(!1),className:"App-toolbar__extra-tools-dropdown",children:[gp.exports.jsx(Pg.Item,{onSelect:()=>s.setActiveTool({type:"frame"}),icon:va,shortcut:j.F.toLocaleUpperCase(),"data-testid":"toolbar-frame",selected:l,children:Np("toolBar.frame")}),gp.exports.jsx(Pg.Item,{onSelect:()=>s.setActiveTool({type:"embeddable"}),icon:id,"data-testid":"toolbar-embeddable",selected:o,children:Np("toolBar.embeddable")}),gp.exports.jsx(Pg.Item,{onSelect:()=>s.setActiveTool({type:"laser"}),icon:ad,"data-testid":"toolbar-laser",selected:r,shortcut:j.K.toLocaleUpperCase(),children:Np("toolBar.laser")}),gp.exports.jsx("div",{style:{margin:"6px 0",fontSize:14,fontWeight:600},children:"Generate"}),!1!==s.props.aiEnabled&&gp.exports.jsx(d.Out,{}),gp.exports.jsx(Pg.Item,{onSelect:()=>s.setOpenDialog({name:"ttd",tab:"mermaid"}),icon:L,"data-testid":"toolbar-embeddable",children:Np("toolBar.mermaidToExcalidraw")}),!1!==s.props.aiEnabled&&s.plugins.diagramToCode&&gp.exports.jsx(gp.exports.Fragment,{children:gp.exports.jsxs(Pg.Item,{onSelect:()=>s.onMagicframeToolSelect(),icon:xe,"data-testid":"toolbar-magicframe",children:[Np("toolBar.magicframe"),gp.exports.jsx(Pg.Item.Badge,{children:"AI"})]})})]})]})]})},gx=({renderAction:e,zoom:t})=>gp.exports.jsx(hg.Col,{gap:1,className:qi.ZOOM_ACTIONS,children:gp.exports.jsxs(hg.Row,{align:"center",children:[e("zoomOut"),e("resetZoom"),e("zoomIn")]})}),xx=({renderAction:e,className:t})=>gp.exports.jsxs("div",{className:`undo-redo-buttons ${t}`,children:[gp.exports.jsx("div",{className:"undo-button-container",children:gp.exports.jsx(_m,{label:Np("buttons.undo"),children:e("undo")})}),gp.exports.jsx("div",{className:"redo-button-container",children:gp.exports.jsxs(_m,{label:Np("buttons.redo"),children:[" ",e("redo")]})})]}),fx=({actionManager:e,showExitZenModeBtn:t})=>gp.exports.jsx("button",{type:"button",className:Vc("disable-zen-mode",{"disable-zen-mode--visible":t}),onClick:()=>e.executeAction(Lu),children:Np("buttons.exitZenMode")}),bx=({renderAction:e,className:t})=>gp.exports.jsx("div",{className:`finalize-button ${t}`,children:e("finalize",{size:"small"})}),Ex=e=>{let t=jc({userFn:e});return t.current.userFn=e,t.current.stableFn||(t.current.stableFn=(...e)=>t.current.userFn(...e)),t.current.stableFn},yx=Gc(null),vx=()=>{let[e,t]=fp(yx),s=iv();return e&&"clearCanvas"===e?gp.exports.jsx(vg,{onConfirm:()=>{s.executeAction(Pm),t(null)},onCancel:()=>t(null),title:Np("clearCanvasDialog.title"),children:gp.exports.jsxs("p",{className:"clear-canvas__content",children:[" ",Np("alerts.clearReset")]})}):null},wx={};Ic(wx,{toggleTheme:()=>Sx});var Sx={...Um,category:"App",label:"Toggle theme",perform:({actionManager:e})=>{e.executeAction(Um,"commandPalette")}},Cx=e({name:"copyElementLink",label:"labels.copyElementLink",icon:fe,trackEvent:{category:"element"},perform:async(e,t,s,n)=>{let i=S(e,t);try{if(window.location){let s=$i(i,t);return s?(await ve(n.props.generateLinkForSelection?n.props.generateLinkForSelection(s.id,s.type):Vi(s.id,s.type)),{appState:{toast:{message:Np("toast.elementLinkCopied"),closable:!0}},captureUpdate:Lt.EVENTUALLY}):{appState:t,elements:e,app:n,captureUpdate:Lt.EVENTUALLY}}}catch(e){console.error(e)}return{appState:t,elements:e,app:n,captureUpdate:Lt.EVENTUALLY}},predicate:(e,t)=>Wi(S(e,t))}),Ix=e({name:"linkToElement",label:"labels.linkToElement",icon:Ai,perform:(e,t,s,n)=>{let i=S(e,t);return 1===i.length&&Wi(i)?{appState:{...t,openDialog:{name:"elementLinkSelector",sourceElementId:S(e,t)[0].id}},captureUpdate:Lt.IMMEDIATELY}:{elements:e,appState:t,app:n,captureUpdate:Lt.EVENTUALLY}},predicate:(e,t,s,n)=>{let i=S(e,t);return"elementLinkSelector"!==t.openDialog?.name&&1===i.length&&Wi(i)},trackEvent:!1}),kx=Gc(null),Tx="App",Mx="Export",jx="Tools",Dx="Editor",Lx="Elements",Nx="Links",Ax=e=>{switch(e){case Tx:return 1;case Mx:return 2;case Dx:return 3;case jx:return 4;case Lx:return 5;case Nx:return 6;default:return 10}},_x=({shortcut:e,className:t,children:s})=>{let n=e.replace("++","+$").split("+");return gp.exports.jsxs("div",{className:Vc("shortcut",t),children:[n.map(((e,t)=>gp.exports.jsx("div",{className:"shortcut-wrapper",children:gp.exports.jsx("div",{className:"shortcut-key",children:"$"===e?"+":e})},e))),gp.exports.jsx("div",{className:"shortcut-desc",children:s})]})},Px=e=>!e.altKey&&e[j.CTRL_OR_CMD]&&(e.shiftKey&&e.key.toLowerCase()===j.P||e.key===j.SLASH);function Rx({customCommandPaletteItems:e}){let t=qy(),n=Oh(),i=nv(),a=Qy(),l=iv(),[r,o]=fp(kx),[d,c]=Mc(null),p=jc(null),h=zh({uiAppState:n,customCommandPaletteItems:e,appProps:a});Dc((()=>{let{uiAppState:e,customCommandPaletteItems:n,appProps:a}=h,d=s=>{let n="";return s.label&&(n="function"==typeof s.label?Np(s.label(t.scene.getNonDeletedElements(),e,t)):Np(s.label)),n},p=s=>"function"==typeof s.icon?s.icon(e,t.scene.getNonDeletedElements()):s.icon,m=[],u=(e,t,s)=>{let n={label:d(e),icon:p(e),category:t,shortcut:nx(e.name),keywords:e.keywords,predicate:e.predicate,viewMode:e.viewMode,perform:()=>{l.executeAction(e,"commandPalette")}};return s?s(n,e):n};if(e&&t.scene&&l){let h=[l.actions.group,l.actions.ungroup,l.actions.cut,l.actions.copy,l.actions.deleteSelectedElements,l.actions.wrapSelectionInFrame,l.actions.copyStyles,l.actions.pasteStyles,l.actions.bringToFront,l.actions.bringForward,l.actions.sendBackward,l.actions.sendToBack,l.actions.alignTop,l.actions.alignBottom,l.actions.alignLeft,l.actions.alignRight,l.actions.alignVerticallyCentered,l.actions.alignHorizontallyCentered,l.actions.duplicateSelection,l.actions.flipHorizontal,l.actions.flipVertical,l.actions.zoomToFitSelection,l.actions.zoomToFitSelectionInViewport,l.actions.increaseFontSize,l.actions.decreaseFontSize,l.actions.toggleLinearEditor,l.actions.cropEditor,Ku,Cx,Ix].map((e=>u(e,Lx,((e,t)=>({...e,predicate:t.predicate?t.predicate:(e,t,s,n)=>S(e,t).length>0}))))),g=[l.actions.toggleHandTool,l.actions.setFrameAsActiveTool].map((e=>u(e,jx))),x=[l.actions.undo,l.actions.redo,l.actions.zoomIn,l.actions.zoomOut,l.actions.resetZoom,l.actions.zoomToFit,l.actions.zenMode,l.actions.viewMode,l.actions.gridMode,l.actions.objectsSnapMode,l.actions.toggleShortcuts,l.actions.selectAll,l.actions.toggleElementLock,l.actions.unlockAllElements,l.actions.stats].map((e=>u(e,Dx))),f=[l.actions.saveToActiveFile,l.actions.saveFileToDisk,l.actions.copyAsPng,l.actions.copyAsSvg].map((e=>u(e,Mx)));m=[...h,...x,{label:d(Pm),icon:p(Pm),shortcut:nx(Pm.name),category:Dx,keywords:["delete","destroy"],viewMode:!1,perform:()=>{wp.set(yx,"clearCanvas")}},{label:Np("buttons.exportImage"),category:Mx,icon:b,shortcut:nx("imageExport"),keywords:["export","image","png","jpeg","svg","clipboard","picture"],perform:()=>{i({openDialog:{name:"imageExport"}})}},...f];let y=[{label:Np("toolBar.library"),category:Tx,icon:E,viewMode:!1,perform:()=>{e.openSidebar?i({openSidebar:null}):i({openSidebar:{name:v.name,tab:v.defaultTab}})}},{label:Np("search.title"),category:Tx,icon:s,viewMode:!0,perform:()=>{l.executeAction(Bx)}},{label:Np("labels.changeStroke"),keywords:["color","outline"],category:Lx,icon:w,viewMode:!1,predicate:(e,t)=>{let s=S(e,t);return s.length>0&&px(t,s)},perform:()=>{i((e=>({openMenu:"shape"===e.openMenu?null:"shape",openPopup:"elementStroke"})))}},{label:Np("labels.changeBackground"),keywords:["color","fill"],icon:w,category:Lx,viewMode:!1,predicate:(e,t)=>{let s=S(e,t);return s.length>0&&hx(t,s)},perform:()=>{i((e=>({openMenu:"shape"===e.openMenu?null:"shape",openPopup:"elementBackground"})))}},{label:Np("labels.canvasBackground"),keywords:["color"],icon:w,category:Dx,viewMode:!1,perform:()=>{i((e=>({openMenu:"canvas"===e.openMenu?null:"canvas",openPopup:"canvasBackground"})))}},...C.reduce(((e,s)=>{let{value:n,icon:i,key:l,numericKey:r}=s;if(!1===a.UIOptions.tools?.[n])return e;let o=l&&I("string"==typeof l?l:l[0])||r,d={label:Np(`toolBar.${n}`),category:jx,shortcut:o,icon:i,keywords:["toolbar"],viewMode:!1,perform:({event:e})=>{"image"===n?t.setActiveTool({type:n,insertOnCanvasDirectly:"keydown"===e.type}):t.setActiveTool({type:n})}};return e.push(d),e}),[]),...g,{label:Np("toolBar.lock"),category:jx,icon:e.activeTool.locked?k:M,shortcut:j.Q.toLocaleUpperCase(),viewMode:!1,perform:()=>{t.toggleLock()}},{label:`${Np("labels.textToDiagram")}...`,category:jx,icon:D,viewMode:!1,predicate:a.aiEnabled,perform:()=>{i((e=>({...e,openDialog:{name:"ttd",tab:"text-to-diagram"}})))}},{label:`${Np("toolBar.mermaidToExcalidraw")}...`,category:jx,icon:L,viewMode:!1,predicate:a.aiEnabled,perform:()=>{i((e=>({...e,openDialog:{name:"ttd",tab:"mermaid"}})))}}],T=[...m,...y,...n||[]].map((e=>({...e,icon:e.icon||N,order:e.order??Ax(e.category),haystack:`${rx(e.label.toLocaleLowerCase())} ${e.keywords?.join(" ")||""}`})));c(T),o(T.find((e=>e.label===r?.label))??null)}}),[h,t,l,c,r?.label,o,i]);let[m,u]=Mc(""),[g,f]=Mc(null),[y,T]=Mc({}),_=e=>{i({openDialog:null},e),u("")},P=(e,t)=>{"commandPalette"===n.openDialog?.name&&(t.stopPropagation(),t.preventDefault(),document.body.classList.add("excalidraw-animations-disabled"),_((()=>{e.perform({actionManager:l,event:t}),o(e),requestAnimationFrame((()=>{document.body.classList.remove("excalidraw-animations-disabled")}))})))},R=Ex((e=>(!1!==e.viewMode||!n.viewModeEnabled)&&("function"==typeof e.predicate?e.predicate(t.scene.getNonDeletedElements(),n,a,t):void 0===e.predicate||e.predicate))),O=Ex((e=>{let t=Ki(e.target)||Px(e)||e.key===j.ESCAPE;if(t&&e.key!==j.ARROW_UP&&e.key!==j.ARROW_DOWN&&e.key!==j.ENTER)return;let s=Object.values(y).flat(),n=r&&!m&&R(r);if(e.key!==j.ARROW_UP)if(e.key!==j.ARROW_DOWN){if(e.key===j.ENTER&&g&&setTimeout((()=>{P(g,e)})),!t){if(e.stopPropagation(),/^[a-zA-Z0-9]$/.test(e.key))return void p?.current?.focus();e.preventDefault()}}else{e.preventDefault();let t=s.findIndex((e=>e.label===g?.label));if(n){if(!g||t===s.length-1)return void f(r);if(g===r){let e=s[0];return void(e&&f(e))}}let i=s[(t+1)%s.length];i&&f(i)}else{e.preventDefault();let t,i=s.findIndex((e=>e.label===g?.label));if(n){if(0===i)return void f(r);if(g===r){let e=s[s.length-1];return void(e&&f(e))}}t=-1===i||0===i?s.length-1:(i-1)%s.length;let a=s[t];a&&f(a)}}));return Dc((()=>(window.addEventListener("keydown",O,{capture:!0}),()=>window.removeEventListener("keydown",O,{capture:!0}))),[O]),Dc((()=>{if(!d)return;let e=e=>{let t={};for(let s of e)t[s.category]?t[s.category].push(s):t[s.category]=[s];return t},t=d.filter(R).sort(((e,t)=>e.order-t.order)),s=!m&&r&&R(r);if(!m)return T(e(s?t.filter((e=>e.label!==r?.label)):t)),void f(s?r:t[0]||null);let n=rx(m.toLocaleLowerCase().replace(/[<>_| -]/g,""));t=lp.filter(n,t,{extract:e=>e.haystack}).sort(((e,t)=>t.score-e.score)).map((e=>e.original)),T(e(t)),f(t[0]??null)}),[m,d,R,r]),gp.exports.jsxs(Jg,{onCloseRequest:()=>_(),closeOnClickOutside:!0,title:!1,size:720,autofocus:!0,className:"command-palette-dialog",children:[gp.exports.jsx(tx,{value:m,placeholder:Np("commandPalette.search.placeholder"),onChange:e=>{u(e)},selectOnRender:!0,ref:p}),!t.device.viewport.isMobile&&gp.exports.jsxs("div",{className:"shortcuts-wrapper",children:[gp.exports.jsx(_x,{shortcut:"↑↓",children:Np("commandPalette.shortcuts.select")}),gp.exports.jsx(_x,{shortcut:"↵",children:Np("commandPalette.shortcuts.confirm")}),gp.exports.jsx(_x,{shortcut:x("Esc"),children:Np("commandPalette.shortcuts.close")})]}),gp.exports.jsxs("div",{className:"commands",children:[r&&!m&&gp.exports.jsxs("div",{className:"command-category",children:[gp.exports.jsxs("div",{className:"command-category-title",children:[Np("commandPalette.recents"),gp.exports.jsx("div",{className:"icon",style:{marginLeft:"6px"},children:A})]}),gp.exports.jsx(Ox,{command:r,isSelected:r.label===g?.label,onClick:e=>P(r,e),disabled:!R(r),onMouseMove:()=>f(r),showShortcut:!t.device.viewport.isMobile,appState:n})]}),Object.keys(y).length>0?Object.keys(y).map(((e,s)=>gp.exports.jsxs("div",{className:"command-category",children:[gp.exports.jsx("div",{className:"command-category-title",children:e}),y[e].map((e=>gp.exports.jsx(Ox,{command:e,isSelected:e.label===g?.label,onClick:t=>P(e,t),onMouseMove:()=>f(e),showShortcut:!t.device.viewport.isMobile,appState:n},e.label)))]},e))):d?gp.exports.jsxs("div",{className:"no-match",children:[gp.exports.jsx("div",{className:"icon",children:s})," ",Np("commandPalette.search.noMatch")]}):null]})]})}Object.assign((e=>{let t=Oh(),s=nv();return Dc((()=>{let e=e=>{Px(e)&&(e.preventDefault(),e.stopPropagation(),s((e=>{let t="commandPalette"===e.openDialog?.name?null:{name:"commandPalette"};return t&&dh("command_palette","open","shortcut"),{openDialog:t}})))};return window.addEventListener("keydown",e,{capture:!0}),()=>window.removeEventListener("keydown",e,{capture:!0})}),[s]),"commandPalette"!==t.openDialog?.name?null:gp.exports.jsx(Rx,{...e})}),{defaultItems:wx});var Ox=({command:e,isSelected:t,disabled:s,onMouseMove:n,onClick:i,showShortcut:a,appState:l})=>{let r=()=>{};return gp.exports.jsxs("div",{className:Vc("command-item",{"item-selected":t,"item-disabled":s}),ref:e=>{t&&!s&&e?.scrollIntoView?.({block:"nearest"})},onClick:s?r:i,onMouseMove:s?r:n,title:s?Np("commandPalette.itemNotAvailable"):"",children:[gp.exports.jsxs("div",{className:"name",children:[e.icon&&gp.exports.jsx(Qh,{icon:"function"==typeof e.icon?e.icon(l):e.icon}),e.label]}),a&&e.shortcut&&gp.exports.jsx(_x,{shortcut:e.shortcut})]})},Fx=e({name:"toggleLinearEditor",category:Lx,label:(e,t,s)=>"arrow"===s.scene.getSelectedElements({selectedElementIds:t.selectedElementIds})[0]?.type?"labels.lineEditor.editArrow":"labels.lineEditor.edit",keywords:["line"],trackEvent:{category:"element"},predicate:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t);return!(t.editingLinearElement||1!==i.length||!zt(i[0])||V(i[0]))},perform(e,t,s,n){let i=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0})[0],a=t.editingLinearElement?.elementId===i.id?null:new ze(i);return{appState:{...t,editingLinearElement:a},captureUpdate:Lt.IMMEDIATELY}},PanelComponent:({appState:e,updateData:t,app:s})=>{let n=s.scene.getSelectedElements({selectedElementIds:e.selectedElementIds})[0],i=Np("arrow"===n.type?"labels.lineEditor.editArrow":"labels.lineEditor.edit");return gp.exports.jsx(Fp,{type:"button",icon:Zi,title:i,"aria-label":i,onClick:()=>t(null)})}}),Bx=e({name:"searchMenu",icon:s,keywords:["search","find"],label:"search.title",viewMode:!0,trackEvent:{category:"search_menu",action:"toggle",predicate:e=>e.gridModeEnabled},perform(e,t,s,n){if(t.openSidebar?.name===v.name&&t.openSidebar.tab===Xi){let e=n.excalidrawContainerValue.container?.querySelector(`.${qi.SEARCH_MENU_INPUT_WRAPPER} input`);return e?.matches(":focus")?{appState:{...t,openSidebar:null},captureUpdate:Lt.EVENTUALLY}:(e?.focus(),e?.select(),!1)}return{appState:{...t,openSidebar:{name:v.name,tab:Xi},openDialog:null},captureUpdate:Lt.EVENTUALLY}},checked:e=>e.gridModeEnabled,predicate:(e,t,s)=>void 0===s.gridModeEnabled,keyTest:e=>e[j.CTRL_OR_CMD]&&e.key===j.F}),zx=e({name:"cropEditor",label:"helpDialog.cropStart",icon:Qi,viewMode:!0,trackEvent:{category:"menu"},keywords:["image","crop"],perform(e,t,s,n){let i=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0})[0];return{appState:{...t,isCropping:!1,croppingElementId:i.id},captureUpdate:Lt.IMMEDIATELY}},predicate:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t);return!(t.croppingElementId||1!==i.length||!B(i[0]))},PanelComponent:({appState:e,updateData:t,app:s})=>{let n=Np("helpDialog.cropStart");return gp.exports.jsx(Fp,{type:"button",icon:Qi,title:n,"aria-label":n,onClick:()=>t(null)})}}),Ux=class{constructor(e=!0,t=!0){this.isUndoStackEmpty=e,this.isRedoStackEmpty=t}},Hx=class e{constructor(){Cc(this,"onHistoryChangedEmitter",new c),Cc(this,"undoStack",[]),Cc(this,"redoStack",[])}get isUndoStackEmpty(){return 0===this.undoStack.length}get isRedoStackEmpty(){return 0===this.redoStack.length}clear(){this.undoStack.length=0,this.redoStack.length=0}record(e,t){let s=Yx.create(t,e);s.isEmpty()||(this.undoStack.push(s.inverse()),s.elementsChange.isEmpty()||(this.redoStack.length=0),this.onHistoryChangedEmitter.trigger(new Ux(this.isUndoStackEmpty,this.isRedoStackEmpty)))}undo(t,s,n){return this.perform(t,s,n,(()=>e.pop(this.undoStack)),(s=>e.push(this.redoStack,s,t)))}redo(t,s,n){return this.perform(t,s,n,(()=>e.pop(this.redoStack)),(s=>e.push(this.undoStack,s,t)))}perform(e,t,s,n,i){try{let a=n();if(null===a)return;let l=e,r=t,o=!1;for(;a;){try{[l,r,o]=a.applyTo(l,r,s)}finally{i(a)}if(o)break;a=n()}return[l,r]}finally{this.onHistoryChangedEmitter.trigger(new Ux(this.isUndoStackEmpty,this.isRedoStackEmpty))}}static pop(e){if(!e.length)return null;let t=e.pop();return void 0!==t?t:null}static push(e,t,s){let n=t.inverse().applyLatestChanges(s);return e.push(n)}},Yx=class e{constructor(e,t){this.appStateChange=e,this.elementsChange=t}static create(t,s){return new e(t,s)}inverse(){return new e(this.appStateChange.inverse(),this.elementsChange.inverse())}applyTo(e,t,s){let[n,i]=this.elementsChange.applyTo(e,s.elements),[a,l]=this.appStateChange.applyTo(t,n);return[n,a,i||l]}applyLatestChanges(t){let s=this.elementsChange.applyLatestChanges(t);return e.create(this.appStateChange,s)}isEmpty(){return this.appStateChange.isEmpty()&&this.elementsChange.isEmpty()}},Gx=(e,t)=>{let[s,n]=Mc(t);return Dc((()=>{let t=e.on((e=>{n(e)}));return()=>{t()}}),[e]),s},$x=(e,t,s)=>{if(!(t.multiElement||t.resizingElement||t.editingTextElement||t.newElement||t.selectedElementsAreBeingDragged||t.selectionElement||e.flowChartCreator.isCreatingChart)){let e=s();if(!e)return{captureUpdate:Lt.EVENTUALLY};let[t,n]=e;return{appState:n,elements:Array.from(t.values()),captureUpdate:Lt.NEVER}}return{captureUpdate:Lt.EVENTUALLY}},Vx=(e,t,s,n,i,a)=>{if(e.trackEvent)try{"object"==typeof e.trackEvent&&(!e.trackEvent.predicate||e.trackEvent.predicate(s,n,a))&&dh(e.trackEvent.category,e.trackEvent.action||e.name,`${t} (${i.device.editor.isMobile?"mobile":"desktop"})`)}catch(e){console.error("error while logging action:",e)}},Wx=class{constructor(e,t,s,n){Cc(this,"actions",{}),Cc(this,"updater"),Cc(this,"getAppState"),Cc(this,"getElementsIncludingDeleted"),Cc(this,"app"),Cc(this,"renderAction",((e,t)=>{let s=this.app.props.UIOptions.canvasActions;if(this.actions[e]&&"PanelComponent"in this.actions[e]&&(!(e in s)||s[e])){let s=this.actions[e],n=s.PanelComponent;n.displayName="PanelComponent";let i=this.getElementsIncludingDeleted(),a=this.getAppState(),l=e=>{Vx(s,"ui",a,i,this.app,e),this.updater(s.perform(this.getElementsIncludingDeleted(),this.getAppState(),e,this.app))};return gp.exports.jsx(n,{elements:this.getElementsIncludingDeleted(),appState:this.getAppState(),updateData:l,appProps:this.app.props,app:this.app,data:t})}return null})),Cc(this,"isActionEnabled",(e=>{let t=this.getElementsIncludingDeleted(),s=this.getAppState();return!e.predicate||e.predicate(t,s,this.app.props,this.app)})),this.updater=t=>{if(!Tt(t))return e(t);t.then((t=>e(t)))},this.getAppState=t,this.getElementsIncludingDeleted=s,this.app=n}registerAction(e){this.actions[e.name]=e}registerAll(e){e.forEach((e=>this.registerAction(e)))}handleKeyDown(e){let t=this.app.props.UIOptions.canvasActions,s=Object.values(this.actions).sort(((e,t)=>(t.keyPriority||0)-(e.keyPriority||0))).filter((s=>(!(s.name in t)||t[s.name])&&s.keyTest&&s.keyTest(e,this.getAppState(),this.getElementsIncludingDeleted(),this.app)));if(1!==s.length)return s.length>1&&console.warn("Canceling as multiple actions match this shortcut",s),!1;let n=s[0];if(this.getAppState().viewModeEnabled&&!0!==n.viewMode)return!1;let i=this.getElementsIncludingDeleted(),a=this.getAppState();return Vx(n,"keyboard",a,i,this.app,null),e.preventDefault(),e.stopPropagation(),this.updater(s[0].perform(i,a,null,this.app)),!0}executeAction(e,t="api",s=null){let n=this.getElementsIncludingDeleted(),i=this.getAppState();Vx(e,t,i,n,this.app,s),this.updater(e.perform(n,i,s,this.app))}},Kx=e=>{let t=Array.from(e.values());return{x:Xx(t,(e=>e.x))/t.length,y:Xx(t,(e=>e.y))/t.length}},Zx=([e,t])=>Math.hypot(e.x-t.x,e.y-t.y),Xx=(e,t)=>e.reduce(((e,s)=>e+t(s)),0),qx=({children:e,left:t,top:s,onCloseRequest:n,fitInViewport:i=!1,offsetLeft:a=0,offsetTop:l=0,viewportWidth:r=window.innerWidth,viewportHeight:o=window.innerHeight})=>{let d=jc(null);Dc((()=>{let e=d.current;if(!e)return;e.contains(document.activeElement)||e.focus();let t=t=>{if(t.key===j.TAB){let s=zi(e),{activeElement:n}=document,i=s.findIndex((e=>e===n));n===e?(t.shiftKey?s[s.length-1]?.focus():s[0].focus(),t.preventDefault(),t.stopImmediatePropagation()):0===i&&t.shiftKey?(s[s.length-1]?.focus(),t.preventDefault(),t.stopImmediatePropagation()):i===s.length-1&&!t.shiftKey&&(s[0]?.focus(),t.preventDefault(),t.stopImmediatePropagation())}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}),[]);let c=jc(null);return Rc((()=>{if(i&&d.current&&null!=s&&null!=t){let e=d.current,{width:n,height:i}=e.getBoundingClientRect();if(c.current?.top===s&&c.current?.left===t)return;c.current={top:s,left:t},n>=r?(e.style.width=`${r}px`,e.style.left="0px",e.style.overflowX="scroll"):e.style.left=t+n-a>r?r-n-10+"px":`${t}px`,i>=o?(e.style.height=o-20+"px",e.style.top="10px",e.style.overflowY="scroll"):e.style.top=s+i-l>o?o-i+"px":`${s}px`}}),[s,t,i,r,o,a,l]),Dc((()=>{if(n){let e=e=>{d.current?.contains(e.target)||Wc((()=>n(e)))};return document.addEventListener("pointerdown",e,!1),()=>document.removeEventListener("pointerdown",e,!1)}}),[n]),gp.exports.jsx("div",{className:"popover",ref:d,tabIndex:-1,children:e})},Qx="separator",Jx=Tc.memo((({actionManager:e,items:t,top:s,left:n,onClose:i})=>{let a=sv(),l=tv(),r=t.reduce(((t,s)=>(s&&(s===Qx||!s.predicate||s.predicate(l,a,e.app.props,e.app))&&t.push(s),t)),[]);return gp.exports.jsx(qx,{onCloseRequest:()=>{i()},top:s,left:n,fitInViewport:!0,offsetLeft:a.offsetLeft,offsetTop:a.offsetTop,viewportWidth:a.width,viewportHeight:a.height,children:gp.exports.jsx("ul",{className:"context-menu",onContextMenu:e=>e.preventDefault(),children:r.map(((t,s)=>{if(t===Qx)return r[s-1]&&r[s-1]!==Qx?gp.exports.jsx("hr",{className:"context-menu-item-separator"},s):null;let n=t.name,o="";return t.label&&(o="function"==typeof t.label?Np(t.label(l,a,e.app)):Np(t.label)),gp.exports.jsx("li",{"data-testid":n,onClick:()=>{i((()=>{e.executeAction(t,"contextMenu")}))},children:gp.exports.jsxs("button",{type:"button",className:Vc("context-menu-item",{dangerous:"deleteSelectedElements"===n,checkmark:t.checked?.(a)}),children:[gp.exports.jsx("div",{className:"context-menu-item__label",children:o}),gp.exports.jsx("kbd",{className:"context-menu-item__shortcut",children:n?nx(n):""})]})},s)}))})})})),ef=({children:e,onClose:t})=>{let[s,n]=Mc(!!e),{container:i}=ev(),a=Tc.useCallback((()=>{n(!1),t&&t(),i?.focus()}),[t,i]);return gp.exports.jsx(gp.exports.Fragment,{children:s&&gp.exports.jsx(Jg,{size:"small",onCloseRequest:a,title:Np("errorDialog.title"),children:gp.exports.jsx("div",{style:{whiteSpace:"pre-wrap"},children:e})})})},tf=function({onChange:e,value:t,choices:s,name:n}){return gp.exports.jsx("div",{className:"RadioGroup",children:s.map((s=>gp.exports.jsxs("div",{className:Vc("RadioGroup__choice",{active:s.value===t}),title:s.ariaLabel,children:[gp.exports.jsx("input",{name:n,type:"radio",checked:s.value===t,onChange:()=>e(s.value),"aria-label":s.ariaLabel}),s.label]},String(s.value))))})},sf=({title:e,name:t,checked:s,onChange:n,disabled:i=!1})=>gp.exports.jsx("div",{className:Vc("Switch",{toggled:s,disabled:i}),children:gp.exports.jsx("input",{name:t,id:t,title:e,type:"checkbox",checked:s,disabled:i,onChange:()=>n(!s),onKeyDown:e=>{" "===e.key&&n(!s)}})}),nf=Lc((({children:e,icon:t,onClick:s,label:n,variant:i="filled",color:a="primary",size:l="medium",fullWidth:r,className:o,status:d},c)=>{let[p,h]=Mc(!1),m=p?"loading":d;return a="success"===m?"success":a,gp.exports.jsx("button",{className:Vc("ExcButton",`ExcButton--color-${a}`,`ExcButton--variant-${i}`,`ExcButton--size-${l}`,`ExcButton--status-${m}`,{"ExcButton--fullWidth":r},o),onClick:async e=>{let t=s?.(e);if(Tt(t)){let e=window.setTimeout((()=>{h(!0)}),50);try{await t}catch(e){if(!(e instanceof Mt))throw e;console.warn(e)}finally{clearTimeout(e),h(!1)}}},type:"button","aria-label":n,ref:c,disabled:"loading"===m||"success"===m,children:gp.exports.jsxs("div",{className:"ExcButton__contents",children:["loading"===m?gp.exports.jsx(Pp,{className:"ExcButton__statusIcon"}):"success"===m&&gp.exports.jsx("div",{className:"ExcButton__statusIcon",children:_}),t&&gp.exports.jsx("div",{className:"ExcButton__icon","aria-hidden":!0,children:t}),"icon"!==i&&(e??n)]})})})),af="filter"in document.createElement("canvas").getContext("2d"),lf=()=>gp.exports.jsxs("div",{children:[gp.exports.jsx("h3",{children:Np("canvasError.cannotShowPreview")}),gp.exports.jsx("p",{children:gp.exports.jsx("span",{children:Np("canvasError.canvasTooBig")})}),gp.exports.jsxs("em",{children:["(",Np("canvasError.canvasTooBigTip"),")"]})]}),rf=({appStateSnapshot:e,elementsSnapshot:t,files:s,actionManager:n,onExportImage:i,name:a})=>{let l=je(t,e),[r,o]=Mc(a),[d,c]=Mc(l),[p,h]=Mc(e.exportBackground),[m,u]=Mc(e.exportWithDarkMode),[g,x]=Mc(e.exportEmbedScene),[f,b]=Mc(e.exportScale),E=jc(null),[y,v]=Mc(null),{onCopy:w,copyStatus:S,resetCopyStatus:C}=(()=>{let[e,t]=Mc(null),s=jc(0);return{copyStatus:e,resetCopyStatus:Ac((()=>{t(null)}),[]),onCopy:()=>{clearTimeout(s.current),t("success"),s.current=window.setTimeout((()=>{t(null)}),2e3)}}})();Dc((()=>{C()}),[r,p,m,f,g,C]);let{exportedElements:I,exportingFrame:k}=Wm(t,e,d);return Dc((()=>{let t=E.current;if(!t)return;let n=t.offsetWidth,i=t.offsetHeight;n&&Xd({elements:I,appState:{...e,name:r,exportBackground:p,exportWithDarkMode:m,exportScale:f,exportEmbedScene:g},files:s,exportPadding:ho,maxWidthOrHeight:Math.max(n,i),exportingFrame:k}).then((e=>(v(null),oo(e).then((()=>{t.replaceChildren(e)})).catch((e=>{throw"CANVAS_POSSIBLY_TOO_BIG"===e.name?new Error(Np("canvasError.canvasTooBig")):e}))))).catch((e=>{console.error(e),v(e)}))}),[e,s,I,k,r,p,m,f,g]),gp.exports.jsxs("div",{className:"ImageExportModal",children:[gp.exports.jsx("h3",{children:Np("imageExportDialog.header")}),gp.exports.jsxs("div",{className:"ImageExportModal__preview",children:[gp.exports.jsx("div",{className:"ImageExportModal__preview__canvas",ref:E,children:y&&gp.exports.jsx(lf,{})}),gp.exports.jsx("div",{className:"ImageExportModal__preview__filename",children:!up&&gp.exports.jsx("input",{type:"text",className:"TextInput",value:r,style:{width:"30ch"},onChange:e=>{o(e.target.value),n.executeAction(Xm,"ui",e.target.value)}})})]}),gp.exports.jsxs("div",{className:"ImageExportModal__settings",children:[gp.exports.jsx("h3",{children:Np("imageExportDialog.header")}),l&&gp.exports.jsx(of,{label:Np("imageExportDialog.label.onlySelected"),name:"exportOnlySelected",children:gp.exports.jsx(sf,{name:"exportOnlySelected",checked:d,onChange:e=>{c(e)}})}),gp.exports.jsx(of,{label:Np("imageExportDialog.label.withBackground"),name:"exportBackgroundSwitch",children:gp.exports.jsx(sf,{name:"exportBackgroundSwitch",checked:p,onChange:e=>{h(e),n.executeAction(Qm,"ui",e)}})}),af&&gp.exports.jsx(of,{label:Np("imageExportDialog.label.darkMode"),name:"exportDarkModeSwitch",children:gp.exports.jsx(sf,{name:"exportDarkModeSwitch",checked:m,onChange:e=>{u(e),n.executeAction(nu,"ui",e)}})}),gp.exports.jsx(of,{label:Np("imageExportDialog.label.embedScene"),tooltip:Np("imageExportDialog.tooltip.embedScene"),name:"exportEmbedSwitch",children:gp.exports.jsx(sf,{name:"exportEmbedSwitch",checked:g,onChange:e=>{x(e),n.executeAction(Jm,"ui",e)}})}),gp.exports.jsx(of,{label:Np("imageExportDialog.label.scale"),name:"exportScale",children:gp.exports.jsx(tf,{name:"exportScale",value:f,onChange:e=>{b(e),n.executeAction(qm,"ui",e)},choices:dn.map((e=>({value:e,label:`${e}×`})))})}),gp.exports.jsxs("div",{className:"ImageExportModal__settings__buttons",children:[gp.exports.jsx(nf,{className:"ImageExportModal__settings__buttons__button",label:Np("imageExportDialog.title.exportToPng"),onClick:()=>i(qd.png,I,{exportingFrame:k}),icon:Qd,children:Np("imageExportDialog.button.exportToPng")}),gp.exports.jsx(nf,{className:"ImageExportModal__settings__buttons__button",label:Np("imageExportDialog.title.exportToSvg"),onClick:()=>i(qd.svg,I,{exportingFrame:k}),icon:Qd,children:Np("imageExportDialog.button.exportToSvg")}),(mi||ai)&&gp.exports.jsx(nf,{className:"ImageExportModal__settings__buttons__button",label:Np("imageExportDialog.title.copyPngToClipboard"),status:S,onClick:async()=>{await i(qd.clipboard,I,{exportingFrame:k}),w()},icon:fe,children:Np("imageExportDialog.button.copyPngToClipboard")})]})]})]})},of=({label:e,children:t,tooltip:s,name:n})=>gp.exports.jsxs("div",{className:"ImageExportModal__settings__setting",title:e,children:[gp.exports.jsxs("label",{htmlFor:n,className:"ImageExportModal__settings__setting__label",children:[e,s&&gp.exports.jsx(_m,{label:s,long:!0,children:Jd})]}),gp.exports.jsx("div",{className:"ImageExportModal__settings__setting__content",children:t})]}),df=({elements:e,appState:t,files:s,actionManager:n,onExportImage:i,onCloseRequest:a,name:l})=>{let[{appStateSnapshot:r,elementsSnapshot:o}]=Mc((()=>({appStateSnapshot:io(t),elementsSnapshot:io(e)})));return gp.exports.jsx(Jg,{onCloseRequest:a,size:"wide",title:!1,children:gp.exports.jsx(rf,{elementsSnapshot:o,appStateSnapshot:r,files:s,actionManager:n,onExportImage:i,name:l})})},cf=({children:e,side:t,className:s})=>gp.exports.jsx("div",{className:Vc("FixedSideContainer",`FixedSideContainer_side_${t}`,s),children:e}),pf=100,hf=100,mf=e=>{switch(e){case j.ARROW_UP:return"up";case j.ARROW_DOWN:return"down";case j.ARROW_RIGHT:return"right";case j.ARROW_LEFT:return"left";default:return"right"}},uf=(e,t,s,n)=>{let i=[...s.values()].reduce(((n,i)=>{let a;if(V(i)&&(a=i["predecessors"===e?"startBinding":"endBinding"])&&i["predecessors"===e?"endBinding":"startBinding"]?.elementId===t.id){let l=s.get(a.elementId);if(!l)return n;ia(na(l),"not an ExcalidrawBindableElement");let r="predecessors"===e?i.points[i.points.length-1]:[0,0],o=ld(t,rd(t),[r[0]+i.x,r[1]+i.y]);n.push({relative:l,heading:o})}return n}),[]);switch(n){case"up":return i.filter((e=>od(e.heading,hd))).map((e=>e.relative));case"down":return i.filter((e=>od(e.heading,pd))).map((e=>e.relative));case"right":return i.filter((e=>od(e.heading,cd))).map((e=>e.relative));case"left":return i.filter((e=>od(e.heading,dd))).map((e=>e.relative))}},gf=(e,t,s)=>uf("successors",e,t,s),xf=(e,t,s)=>uf("predecessors",e,t,s),ff=(e,t,s,n)=>{let i=((e,t,s)=>{let n=hf+e.width;if("up"===s||"down"===s){let n=pf+e.height,i=e.x,a=e.x+e.width;if(t.every((e=>e.x+e.width<i||e.x>a)))return{x:0,y:n*("up"===s?-1:1)}}else if("right"===s||"left"===s){let n=e.y,i=e.y+e.height;if(t.every((e=>e.y+e.height<n||e.y>i)))return{x:(hf+e.width)*("left"===s?-1:1),y:0}}if("up"===s||"down"===s){let i=pf+e.height,a=(t.length,i),l=0===t.length?0:(t.length+1)%2==0?(t.length+1)/2*n:t.length/2*n*-1;return"up"===s?{x:l,y:-1*a}:{x:l,y:a}}let i=pf+e.height,a=(t.length,hf+e.width),l=0===t.length?0:(t.length+1)%2==0?(t.length+1)/2*i:t.length/2*i*-1;return"left"===s?{x:-1*a,y:l}:{x:a,y:l}})(e,[...gf(e,t,n),...xf(e,t,n)],n),a=ki({type:e.type,x:e.x+i.x,y:e.y+i.y,width:e.width,height:e.height,roundness:e.roundness,roughness:e.roughness,backgroundColor:e.backgroundColor,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,opacity:e.opacity,fillStyle:e.fillStyle,strokeStyle:e.strokeStyle});return ia(xl(a),"not an ExcalidrawFlowchartNodeElement"),{nextNode:a,bindingArrow:bf(e,a,t,n,s)}},bf=(e,t,s,n,i)=>{let a,l,r,o;switch(n){case"up":a=e.x+e.width/2,l=e.y-6;break;case"down":a=e.x+e.width/2,l=e.y+e.height+6;break;case"right":a=e.x+e.width+6,l=e.y+e.height/2;break;case"left":a=e.x-6,l=e.y+e.height/2}switch(n){case"up":r=t.x+t.width/2-a,o=t.y+t.height-l+6;break;case"down":r=t.x+t.width/2-a,o=t.y-l-6;break;case"right":r=t.x-a-6,o=t.y-l+t.height/2;break;case"left":r=t.x+t.width-a+6,o=t.y-l+t.height/2}let d=Jl({type:"arrow",x:a,y:l,startArrowhead:null,endArrowhead:i.currentItemEndArrowhead,strokeColor:e.strokeColor,strokeStyle:e.strokeStyle,strokeWidth:e.strokeWidth,opacity:e.opacity,roughness:e.roughness,points:[an(0,0),an(r,o)],elbowed:!0});so(d,e,"start",s),so(d,t,"end",s);let c=new Map;c.set(e.id,e),c.set(t.id,t),c.set(d.id,d),ze.movePoints(d,[{index:1,point:d.points[1]}]);let p=So(d,Co(new Map([...s.entries(),[e.id,e],[t.id,t],[d.id,d]])),{points:d.points});return{...d,...p}},Ef=class{constructor(){Cc(this,"isExploring",!1),Cc(this,"sameLevelNodes",[]),Cc(this,"sameLevelIndex",0),Cc(this,"direction",null),Cc(this,"visitedNodes",new Set)}clear(){this.isExploring=!1,this.sameLevelNodes=[],this.sameLevelIndex=0,this.direction=null,this.visitedNodes.clear()}exploreByDirection(e,t,s){if(!na(e))return null;if(s!==this.direction&&this.clear(),this.visitedNodes.has(e.id)||this.visitedNodes.add(e.id),this.isExploring&&s===this.direction&&this.sameLevelNodes.length>1)return this.sameLevelIndex=(this.sameLevelIndex+1)%this.sameLevelNodes.length,this.sameLevelNodes[this.sameLevelIndex].id;let n=[...gf(e,t,s),...xf(e,t,s)];if(n.length>0)return this.sameLevelIndex=0,this.isExploring=!0,this.sameLevelNodes=n,this.direction=s,this.visitedNodes.add(n[0].id),n[0].id;if(s===this.direction||!this.isExploring){this.isExploring||this.visitedNodes.add(e.id);let n=["up","right","down","left"].filter((e=>e!==s)).map((s=>[...gf(e,t,s),...xf(e,t,s)])).flat().filter((e=>!this.visitedNodes.has(e.id)));for(let e of n)if(!this.visitedNodes.has(e.id))return this.visitedNodes.add(e.id),this.isExploring=!0,this.direction=s,e.id}return null}},yf=class{constructor(){Cc(this,"isCreatingChart",!1),Cc(this,"numberOfNodes",0),Cc(this,"direction","right"),Cc(this,"pendingNodes",null)}createNodes(e,t,s,n){if(n!==this.direction){let{nextNode:i,bindingArrow:a}=ff(e,t,s,n);this.numberOfNodes=1,this.isCreatingChart=!0,this.direction=n,this.pendingNodes=[i,a]}else{this.numberOfNodes+=1;let i=((e,t,s,n,i)=>{let a=[];for(let l=0;l<i;l++){let r,o;if("left"===n||"right"===n){let t=pf*(i-1)+i*e.height,s=e.y+e.height/2-t/2,a=hf+e.width;"left"===n&&(a*=-1),r=e.x+a,o=s+(pf+e.height)*l}else{let t=hf*(i-1)+i*e.width,s=e.x+e.width/2-t/2,a=pf+e.height;"up"===n&&(a*=-1),o=e.y+a,r=s+(hf+e.width)*l}let d=ki({type:e.type,x:r,y:o,width:e.width,height:e.height,roundness:e.roundness,roughness:e.roughness,backgroundColor:e.backgroundColor,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,opacity:e.opacity,fillStyle:e.fillStyle,strokeStyle:e.strokeStyle});ia(xl(d),"not an ExcalidrawFlowchartNodeElement");let c=bf(e,d,t,n,s);a.push(d),a.push(c)}return a})(e,t,s,n,this.numberOfNodes);this.isCreatingChart=!0,this.direction=n,this.pendingNodes=i}if(e.frameId){let s=t.get(e.frameId);ia(s&&aa(s),"not an ExcalidrawFrameElement"),s&&this.pendingNodes.every((e=>la([e],s,t)||ra(e,s,t)))&&(this.pendingNodes=this.pendingNodes.map((t=>He(t,{frameId:e.frameId},!1))))}}clear(){this.isCreatingChart=!1,this.pendingNodes=null,this.direction=null,this.numberOfNodes=0}},vf=({appState:e,isMobile:t,device:s,app:n})=>{let i=(({appState:e,isMobile:t,device:s,app:n})=>{let{activeTool:i,isResizing:a,isRotating:l,lastPointerDownWith:r}=e,o=null!==e.multiElement;if(e.openSidebar?.name===v.name&&e.openSidebar.tab===Xi&&e.searchMatches?.length)return Np("hints.dismissSearch");if(e.openSidebar&&!s.editor.canFitSidebar)return null;if(Ae(e))return Np("hints.eraserRevert");if("arrow"===i.type||"line"===i.type)return o?Np("hints.linearElementMulti"):"arrow"===i.type?Np("hints.arrowTool",{arrowShortcut:x("A")}):Np("hints.linearElement");if("freedraw"===i.type)return Np("hints.freeDraw");if("text"===i.type)return Np("hints.text");if("embeddable"===i.type)return Np("hints.embeddable");if("image"===e.activeTool.type&&e.pendingImageElementId)return Np("hints.placeImage");let d=n.scene.getSelectedElements(e);if(a&&"mouse"===r&&1===d.length){let e=d[0];return zt(e)&&2===e.points.length?Np("hints.lockAngle"):B(e)?Np("hints.resizeImage"):Np("hints.resize")}if(l&&"mouse"===r)return Np("hints.rotate");if(1===d.length&&tt(d[0]))return Np("hints.text_selected");if(e.editingTextElement)return Np("hints.text_editing");if(e.croppingElementId)return Np("hints.leaveCropEditor");if(1===d.length&&B(d[0]))return Np("hints.enterCropEditor");if("selection"===i.type){if(e.selectionElement&&!d.length&&!e.editingTextElement&&!e.editingLinearElement)return Np("hints.deepBoxSelect");if(Ee(n)&&e.selectedElementsAreBeingDragged)return Np("hints.disableSnapping");if(!d.length&&!t)return Np("hints.canvasPanning");if(1===d.length){if(zt(d[0]))return e.editingLinearElement?e.editingLinearElement.selectedPointsIndices?Np("hints.lineEditor_pointSelected"):Np("hints.lineEditor_nothingSelected"):Np("hints.lineEditor_info");if(!e.newElement&&!e.selectedElementsAreBeingDragged&&ht(d[0]))return xl(d[0])?(((e,t)=>{for(let[,s]of t)if("arrow"===s.type&&(s.startBinding?.elementId===e.id||s.endBinding?.elementId===e.id))return!0})(d[0],n.scene.getNonDeletedElementsMap()),[Np("hints.bindTextToElement"),Np("hints.createFlowchart")]):Np("hints.bindTextToElement")}}return null})({appState:e,isMobile:t,device:s,app:n});if(!i)return null;let a=Array.isArray(i)?i.map((e=>x(e).replace(/\. ?$/,""))).join(". "):x(i);return gp.exports.jsx("div",{className:"HintViewer",children:gp.exports.jsx("span",{children:a})})},wf={CHECKED:k,UNCHECKED:M},Sf=e=>gp.exports.jsxs("label",{className:Vc("ToolIcon ToolIcon__lock","ToolIcon_size_medium",{"is-mobile":e.isMobile}),title:`${e.title} — Q`,children:[gp.exports.jsx("input",{className:"ToolIcon_type_checkbox",type:"checkbox",name:e.name,onChange:e.onChange,checked:e.checked,"aria-label":e.title,"data-testid":"toolbar-lock"}),gp.exports.jsx("div",{className:"ToolIcon__icon",children:e.checked?wf.CHECKED:wf.UNCHECKED})]}),Cf=({heading:e,children:t,...s})=>{let{id:n}=ev(),i=gp.exports.jsx("h2",{className:"visually-hidden",id:`${n}-${e}-title`,children:Np(`headings.${e}`)});return gp.exports.jsx("section",{...s,"aria-labelledby":`${n}-${e}-title`,children:"function"==typeof t?t(i):gp.exports.jsxs(gp.exports.Fragment,{children:[i,t]})})},If=(e,t,s)=>{let[n,i]=[e.horizontal,e.vertical].map((e=>null!=e&&e.x<=t&&t<=e.x+e.width&&e.y<=s&&s<=e.y+e.height));return{isOverEither:n||i,isOverHorizontal:n,isOverVertical:i}},kf=e=>e.penDetected?gp.exports.jsxs("label",{className:Vc("ToolIcon ToolIcon__penMode","ToolIcon_size_medium",{"is-mobile":e.isMobile}),title:`${e.title}`,children:[gp.exports.jsx("input",{className:"ToolIcon_type_checkbox",type:"checkbox",name:e.name,onChange:e.onChange,checked:e.checked,"aria-label":e.title}),gp.exports.jsx("div",{className:"ToolIcon__icon",children:md})]}):null,Tf=e=>gp.exports.jsx(Fp,{className:Vc("Shape",{fillable:!1}),type:"radio",icon:Qs,name:"editor-current-shape",checked:e.checked,title:`${e.title} — H`,keyBindingLabel:e.isMobile?void 0:j.H.toLocaleUpperCase(),"aria-label":`${e.title} — H`,"aria-keyshortcuts":j.H,"data-testid":"toolbar-hand",onChange:()=>e.onChange?.()}),Mf=({appState:e,elements:t,actionManager:s,setAppState:n,onLockToggle:i,onHandToolToggle:a,onPenModeToggle:l,renderTopRightUI:r,renderCustomStats:o,renderSidebars:d,device:c,renderWelcomeScreen:p,UIOptions:h,app:m})=>{let{WelcomeScreenCenterTunnel:u,MainMenuTunnel:g,DefaultSidebarTriggerTunnel:x}=dx();return gp.exports.jsxs(gp.exports.Fragment,{children:[d(),!e.viewModeEnabled&&"elementLinkSelector"!==e.openDialog?.name&&gp.exports.jsxs(cf,{side:"top",className:"App-top-bar",children:[p&&gp.exports.jsx(u.Out,{}),gp.exports.jsx(Cf,{heading:"shapes",children:t=>gp.exports.jsx(hg.Col,{gap:4,align:"center",children:gp.exports.jsxs(hg.Row,{gap:1,className:"App-toolbar-container",children:[gp.exports.jsxs(Gh,{padding:1,className:"App-toolbar App-toolbar--mobile",children:[t,gp.exports.jsx(hg.Row,{gap:1,children:gp.exports.jsx(ux,{appState:e,activeTool:e.activeTool,UIOptions:h,app:m})})]}),r&&r(!0,e),gp.exports.jsxs("div",{className:"mobile-misc-tools-container",children:[!e.viewModeEnabled&&"elementLinkSelector"!==e.openDialog?.name&&gp.exports.jsx(x.Out,{}),gp.exports.jsx(kf,{checked:e.penMode,onChange:()=>l(null),title:Np("toolBar.penMode"),isMobile:!0,penDetected:e.penDetected}),gp.exports.jsx(Sf,{checked:e.activeTool.locked,onChange:i,title:Np("toolBar.lock"),isMobile:!0}),gp.exports.jsx(Tf,{checked:Js(e),onChange:()=>a(),title:Np("toolBar.hand"),isMobile:!0})]})]})})}),gp.exports.jsx(vf,{appState:e,isMobile:!0,device:c,app:m})]}),gp.exports.jsx("div",{className:"App-bottom-bar",style:{marginBottom:14,marginLeft:14,marginRight:14},children:gp.exports.jsxs(Gh,{padding:0,children:["shape"===e.openMenu&&!e.viewModeEnabled&&"elementLinkSelector"!==e.openDialog?.name&&Cn(e,t)?gp.exports.jsx(Cf,{className:"App-mobile-menu",heading:"selectedShapeActions",children:gp.exports.jsx(mx,{appState:e,elementsMap:m.scene.getNonDeletedElementsMap(),renderAction:s.renderAction,app:m})}):null,gp.exports.jsxs("footer",{className:"App-toolbar",children:[e.viewModeEnabled||"elementLinkSelector"===e.openDialog?.name?gp.exports.jsx("div",{className:"App-toolbar-content",children:gp.exports.jsx(g.Out,{})}):gp.exports.jsxs("div",{className:"App-toolbar-content",children:[gp.exports.jsx(g.Out,{}),s.renderAction("toggleEditMenu"),s.renderAction(e.multiElement?"finalize":"duplicateSelection"),s.renderAction("deleteSelectedElements"),gp.exports.jsxs("div",{children:[s.renderAction("undo"),s.renderAction("redo")]})]}),e.scrolledOutside&&!e.openMenu&&!e.openSidebar&&gp.exports.jsx("button",{type:"button",className:"scroll-back-to-content",onClick:()=>{n((e=>({...Ea(t,e)})))},children:Np("buttons.scrollBackToContent")})]})]})})]})},jf=e=>{let t=jc(null),[s,n]=Mc(null);return Rc((()=>{if(!e.spreadsheet)return;let s=ud(e.chartType,e.spreadsheet,0,0);n(s);let i,a=t.current;return(async()=>{i=await ao(s,{exportBackground:!1,viewBackgroundColor:ip.white},null,{skipInliningFonts:!0}),i.querySelector(".style-fonts")?.remove(),a.replaceChildren(),a.appendChild(i),e.selected&&a.parentNode.focus()})(),()=>{a.replaceChildren()}}),[e.spreadsheet,e.chartType,e.selected]),gp.exports.jsx("button",{type:"button",className:"ChartPreview",onClick:()=>{s&&e.onClick(e.chartType,s)},children:gp.exports.jsx("div",{ref:t})})},Df=({setAppState:e,appState:t,onClose:s})=>{let{onInsertElements:n}=qy(),i=Tc.useCallback((()=>{s&&s()}),[s]),a=(t,s)=>{n(s),dh("paste","chart",t),e({currentChartType:t,pasteDialog:{shown:!1,data:null}})};return gp.exports.jsx(Jg,{size:"small",onCloseRequest:i,title:Np("labels.pasteCharts"),className:"PasteChartDialog",autofocus:!1,children:gp.exports.jsxs("div",{className:"container",children:[gp.exports.jsx(jf,{chartType:"bar",spreadsheet:t.pasteDialog.data,selected:"bar"===t.currentChartType,onClick:a}),gp.exports.jsx(jf,{chartType:"line",spreadsheet:t.pasteDialog.data,selected:"line"===t.currentChartType,onClick:a})]})})},Lf=()=>gp.exports.jsxs("div",{className:"HelpDialog__header",children:[gp.exports.jsxs("a",{className:"HelpDialog__btn",href:"https://docs.excalidraw.com",target:"_blank",rel:"noopener noreferrer",children:[gp.exports.jsx("div",{className:"HelpDialog__link-icon",children:gd}),Np("helpDialog.documentation")]}),gp.exports.jsxs("a",{className:"HelpDialog__btn",href:"https://plus.excalidraw.com/blog",target:"_blank",rel:"noopener noreferrer",children:[gp.exports.jsx("div",{className:"HelpDialog__link-icon",children:gd}),Np("helpDialog.blog")]}),gp.exports.jsxs("a",{className:"HelpDialog__btn",href:"https://github.com/excalidraw/excalidraw/issues",target:"_blank",rel:"noopener noreferrer",children:[gp.exports.jsx("div",{className:"HelpDialog__link-icon",children:ma}),Np("helpDialog.github")]}),gp.exports.jsxs("a",{className:"HelpDialog__btn",href:"https://youtube.com/@excalidraw",target:"_blank",rel:"noopener noreferrer",children:[gp.exports.jsx("div",{className:"HelpDialog__link-icon",children:xd}),"YouTube"]})]}),Nf=e=>gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsx("h3",{children:e.title}),gp.exports.jsx("div",{className:"HelpDialog__islands-container",children:e.children})]}),Af=e=>gp.exports.jsxs("div",{className:`HelpDialog__island ${e.className}`,children:[gp.exports.jsx("h4",{className:"HelpDialog__island-title",children:e.caption}),gp.exports.jsx("div",{className:"HelpDialog__island-content",children:e.children})]});function*_f(e,t){let s=!0;for(let n of e)s||(yield t),s=!1,yield n}var Pf=e=>e.replace(/\b[a-z]\b/,(e=>e.toUpperCase())),Rf=({label:e,shortcuts:t,isOr:s=!0})=>{let n=t.map((e=>(e.endsWith("++")?[...e.slice(0,-2).split("+"),"+"]:e.split("+")).map((e=>gp.exports.jsx(Of,{children:Pf(e)},e)))));return gp.exports.jsxs("div",{className:"HelpDialog__shortcut",children:[gp.exports.jsx("div",{children:e}),gp.exports.jsx("div",{className:"HelpDialog__key-container",children:[..._f(n,s?Np("helpDialog.or"):null)]})]})},Of=e=>gp.exports.jsx("kbd",{className:"HelpDialog__key",...e}),Ff=({onClose:e})=>{let t=Tc.useCallback((()=>{e&&e()}),[e]);return gp.exports.jsx(gp.exports.Fragment,{children:gp.exports.jsxs(Jg,{onCloseRequest:t,title:Np("helpDialog.title"),className:"HelpDialog",children:[gp.exports.jsx(Lf,{}),gp.exports.jsxs(Nf,{title:Np("helpDialog.shortcuts"),children:[gp.exports.jsxs(Af,{className:"HelpDialog__island--tools",caption:Np("helpDialog.tools"),children:[gp.exports.jsx(Rf,{label:Np("toolBar.hand"),shortcuts:[j.H]}),gp.exports.jsx(Rf,{label:Np("toolBar.selection"),shortcuts:[j.V,j[1]]}),gp.exports.jsx(Rf,{label:Np("toolBar.rectangle"),shortcuts:[j.R,j[2]]}),gp.exports.jsx(Rf,{label:Np("toolBar.diamond"),shortcuts:[j.D,j[3]]}),gp.exports.jsx(Rf,{label:Np("toolBar.ellipse"),shortcuts:[j.O,j[4]]}),gp.exports.jsx(Rf,{label:Np("toolBar.arrow"),shortcuts:[j.A,j[5]]}),gp.exports.jsx(Rf,{label:Np("toolBar.line"),shortcuts:[j.L,j[6]]}),gp.exports.jsx(Rf,{label:Np("toolBar.freedraw"),shortcuts:[j.P,j[7]]}),gp.exports.jsx(Rf,{label:Np("toolBar.text"),shortcuts:[j.T,j[8]]}),gp.exports.jsx(Rf,{label:Np("toolBar.image"),shortcuts:[j[9]]}),gp.exports.jsx(Rf,{label:Np("toolBar.eraser"),shortcuts:[j.E,j[0]]}),gp.exports.jsx(Rf,{label:Np("toolBar.frame"),shortcuts:[j.F]}),gp.exports.jsx(Rf,{label:Np("toolBar.laser"),shortcuts:[j.K]}),gp.exports.jsx(Rf,{label:Np("labels.eyeDropper"),shortcuts:[j.I,"Shift+S","Shift+G"]}),gp.exports.jsx(Rf,{label:Np("helpDialog.editLineArrowPoints"),shortcuts:[x("CtrlOrCmd+Enter")]}),gp.exports.jsx(Rf,{label:Np("helpDialog.editText"),shortcuts:[x("Enter")]}),gp.exports.jsx(Rf,{label:Np("helpDialog.textNewLine"),shortcuts:[x("Enter"),x("Shift+Enter")]}),gp.exports.jsx(Rf,{label:Np("helpDialog.textFinish"),shortcuts:[x("Esc"),x("CtrlOrCmd+Enter")]}),gp.exports.jsx(Rf,{label:Np("helpDialog.curvedArrow"),shortcuts:["A",Np("helpDialog.click"),Np("helpDialog.click"),Np("helpDialog.click")],isOr:!1}),gp.exports.jsx(Rf,{label:Np("helpDialog.curvedLine"),shortcuts:["L",Np("helpDialog.click"),Np("helpDialog.click"),Np("helpDialog.click")],isOr:!1}),gp.exports.jsx(Rf,{label:Np("helpDialog.cropStart"),shortcuts:[Np("helpDialog.doubleClick"),x("Enter")],isOr:!0}),gp.exports.jsx(Rf,{label:Np("helpDialog.cropFinish"),shortcuts:[x("Enter"),x("Escape")],isOr:!0}),gp.exports.jsx(Rf,{label:Np("toolBar.lock"),shortcuts:[j.Q]}),gp.exports.jsx(Rf,{label:Np("helpDialog.preventBinding"),shortcuts:[x("CtrlOrCmd")]}),gp.exports.jsx(Rf,{label:Np("toolBar.link"),shortcuts:[x("CtrlOrCmd+K")]})]}),gp.exports.jsxs(Af,{className:"HelpDialog__island--view",caption:Np("helpDialog.view"),children:[gp.exports.jsx(Rf,{label:Np("buttons.zoomIn"),shortcuts:[x("CtrlOrCmd++")]}),gp.exports.jsx(Rf,{label:Np("buttons.zoomOut"),shortcuts:[x("CtrlOrCmd+-")]}),gp.exports.jsx(Rf,{label:Np("buttons.resetZoom"),shortcuts:[x("CtrlOrCmd+0")]}),gp.exports.jsx(Rf,{label:Np("helpDialog.zoomToFit"),shortcuts:["Shift+1"]}),gp.exports.jsx(Rf,{label:Np("helpDialog.zoomToSelection"),shortcuts:["Shift+2"]}),gp.exports.jsx(Rf,{label:Np("helpDialog.movePageUpDown"),shortcuts:["PgUp/PgDn"]}),gp.exports.jsx(Rf,{label:Np("helpDialog.movePageLeftRight"),shortcuts:["Shift+PgUp/PgDn"]}),gp.exports.jsx(Rf,{label:Np("buttons.zenMode"),shortcuts:[x("Alt+Z")]}),gp.exports.jsx(Rf,{label:Np("buttons.objectsSnapMode"),shortcuts:[x("Alt+S")]}),gp.exports.jsx(Rf,{label:Np("labels.toggleGrid"),shortcuts:[x("CtrlOrCmd+'")]}),gp.exports.jsx(Rf,{label:Np("labels.viewMode"),shortcuts:[x("Alt+R")]}),gp.exports.jsx(Rf,{label:Np("labels.toggleTheme"),shortcuts:[x("Alt+Shift+D")]}),gp.exports.jsx(Rf,{label:Np("stats.fullTitle"),shortcuts:[x("Alt+/")]}),gp.exports.jsx(Rf,{label:Np("search.title"),shortcuts:[nx("searchMenu")]}),gp.exports.jsx(Rf,{label:Np("commandPalette.title"),shortcuts:ai?[nx("commandPalette")]:[nx("commandPalette"),nx("commandPalette",1)]})]}),gp.exports.jsxs(Af,{className:"HelpDialog__island--editor",caption:Np("helpDialog.editor"),children:[gp.exports.jsx(Rf,{label:Np("helpDialog.createFlowchart"),shortcuts:[x("CtrlOrCmd+Arrow Key")],isOr:!0}),gp.exports.jsx(Rf,{label:Np("helpDialog.navigateFlowchart"),shortcuts:[x("Alt+Arrow Key")],isOr:!0}),gp.exports.jsx(Rf,{label:Np("labels.moveCanvas"),shortcuts:[x(`Space+${Np("helpDialog.drag")}`),x(`Wheel+${Np("helpDialog.drag")}`)],isOr:!0}),gp.exports.jsx(Rf,{label:Np("buttons.clearReset"),shortcuts:[x("CtrlOrCmd+Delete")]}),gp.exports.jsx(Rf,{label:Np("labels.delete"),shortcuts:[x("Delete")]}),gp.exports.jsx(Rf,{label:Np("labels.cut"),shortcuts:[x("CtrlOrCmd+X")]}),gp.exports.jsx(Rf,{label:Np("labels.copy"),shortcuts:[x("CtrlOrCmd+C")]}),gp.exports.jsx(Rf,{label:Np("labels.paste"),shortcuts:[x("CtrlOrCmd+V")]}),gp.exports.jsx(Rf,{label:Np("labels.pasteAsPlaintext"),shortcuts:[x("CtrlOrCmd+Shift+V")]}),gp.exports.jsx(Rf,{label:Np("labels.selectAll"),shortcuts:[x("CtrlOrCmd+A")]}),gp.exports.jsx(Rf,{label:Np("labels.multiSelect"),shortcuts:[x(`Shift+${Np("helpDialog.click")}`)]}),gp.exports.jsx(Rf,{label:Np("helpDialog.deepSelect"),shortcuts:[x(`CtrlOrCmd+${Np("helpDialog.click")}`)]}),gp.exports.jsx(Rf,{label:Np("helpDialog.deepBoxSelect"),shortcuts:[x(`CtrlOrCmd+${Np("helpDialog.drag")}`)]}),(mi||ai)&&gp.exports.jsx(Rf,{label:Np("labels.copyAsPng"),shortcuts:[x("Shift+Alt+C")]}),gp.exports.jsx(Rf,{label:Np("labels.copyStyles"),shortcuts:[x("CtrlOrCmd+Alt+C")]}),gp.exports.jsx(Rf,{label:Np("labels.pasteStyles"),shortcuts:[x("CtrlOrCmd+Alt+V")]}),gp.exports.jsx(Rf,{label:Np("labels.sendToBack"),shortcuts:[x(f?"CtrlOrCmd+Alt+[":"CtrlOrCmd+Shift+[")]}),gp.exports.jsx(Rf,{label:Np("labels.bringToFront"),shortcuts:[x(f?"CtrlOrCmd+Alt+]":"CtrlOrCmd+Shift+]")]}),gp.exports.jsx(Rf,{label:Np("labels.sendBackward"),shortcuts:[x("CtrlOrCmd+[")]}),gp.exports.jsx(Rf,{label:Np("labels.bringForward"),shortcuts:[x("CtrlOrCmd+]")]}),gp.exports.jsx(Rf,{label:Np("labels.alignTop"),shortcuts:[x("CtrlOrCmd+Shift+Up")]}),gp.exports.jsx(Rf,{label:Np("labels.alignBottom"),shortcuts:[x("CtrlOrCmd+Shift+Down")]}),gp.exports.jsx(Rf,{label:Np("labels.alignLeft"),shortcuts:[x("CtrlOrCmd+Shift+Left")]}),gp.exports.jsx(Rf,{label:Np("labels.alignRight"),shortcuts:[x("CtrlOrCmd+Shift+Right")]}),gp.exports.jsx(Rf,{label:Np("labels.duplicateSelection"),shortcuts:[x("CtrlOrCmd+D"),x(`Alt+${Np("helpDialog.drag")}`)]}),gp.exports.jsx(Rf,{label:Np("helpDialog.toggleElementLock"),shortcuts:[x("CtrlOrCmd+Shift+L")]}),gp.exports.jsx(Rf,{label:Np("buttons.undo"),shortcuts:[x("CtrlOrCmd+Z")]}),gp.exports.jsx(Rf,{label:Np("buttons.redo"),shortcuts:sa?[x("CtrlOrCmd+Y"),x("CtrlOrCmd+Shift+Z")]:[x("CtrlOrCmd+Shift+Z")]}),gp.exports.jsx(Rf,{label:Np("labels.group"),shortcuts:[x("CtrlOrCmd+G")]}),gp.exports.jsx(Rf,{label:Np("labels.ungroup"),shortcuts:[x("CtrlOrCmd+Shift+G")]}),gp.exports.jsx(Rf,{label:Np("labels.flipHorizontal"),shortcuts:[x("Shift+H")]}),gp.exports.jsx(Rf,{label:Np("labels.flipVertical"),shortcuts:[x("Shift+V")]}),gp.exports.jsx(Rf,{label:Np("labels.showStroke"),shortcuts:[x("S")]}),gp.exports.jsx(Rf,{label:Np("labels.showBackground"),shortcuts:[x("G")]}),gp.exports.jsx(Rf,{label:Np("labels.showFonts"),shortcuts:[x("Shift+F")]}),gp.exports.jsx(Rf,{label:Np("labels.decreaseFontSize"),shortcuts:[x("CtrlOrCmd+Shift+<")]}),gp.exports.jsx(Rf,{label:Np("labels.increaseFontSize"),shortcuts:[x("CtrlOrCmd+Shift+>")]})]})]})]})})},Bf=({shouldWrap:e,children:t,username:s})=>e?gp.exports.jsx(_m,{label:s||"Unknown user",children:t}):gp.exports.jsx(gp.exports.Fragment,{children:t}),zf=({actionManager:e,collaborator:t,socketId:s,withName:n=!1,shouldWrapWithTooltip:i=!1,isBeingFollowed:a})=>{let l={socketId:s,collaborator:t,withName:n,isBeingFollowed:a},r=e.renderAction("goToCollaborator",l);return gp.exports.jsx(Bf,{username:t.username,shouldWrap:i,children:r},s)},Uf=["avatarUrl","id","socketId","username","isInCall","isSpeaking","isMuted"],Hf=Tc.memo((({className:e,mobile:t,collaborators:s,userToFollow:n})=>{let i=iv(),a=new Map;s.forEach(((e,t)=>{let s=e.id||t;a.set(s,{...e,socketId:t})}));let l=Array.from(a.values()).filter((e=>e.username?.trim())),[r,o]=Tc.useState(""),d=l.filter((e=>e.username?.toLowerCase().includes(r))),c=Tc.useRef(null);Rc((()=>{if(c.current){let e=e=>{let t=Math.max(1,Math.min(8,Math.floor(e/38)));h(t)};if(e(c.current.clientWidth),!P)return;let t=new ResizeObserver((t=>{for(let s of t){let{width:t}=s.contentRect;e(t)}}));return t.observe(c.current),()=>{t.disconnect()}}}),[]);let[p,h]=Tc.useState(4),m=l.slice(0,p-1).map((e=>zf({actionManager:i,collaborator:e,socketId:e.socketId,shouldWrapWithTooltip:!0,isBeingFollowed:e.socketId===n})));return t?gp.exports.jsx("div",{className:Vc("UserList UserList_mobile",e),children:l.map((e=>zf({actionManager:i,collaborator:e,socketId:e.socketId,shouldWrapWithTooltip:!0,isBeingFollowed:e.socketId===n})))}):gp.exports.jsx("div",{className:"UserList__wrapper",ref:c,children:gp.exports.jsxs("div",{className:Vc("UserList",e),style:{"--max-avatars":p},children:[m,l.length>p-1&&gp.exports.jsxs(sp,{children:[gp.exports.jsxs(np,{className:"UserList__more",children:["+",l.length-p+1]}),gp.exports.jsx(ep,{style:{zIndex:2,width:"15rem",textAlign:"left"},align:"end",sideOffset:10,children:gp.exports.jsxs(Gh,{padding:2,children:[l.length>=8&&gp.exports.jsx(im,{placeholder:Np("quickSearch.placeholder"),onChange:o}),gp.exports.jsx(am,{className:"dropdown-menu UserList__collaborators",placeholder:Np("userList.empty"),children:d.length>0?[gp.exports.jsx("div",{className:"hint",children:Np("userList.hint.text")}),d.map((e=>zf({actionManager:i,collaborator:e,socketId:e.socketId,withName:!0,isBeingFollowed:e.socketId===n})))]:[]}),gp.exports.jsx(tp,{width:20,height:10,style:{fill:"var(--popup-bg-color)",filter:"drop-shadow(rgba(0, 0, 0, 0.05) 0px 3px 2px)"}})]})})]})]})})}),((e,t)=>{if(e.collaborators.size!==t.collaborators.size||e.mobile!==t.mobile||e.className!==t.className||e.userToFollow!==t.userToFollow)return!1;let s=t.collaborators.keys();for(let[n,i]of e.collaborators){let e=t.collaborators.get(n);if(!e||n!==s.next().value||!R(i,e,Uf))return!1}return!0})),Yf=({children:e,color:t})=>gp.exports.jsx("div",{className:"Card",style:{"--card-color":"primary"===t?"var(--color-primary)":ip[t][7],"--card-color-darker":"primary"===t?"var(--color-primary-darker)":ip[t][8],"--card-color-darkest":"primary"===t?"var(--color-primary-darkest)":ip[t][9]},children:e}),Gf=({elements:e,appState:t,setAppState:s,files:n,actionManager:i,exportOpts:a,canvas:l,onCloseRequest:r})=>{let{onExportToBackend:o}=a;return gp.exports.jsx("div",{className:"ExportDialog ExportDialog--json",children:gp.exports.jsxs("div",{className:"ExportDialog-cards",children:[a.saveFileToDisk&&gp.exports.jsxs(Yf,{color:"lime",children:[gp.exports.jsx("div",{className:"Card-icon",children:tc}),gp.exports.jsx("h2",{children:Np("exportDialog.disk_title")}),gp.exports.jsxs("div",{className:"Card-details",children:[Np("exportDialog.disk_details"),!up&&i.renderAction("changeProjectName")]}),gp.exports.jsx(Fp,{className:"Card-button",type:"button",title:Np("exportDialog.disk_button"),"aria-label":Np("exportDialog.disk_button"),showAriaLabel:!0,onClick:()=>{i.executeAction(tu,"ui")}})]}),o&&gp.exports.jsxs(Yf,{color:"pink",children:[gp.exports.jsx("div",{className:"Card-icon",children:_i}),gp.exports.jsx("h2",{children:Np("exportDialog.link_title")}),gp.exports.jsx("div",{className:"Card-details",children:Np("exportDialog.link_details")}),gp.exports.jsx(Fp,{className:"Card-button",type:"button",title:Np("exportDialog.link_button"),"aria-label":Np("exportDialog.link_button"),showAriaLabel:!0,onClick:async()=>{try{dh("export","link",`ui (${sc()})`),await o(e,t,n),r()}catch(e){s({errorMessage:e.message})}}})]}),a.renderCustomUI&&a.renderCustomUI(e,t,n,l)]})})},$f=({elements:e,appState:t,files:s,actionManager:n,exportOpts:i,canvas:a,setAppState:l})=>{let r=Tc.useCallback((()=>{l({openDialog:null})}),[l]);return gp.exports.jsx(gp.exports.Fragment,{children:"jsonExport"===t.openDialog?.name&&gp.exports.jsx(Jg,{onCloseRequest:r,title:Np("buttons.export"),children:gp.exports.jsx(Gf,{elements:e,appState:t,setAppState:l,files:s,actionManager:n,onCloseRequest:r,exportOpts:i,canvas:a})})})},Vf=e=>gp.exports.jsx("button",{className:"help-icon",onClick:e.onClick,type:"button",title:`${Np("helpDialog.title")} — ?`,"aria-label":Np("helpDialog.title"),children:pa}),Wf=({appState:e,actionManager:t,showExitZenModeBtn:s,renderWelcomeScreen:n})=>{let{FooterCenterTunnel:i,WelcomeScreenHelpHintTunnel:a}=dx(),l=Jy(),r=!e.viewModeEnabled&&e.multiElement&&l.isTouchScreen;return gp.exports.jsxs("footer",{role:"contentinfo",className:"layer-ui__wrapper__footer App-menu App-menu_bottom",children:[gp.exports.jsx("div",{className:Vc("layer-ui__wrapper__footer-left zen-mode-transition",{"layer-ui__wrapper__footer-left--transition-left":e.zenModeEnabled}),children:gp.exports.jsx(hg.Col,{gap:2,children:gp.exports.jsxs(Cf,{heading:"canvasActions",children:[gp.exports.jsx(gx,{renderAction:t.renderAction,zoom:e.zoom}),!e.viewModeEnabled&&gp.exports.jsx(xx,{renderAction:t.renderAction,className:Vc("zen-mode-transition",{"layer-ui__wrapper__footer-left--transition-bottom":e.zenModeEnabled})}),r&&gp.exports.jsx(bx,{renderAction:t.renderAction,className:Vc("zen-mode-transition",{"layer-ui__wrapper__footer-left--transition-left":e.zenModeEnabled})})]})})}),gp.exports.jsx(i.Out,{}),gp.exports.jsx("div",{className:Vc("layer-ui__wrapper__footer-right zen-mode-transition",{"transition-right":e.zenModeEnabled}),children:gp.exports.jsxs("div",{style:{position:"relative"},children:[n&&gp.exports.jsx(a.Out,{}),gp.exports.jsx(Vf,{onClick:()=>t.executeAction(ru)})]})}),gp.exports.jsx(fx,{actionManager:t,showExitZenModeBtn:s})]})},Kf=Wf;Wf.displayName="Footer";var Zf=Tc.createContext({}),Xf=({children:e,className:t})=>{let s=Jy(),n=Bc(Zf),i=!(!s.editor.canFitSidebar||!n.shouldRenderDockButton);return gp.exports.jsxs("div",{className:Vc("sidebar__header",t),"data-testid":"sidebar-header",children:[e,gp.exports.jsxs("div",{className:"sidebar__header__buttons",children:[i&&gp.exports.jsx(_m,{label:Np("labels.sidebarLock"),children:gp.exports.jsx(ex,{onSelect:()=>n.onDock?.(!n.docked),selected:!!n.docked,className:"sidebar__dock","data-testid":"sidebar-dock","aria-label":Np("labels.sidebarLock"),children:oa})}),gp.exports.jsx(ex,{"data-testid":"sidebar-close",className:"sidebar__close",onSelect:n.onCloseRequest,"aria-label":Np("buttons.close"),children:H})]})]})};Xf.displayName="SidebarHeader";var qf=({name:e,tab:t,icon:s,title:n,children:i,onToggle:a,className:l,style:r})=>{let o=nv(),d=Oh();return gp.exports.jsxs("label",{title:n,className:"sidebar-trigger__label-element",children:[gp.exports.jsx("input",{className:"ToolIcon_type_checkbox",type:"checkbox",onChange:s=>{document.querySelector(".layer-ui__wrapper")?.classList.remove("animate");let n=s.target.checked;o({openSidebar:n?{name:e,tab:t}:null}),a?.(n)},checked:d.openSidebar?.name===e,"aria-label":n,"aria-keyshortcuts":"0"}),gp.exports.jsxs("div",{className:Vc("sidebar-trigger",l),style:r,children:[s&&gp.exports.jsx("div",{children:s}),i&&gp.exports.jsx("div",{className:"sidebar-trigger__label",children:i})]})]})};qf.displayName="SidebarTrigger";var Qf=({children:e,...t})=>gp.exports.jsx(op,{className:"sidebar-triggers",...t,children:e});Qf.displayName="SidebarTabTriggers";var Jf=({children:e,tab:t,onSelect:s,...n})=>gp.exports.jsx(dp,{value:t,asChild:!0,onSelect:s,children:gp.exports.jsx("button",{type:"button",className:"excalidraw-button sidebar-tab-trigger",...n,children:e})});Jf.displayName="SidebarTabTrigger";var eb=({children:e,...t})=>{let s=Oh(),n=nv();if(!s.openSidebar)return null;let{name:i}=s.openSidebar;return gp.exports.jsx(cp,{className:"sidebar-tabs-root",value:s.openSidebar.tab,onValueChange:e=>n((t=>({...t,openSidebar:{...t.openSidebar,name:i,tab:e}}))),...t,children:e})};eb.displayName="SidebarTabs";var tb=({tab:e,children:t,...s})=>gp.exports.jsx(pp,{...s,value:e,"data-testid":e,children:t});tb.displayName="SidebarTab";var sb=Gc(!1),nb=Lc((({name:e,children:t,onDock:s,docked:n,className:i,...a},l)=>{vc.DEV&&s&&null==n&&console.warn("Sidebar: `docked` must be set when `onDock` is supplied for the sidebar to be user-dockable. To hide this message, either pass `docked` or remove `onDock`");let r=nv(),o=bp(sb);Rc((()=>(o(!!n),()=>{o(!1)})),[o,n]);let d=jc({});d.current.onCloseRequest=()=>{r({openSidebar:null})},d.current.onDock=e=>s?.(e),d.current=O(d.current,{docked:n,shouldRenderDockButton:!!s&&null!=n});let c=jc(null);Pc(l,(()=>c.current));let p=Jy(),h=Ac((()=>{document.querySelector(".Dialog")||r({openSidebar:null})}),[r]);return Bh(c,Ac((e=>{e.target.closest(".sidebar-trigger")||(!n||!p.editor.canFitSidebar)&&h()}),[h,n,p.editor.canFitSidebar])),Dc((()=>{let e=e=>{e.key===j.ESCAPE&&(!n||!p.editor.canFitSidebar)&&h()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[h,n,p.editor.canFitSidebar]),gp.exports.jsx(Gh,{...a,className:Vc("sidebar",{"sidebar--docked":n},i),ref:c,children:gp.exports.jsx(Zf.Provider,{value:d.current,children:t})})}));nb.displayName="SidebarInner";var ib=Object.assign(Lc(((e,t)=>{let s=Oh(),{onStateChange:n}=e,i=jc(s.openSidebar);Dc((()=>{(!s.openSidebar&&i?.current?.name===e.name||s.openSidebar?.name===e.name&&i?.current?.name!==e.name||i.current?.name===e.name)&&s.openSidebar!==i.current&&n?.(s.openSidebar?.name!==e.name?null:s.openSidebar),i.current=s.openSidebar}),[s.openSidebar,n,e.name]);let[a,l]=Mc(!1);return Rc((()=>(l(!0),()=>l(!1))),[]),a&&s.openSidebar?.name===e.name?Oc(nb,{...e,ref:t,key:e.name}):null})),{Header:Xf,TabTriggers:Qf,TabTrigger:Jf,Tabs:eb,Tab:tb,Trigger:qf});ib.displayName="Sidebar";var ab={};Ic(ab,{ChangeCanvasBackground:()=>Eb,ClearCanvas:()=>fb,CommandPalette:()=>ub,Export:()=>yb,Help:()=>xb,LiveCollaborationTrigger:()=>wb,LoadScene:()=>cb,SaveAsImage:()=>hb,SaveToActiveFile:()=>pb,SearchMenu:()=>gb,Socials:()=>vb,ToggleTheme:()=>bb});var rb=Gc({active:!1});var ob=({value:e,shortcut:t,onChange:s,choices:n,children:i,name:a})=>{let l=Jy();return gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsxs("div",{className:"dropdown-menu-item-base dropdown-menu-item-bare",children:[gp.exports.jsx("label",{className:"dropdown-menu-item__text",htmlFor:a,children:i}),gp.exports.jsx(tf,{name:a,value:e,onChange:s,choices:n})]}),t&&!l.editor.isMobile&&gp.exports.jsx("div",{className:"dropdown-menu-item__shortcut dropdown-menu-item__shortcut--orphaned",children:t})]})};ob.displayName="DropdownMenuItemContentRadio";var db=ob,cb=()=>{let{t:e}=_p(),t=iv(),s=tv();return t.isActionEnabled(su)?gp.exports.jsx(fm,{icon:da,onSelect:async()=>{(!s.length||await async function({title:e,description:t,actionLabel:s,color:n}){return new Promise((i=>{wp.set(rb,{active:!0,onConfirm:()=>i(!0),onClose:()=>i(!1),onReject:()=>i(!1),title:e,description:t,actionLabel:s,color:n})}))}({title:e("overwriteConfirm.modal.loadFromFile.title"),actionLabel:e("overwriteConfirm.modal.loadFromFile.button"),color:"warning",description:gp.exports.jsx(Eg,{i18nKey:"overwriteConfirm.modal.loadFromFile.description",bold:e=>gp.exports.jsx("strong",{children:e}),br:()=>gp.exports.jsx("br",{})})}))&&t.executeAction(su)},"data-testid":"load-button",shortcut:nx("loadScene"),"aria-label":e("buttons.load"),children:e("buttons.load")}):null};cb.displayName="LoadScene";var pb=()=>{let{t:e}=_p(),t=iv();return t.isActionEnabled(eu)?gp.exports.jsx(fm,{shortcut:nx("saveScene"),"data-testid":"save-button",onSelect:()=>t.executeAction(eu),icon:ca,"aria-label":`${e("buttons.save")}`,children:`${e("buttons.save")}`}):null};pb.displayName="SaveToActiveFile";var hb=()=>{let e=nv(),{t:t}=_p();return gp.exports.jsx(fm,{icon:b,"data-testid":"image-export-button",onSelect:()=>e({openDialog:{name:"imageExport"}}),shortcut:nx("imageExport"),"aria-label":t("buttons.exportImage"),children:t("buttons.exportImage")})};hb.displayName="SaveAsImage";var ub=e=>{let t=nv(),{t:s}=_p();return gp.exports.jsx(fm,{icon:N,"data-testid":"command-palette-button",onSelect:()=>{dh("command_palette","open","menu"),t({openDialog:{name:"commandPalette"}})},shortcut:nx("commandPalette"),"aria-label":s("commandPalette.title"),className:e?.className,children:s("commandPalette.title")})};ub.displayName="CommandPalette";var gb=e=>{let{t:t}=_p(),n=iv();return gp.exports.jsx(fm,{icon:s,"data-testid":"search-menu-button",onSelect:()=>{n.executeAction(Bx)},shortcut:nx("searchMenu"),"aria-label":t("search.title"),className:e?.className,children:t("search.title")})};gb.displayName="SearchMenu";var xb=()=>{let{t:e}=_p(),t=iv();return gp.exports.jsx(fm,{"data-testid":"help-menu-item",icon:pa,onSelect:()=>t.executeAction(ru),shortcut:"?","aria-label":e("helpDialog.title"),children:e("helpDialog.title")})};xb.displayName="Help";var fb=()=>{let{t:e}=_p(),t=bp(yx);return iv().isActionEnabled(Pm)?gp.exports.jsx(fm,{icon:jt,onSelect:()=>t("clearCanvas"),"data-testid":"clear-canvas-button","aria-label":e("buttons.clearReset"),children:e("buttons.clearReset")}):null};fb.displayName="ClearCanvas";var bb=e=>{let{t:t}=_p(),s=Oh(),n=iv(),i=nx("toggleTheme");return n.isActionEnabled(Um)?e?.allowSystemTheme?gp.exports.jsx(db,{name:"theme",value:e.theme,onChange:t=>e.onSelect(t),choices:[{value:X.LIGHT,label:qs,ariaLabel:`${t("buttons.lightMode")} - ${i}`},{value:X.DARK,label:Xs,ariaLabel:`${t("buttons.darkMode")} - ${i}`},{value:"system",label:ha,ariaLabel:t("buttons.systemMode")}],children:t("labels.theme")}):gp.exports.jsx(fm,{onSelect:t=>{if(t.preventDefault(),!e?.onSelect)return n.executeAction(Um);e.onSelect(s.theme===X.DARK?X.LIGHT:X.DARK)},icon:s.theme===X.DARK?qs:Xs,"data-testid":"toggle-dark-mode",shortcut:i,"aria-label":s.theme===X.DARK?t("buttons.lightMode"):t("buttons.darkMode"),children:s.theme===X.DARK?t("buttons.lightMode"):t("buttons.darkMode")}):null};bb.displayName="ToggleTheme";var Eb=()=>{let{t:e}=_p(),t=Oh(),s=iv(),n=Qy();return t.viewModeEnabled||!n.UIOptions.canvasActions.changeViewBackgroundColor?null:gp.exports.jsxs("div",{style:{marginTop:"0.5rem"},children:[gp.exports.jsx("div",{"data-testid":"canvas-background-label",style:{fontSize:".75rem",marginBottom:".5rem"},children:e("labels.canvasBackground")}),gp.exports.jsx("div",{style:{padding:"0 0.625rem"},children:s.renderAction("changeViewBackgroundColor")})]})};Eb.displayName="ChangeCanvasBackground";var yb=()=>{let{t:e}=_p(),t=nv();return gp.exports.jsx(fm,{icon:hn,onSelect:()=>{t({openDialog:{name:"jsonExport"}})},"data-testid":"json-export-button","aria-label":e("buttons.export"),children:e("buttons.export")})};yb.displayName="Export";var vb=()=>{let{t:e}=_p();return gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsx(Ng,{icon:ma,href:"https://github.com/excalidraw/excalidraw","aria-label":"GitHub",children:"GitHub"}),gp.exports.jsx(Ng,{icon:ga,href:"https://x.com/excalidraw","aria-label":"X",children:e("labels.followUs")}),gp.exports.jsx(Ng,{icon:xa,href:"https://discord.gg/UexuTaE","aria-label":"Discord",children:e("labels.discordChat")})]})};vb.displayName="Socials";var wb=({onSelect:e,isCollaborating:t})=>{let{t:s}=_p();return gp.exports.jsx(fm,{"data-testid":"collab-button",icon:fa,className:Vc({"active-collab":t}),onSelect:e,children:s("labels.liveCollaboration")})};wb.displayName="LiveCollaborationTrigger";var Sb=(e,t)=>{let s=Gc(0),n=e=>{let{tunnelsJotai:{useAtom:n}}=dx(),[,i]=n(s),a=jc({preferHost:!1,counter:0});return Rc((()=>{let e=a.current;return i((t=>{let s=t+1;return e.counter=s,s})),()=>{i((t=>{let s=t-1;return e.counter=s,s||(e.preferHost=!1),s}))}}),[i]),e.__fallback||(a.current.preferHost=!0),!a.current.counter&&e.__fallback&&a.current.preferHost||a.current.counter>1&&e.__fallback?null:gp.exports.jsx(t,{...e})};return n.displayName=e,n},Cb=Object.assign(Sb("MainMenu",(({children:e,onSelect:t})=>{let{MainMenuTunnel:s}=dx(),n=Jy(),i=Oh(),a=nv(),l=n.editor.isMobile?void 0:()=>a({openMenu:null});return gp.exports.jsx(s.In,{children:gp.exports.jsxs(Pg,{open:"canvas"===i.openMenu,children:[gp.exports.jsx(Pg.Trigger,{onToggle:()=>{a({openMenu:"canvas"===i.openMenu?null:"canvas"})},"data-testid":"main-menu-trigger",className:"main-menu-trigger",children:Sn}),gp.exports.jsxs(Pg.Content,{onClickOutside:l,onSelect:Hi(t,(()=>{a({openMenu:null})})),children:[e,n.editor.isMobile&&i.collaborators.size>0&&gp.exports.jsxs("fieldset",{className:"UserList-Wrapper",children:[gp.exports.jsx("legend",{children:Np("labels.collaborators")}),gp.exports.jsx(Hf,{mobile:!0,collaborators:i.collaborators,userToFollow:i.userToFollow?.socketId||null})]})]})]})})})),{Trigger:Pg.Trigger,Item:Pg.Item,ItemLink:Pg.ItemLink,ItemCustom:Pg.ItemCustom,Group:Pg.Group,Separator:Pg.Separator,DefaultItems:ab}),Ib=Cb,kb=({title:e,children:t,actionLabel:s,onClick:n})=>gp.exports.jsxs("div",{className:"OverwriteConfirm__Actions__Action",children:[gp.exports.jsx("h4",{children:e}),gp.exports.jsx("div",{className:"OverwriteConfirm__Actions__Action__content",children:t}),gp.exports.jsx(nf,{variant:"outlined",color:"muted",label:s,size:"large",fullWidth:!0,onClick:n})]}),Tb=Object.assign((({children:e})=>gp.exports.jsx("div",{className:"OverwriteConfirm__Actions",children:e})),{ExportToImage:()=>{let{t:e}=_p(),t=iv(),s=nv();return gp.exports.jsx(kb,{title:e("overwriteConfirm.action.exportToImage.title"),actionLabel:e("overwriteConfirm.action.exportToImage.button"),onClick:()=>{t.executeAction(Jm,"ui",!0),s({openDialog:{name:"imageExport"}})},children:e("overwriteConfirm.action.exportToImage.description")})},SaveToDisk:()=>{let{t:e}=_p(),t=iv();return gp.exports.jsx(kb,{title:e("overwriteConfirm.action.saveToDisk.title"),actionLabel:e("overwriteConfirm.action.saveToDisk.button"),onClick:()=>{t.executeAction(tu,"ui")},children:e("overwriteConfirm.action.saveToDisk.description")})}}),Mb=Object.assign(Sb("OverwriteConfirmDialog",(({children:e})=>{let{OverwriteConfirmDialogTunnel:t}=dx(),[s,n]=fp(rb);if(!s.active)return null;return gp.exports.jsx(t.In,{children:gp.exports.jsx(Jg,{onCloseRequest:()=>{s.onClose(),n((e=>({...e,active:!1})))},title:!1,size:916,children:gp.exports.jsxs("div",{className:"OverwriteConfirm",children:[gp.exports.jsx("h3",{children:s.title}),gp.exports.jsxs("div",{className:`OverwriteConfirm__Description OverwriteConfirm__Description--color-${s.color}`,children:[gp.exports.jsx("div",{className:"OverwriteConfirm__Description__icon",children:Io}),gp.exports.jsx("div",{children:s.description}),gp.exports.jsx("div",{className:"OverwriteConfirm__Description__spacer"}),gp.exports.jsx(nf,{color:s.color,size:"large",label:s.actionLabel,onClick:()=>{s.onConfirm(),n((e=>({...e,active:!1})))}})]}),gp.exports.jsx(Tb,{children:e})]})})})})),{Actions:Tb,Action:kb}),jb=Gc(""),Db=Gc(null),Lb=()=>{let e=qy(),t=nv(),n=jc(null),[i,a]=fp(jb),l=i.trim(),[r,o]=Mc(!1),[d,c]=Mc({nonce:null,items:[]}),p=jc(null),h=jc(void 0),[m,u]=fp(Db),g=e.scene.getNonDeletedElementsMap();Dc((()=>{r||(l!==p.current||e.scene.getSceneNonce()!==h.current)&&(p.current=null,Rb(l,e,((s,n)=>{c({nonce:Hr(),items:s}),p.current=l,h.current=e.scene.getSceneNonce(),t({searchMatches:s.map((e=>({id:e.textElement.id,focus:!1,matchedLines:e.matchedLines})))})})))}),[r,l,g,e,t,u,h]);let x=()=>{d.items.length>0&&u((e=>null===e?0:(e+1)%d.items.length))},f=()=>{d.items.length>0&&u((e=>null===e?0:e-1<0?d.items.length-1:e-1))};Dc((()=>{t((e=>({searchMatches:e.searchMatches.map(((e,t)=>t===m?{...e,focus:!0}:{...e,focus:!1}))})))}),[m,t]),Dc((()=>{if(d.items.length>0&&null!==m){let t=d.items[m];if(t){let s=e.state.zoom.value,n=Je({text:t.searchQuery,x:t.textElement.x+(t.matchedLines[0]?.offsetX??0),y:t.textElement.y+(t.matchedLines[0]?.offsetY??0),width:t.matchedLines[0]?.width,height:t.matchedLines[0]?.height,fontSize:t.textElement.fontSize,fontFamily:t.textElement.fontFamily}),i=14,a=t.textElement.fontSize,l=a*s<i;if(!fl([n],e.canvas.width/window.devicePixelRatio,e.canvas.height/window.devicePixelRatio,{offsetLeft:e.state.offsetLeft,offsetTop:e.state.offsetTop,scrollX:e.state.scrollX,scrollY:e.state.scrollY,zoom:e.state.zoom},e.scene.getNonDeletedElementsMap(),e.getEditorUIOffsets())||l){let t;t=l?a>=i?{fitToContent:!0}:{fitToViewport:!0,maxZoom:$(i/a,1)}:{fitToContent:!0},e.scrollToContent(n,{animate:!0,duration:300,...t,canvasOffsets:e.getEditorUIOffsets()})}}}}),[m,d,e]),Dc((()=>()=>{u(null),p.current=null,h.current=void 0,t({searchMatches:[]}),o(!1)}),[t,u]);let b=zh({goToNextItem:x,goToPreviousItem:f,searchMatches:d});Dc((()=>Le(window,"keydown",(s=>{if(s.key===j.ESCAPE&&!e.state.openDialog&&!e.state.openPopup)return s.preventDefault(),s.stopPropagation(),void t({openSidebar:null});s[j.CTRL_OR_CMD]&&s.key===j.F&&(s.preventDefault(),s.stopPropagation(),n.current?.matches(":focus")?t({openSidebar:null}):(e.state.openDialog&&t({openDialog:null}),n.current?.focus(),n.current?.select())),s.target instanceof HTMLElement&&s.target.closest(".layer-ui__search")&&b.searchMatches.items.length&&(s.key===j.ENTER&&(s.stopPropagation(),b.goToNextItem()),s.key===j.ARROW_UP?(s.stopPropagation(),b.goToPreviousItem()):s.key===j.ARROW_DOWN&&(s.stopPropagation(),b.goToNextItem()))}),{capture:!0,passive:!1})),[t,b,e]);let E=`${d.items.length} ${1===d.items.length?Np("search.singleResult"):Np("search.multipleResults")}`;return gp.exports.jsxs("div",{className:"layer-ui__search",children:[gp.exports.jsx("div",{className:"layer-ui__search-header",children:gp.exports.jsx(tx,{className:qi.SEARCH_MENU_INPUT_WRAPPER,value:i,ref:n,placeholder:Np("search.placeholder"),icon:s,onChange:s=>{a(s),o(!0);let n=s.trim();Rb(n,e,((s,i)=>{c({nonce:Hr(),items:s}),u(i),p.current=n,h.current=e.scene.getSceneNonce(),t({searchMatches:s.map((e=>({id:e.textElement.id,focus:!1,matchedLines:e.matchedLines})))}),o(!1)}))},selectOnRender:!0})}),gp.exports.jsxs("div",{className:"layer-ui__search-count",children:[d.items.length>0&&gp.exports.jsxs(gp.exports.Fragment,{children:[null!==m&&m>-1?gp.exports.jsxs("div",{children:[m+1," / ",E]}):gp.exports.jsx("div",{children:E}),gp.exports.jsxs("div",{className:"result-nav",children:[gp.exports.jsx(ex,{onSelect:()=>{x()},className:"result-nav-btn",children:zr}),gp.exports.jsx(ex,{onSelect:()=>{f()},className:"result-nav-btn",children:fd})]})]}),0===d.items.length&&l&&p.current&&gp.exports.jsx("div",{style:{margin:"1rem auto"},children:Np("search.noMatch")})]}),gp.exports.jsx(Ab,{matches:d,onItemClick:u,focusIndex:m,searchQuery:l})]})},Nb=e=>{let t=[e.preview.moreBefore?"...":"",e.preview.previewText.slice(0,e.preview.indexInSearchQuery),e.preview.previewText.slice(e.preview.indexInSearchQuery,e.preview.indexInSearchQuery+e.searchQuery.length),e.preview.previewText.slice(e.preview.indexInSearchQuery+e.searchQuery.length),e.preview.moreAfter?"...":""];return gp.exports.jsx("div",{tabIndex:-1,className:Vc("layer-ui__result-item",{active:e.highlighted}),onClick:e.onClick,ref:t=>{e.highlighted&&t?.scrollIntoView({behavior:"auto",block:"nearest"})},children:gp.exports.jsx("div",{className:"preview-text",children:t.flatMap(((e,t)=>gp.exports.jsx(Uc,{children:2===t?gp.exports.jsx("b",{children:e}):e},t)))})})},Ab=_c((e=>gp.exports.jsx("div",{className:"layer-ui__search-result-container",children:e.matches.items.map(((t,s)=>gp.exports.jsx(Nb,{searchQuery:e.searchQuery,preview:t.preview,highlighted:s===e.focusIndex,onClick:()=>e.onItemClick(s)},t.textElement.id+t.index)))})),((e,t)=>e.matches.nonce===t.matches.nonce&&e.focusIndex===t.focusIndex)),_b=(e,t,s)=>{let n=e.slice(0,t),i=n.split(/\s+/),a=n.endsWith(" "),l=i.length-2-1-(a?0:1),r=i.slice(l<=0?0:l).join(" ")+(a?" ":"");r=r.length>20?r.slice(-20):r;let o=e.slice(t+s.length),d=o.split(/\s+/),c=!o.startsWith(" "),p=c?6:5,h=(c?"":" ")+d.slice(0,p).join(" ");return{indexInSearchQuery:r.length,previewText:r+s+h,moreBefore:l>0,moreAfter:d.length>p}},Pb=(e,t,s)=>{let n=((e,t)=>{let s=e.split("\n"),n=[],i=0;for(let e=0;e<s.length;e++){let a=s[e],l=s[e+1];if(l){let e=t.indexOf(l,i);if(e>a.length+i){let t=e-(a.length+i);for(;t>0;)a+=" ",t--}}n.push(a),i+=a.length}return n.join("\n")})(e.text,e.originalText).split("\n"),i=[],a=0,l=0;for(let e of n){let t=a,s=t+e.length-1;i.push({line:e,startIndex:t,endIndex:s,lineNumber:l}),a=s+1,l++}let r=s,o=e.originalText.slice(s,s+t.length),d=[];for(let t of i){if(""===o)break;if(r>=t.startIndex&&r<=t.endIndex){let s=t.endIndex+1-r,n=t.line.slice(0,r-t.startIndex),i=o.slice(0,s);o=o.slice(s);let a=qe(n,We(e),e.lineHeight);if(""===n&&(a.width=0),"left"!==e.textAlign&&t.line.length>0){let s=qe(t.line,We(e),e.lineHeight),n="center"===e.textAlign?(e.width-s.width)/2:e.width-s.width;a.width+=n}let{width:l,height:c}=qe(i,We(e),e.lineHeight),p=a.width,h=t.lineNumber*a.height;d.push({offsetX:p,offsetY:h,width:l,height:c}),r+=s}}return d},Rb=hp(((e,t,s)=>{if(!e||""===e)return void s([],null);let n=t.scene.getNonDeletedElements().filter((e=>tt(e)));n.sort(((e,t)=>e.y-t.y));let i=[],a=new RegExp((e=>e.replace(/[.*+?^${}()|[\]\\-]/g,"\\$&"))(e),"gi");for(let t of n){let s=null,n=t.originalText;for(;null!==(s=a.exec(n));){let a=_b(n,s.index,e),l=Pb(t,e,s.index);l.length>0&&i.push({textElement:t,searchQuery:e,preview:a,index:s.index,matchedLines:l})}}let l=new Set(t.visibleElements.map((e=>e.id))),r=i.findIndex((e=>l.has(e.textElement.id)))??null;s(i,r)}),350),Ob=Sb("DefaultSidebarTrigger",(e=>{let{DefaultSidebarTriggerTunnel:t}=dx();return gp.exports.jsx(t.In,{children:gp.exports.jsx(ib.Trigger,{...e,className:"default-sidebar-trigger",name:v.name})})}));Ob.displayName="DefaultSidebarTrigger";var Fb=({children:e})=>{let{DefaultSidebarTabTriggersTunnel:t}=dx();return gp.exports.jsx(t.In,{children:e})};Fb.displayName="DefaultTabTriggers";var Bb=Object.assign(Sb("DefaultSidebar",(({children:e,className:t,onDock:n,docked:i,...a})=>{let l=Oh(),r=nv(),{DefaultSidebarTabTriggersTunnel:o}=dx(),d=l.openSidebar?.tab===Xi;return Oc(ib,{...a,name:"default",key:"default",className:Vc("default-sidebar",t),docked:d||(i??l.defaultSidebarDockedPreference),onDock:d||!1===n||!n&&null!=i?void 0:Hi(n,(e=>{r({defaultSidebarDockedPreference:e})}))},gp.exports.jsxs(ib.Tabs,{children:[gp.exports.jsx(ib.Header,{children:gp.exports.jsxs(ib.TabTriggers,{children:[gp.exports.jsx(ib.TabTrigger,{tab:Xi,children:s}),gp.exports.jsx(ib.TabTrigger,{tab:yo,children:E}),gp.exports.jsx(o.Out,{})]})}),gp.exports.jsx(ib.Tab,{tab:yo,children:gp.exports.jsx(qg,{})}),gp.exports.jsx(ib.Tab,{tab:Xi,children:gp.exports.jsx(Lb,{})}),e]}))})),{Trigger:Ob,TabTriggers:Fb}),zb=e=>gp.exports.jsxs("label",{className:Vc("ToolIcon ToolIcon__LaserPointer","ToolIcon_size_small",{"is-mobile":e.isMobile}),title:`${e.title}`,children:[gp.exports.jsx("input",{className:"ToolIcon_type_checkbox",type:"checkbox",name:e.name,onChange:e.onChange,checked:e.checked,"aria-label":e.title,"data-testid":"toolbar-LaserPointer"}),gp.exports.jsx("div",{className:"ToolIcon__icon",children:ad})]}),Ub=async({canvasRef:e,mermaidToExcalidrawLib:t,mermaidDefinition:s,setError:n,data:i})=>{let a=e.current,l=a?.parentElement;if(a&&l){if(!s)return void(({canvasRef:e,setError:t})=>{let s=e.current;if(!s)return;let n=s.parentElement;n&&(n.style.background="",t(null),s.replaceChildren())})({canvasRef:e,setError:n});try{let e,r=await t.api;try{e=await r.parseMermaidToExcalidraw(s)}catch{e=await r.parseMermaidToExcalidraw(s.replace(/"/g,"'"))}let{elements:o,files:d}=e;n(null),i.current={elements:iy(o,{regenerateIds:!0}),files:d};let c=await Xd({elements:i.current.elements,files:i.current.files,exportPadding:ho,maxWidthOrHeight:Math.max(l.offsetWidth,l.offsetHeight)*window.devicePixelRatio});try{await oo(c)}catch(e){throw"CANVAS_POSSIBLY_TOO_BIG"===e.name?new Error(Np("canvasError.canvasTooBig")):e}l.style.background="var(--default-bg-color)",a.replaceChildren(c)}catch(e){throw l.style.background="var(--default-bg-color)",s&&n(e),e}}},Hb=e=>{wg.set(bd.MERMAID_TO_EXCALIDRAW,e)},Yb=({app:e,data:t,text:s,shouldSaveMermaidDataToStorage:n})=>{let{elements:i,files:a}=t.current;i.length&&(e.addElementsFromPasteOrLibrary({elements:i,files:a,position:"center",fitToContent:!0}),e.setOpenDialog(null),n&&s&&Hb(s))},Gb=({children:e})=>gp.exports.jsx("div",{className:"ttd-dialog-panels",children:e}),$b=({label:e,children:t,panelAction:s,panelActionDisabled:n=!1,onTextSubmitInProgess:i,renderTopRight:a,renderSubmitShortcut:l,renderBottomRight:r})=>gp.exports.jsxs("div",{className:"ttd-dialog-panel",children:[gp.exports.jsxs("div",{className:"ttd-dialog-panel__header",children:[gp.exports.jsx("label",{children:e}),a?.()]}),t,gp.exports.jsxs("div",{className:Vc("ttd-dialog-panel-button-container",{invisible:!s}),style:{display:"flex",alignItems:"center"},children:[gp.exports.jsxs(ex,{className:"ttd-dialog-panel-button",onSelect:s?s.action:()=>{},disabled:n||i,children:[gp.exports.jsxs("div",{className:Vc({invisible:i}),children:[s?.label,s?.icon&&gp.exports.jsx("span",{children:s.icon})]}),i&&gp.exports.jsx(Pp,{})]}),!n&&!i&&l?.(),r?.()]})]}),Vb=({input:e,placeholder:t,onChange:s,onKeyboardSubmit:n})=>{let i=jc(null),a=jc(n);return a.current=n,Dc((()=>{if(!a.current)return;let e=i.current;if(e){let t=e=>{e[j.CTRL_OR_CMD]&&e.key===j.ENTER&&(e.preventDefault(),a.current?.())};return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}}),[]),gp.exports.jsx("textarea",{className:"ttd-dialog-input",onChange:s,value:e,placeholder:t,autoFocus:!0,ref:i})},Wb=({error:e})=>gp.exports.jsxs("div",{"data-testid":"ttd-dialog-output-error",className:"ttd-dialog-output-error",children:["Error! ",gp.exports.jsx("p",{children:e})]}),Kb=({error:e,canvasRef:t,loaded:s})=>gp.exports.jsxs("div",{className:"ttd-dialog-output-wrapper",children:[e&&gp.exports.jsx(Wb,{error:e.message}),s?gp.exports.jsx("div",{ref:t,style:{opacity:e?"0.15":1},className:"ttd-dialog-output-canvas-container"}):gp.exports.jsx(Pp,{size:"2rem"})]}),Zb=()=>gp.exports.jsxs("div",{className:"ttd-dialog-submit-shortcut",children:[gp.exports.jsx("div",{className:"ttd-dialog-submit-shortcut__key",children:x("CtrlOrCmd")}),gp.exports.jsx("div",{className:"ttd-dialog-submit-shortcut__key",children:x("Enter")})]}),Xb=l(Hb,300),qb=({mermaidToExcalidrawLib:e})=>{let[t,s]=Mc((()=>wg.get(bd.MERMAID_TO_EXCALIDRAW)||"flowchart TD\n A[Christmas] --\x3e|Get money| B(Go shopping)\n B --\x3e C{Let me think}\n C --\x3e|One| D[Laptop]\n C --\x3e|Two| E[iPhone]\n C --\x3e|Three| F[Car]")),n=Hc(t.trim()),[i,a]=Mc(null),l=jc(null),r=jc({elements:[],files:null}),o=qy();Dc((()=>{Ub({canvasRef:l,data:r,mermaidToExcalidrawLib:e,setError:a,mermaidDefinition:n}).catch((e=>{_o()&&console.error("Failed to parse mermaid definition",e)})),Xb(n)}),[n,e]),Dc((()=>()=>{Xb.flush()}),[]);let d=()=>{Yb({app:o,data:r,text:t,shouldSaveMermaidDataToStorage:!0})};return gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsx("div",{className:"ttd-dialog-desc",children:gp.exports.jsx(Eg,{i18nKey:"mermaid.description",flowchartLink:e=>gp.exports.jsx("a",{href:"https://mermaid.js.org/syntax/flowchart.html",children:e}),sequenceLink:e=>gp.exports.jsx("a",{href:"https://mermaid.js.org/syntax/sequenceDiagram.html",children:e}),classLink:e=>gp.exports.jsx("a",{href:"https://mermaid.js.org/syntax/classDiagram.html",children:e})})}),gp.exports.jsxs(Gb,{children:[gp.exports.jsx($b,{label:Np("mermaid.syntax"),children:gp.exports.jsx(Vb,{input:t,placeholder:"Write Mermaid diagram defintion here...",onChange:e=>s(e.target.value),onKeyboardSubmit:()=>{d()}})}),gp.exports.jsx($b,{label:Np("mermaid.preview"),panelAction:{action:()=>{d()},label:Np("mermaid.button"),icon:ko},renderSubmitShortcut:()=>gp.exports.jsx(Zb,{}),children:gp.exports.jsx(Kb,{canvasRef:l,loaded:e.loaded,error:i})})]})]})},Qb=e=>{let t=nv(),s=jc(null),n=jc(0);return gp.exports.jsx(cp,{ref:s,className:"ttd-dialog-tabs-root",value:e.tab,onValueChange:i=>{if(!i)return;let a=s.current?.closest(".Modal__content");if(a){let e=a.offsetHeight||0;e>n.current&&(n.current=e,a.style.minHeight=`min(${n.current}px, 100%)`)}"ttd"===e.dialog&&nc(["text-to-diagram","mermaid"],i)&&t({openDialog:{name:e.dialog,tab:i}})},children:e.children})};Qb.displayName="TTDDialogTabs";var Jb=Qb,eE=({children:e,...t})=>gp.exports.jsx(op,{className:"ttd-dialog-triggers",...t,children:e});eE.displayName="TTDDialogTabTriggers";var tE=({children:e,tab:t,onSelect:s,...n})=>gp.exports.jsx(dp,{value:t,asChild:!0,onSelect:s,children:gp.exports.jsx("button",{type:"button",className:"ttd-dialog-tab-trigger",...n,children:e})});tE.displayName="TTDDialogTabTrigger";var sE=({tab:e,children:t,...s})=>gp.exports.jsx(pp,{...s,value:e,children:t});sE.displayName="TTDDialogTab";var nE=1e3,iE=Gc(null),aE=Gc(null),lE=e=>{let t=Oh();return"ttd"!==t.openDialog?.name?null:gp.exports.jsx(rE,{...e,tab:t.openDialog.tab})},rE=Sb("TTDDialogBase",(({tab:e,...t})=>{let s=qy(),n=nv(),i=jc(null),[a,l]=fp(aE),[r,o]=Mc(a?.prompt??""),d=r.trim(),[c,p]=Mc(!1),[h,m]=fp(iE),u=async()=>{if(d.length>nE||d.length<3||c||0===h?.rateLimitRemaining||"__fallback"in t)return d.length<3&&y(new Error("Prompt is too short (min 3 characters)")),void(d.length>nE&&y(new Error("Prompt is too long (max 1000 characters)")));try{p(!0),dh("ai","generate","ttd");let{generatedResponse:e,error:s,rateLimit:n,rateLimitRemaining:a}=await t.onTextSubmit(d);if("string"==typeof e&&l((t=>({generatedResponse:e,prompt:t?.prompt??null}))),Ed(n)&&Ed(a)&&m({rateLimit:n,rateLimitRemaining:a}),s)return void y(s);if(!e)return void y(new Error("Generation failed"));try{await Ub({canvasRef:i,data:b,mermaidToExcalidrawLib:x,setError:y,mermaidDefinition:e}),dh("ai","mermaid parse success","ttd")}catch(e){console.info(`%cTTD mermaid render errror: ${e.message}`,"color: red"),console.info(`>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\nTTD mermaid definition render errror: ${e.message}`,"color: yellow"),dh("ai","mermaid parse failed","ttd"),y(new Error("Generated an invalid diagram :(. You may also try a different prompt."))}}catch(e){let t=e.message;(!t||"Failed to fetch"===t)&&(t="Request failed"),y(new Error(t))}finally{p(!1)}},g=jc(u);g.current=u;let[x,f]=Mc({loaded:!1,api:import("../../../mermaid-to-excalidraw/dist/index.js")});Dc((()=>{(async()=>{await x.api,f((e=>({...e,loaded:!0})))})()}),[x.api]);let b=jc({elements:[],files:null}),[E,y]=Mc(null);return gp.exports.jsx(Jg,{className:"ttd-dialog",onCloseRequest:()=>{s.setOpenDialog(null)},size:1200,title:!1,...t,autofocus:!1,children:gp.exports.jsxs(Jb,{dialog:"ttd",tab:e,children:["__fallback"in t&&t.__fallback?gp.exports.jsx("p",{className:"dialog-mermaid-title",children:Np("mermaid.title")}):gp.exports.jsxs(eE,{children:[gp.exports.jsx(tE,{tab:"text-to-diagram",children:gp.exports.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[Np("labels.textToDiagram"),gp.exports.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1px 6px",marginLeft:"10px",fontSize:10,borderRadius:"12px",background:"var(--color-promo)",color:"var(--color-surface-lowest)"},children:"AI Beta"})]})}),gp.exports.jsx(tE,{tab:"mermaid",children:"Mermaid"})]}),gp.exports.jsx(sE,{className:"ttd-dialog-content",tab:"mermaid",children:gp.exports.jsx(qb,{mermaidToExcalidrawLib:x})}),!("__fallback"in t)&&gp.exports.jsxs(sE,{className:"ttd-dialog-content",tab:"text-to-diagram",children:[gp.exports.jsx("div",{className:"ttd-dialog-desc",children:"Currently we use Mermaid as a middle step, so you'll get best results if you describe a diagram, workflow, flow chart, and similar."}),gp.exports.jsxs(Gb,{children:[gp.exports.jsx($b,{label:Np("labels.prompt"),panelAction:{action:u,label:"Generate",icon:ko},onTextSubmitInProgess:c,panelActionDisabled:d.length>nE||0===h?.rateLimitRemaining,renderTopRight:()=>h?gp.exports.jsxs("div",{className:"ttd-dialog-rate-limit",style:{fontSize:12,marginLeft:"auto",color:0===h.rateLimitRemaining?"var(--color-danger)":void 0},children:[h.rateLimitRemaining," requests left today"]}):null,renderSubmitShortcut:()=>gp.exports.jsx(Zb,{}),renderBottomRight:()=>{if("string"==typeof a?.generatedResponse)return gp.exports.jsxs("div",{className:"excalidraw-link",style:{marginLeft:"auto",fontSize:14},onClick:()=>{"string"==typeof a?.generatedResponse&&(Hb(a.generatedResponse),n({openDialog:{name:"ttd",tab:"mermaid"}}))},children:["View as Mermaid",gp.exports.jsx(Qh,{icon:ko})]});let e=d.length/nE;return e>.8?gp.exports.jsxs("div",{style:{marginLeft:"auto",fontSize:12,fontFamily:"monospace",color:e>1?"var(--color-danger)":void 0},children:["Length: ",d.length,"/",nE]}):null},children:gp.exports.jsx(Vb,{onChange:e=>{o(e.target.value),l((t=>({generatedResponse:t?.generatedResponse??null,prompt:e.target.value})))},input:r,placeholder:"Describe what you want to see...",onKeyboardSubmit:()=>{g.current()}})}),gp.exports.jsx($b,{label:"Preview",panelAction:{action:()=>{console.info("Panel action clicked"),Yb({app:s,data:b})},label:"Insert",icon:ko},children:gp.exports.jsx(Kb,{canvasRef:i,error:E,loaded:x.loaded})})]})]})]})})})),oE=(e,t)=>!("height"===t&&tt(e)||"width"===t&&tt(e)||"angle"===t&&it(e)),dE=(e,t)=>{let s=e+t/2;return s-s%t},cE=(e,t,s)=>Object.keys(e).map((e=>({original:(s??t).get(e),latest:t.get(e)}))).filter((e=>void 0!==e.original&&void 0!==e.latest)),pE=(e,t,s,n,i,a,l,r=!0)=>{let o=n.get(s.id);if(!o)return;let[d,c]=[s.x+s.width/2,s.y+s.height/2],[p,h]=jo(an(s.x,s.y),an(d,c),s.angle),m=e-p,u=t-h,[g,x]=jo(an(e,t),an(d+m,c+u),-s.angle);He(o,{x:g,y:x},r),mE(o,n,i,a);let f=Kt(s,l);if(f){let e=n.get(f.id);e&&He(e,{x:f.x+m,y:f.y+u},r)}},hE=(e,t)=>{let s=jn(t).map((t=>Gt(e,t).reduce(((e,t)=>(e[t.id]=!0,e)),{})));return e.filter((e=>!ba(e))).forEach((e=>{s.push({[e.id]:!0})})),s},mE=(e,t,s,n,i)=>{zt(e)?si([e],t,s,n,!0,[],i?.zoom):yl(e,t,i)},uE=({label:e,icon:t,dragInputCallback:s,value:n,elements:i,editable:a=!0,shouldKeepAspectRatio:l,property:r,scene:o,appState:d,sensitivity:c=1})=>{let p=qy(),h=jc(null),m=jc(null),[u,g]=Mc(n.toString()),x=jc(null);x.current||(x.current={originalAppState:io(d),originalElements:i,lastUpdatedValue:u,updatePending:!1}),Dc((()=>{let e=n.toString();g(e),x.current.lastUpdatedValue=e}),[n]);let f=(e,t,i)=>{if(!x.current.updatePending)return!1;x.current.updatePending=!1;let a=Number(e);if(isNaN(a))return void g(n.toString());let d=Number(a.toFixed(2)),c=Number(n);(isNaN(c)||Math.abs(d-c)>=.01)&&(x.current.lastUpdatedValue=e,s({accumulatedChange:0,instantChange:0,originalElements:t,originalElementsMap:p.scene.getNonDeletedElementsMap(),shouldKeepAspectRatio:l,shouldChangeByStepSize:!1,scene:o,nextValue:d,property:r,originalAppState:i,setInputValue:e=>g(String(e))}),p.syncActionResult({captureUpdate:Lt.IMMEDIATELY}))},b=jc({});return b.current.handleInputValue=f,Dc((()=>{let e=h.current,t=b.current;return()=>{let s=e?.value;s&&t.handleInputValue?.(s,x.current.originalElements,x.current.originalAppState),window.removeEventListener("pointermove",t.onPointerMove,!1),window.removeEventListener("pointerup",t.onPointerUp,!1)}}),[a]),a?gp.exports.jsxs("div",{className:Vc("drag-input-container",!a&&"disabled"),"data-testid":e,children:[gp.exports.jsx("div",{className:"drag-input-label",ref:m,onPointerDown:e=>{if(h.current&&a){document.body.classList.add("excalidraw-cursor-resize"),Number(h.current.value);let e=null,t=p.scene.getNonDeletedElements().reduce(((e,t)=>(e.set(t.id,bt(t)),e)),new Map),n=i.map((e=>t.get(e.id))),a=io(d),m=0,u=0,x=i=>{if(e&&null!==t&&null!==n){let d=i.clientX-e.x;0!==d&&(u+=d,Math.abs(u)>=c&&(u=Math.sign(u)*Math.floor(Math.abs(u)/c),m+=u,s({accumulatedChange:m,instantChange:u,originalElements:n,originalElementsMap:t,shouldKeepAspectRatio:l,shouldChangeByStepSize:i.shiftKey,property:r,scene:o,originalAppState:a,setInputValue:e=>g(String(e))}),u=0))}e={x:i.clientX,y:i.clientY}},f=()=>{window.removeEventListener("pointermove",x,!1),p.syncActionResult({captureUpdate:Lt.IMMEDIATELY}),e=null,m=0,u=0,n=null,t=null,document.body.classList.remove("excalidraw-cursor-resize"),window.removeEventListener("pointerup",f,!1)};b.current.onPointerMove=x,b.current.onPointerUp=f,window.addEventListener("pointermove",x,!1),window.addEventListener("pointerup",f,!1)}},onPointerEnter:()=>{m.current&&(m.current.style.cursor="ew-resize")},children:t?gp.exports.jsx(Qh,{icon:t}):e}),gp.exports.jsx("input",{className:"drag-input",autoComplete:"off",spellCheck:"false",onKeyDown:e=>{if(a){let t=e.target;t instanceof HTMLInputElement&&e.key===j.ENTER&&(f(t.value,i,d),p.focusContainer())}},ref:h,value:u,onChange:e=>{x.current.updatePending=!0,g(e.target.value)},onFocus:e=>{e.target.select(),x.current.originalElements=i,x.current.originalAppState=io(d)},onBlur:e=>{u?a&&f(e.target.value,x.current.originalElements,x.current.originalAppState):g(n.toString())},disabled:!a})]}):null},gE=({accumulatedChange:e,originalElements:t,originalElementsMap:s,shouldKeepAspectRatio:n,shouldChangeByStepSize:i,nextValue:a,property:l,originalAppState:r,instantChange:o,scene:d})=>{let c=d.getNonDeletedElementsMap(),p=t[0],h=c.get(p.id);if(p&&h){let t=n||(e=>"image"===e.type)(p),d=p.width/p.height;if(r.croppingElementId===p.id){let e=c.get(p.id);if(!e||!B(e)||!e.crop)return;let t=e.crop,s={...t},n=-1===e.scale[0],i=-1===e.scale[1],{width:r,height:d}=z(e),h=t.naturalWidth/r,m=t.naturalHeight/d,u=n?t.width+t.x:t.naturalWidth-t.x,g=i?t.height+t.y:t.naturalHeight-t.y,x=ic*h,f=ic*m;if(void 0!==a){if("width"===l){let e=$o(a*h,x,u);s={...s,width:e,x:n?t.x+t.width-e:t.x}}else if("height"===l){let e=$o(a*m,f,g);s={...s,height:e,y:i?t.y+t.height-e:t.y}}return void He(e,{crop:s,width:s.width/(t.naturalWidth/r),height:s.height/(t.naturalHeight/d)})}let b="width"===l?o:0,E="height"===l?o:0,y=$o(t.width+b,x,u),v=$o(t.height+E,x,g);return s={...t,x:n?t.x+t.width-y:t.x,y:i?t.y+t.height-v:t.y,width:y,height:v},void He(e,{crop:s,width:s.width/(t.naturalWidth/r),height:s.height/(t.naturalHeight/d)})}if(void 0!==a){let e=Math.max("width"===l?a:t?a*d:p.width,yd),n=Math.max("height"===l?a:t?a/d:p.height,yd);return void vd(e,n,h,p,c,s,"width"===l?"e":"s",{shouldMaintainAspectRatio:t})}let m="width"===l?e:0,u="height"===l?e:0,g=Math.max(0,p.width+m);"width"===l&&(g=i?dE(g,10):Math.round(g));let x=Math.max(0,p.height+u);"height"===l&&(x=i?dE(x,10):Math.round(x)),t&&("width"===l?x=Math.round(g/d*100)/100:g=Math.round(x*d*100)/100),x=Math.max(yd,x),g=Math.max(yd,g),vd(g,x,h,p,c,s,"width"===l?"e":"s",{shouldMaintainAspectRatio:t})}},xE=({property:e,element:t,scene:s,appState:n})=>{let i=$("width"===e?t.width:t.height,2);if(n.croppingElementId&&n.croppingElementId===t.id&&B(t)&&t.crop){let{width:s,height:n}=z(t);if("width"===e){let e=s/t.crop.naturalWidth;i=$(t.crop.width*e,2)}if("height"===e){let e=n/t.crop.naturalHeight;i=$(t.crop.height*e,2)}}return gp.exports.jsx(uE,{label:"width"===e?"W":"H",elements:[t],dragInputCallback:gE,value:i,editable:oE(t,e),scene:s,appState:n,property:e})},fE=({accumulatedChange:e,originalElements:t,shouldChangeByStepSize:s,nextValue:n,scene:i})=>{let a=i.getNonDeletedElementsMap(),l=i.getNonDeletedElements(),r=t[0];if(r&&!V(r)){let t=a.get(r.id);if(!t)return;if(void 0!==n){let e=ac(n);He(t,{angle:e}),mE(t,a,l,i);let s=Kt(t,a);return void(s&&!ut(t)&&He(s,{angle:e}))}let o=(Math.round(100*Mo(r.angle))/100+Math.round(e))%360;s&&(o=dE(o,15)),o=o<0?o+360:o;let d=ac(o);He(t,{angle:d}),mE(t,a,l,i);let c=Kt(t,a);c&&!ut(t)&&He(c,{angle:d})}},bE=({element:e,scene:t,appState:s,property:n})=>gp.exports.jsx(uE,{label:"A",icon:To,value:Math.round(Mo(e.angle)%360*100)/100,elements:[e],dragInputCallback:fE,editable:oE(e,"angle"),scene:t,appState:s,property:n}),EE=({accumulatedChange:e,originalElements:t,shouldChangeByStepSize:s,nextValue:n,scene:i})=>{let a=i.getNonDeletedElementsMap(),l=t[0];if(l){let t,r=a.get(l.id);if(!r||!tt(r))return;if(void 0!==n)t=Math.max(Math.round(n),4);else if("text"===l.type){let n=Math.round(l.fontSize),i=Math.round(e);t=Math.max(n+i,4),s&&(t=dE(t,4))}t&&(He(r,{fontSize:t}),Is(r,i.getContainerElement(r),i.getNonDeletedElementsMap()))}},yE=({element:e,scene:t,appState:s,property:n})=>{let i=tt(e)?e:Wt(e)?Kt(e,t.getNonDeletedElementsMap()):null;return i?gp.exports.jsx(uE,{label:"F",value:Math.round(10*i.fontSize)/10,elements:[i],dragInputCallback:EE,icon:Cs,appState:s,scene:t,property:n}):null},vE=10,wE=(e,t,s,n,i,a,l,r)=>{let o=((e,t,s,n)=>{let i=n.x-e,a=n.y-t,l=n.width*s,r=n.height*s;return{width:l,height:r,x:e+i*s,y:t+a*s,...uc(n,l,r,!1),...tt(n)?{fontSize:n.fontSize*s}:{}}})(e,t,n,a);He(i,o,!1);let d=Kt(a,r);if(d){let e=d.fontSize*n;yl(i,l,{newSize:{width:o.width,height:o.height}});let t=l.get(d.id);t&&tt(t)&&(He(t,{fontSize:e},!1),hc(i,l,"width"===s?"e":"s",!0))}},SE=(e,t,s,n,i,a,l,r,o,d)=>{"width"===a?t=Math.round(e/n*100)/100:e=Math.round(t*n*100)/100;let c=t/s;for(let e=0;e<r.length;e++){let t=r[e],s=l[e];wE(i[0],i[1],a,c,s,t,o,d)}},CE=({accumulatedChange:e,originalElements:t,originalElementsMap:s,originalAppState:n,shouldChangeByStepSize:i,nextValue:a,scene:l,property:r})=>{let o=l.getNonDeletedElementsMap(),d=hE(t,n);if(void 0!==a){for(let e of d){let t=cE(e,o,s);if(t.length>1){let e=t.map((e=>e.latest)),n=t.map((e=>e.original)),[i,l,d,c]=xt(n),p=d-i,h=c-l,m=p/h,u=Math.max(yd,"width"===r?Math.max(0,a):p),g=Math.max(yd,"height"===r?Math.max(0,a):h);SE(u,g,h,m,an(i,l),r,e,n,o,s)}else{let[e]=t,n=e?.latest,l=e?.original;if(n&&l&&oE(n,r)){let e="width"===r?Math.max(0,a):n.width;"width"===r&&(e=i?dE(e,vE):Math.round(e));let t="height"===r?Math.max(0,a):n.height;"height"===r&&(t=i?dE(t,vE):Math.round(t)),e=Math.max(yd,e),t=Math.max(yd,t),vd(e,t,n,l,o,s,"width"===r?"e":"s",{shouldInformMutation:!1})}}}return void l.triggerUpdate()}let c="width"===r?e:0,p="height"===r?e:0;for(let e of d){let t=cE(e,o,s);if(t.length>1){let e=t.map((e=>e.latest)),n=t.map((e=>e.original)),[a,l,d,h]=xt(n),m=d-a,u=h-l,g=m/u,x=Math.max(0,m+c);"width"===r&&(x=i?dE(x,vE):Math.round(x));let f=Math.max(0,u+p);"height"===r&&(f=i?dE(f,vE):Math.round(f)),x=Math.max(yd,x),f=Math.max(yd,f),SE(x,f,u,g,an(a,l),r,e,n,o,s)}else{let[e]=t,n=e?.latest,a=e?.original;if(n&&a&&oE(n,r)){let e=Math.max(0,a.width+c);"width"===r&&(e=i?dE(e,vE):Math.round(e));let t=Math.max(0,a.height+p);"height"===r&&(t=i?dE(t,vE):Math.round(t)),e=Math.max(yd,e),t=Math.max(yd,t),vd(e,t,n,a,o,s,"width"===r?"e":"s",{shouldInformMutation:!1})}}}l.triggerUpdate()},IE=({property:e,elements:t,elementsMap:s,atomicUnits:n,scene:i,appState:a})=>{let l=Nc((()=>n.map((t=>{let n=cE(t,s);if(n.length>1){let[t,s,i,a]=xt(n.map((e=>e.latest)));return Math.round(100*("width"===e?i-t:a-s))/100}let[i]=n;return Math.round(100*("width"===e?i.latest.width:i.latest.height))/100}))),[s,n,e]),r=1===new Set(l).size?Math.round(100*l[0])/100:"Mixed",o=l.length>0;return gp.exports.jsx(uE,{label:"width"===e?"W":"H",elements:t,dragInputCallback:CE,value:r,editable:o,appState:a,property:e,scene:i})},kE=({accumulatedChange:e,originalElements:t,shouldChangeByStepSize:s,nextValue:n,property:i,scene:a})=>{let l=a.getNonDeletedElementsMap(),r=t.map((e=>l.get(e.id))).filter((e=>e&&!ba(e)&&oE(e,i))),o=t.filter((e=>!ba(e)&&oE(e,i)));if(void 0===n){for(let t=0;t<r.length;t++){let n=r[t];if(!n)continue;let i=o[t],a=(Math.round(100*Mo(i.angle))/100+Math.round(e))%360;s&&(a=dE(a,15)),a=a<0?a+360:a;let d=ac(a);He(n,{angle:d},!1);let c=Kt(n,l);c&&!ut(n)&&He(c,{angle:d},!1)}a.triggerUpdate()}else{let e=ac(n);for(let t of r){if(!t)continue;He(t,{angle:e},!1);let s=Kt(t,l);s&&!ut(t)&&He(s,{angle:e},!1)}a.triggerUpdate()}},TE=({elements:e,scene:t,appState:s,property:n})=>{let i=e.filter((e=>!ba(e)&&oE(e,"angle"))),a=i.map((e=>Math.round(Mo(e.angle)%360*100)/100)),l=1===new Set(a).size?a[0]:"Mixed",r=i.some((e=>oE(e,"angle")));return gp.exports.jsx(uE,{label:"A",icon:To,value:l,elements:e,dragInputCallback:kE,editable:r,appState:s,scene:t,property:n})},ME=({accumulatedChange:e,originalElements:t,shouldChangeByStepSize:s,nextValue:n,scene:i})=>{let a,l=i.getNonDeletedElementsMap(),r=t.map((e=>l.get(e.id)));if(n){a=Math.max(Math.round(n),4);for(let e of r)He(e,{fontSize:a},!1),Is(e,i.getContainerElement(e),l,!1);i.triggerUpdate()}else{let n=t;for(let t=0;t<r.length;t++){let a=r[t],o=n[t],d=Math.round(o.fontSize),c=Math.round(e),p=Math.max(d+c,4);s&&(p=dE(p,4)),He(a,{fontSize:p},!1),Is(a,i.getContainerElement(a),l,!1)}i.triggerUpdate()}},jE=({elements:e,scene:t,appState:s,property:n,elementsMap:i})=>{let a=((e,t)=>e.reduce(((e,s)=>{if(!s||ba(s))return e;if(tt(s))return e.push(s),e;if(Wt(s)){let n=Kt(s,t);if(n)return e.push(n),e}return e}),[]))(e,i);if(!a.length)return null;let l=a.map((e=>Math.round(10*e.fontSize)/10)),r=1===new Set(l).size?l[0]:"Mixed",o=l.length>0;return gp.exports.jsx(uE,{label:"F",icon:Cs,elements:a,dragInputCallback:ME,value:r,editable:o,scene:t,property:n,appState:s})},DE=({accumulatedChange:e,instantChange:t,originalElements:s,originalElementsMap:n,shouldChangeByStepSize:i,nextValue:a,property:l,scene:r,originalAppState:o})=>{let d=r.getNonDeletedElementsMap(),c=r.getNonDeletedElements(),p=s[0],[h,m]=[p.x+p.width/2,p.y+p.height/2],[u,g]=jo(an(p.x,p.y),an(h,m),p.angle);if(o.croppingElementId===p.id){let e=d.get(p.id);if(!e||!B(e)||!e.crop)return;let s=e.crop,n=s,i=-1===e.scale[0],r=-1===e.scale[1],{width:o,height:c}=z(e);if(void 0!==a){if("x"===l){let e=a*(s.naturalWidth/o);n=i?{...s,x:$o(s.naturalWidth-e-s.width,0,s.naturalWidth-s.width)}:{...s,x:$o(a*(s.naturalWidth/o),0,s.naturalWidth-s.width)}}return"y"===l&&(n={...s,y:$o(a*(s.naturalHeight/c),0,s.naturalHeight-s.height)}),void He(e,{crop:n})}let h=("x"===l?t:0)*(i?-1:1),m=("y"===l?t:0)*(r?-1:1);return n={...s,x:$o(s.x+h,0,s.naturalWidth-s.width),y:$o(s.y+m,0,s.naturalHeight-s.height)},void He(e,{crop:n})}if(void 0!==a)return void pE("x"===l?a:u,"y"===l?a:g,p,d,c,r,n);let x="x"===l?e:0,f="y"===l?e:0,b="x"===l?Math.round(i?dE(p.x+x,10):u+x):u,E="y"===l?Math.round(i?dE(p.y+f,10):g+f):g;pE(b,E,p,d,c,r,n)},LE=({property:e,element:t,elementsMap:s,scene:n,appState:i})=>{let[a,l]=jo(an(t.x,t.y),an(t.x+t.width/2,t.y+t.height/2),t.angle),r=$("x"===e?a:l,2);if(i.croppingElementId===t.id&&B(t)&&t.crop){let s=Do(t);s&&(r=$("x"===e?s.x:s.y,2))}return gp.exports.jsx(uE,{label:"x"===e?"X":"Y",elements:[t],dragInputCallback:DE,scene:n,value:r,property:e,appState:i})},NE=(e,t,s,n,i,a,l)=>{let[r,o,,]=xt(s),d=e-r,c=t-o;for(let e=0;e<s.length;e++){let t=s[e],r=n.get(t.id);if(r&&(!tt(r)||!r.containerId)){let[e,s]=[r.x+r.width/2,r.y+r.height/2],[o,p]=jo(an(r.x,r.y),an(e,s),r.angle);pE(o+d,p+c,t,n,i,l,a,!1)}}},AE=({accumulatedChange:e,originalElements:t,originalElementsMap:s,shouldChangeByStepSize:n,nextValue:i,property:a,scene:l,originalAppState:r})=>{let o=l.getNonDeletedElementsMap(),d=l.getNonDeletedElements();if(void 0!==i){for(let e of hE(t,r)){let t=cE(e,o,s);if(t.length>1){let[e,n,,]=xt(t.map((e=>e.latest)));NE("x"===a?i:e,"y"===a?i:n,t.map((e=>e.original)),o,d,s,l)}else{let e=t[0]?.original,n=t[0]?.latest;if(e&&n&&oE(n,a)){let[t,n]=[e.x+e.width/2,e.y+e.height/2],[r,c]=jo(an(e.x,e.y),an(t,n),e.angle);pE("x"===a?i:r,"y"===a?i:c,e,o,d,l,s,!1)}}}return void l.triggerUpdate()}let c=n?dE(e,10):e;((e,t,s,n,i,a,l,r)=>{for(let o=0;o<n.length;o++){let d=i[o],[c,p]=[d.x+d.width/2,d.y+d.height/2],[h,m]=jo(an(d.x,d.y),an(c,p),d.angle),u="x"===e?Math.round(h+t):h,g="y"===e?Math.round(m+s):m;pE(u,g,d,a,n,r,l,!1)}})(a,"x"===a?c:0,"y"===a?c:0,t,t,o,s,l),l.triggerUpdate()},_E=({property:e,elements:t,elementsMap:s,atomicUnits:n,scene:i,appState:a})=>{let l=Nc((()=>n.map((t=>{let n=Object.keys(t).map((e=>s.get(e))).filter((e=>void 0!==e));if(n.length>1){let[t,s]=xt(n);return Math.round(100*("x"===e?t:s))/100}let[i]=n,[a,l]=[i.x+i.width/2,i.y+i.height/2],[r,o]=jo(an(i.x,i.y),an(a,l),i.angle);return Math.round(100*("x"===e?r:o))/100}))),[n,s,e]),r=1===new Set(l).size?l[0]:"Mixed";return gp.exports.jsx(uE,{label:"x"===e?"X":"Y",elements:t,dragInputCallback:AE,value:r,property:e,scene:i,appState:a})},PE=({property:e,scene:t,appState:s,setAppState:n})=>gp.exports.jsx(uE,{label:"Grid step",sensitivity:8,elements:[],dragInputCallback:({nextValue:e,instantChange:t,shouldChangeByStepSize:s,setInputValue:i})=>{n((n=>{let a;return e?a=e:t&&(a=s?dE(n.gridStep+5*Math.sign(t),5):n.gridStep+t),a?(a=Lo(a),i(a),{gridStep:a}):(i(n.gridStep),null)}))},scene:t,value:s.gridStep,property:e,appState:s}),RE=e=>{let t=sv(),s=e.app.scene.getSceneNonce()||1,n=e.app.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!1}),i=Ee(e.app);return gp.exports.jsx(BE,{...e,appState:t,sceneNonce:s,selectedElements:n,gridModeEnabled:i})},OE=({children:e,columns:t=1,heading:s,style:n,...i})=>gp.exports.jsx("div",{className:Vc("exc-stats__row",{"exc-stats__row--heading":s}),style:{gridTemplateColumns:`repeat(${t}, 1fr)`,...n},...i,children:e});OE.displayName="StatsRow";var FE=({children:e,order:t,style:s,...n})=>gp.exports.jsx("div",{className:"exc-stats__rows",style:{order:t,...s},...n,children:e});FE.displayName="StatsRows",RE.StatsRow=OE,RE.StatsRows=FE;var BE=_c((({app:e,onClose:t,renderCustomStats:s,selectedElements:n,appState:i,sceneNonce:a,gridModeEnabled:l})=>{let r=e.scene,o=r.getNonDeletedElements(),d=r.getNonDeletedElementsMap(),c=nv(),p=1===n.length?n[0]:null,h=n.length>1?n:null,m=i.croppingElementId&&B(p),u=m?z(p):null,[g,x]=Mc({width:0,height:0}),f=Nc((()=>ap((e=>{let t=xt(e);x({width:Math.round(t[2])-Math.round(t[0]),height:Math.round(t[3])-Math.round(t[1])})}),50)),[]);Dc((()=>{f(o)}),[a,o,f]),Dc((()=>()=>f.cancel()),[f]);let b=Nc((()=>hE(n,i)),[n,i]),E=Nc((()=>U(n)),[n]);return gp.exports.jsx("div",{className:"exc-stats",children:gp.exports.jsxs(Gh,{padding:3,children:[gp.exports.jsxs("div",{className:"title",children:[gp.exports.jsx("h2",{children:Np("stats.title")}),gp.exports.jsx("div",{className:"close",onClick:t,children:H})]}),gp.exports.jsxs(em,{label:gp.exports.jsx("h3",{children:Np("stats.generalStats")}),open:!!(i.stats.panels&Y.generalStats),openTrigger:()=>c((e=>({stats:{open:!0,panels:e.stats.panels^Y.generalStats}}))),children:[gp.exports.jsxs(FE,{children:[gp.exports.jsx(OE,{heading:!0,children:Np("stats.scene")}),gp.exports.jsxs(OE,{columns:2,children:[gp.exports.jsx("div",{children:Np("stats.shapes")}),gp.exports.jsx("div",{children:o.length})]}),gp.exports.jsxs(OE,{columns:2,children:[gp.exports.jsx("div",{children:Np("stats.width")}),gp.exports.jsx("div",{children:g.width})]}),gp.exports.jsxs(OE,{columns:2,children:[gp.exports.jsx("div",{children:Np("stats.height")}),gp.exports.jsx("div",{children:g.height})]}),l&&gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsx(OE,{heading:!0,children:"Canvas"}),gp.exports.jsx(OE,{children:gp.exports.jsx(PE,{property:"gridStep",scene:r,appState:i,setAppState:c})})]})]}),s?.(o,i)]}),!E&&n.length>0&&gp.exports.jsx("div",{id:"elementStats",style:{marginTop:12},children:gp.exports.jsx(em,{label:gp.exports.jsx("h3",{children:Np("stats.elementProperties")}),open:!!(i.stats.panels&Y.elementProperties),openTrigger:()=>c((e=>({stats:{open:!0,panels:e.stats.panels^Y.elementProperties}}))),children:gp.exports.jsxs(FE,{children:[p&&gp.exports.jsxs(gp.exports.Fragment,{children:[m&&gp.exports.jsx(OE,{heading:!0,children:Np("labels.unCroppedDimension")}),i.croppingElementId&&B(p)&&u&&gp.exports.jsxs(OE,{columns:2,children:[gp.exports.jsx("div",{children:Np("stats.width")}),gp.exports.jsx("div",{children:$(u.width,2)})]}),i.croppingElementId&&B(p)&&u&&gp.exports.jsxs(OE,{columns:2,children:[gp.exports.jsx("div",{children:Np("stats.height")}),gp.exports.jsx("div",{children:$(u.height,2)})]}),gp.exports.jsx(OE,{heading:!0,"data-testid":"stats-element-type",children:i.croppingElementId?Np("labels.imageCropping"):Np(`element.${p.type}`)}),gp.exports.jsx(OE,{children:gp.exports.jsx(LE,{element:p,property:"x",elementsMap:d,scene:r,appState:i})}),gp.exports.jsx(OE,{children:gp.exports.jsx(LE,{element:p,property:"y",elementsMap:d,scene:r,appState:i})}),gp.exports.jsx(OE,{children:gp.exports.jsx(xE,{property:"width",element:p,scene:r,appState:i})}),gp.exports.jsx(OE,{children:gp.exports.jsx(xE,{property:"height",element:p,scene:r,appState:i})}),!V(p)&&gp.exports.jsx(OE,{children:gp.exports.jsx(bE,{property:"angle",element:p,scene:r,appState:i})}),gp.exports.jsx(OE,{children:gp.exports.jsx(yE,{property:"fontSize",element:p,scene:r,appState:i})})]}),h&&gp.exports.jsxs(gp.exports.Fragment,{children:[W(h)&&gp.exports.jsx(OE,{heading:!0,children:Np("element.group")}),gp.exports.jsxs(OE,{columns:2,style:{margin:"0.3125rem 0"},children:[gp.exports.jsx("div",{children:Np("stats.shapes")}),gp.exports.jsx("div",{children:n.length})]}),gp.exports.jsx(OE,{children:gp.exports.jsx(_E,{property:"x",elements:h,elementsMap:d,atomicUnits:b,scene:r,appState:i})}),gp.exports.jsx(OE,{children:gp.exports.jsx(_E,{property:"y",elements:h,elementsMap:d,atomicUnits:b,scene:r,appState:i})}),gp.exports.jsx(OE,{children:gp.exports.jsx(IE,{property:"width",elements:h,elementsMap:d,atomicUnits:b,scene:r,appState:i})}),gp.exports.jsx(OE,{children:gp.exports.jsx(IE,{property:"height",elements:h,elementsMap:d,atomicUnits:b,scene:r,appState:i})}),gp.exports.jsx(OE,{children:gp.exports.jsx(TE,{property:"angle",elements:h,scene:r,appState:i})}),gp.exports.jsx(OE,{children:gp.exports.jsx(jE,{property:"fontSize",elements:h,scene:r,appState:i,elementsMap:d})})]})]})})})]})})}),((e,t)=>e.sceneNonce===t.sceneNonce&&e.selectedElements===t.selectedElements&&e.appState.stats.panels===t.appState.stats.panels&&e.gridModeEnabled===t.gridModeEnabled&&e.appState.gridStep===t.appState.gridStep&&e.appState.croppingElementId===t.appState.croppingElementId)),zE=({sourceElementId:e,onClose:t,elementsMap:s,appState:n,generateLinkForSelection:i=Vi})=>{let a=s.get(e)?.link??null,[l,r]=Mc(a),[o,d]=Mc(!1);Dc((()=>{let e=S(s,n),t=a;if(e.length>0&&i){let s=$i(e,n);s&&(t=ji(i(s.id,s.type)))}r(t)}),[s,n,n.selectedElementIds,a,i]);let c=Ac((()=>{if(l&&l!==s.get(e)?.link){let t=s.get(e);t&&He(t,{link:l})}if(!l&&o&&e){let t=s.get(e);t&&He(t,{link:null})}t?.()}),[e,l,s,o,t]);return Dc((()=>{let e=e=>{"elementLinkSelector"===n.openDialog?.name&&e.key===j.ENTER&&c(),"elementLinkSelector"===n.openDialog?.name&&e.key===j.ESCAPE&&t?.()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[n,t,c]),gp.exports.jsxs("div",{className:"ElementLinkDialog",children:[gp.exports.jsxs("div",{className:"ElementLinkDialog__header",children:[gp.exports.jsx("h2",{children:Np("elementLink.title")}),gp.exports.jsx("p",{children:Np("elementLink.desc")})]}),gp.exports.jsxs("div",{className:"ElementLinkDialog__input",children:[gp.exports.jsx(tx,{value:l??"",onChange:e=>{o||d(!0),r(e)},onKeyDown:e=>{e.key===j.ENTER&&c()},className:"ElementLinkDialog__input-field",selectOnRender:!0}),a&&l&&gp.exports.jsx(Fp,{type:"button",title:Np("buttons.remove"),"aria-label":Np("buttons.remove"),label:Np("buttons.remove"),onClick:()=>{r(null),d(!0)},className:"ElementLinkDialog__remove",icon:jt})]}),gp.exports.jsxs("div",{className:"ElementLinkDialog__actions",children:[gp.exports.jsx(yg,{label:Np("buttons.cancel"),onClick:()=>{t?.()},style:{marginRight:10}}),gp.exports.jsx(yg,{label:Np("buttons.confirm"),onClick:c,actionType:"primary"})]})]})},UE=({UIOptions:e})=>gp.exports.jsxs(Ib,{__fallback:!0,children:[gp.exports.jsx(Ib.DefaultItems.LoadScene,{}),gp.exports.jsx(Ib.DefaultItems.SaveToActiveFile,{}),e.canvasActions.export&&gp.exports.jsx(Ib.DefaultItems.Export,{}),e.canvasActions.saveAsImage&&gp.exports.jsx(Ib.DefaultItems.SaveAsImage,{}),gp.exports.jsx(Ib.DefaultItems.SearchMenu,{}),gp.exports.jsx(Ib.DefaultItems.Help,{}),gp.exports.jsx(Ib.DefaultItems.ClearCanvas,{}),gp.exports.jsx(Ib.Separator,{}),gp.exports.jsx(Ib.Group,{title:"Excalidraw links",children:gp.exports.jsx(Ib.DefaultItems.Socials,{})}),gp.exports.jsx(Ib.Separator,{}),gp.exports.jsx(Ib.DefaultItems.ToggleTheme,{}),gp.exports.jsx(Ib.DefaultItems.ChangeCanvasBackground,{})]}),HE=()=>gp.exports.jsxs(Mb,{__fallback:!0,children:[gp.exports.jsx(Mb.Actions.SaveToDisk,{}),gp.exports.jsx(Mb.Actions.ExportToImage,{})]}),YE=e=>{let{suggestedBindings:t,startBoundElement:s,cursorButton:n,scrollX:i,scrollY:a,...l}=e;return l},GE=Tc.memo((({actionManager:e,appState:t,files:s,setAppState:n,elements:i,canvas:a,onLockToggle:l,onHandToolToggle:r,onPenModeToggle:o,showExitZenModeBtn:d,renderTopRightUI:c,renderCustomStats:p,UIOptions:h,onExportImage:m,renderWelcomeScreen:u,children:g,app:x,isCollaborating:f,generateLinkForSelection:b})=>{let y=Jy(),w=Tc.useMemo((()=>({MainMenuTunnel:rp(),WelcomeScreenMenuHintTunnel:rp(),WelcomeScreenToolbarHintTunnel:rp(),WelcomeScreenHelpHintTunnel:rp(),WelcomeScreenCenterTunnel:rp(),FooterCenterTunnel:rp(),DefaultSidebarTriggerTunnel:rp(),DefaultSidebarTabTriggersTunnel:rp(),OverwriteConfirmDialogTunnel:rp(),TTDDialogTriggerTunnel:rp(),tunnelsJotai:cx})),[]),S=w.tunnelsJotai.Provider,[C,k]=fp(Uh),T=()=>h.canvasActions.export?gp.exports.jsx($f,{elements:i,appState:t,files:s,actionManager:e,exportOpts:h.canvasActions.export,canvas:a,setAppState:n}):null,M=()=>h.canvasActions.saveAsImage&&"imageExport"===t.openDialog?.name?gp.exports.jsx(df,{elements:i,appState:t,files:s,actionManager:e,onExportImage:m,onCloseRequest:()=>n({openDialog:null}),name:x.getName()}):null,j=()=>gp.exports.jsx(Bb,{__fallback:!0,onDock:e=>{dh("sidebar",`toggleDock (${e?"dock":"undock"})`,`(${y.editor.isMobile?"mobile":"desktop"})`)}}),D=Ep(sb),L=gp.exports.jsxs(gp.exports.Fragment,{children:[g,gp.exports.jsx(UE,{UIOptions:h}),gp.exports.jsx(Bb.Trigger,{__fallback:!0,icon:E,title:I(Np("toolBar.library")),onToggle:e=>{e&&dh("sidebar",`${v.name} (open)`,`button (${y.editor.isMobile?"mobile":"desktop"})`)},tab:v.defaultTab,children:Np("toolBar.library")}),gp.exports.jsx(HE,{}),"ttd"===t.openDialog?.name&&gp.exports.jsx(lE,{__fallback:!0}),t.isLoading&&gp.exports.jsx(Rp,{delay:250}),t.errorMessage&&gp.exports.jsx(ef,{onClose:()=>n({errorMessage:null}),children:t.errorMessage}),C&&!y.editor.isMobile&&gp.exports.jsx(Hh,{colorPickerType:C.colorPickerType,onCancel:()=>{k(null)},onChange:(e,t,s,{altKey:i})=>{if("elementBackground"===e||"elementStroke"===e)if(s.length){for(let n of s)He(n,{[i&&C.swapPreviewOnAlt?"elementBackground"===e?"strokeColor":"backgroundColor":"elementBackground"===e?"backgroundColor":"strokeColor"]:t},!1),Se.delete(n);Q.getScene(s[0])?.triggerUpdate()}else n("elementBackground"===e?{currentItemBackgroundColor:t}:{currentItemStrokeColor:t})},onSelect:(e,t)=>{k((e=>e?.keepOpenOnAlt&&t.altKey?e:null)),C?.onSelect?.(e,t)}}),"help"===t.openDialog?.name&&gp.exports.jsx(Ff,{onClose:()=>{n({openDialog:null})}}),gp.exports.jsx(vx,{}),"elementLinkSelector"===t.openDialog?.name&&gp.exports.jsx(zE,{sourceElementId:t.openDialog.sourceElementId,onClose:()=>{n({openDialog:null})},elementsMap:x.scene.getNonDeletedElementsMap(),appState:t,generateLinkForSelection:b}),gp.exports.jsx(w.OverwriteConfirmDialogTunnel.Out,{}),M(),T(),t.pasteDialog.shown&&gp.exports.jsx(Df,{setAppState:n,appState:t,onClose:()=>n({pasteDialog:{shown:!1,data:null}})}),y.editor.isMobile&&gp.exports.jsx(Mf,{app:x,appState:t,elements:i,actionManager:e,renderJSONExportDialog:T,renderImageExportDialog:M,setAppState:n,onLockToggle:l,onHandToolToggle:r,onPenModeToggle:o,renderTopRightUI:c,renderCustomStats:p,renderSidebars:j,device:y,renderWelcomeScreen:u,UIOptions:h}),!y.editor.isMobile&&gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsxs("div",{className:"layer-ui__wrapper",style:t.openSidebar&&D&&y.editor.canFitSidebar?{width:"calc(100% - var(--right-sidebar-width))"}:{},children:[u&&gp.exports.jsx(w.WelcomeScreenCenterTunnel.Out,{}),(()=>{let s=Cn(t,i),n=t.stats.open&&!t.zenModeEnabled&&!t.viewModeEnabled&&"elementLinkSelector"!==t.openDialog?.name;return gp.exports.jsx(cf,{side:"top",children:gp.exports.jsxs("div",{className:"App-menu App-menu_top",children:[gp.exports.jsxs(hg.Col,{gap:6,className:Vc("App-menu_top__left"),children:[gp.exports.jsxs("div",{style:{position:"relative"},children:[gp.exports.jsx(w.MainMenuTunnel.Out,{}),u&&gp.exports.jsx(w.WelcomeScreenMenuHintTunnel.Out,{})]}),s&&gp.exports.jsx(Cf,{heading:"selectedShapeActions",className:Vc("selected-shape-actions zen-mode-transition",{"transition-left":t.zenModeEnabled}),children:gp.exports.jsx(Gh,{className:qi.SHAPE_ACTIONS_MENU,padding:2,style:{maxHeight:t.height-166+"px"},children:gp.exports.jsx(mx,{appState:t,elementsMap:x.scene.getNonDeletedElementsMap(),renderAction:e.renderAction,app:x})})})]}),!t.viewModeEnabled&&"elementLinkSelector"!==t.openDialog?.name&&gp.exports.jsx(Cf,{heading:"shapes",className:"shapes-section",children:e=>gp.exports.jsxs("div",{style:{position:"relative"},children:[u&&gp.exports.jsx(w.WelcomeScreenToolbarHintTunnel.Out,{}),gp.exports.jsx(hg.Col,{gap:4,align:"start",children:gp.exports.jsxs(hg.Row,{gap:1,className:Vc("App-toolbar-container",{"zen-mode":t.zenModeEnabled}),children:[gp.exports.jsxs(Gh,{padding:1,className:Vc("App-toolbar",{"zen-mode":t.zenModeEnabled}),children:[gp.exports.jsx(vf,{appState:t,isMobile:y.editor.isMobile,device:y,app:x}),e,gp.exports.jsxs(hg.Row,{gap:1,children:[gp.exports.jsx(kf,{zenModeEnabled:t.zenModeEnabled,checked:t.penMode,onChange:()=>o(null),title:Np("toolBar.penMode"),penDetected:t.penDetected}),gp.exports.jsx(Sf,{checked:t.activeTool.locked,onChange:l,title:Np("toolBar.lock")}),gp.exports.jsx("div",{className:"App-toolbar__divider"}),gp.exports.jsx(Tf,{checked:Js(t),onChange:()=>r(),title:Np("toolBar.hand"),isMobile:!0}),gp.exports.jsx(ux,{appState:t,activeTool:t.activeTool,UIOptions:h,app:x})]})]}),f&&gp.exports.jsx(Gh,{style:{marginLeft:8,alignSelf:"center",height:"fit-content"},children:gp.exports.jsx(zb,{title:Np("toolBar.laser"),checked:t.activeTool.type===Ya.laser,onChange:()=>x.setActiveTool({type:Ya.laser}),isMobile:!0})})]})})]})}),gp.exports.jsxs("div",{className:Vc("layer-ui__wrapper__top-right zen-mode-transition",{"transition-right":t.zenModeEnabled}),children:[t.collaborators.size>0&&gp.exports.jsx(Hf,{collaborators:t.collaborators,userToFollow:t.userToFollow?.socketId||null}),c?.(y.editor.isMobile,t),!t.viewModeEnabled&&"elementLinkSelector"!==t.openDialog?.name&&(!D||t.openSidebar?.name!==v.name)&&gp.exports.jsx(w.DefaultSidebarTriggerTunnel.Out,{}),n&&gp.exports.jsx(RE,{app:x,onClose:()=>{e.executeAction(Au)},renderCustomStats:p})]})]})})})(),gp.exports.jsx(Kf,{appState:t,actionManager:e,showExitZenModeBtn:d,renderWelcomeScreen:u}),t.scrolledOutside&&gp.exports.jsx("button",{type:"button",className:"scroll-back-to-content",onClick:()=>{n((e=>({...Ea(i,e)})))},children:Np("buttons.scrollBackToContent")})]}),j()]})]});return gp.exports.jsx(Rh.Provider,{value:t,children:gp.exports.jsx(S,{children:gp.exports.jsx(ox.Provider,{value:w,children:L})})})}),((e,t)=>{if(e.children!==t.children)return!1;let{canvas:s,appState:n,...i}=e,{canvas:a,appState:l,...r}=t;return R(YE(n),YE(l),{selectedElementIds:R,selectedGroupIds:R})&&R(i,r)})),$E=({message:e,onClose:t,closable:s=!1,duration:n=5e3,style:i})=>{let a=jc(0),l=n!==1/0,r=Ac((()=>{l&&(a.current=window.setTimeout((()=>t()),n))}),[t,n,l]);return Dc((()=>{if(l)return r(),()=>clearTimeout(a.current)}),[r,e,n,l]),gp.exports.jsxs("div",{className:"Toast",onMouseEnter:l?()=>clearTimeout(a?.current):void 0,onMouseLeave:l?r:void 0,style:i,children:[gp.exports.jsx("p",{className:"Toast__message",children:e}),s&&gp.exports.jsx(Fp,{icon:H,"aria-label":"close",type:"icon",onClick:t,className:"close"})]})},VE=e({name:"viewMode",label:"labels.viewMode",paletteName:"Toggle view mode",icon:g,viewMode:!0,trackEvent:{category:"canvas",predicate:e=>!e.viewModeEnabled},perform(e,t){return{appState:{...t,viewModeEnabled:!this.checked(t)},captureUpdate:Lt.EVENTUALLY}},checked:e=>e.viewModeEnabled,predicate:(e,t,s)=>typeof s.viewModeEnabled>"u",keyTest:e=>!e[j.CTRL_OR_CMD]&&e.altKey&&e.code===Pt.R}),WE=(e,t)=>{let s=t.scene.getSelectedElements(e);return 1===s.length&&it(s[0])},KE=e({name:"selectAllElementsInFrame",label:"labels.selectAllElementsInFrame",trackEvent:{category:"canvas"},perform:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t).at(0)||null;if(it(i)){let s=$t(At(e),i.id).filter((e=>!("text"===e.type&&e.containerId)));return{elements:e,appState:{...t,selectedElementIds:s.reduce(((e,t)=>(e[t.id]=!0,e)),{})},captureUpdate:Lt.IMMEDIATELY}}return{elements:e,appState:t,captureUpdate:Lt.EVENTUALLY}},predicate:(e,t,s,n)=>WE(t,n)}),ZE=e({name:"removeAllElementsFromFrame",label:"labels.removeAllElementsFromFrame",trackEvent:{category:"history"},perform:(e,t,s,n)=>{let i=n.scene.getSelectedElements(t).at(0)||null;return it(i)?{elements:ya(e,i),appState:{...t,selectedElementIds:{[i.id]:!0}},captureUpdate:Lt.IMMEDIATELY}:{elements:e,appState:t,captureUpdate:Lt.EVENTUALLY}},predicate:(e,t,s,n)=>WE(t,n)});e({name:"updateFrameRendering",label:"labels.updateFrameRendering",viewMode:!0,trackEvent:{category:"canvas"},perform:(e,t)=>({elements:e,appState:{...t,frameRendering:{...t.frameRendering,enabled:!t.frameRendering.enabled}},captureUpdate:Lt.EVENTUALLY}),checked:e=>e.frameRendering.enabled}),e({name:"setFrameAsActiveTool",label:"toolBar.frame",trackEvent:{category:"toolbar"},icon:va,viewMode:!1,perform:(e,t,s,n)=>{let i=_e(t,{type:"frame"});return wa(n.interactiveCanvas,{...t,activeTool:i}),{elements:e,appState:{...t,activeTool:_e(t,{type:"frame"})},captureUpdate:Lt.EVENTUALLY}},keyTest:e=>!e[j.CTRL_OR_CMD]&&!e.shiftKey&&!e.altKey&&e.key.toLocaleLowerCase()===j.F});var XE=e({name:"wrapSelectionInFrame",label:"labels.wrapSelectionInFrame",trackEvent:{category:"element"},predicate:(e,t,s,n)=>{let i=S(e,t);return i.length>0&&!i.some((e=>it(e)))},perform:(e,t,s,n)=>{let i=S(e,t),[a,l,r,o]=xt(i,n.scene.getNonDeletedElementsMap()),d=Sa({x:a-16,y:l-16,width:r-a+32,height:o-l+32});if(t.editingGroupId){let e=Gt(i,t.editingGroupId);for(let s of e){let e=s.groupIds.indexOf(t.editingGroupId);He(s,{groupIds:s.groupIds.slice(0,e)},!1)}}return{elements:Ca([...n.scene.getElementsIncludingDeleted(),d],i,d,t),appState:{selectedElementIds:{[d.id]:!0}},captureUpdate:Lt.IMMEDIATELY}}}),qE=()=>gp.exports.jsxs("div",{"data-testid":"brave-measure-text-error",children:[gp.exports.jsx("p",{children:gp.exports.jsx(Eg,{i18nKey:"errors.brave_measure_text_error.line1",bold:e=>gp.exports.jsx("span",{style:{fontWeight:600},children:e})})}),gp.exports.jsx("p",{children:gp.exports.jsx(Eg,{i18nKey:"errors.brave_measure_text_error.line2",bold:e=>gp.exports.jsx("span",{style:{fontWeight:600},children:e})})}),gp.exports.jsx("p",{children:gp.exports.jsx(Eg,{i18nKey:"errors.brave_measure_text_error.line3",link:e=>gp.exports.jsx("a",{href:"http://docs.excalidraw.com/docs/@excalidraw/excalidraw/faq#turning-off-aggresive-block-fingerprinting-in-brave-browser",children:e})})}),gp.exports.jsx("p",{children:gp.exports.jsx(Eg,{i18nKey:"errors.brave_measure_text_error.line4",issueLink:e=>gp.exports.jsx("a",{href:"https://github.com/excalidraw/excalidraw/issues/new",children:e}),discordLink:e=>gp.exports.jsxs("a",{href:"https://discord.gg/UexuTaE",children:[e,"."]})})})]}),QE=100,JE=0,ey=100,ty=(e,t,s)=>{let n=Je({x:0,y:0,textAlign:Ci.CENTER,verticalAlign:js.MIDDLE,...t,containerId:e.id,strokeColor:t.strokeColor||e.strokeColor});return Object.assign(e,{boundElements:(e.boundElements||[]).concat({type:"text",id:n.id})}),Is(n,e,s),[e,n]},sy=(e,t,s,n,i)=>{let a,l;if(Object.assign(e,{startBinding:e?.startBinding||null,endBinding:e.endBinding||null}),t){let s,l=t?.width??ey,r=t?.height??ey;t.id&&(s=n.getElement(t.id),s||console.error(`No element for start binding with id ${t.id} found`));let o=t.x||e.x-l,d=t.y||e.y-r/2,c=s?s.type:t.type;if(c){if("text"===c){let n="";s&&"text"===s.type?n=s.text:"text"===t.type&&(n=t.text),n||console.error(`No text found for start binding text element for ${e.id}`),a=Je({x:o,y:d,type:"text",...s,...t,text:n}),Object.assign(a,{x:t.x||e.x-a.width,y:t.y||e.y-a.height/2})}else switch(c){case"rectangle":case"ellipse":case"diamond":a=ki({x:o,y:d,width:l,height:r,...s,...t,type:c});break;default:No(e,`Unhandled element start type "${t.type}"`,!0)}so(e,a,"start",i)}}if(s){let t,a=s?.height??ey,r=s?.width??ey;s.id&&(t=n.getElement(s.id),t||console.error(`No element for end binding with id ${s.id} found`));let o=s.x||e.x+e.width,d=s.y||e.y-a/2,c=t?t.type:s.type;if(c){if("text"===c){let n="";t&&"text"===t.type?n=t.text:"text"===s.type&&(n=s.text),n||console.error(`No text found for end binding text element for ${e.id}`),l=Je({x:o,y:d,type:"text",...t,...s,text:n}),Object.assign(l,{y:s.y||e.y-l.height/2})}else switch(c){case"rectangle":case"ellipse":case"diamond":l=ki({x:o,y:d,width:r,height:a,...t,...s,type:c});break;default:No(e,`Unhandled element end type "${c}"`,!0)}so(e,l,"end",i)}}if(e.points.length<2)return{linearElement:e,startBoundElement:a,endBoundElement:l};let r=e.points.length-1,o=.5,d=io(e.points);return e.points[r][0]>e.points[r-1][0]&&(d[0][0]=o,d[r][0]-=o),e.points[r][0]<e.points[r-1][0]&&(d[0][0]=-o,d[r][0]+=o),e.points[r][1]>e.points[r-1][1]&&(d[0][1]=o,d[r][1]-=o),e.points[r][1]<e.points[r-1][1]&&(d[0][1]=-o,d[r][1]+=o),Object.assign(e,{points:d}),{linearElement:e,startBoundElement:a,endBoundElement:l}},ny=class{constructor(){Cc(this,"excalidrawElements",new Map),Cc(this,"add",(e=>{e&&this.excalidrawElements.set(e.id,e)})),Cc(this,"getElements",(()=>ml(Array.from(this.excalidrawElements.values())))),Cc(this,"getElementsMap",(()=>Co(Ht(this.getElements())))),Cc(this,"getElement",(e=>this.excalidrawElements.get(e)))}},iy=(e,t)=>{if(!e)return[];let s=io(e),n=new ny,i=new Map,a=new Map;for(let e of s){let s,l=e.id;switch(!1!==t?.regenerateIds&&Object.assign(e,{id:m()}),e.type){case"rectangle":case"ellipse":case"diamond":{let t=e?.label?.text&&void 0===e.width?0:e?.width||ey,n=e?.label?.text&&void 0===e.height?0:e?.height||ey;s=ki({...e,width:t,height:n});break}case"line":{let t=e.width||QE,n=e.height||JE;s=er({width:t,height:n,points:[an(0,0),an(t,n)],...e});break}case"arrow":{let t=e.width||QE,n=e.height||JE;s=Jl({width:t,height:n,endArrowhead:"arrow",points:[an(0,0),an(t,n)],...e,type:"arrow"}),Object.assign(s,Ao(s.points));break}case"text":{let t=e?.fontFamily||wn,n=e?.fontSize||vn,i=e?.lineHeight||Ke(t),a=e.text??"",l=Xe(a),r=qe(l,We({fontFamily:t,fontSize:n}),i);s=Je({width:r.width,height:r.height,fontFamily:t,fontSize:n,...e});break}case"image":s=Ql({width:e?.width||ey,height:e?.height||ey,...e});break;case"frame":s=Sa({x:0,y:0,...e});break;case"magicframe":s=Ga({x:0,y:0,...e});break;case"freedraw":case"iframe":case"embeddable":s=e;break;default:s=e,No(e,`Unhandled element type "${e.type}"`,!0)}n.getElement(s.id)?console.error(`Duplicate id found for ${s.id}`):(n.add(s),i.set(s.id,e),l&&a.set(l,s.id))}let l=n.getElementsMap();for(let[e,t]of i){let s=n.getElement(e);switch(t.type){case"rectangle":case"ellipse":case"diamond":case"arrow":if(t.label?.text){let[e,i]=ty(s,t?.label,l);if(n.add(e),n.add(i),ut(e)){let s="arrow"===t.type?t?.start:void 0,i="arrow"===t.type?t?.end:void 0;if(s&&s.id){let e=a.get(s.id);e&&Object.assign(s,{id:e})}if(i&&i.id){let e=a.get(i.id);e&&Object.assign(i,{id:e})}let{linearElement:r,startBoundElement:o,endBoundElement:d}=sy(e,s,i,n,l);e=r,n.add(r),n.add(o),n.add(d)}}else switch(t.type){case"arrow":{let{start:e,end:i}=t;if(e&&e.id){let t=a.get(e.id);Object.assign(e,{id:t})}if(i&&i.id){let e=a.get(i.id);Object.assign(i,{id:e})}let{linearElement:r,startBoundElement:o,endBoundElement:d}=sy(s,e,i,n,l);n.add(r),n.add(o),n.add(d);break}}}}for(let[e,t]of i){if("frame"!==t.type&&"magicframe"!==t.type)continue;let s=n.getElement(e);if(!s)throw new Error(`Excalidraw element with id ${e} doesn't exist`);let i=[];t.children.forEach((e=>{let t=a.get(e);if(!t)throw new Error(`Element with ${e} wasn't mapped correctly`);let l=n.getElement(t);if(!l)throw new Error(`Frame element with id ${t} doesn't exist`);Object.assign(l,{frameId:s.id}),l?.boundElements?.forEach((e=>{let t=n.getElement(e.id);if(!t)throw new Error(`Bound element with id ${e.id} doesn't exist`);Object.assign(t,{frameId:s.id}),i.push(t)})),i.push(l)}));let[l,r,o,d]=xt(i),c=10;l-=c,r-=c,o+=c,d+=c;let p=s?.x||l,h=s?.y||r,m=s?.width||o-l,u=s?.height||d-r;Object.assign(s,{x:p,y:h,width:m,height:u}),_o()&&t.children.length&&(s?.x||s?.y||s?.width||s?.height)&&console.info("User provided frame attributes are being considered, if you find this inaccurate, please remove any of the attributes - x, y, width and height so frame coordinates and dimensions are calculated automatically")}return n.getElements()},ay=e=>t=>{Wc(e,t)},ly=e=>Ia((t=>{Wc(e,t)})),ry=(()=>{let e;try{let t=Fc.split(".");e=Number(t[0])>17}catch{e=!1}let t=!1;return()=>!0===window.EXCALIDRAW_THROTTLE_RENDER&&(!!e||(t||(t=!0,console.warn("Excalidraw: render throttling is disabled on React versions < 18.")),!1))})(),oy=(e,t,s)=>{if(!s.zenModeEnabled){let s=e.points[0],n=e.points[e.points.length-1];py(s,n,t)}for(let n of e.points)cy(n,s,t)},dy=(e,t,s)=>{cy(e.points[0],s,t),s.zenModeEnabled||py(e.points[0],e.points[1],t)},cy=([e,t],s,n)=>{n.save();let i=(s.zenModeEnabled?3:2)/s.zoom.value;n.beginPath(),n.moveTo(e-i,t-i),n.lineTo(e+i,t+i),n.moveTo(e+i,t-i),n.lineTo(e-i,t+i),n.stroke(),n.restore()},py=(e,t,s)=>{s.beginPath(),s.lineTo(e[0],e[1]),s.lineTo(t[0],t[1]),s.stroke()},hy=(e,t,s,n,i)=>{let a=8/n.zoom.value,l=a/2,r=a/4;if("horizontal"===s){let s=[(e[0]+t[0])/2,e[1]];n.zenModeEnabled||py(an(e[0],e[1]-a),an(e[0],e[1]+a),i),py(an(s[0]-r,s[1]-l),an(s[0]-r,s[1]+l),i),py(an(s[0]+r,s[1]-l),an(s[0]+r,s[1]+l),i),n.zenModeEnabled||(py(an(t[0],t[1]-a),an(t[0],t[1]+a),i),py(e,t,i))}else{let s=[e[0],(e[1]+t[1])/2];n.zenModeEnabled||py(an(e[0]-a,e[1]),an(e[0]+a,e[1]),i),py(an(s[0]-l,s[1]-r),an(s[0]+l,s[1]-r),i),py(an(s[0]-l,s[1]+r),an(s[0]+l,s[1]+r),i),n.zenModeEnabled||(py(an(t[0]-a,t[1]),an(t[0]+a,t[1]),i),py(e,t,i))}},my=(e,t,s)=>{t.fillStyle="rgba(105, 101, 219, 0.4)",lc(t,e[0],e[1],ze.POINT_HANDLE_SIZE/s.zoom.value,!1)},uy=(e,t,s,n,i,a,l,r,o=!1,d=0)=>{e.save(),e.translate(a,l),e.rotate(r),o&&e.fillRect(t-a,s-l,n,i),d&&e.roundRect?(e.beginPath(),e.roundRect(t-a,s-l,n,i,d),e.stroke(),e.closePath()):e.strokeRect(t-a,s-l,n,i),e.restore()},gy=(e,t,s,n,i,a=!1)=>{e.strokeStyle="#5e5ad8",e.setLineDash([]),e.fillStyle="rgba(255, 255, 255, 0.9)",i?e.fillStyle="rgba(134, 131, 226, 0.9)":a&&(e.fillStyle="rgba(177, 151, 252, 0.7)"),lc(e,s[0],s[1],n/t.zoom.value,!a)},xy=(e,t,s,n)=>{let[i,a,l,r]=mt(t,s),o=l-i,d=r-a;e.strokeStyle="rgba(0,0,0,.05)";let c=n.value<1?n.value:1;e.lineWidth=gc/c;let p=e.lineWidth/2+xc,h=me(Math.min(t.width,t.height),t);switch(t.type){case"rectangle":case"text":case"image":case"iframe":case"embeddable":case"frame":case"magicframe":uy(e,i-p,a-p,o+2*p,d+2*p,i+o/2,a+d/2,t.angle,void 0,h);break;case"diamond":let s=Math.hypot(o,d);((e,t,s,n,i,a)=>{e.save(),e.translate(n,i),e.rotate(a),e.beginPath(),e.moveTo(0,s/2),e.lineTo(t/2,0),e.lineTo(0,-s/2),e.lineTo(-t/2,0),e.closePath(),e.stroke(),e.restore()})(e,o+2*(p*s/d),d+2*(p*s/o),i+o/2,a+d/2,t.angle);break;case"ellipse":((e,t,s,n,i,a)=>{e.beginPath(),e.ellipse(n,i,t/2,s/2,a,0,2*Math.PI),e.stroke()})(e,o+2*p,d+2*p,i+o/2,a+d/2,t.angle)}},fy=(e,t,s,n)=>{let[i,a,l]=t,r=fc(l,l.width,l.height,n);e.strokeStyle="rgba(0,0,0,0)",e.fillStyle="rgba(0,0,0,.05)",("both"===a?[0,-1]:"start"===a?[0]:[-1]).forEach((t=>{let[n,a]=ze.getPointAtIndexGlobalCoordinates(i,t,s);lc(e,n,a,r)}))},by=(e,t,s)=>{let{angle:n,x1:i,y1:a,x2:l,y2:r,selectionColors:o,cx:d,cy:c,dashed:p,activeEmbeddable:h}=s,m=l-i,u=r-a,g=(s.padding??2*Td)/t.zoom.value,x=8/t.zoom.value,f=4/t.zoom.value;e.save(),e.translate(t.scrollX,t.scrollY),e.lineWidth=(h?4:1)/t.zoom.value;let b=o.length;for(let t=0;t<b;++t)e.strokeStyle=o[t],p&&e.setLineDash([x,f+(x+f)*(b-1)]),e.lineDashOffset=(x+f)*t,uy(e,i-g,a-g,m+2*g,u+2*g,d,c,n);e.restore()},Ey=(e,t,s)=>{let n=s.filter((e=>0===e.groupIds.length)),i=s.filter((e=>e.groupIds.length>0)),a=e=>{let[t,s,n,i]=xt(e);return{angle:0,x1:t,x2:n,y1:s,y2:i,selectionColors:["rgb(0,118,255)"],dashed:!1,cx:t+(n-t)/2,cy:s+(i-s)/2,activeEmbeddable:!1}};Object.entries(rc(i,t)).filter((([e,t])=>t)).map((([e,t])=>e)).map((e=>(e=>{let t=Gt(s,e);return a(t)})(e))).concat(n.map((e=>a([e])))).forEach((s=>by(e,t,s)))},yy=(e,t,s,n)=>{if(!t.selectedLinearElement)return;e.save(),e.translate(t.scrollX,t.scrollY),e.lineWidth=1/t.zoom.value;let i=ze.getPointsGlobalCoordinates(s,n),{POINT_HANDLE_SIZE:a}=ze,l=t.editingLinearElement?a:a/2;if(i.forEach(((n,a)=>{if(V(s)&&0!==a&&a!==i.length-1)return;let r=!!t.editingLinearElement?.selectedPointsIndices?.includes(a);gy(e,t,n,l,r)})),V(s)){let n=s.fixedSegments?.map((e=>e.index))||[];i.slice(0,-1).forEach(((l,r)=>{ze.isSegmentTooShort(s,i[r+1],i[r],r,t.zoom)||gy(e,t,an((l[0]+i[r+1][0])/2,(l[1]+i[r+1][1])/2),a/2,!1,!n.includes(r+1))}))}else ze.getEditorMidPoints(s,n,t).filter(((e,t,n)=>null!==e&&!(V(s)&&(0===t||t===n.length-1)))).forEach((s=>{(t.editingLinearElement||2===i.length)&&gy(e,t,s,a/2,!1,!0)}));e.restore()},vy=(e,t,s,n,i)=>{Object.keys(n).forEach((a=>{let l=n[a];if(void 0!==l){let[n,r,o,d]=l;e.save(),e.lineWidth=1/s.zoom.value,t.selectionColor&&(e.strokeStyle=t.selectionColor),"rotation"===a?lc(e,n+o/2,r+d/2,o/2):e.roundRect?(e.beginPath(),e.roundRect(n,r,o,d,2/s.zoom.value),e.fill(),e.stroke()):uy(e,n,r,o,d,n+o/2,r+d/2,i,!0),e.restore()}}))},wy=({canvas:e,elementsMap:t,visibleElements:s,selectedElements:n,allElementsMap:i,scale:a,appState:l,renderConfig:r,device:o})=>{if(null===e)return{atLeastOneVisibleElement:!1,elementsMap:t};let d,[c,p]=wd(e,a),h=Sd({canvas:e,scale:a,normalizedWidth:c,normalizedHeight:p});if(h.save(),h.scale(l.zoom.value,l.zoom.value),s.forEach((e=>{l.editingLinearElement?.elementId===e.id&&e&&(d=e)})),d&&yy(h,l,d,t),l.selectionElement&&!l.isCropping)try{Cd(l.selectionElement,h,l,r.selectionColor)}catch(e){console.error(e)}if(l.editingTextElement&&tt(l.editingTextElement)){let e=i.get(l.editingTextElement.id);e&&!e.autoResize&&((e,t,s,n)=>{t.save();let i=2*Td/s.zoom.value,a=e.width+2*i,l=e.height+2*i,r=e.x+a/2,o=e.y+l/2,d=-(a/2+i),c=-(l/2+i);t.translate(r+s.scrollX,o+s.scrollY),t.rotate(e.angle),t.lineWidth=1/s.zoom.value,t.strokeStyle=n,t.strokeRect(d,c,a,l),t.restore()})(e,h,l,r.selectionColor)}l.isBindingEnabled&&l.suggestedBindings.filter((e=>null!=e)).forEach((e=>{((e,t,s,n)=>{let i=Array.isArray(s)?fy:xy;e.save(),e.translate(t.scrollX,t.scrollY),i(e,s,n,t.zoom),e.restore()})(h,l,e,t)})),l.frameToHighlight&&((e,t,s,n)=>{let[i,a,l,r]=mt(s,n),o=l-i,d=r-a;e.strokeStyle="rgb(0,118,255)",e.lineWidth=za.strokeWidth/t.zoom.value,e.save(),e.translate(t.scrollX,t.scrollY),uy(e,i,a,o,d,i+o/2,a+d/2,s.angle,!1,za.radius/t.zoom.value),e.restore()})(h,l,l.frameToHighlight,t),l.elementsToHighlight&&Ey(h,l,l.elementsToHighlight);let m,u=n.some((e=>it(e)));if(1===n.length&&l.editingLinearElement?.elementId===n[0].id&&yy(h,l,n[0],t),V(n[0])&&l.selectedLinearElement&&l.selectedLinearElement.segmentMidPointHoveredCoords?((e,t)=>{ia(t.selectedLinearElement,"selectedLinearElement is null");let{segmentMidPointHoveredCoords:s}=t.selectedLinearElement;ia(s,"midPointCoords is null"),e.save(),e.translate(t.scrollX,t.scrollY),my(s,e,t),e.restore()})(h,l):l.selectedLinearElement&&l.selectedLinearElement.hoverPointIndex>=0&&!(V(n[0])&&l.selectedLinearElement.hoverPointIndex>0&&l.selectedLinearElement.hoverPointIndex<n[0].points.length-1)&&((e,t,s)=>{let{elementId:n,hoverPointIndex:i}=t.selectedLinearElement;if(t.editingLinearElement?.selectedPointsIndices?.includes(i))return;let a=ze.getElement(n,s);if(!a)return;let l=ze.getPointAtIndexGlobalCoordinates(a,i,s);e.save(),e.translate(t.scrollX,t.scrollY),my(l,e,t),e.restore()})(h,l,t),!l.multiElement&&!l.editingLinearElement){let e=rt(n,l),s=1===n.length&&zt(n[0]);s&&l.selectedLinearElement?.elementId===n[0].id&&!n[0].locked&&yy(h,l,n[0],t);let i=r.selectionColor||ip.black;if(e){let e=Ht(n),a=[];for(let n of t.values()){let o=[],d=r.remoteSelectedElementIds.get(n.id);if(s&&V(n)&&(n.startBinding||n.endBinding)||(e.has(n.id)&&!Ar(l,n)&&o.push(i),d&&o.push(...d.map((e=>hu(e,l.collaborators.get(e)))))),o.length){let[e,s,i,r,c,p]=mt(n,t,!0);a.push({angle:n.angle,x1:e,y1:s,x2:i,y2:r,selectionColors:o,dashed:!!d,cx:c,cy:p,activeEmbeddable:l.activeEmbeddable?.element===n&&"active"===l.activeEmbeddable.state,padding:n.id===l.croppingElementId||B(n)?0:void 0})}}let o=e=>{let s=Gt(t,e),[n,i,l,r]=xt(s);a.push({angle:0,x1:n,x2:l,y1:i,y2:r,selectionColors:[ip.black],dashed:!0,cx:n+(l-n)/2,cy:i+(r-i)/2,activeEmbeddable:!1})};for(let e of jn(l))o(e);l.editingGroupId&&o(l.editingGroupId),a.forEach((e=>by(h,l,e)))}if(h.save(),h.translate(l.scrollX,l.scrollY),1===n.length){h.fillStyle=ip.white;let s=Id(n[0],l.zoom,t,"mouse",kd(o));if(!l.viewModeEnabled&&e&&!tt(l.editingTextElement)&&!l.croppingElementId&&vy(h,r,l,s,n[0].angle),l.croppingElementId&&!l.isCropping){let e=t.get(l.croppingElementId);e&&B(e)&&((e,t,s,n,i)=>{let[a,l,,,r,o]=mt(n,i),d=3/s.zoom.value,c=d/2,p=r-a+d,h=o-l+d,m=Math.min(20/s.zoom.value,p),u=Math.min(20/s.zoom.value,h);e.save(),e.fillStyle=t.selectionColor,e.strokeStyle=t.selectionColor,e.lineWidth=d,[[[-p,-h],[0,c],[m,c],[c,0],[c,u]],[[p-c,-h],[c,c],[-m+c,c],[0,0],[0,u]],[[-p,h],[0,-c],[m,-c],[c,0],[c,-u]],[[p-c,h],[c,-c],[-m+c,-c],[0,0],[0,-u]]].forEach((t=>{let[[s,i],[a,l],[d,c],[p,h],[m,u]]=t;e.save(),e.translate(r,o),e.rotate(n.angle),e.beginPath(),e.moveTo(s+a,i+l),e.lineTo(s+d,i+c),e.stroke(),e.beginPath(),e.moveTo(s+p,i+h),e.lineTo(s+m,i+u),e.stroke(),e.restore()})),e.restore()})(h,r,l,e,t)}}else if(n.length>1&&!l.isRotating){let e=2*Td/l.zoom.value;h.fillStyle=ip.white;let[t,s,a,d]=xt(n),c=h.getLineDash();h.setLineDash([2/l.zoom.value]);let p=h.lineWidth;h.lineWidth=1/l.zoom.value,h.strokeStyle=i,uy(h,t-e,s-e,a-t+2*e,d-s+2*e,(t+a)/2,(s+d)/2,0),h.lineWidth=p,h.setLineDash(c);let m=Md([t,s,a,d,(t+a)/2,(s+d)/2],0,l.zoom,"mouse",u?{...kd(o),rotation:!0}:kd(o));n.some((e=>!e.locked))&&vy(h,r,l,m,0)}h.restore()}return l.searchMatches.forEach((({id:e,focus:s,matchedLines:n})=>{let i=t.get(e);if(i&&tt(i)){let[e,a,,,r,o]=mt(i,t,!0);h.save(),l.theme===X.LIGHT?h.fillStyle=s?"rgba(255, 124, 0, 0.4)":"rgba(255, 226, 0, 0.4)":h.fillStyle=s?"rgba(229, 82, 0, 0.4)":"rgba(99, 52, 0, 0.4)",h.translate(l.scrollX,l.scrollY),h.translate(r,o),h.rotate(i.angle),n.forEach((t=>{h.fillRect(e+t.offsetX-r,a+t.offsetY-o,t.width,t.height)})),h.restore()}})),((e,t)=>{if(!t.snapLines.length)return;let s=t.theme===X.LIGHT||t.zenModeEnabled?"#ff6b6b":"#ff0000",n=(t.zenModeEnabled?1.5:1)/t.zoom.value;e.save(),e.translate(t.scrollX,t.scrollY);for(let i of t.snapLines)"pointer"===i.type?(e.lineWidth=n,e.strokeStyle=s,dy(i,e,t)):"gap"===i.type?(e.lineWidth=n,e.strokeStyle=s,hy(i.points[0],i.points[1],i.direction,t,e)):"points"===i.type&&(e.lineWidth=n,e.strokeStyle=s,oy(i,e,t));e.restore()})(h,l),h.restore(),(({context:e,renderConfig:t,appState:s,normalizedWidth:n,normalizedHeight:i})=>{for(let[a,l]of t.remotePointerViewportCoords){let{x:r,y:o}=l,d=s.collaborators.get(a);r-=s.offsetLeft,o-=s.offsetTop;let c=11,p=14,h=r<0||r>n-c||o<0||o>i-p;r=Math.max(r,0),r=Math.min(r,n-c),o=Math.max(o,0),o=Math.min(o,i-p);let m=hu(a,d);e.save(),e.strokeStyle=m,e.fillStyle=m;let u=t.remotePointerUserStates.get(a),g=h||"idle"===u||"away"===u;g&&(e.globalAlpha=.3),"down"===t.remotePointerButton.get(a)&&(e.beginPath(),e.arc(r,o,15,0,2*Math.PI,!1),e.lineWidth=3,e.strokeStyle="#ffffff88",e.stroke(),e.closePath(),e.beginPath(),e.arc(r,o,15,0,2*Math.PI,!1),e.lineWidth=1,e.strokeStyle=m,e.stroke(),e.closePath());let x=s.theme===X.DARK?"#2f6330":$d,f=d?.isSpeaking;f&&(e.fillStyle=x,e.strokeStyle=x,e.lineWidth=10,e.lineJoin="round",e.beginPath(),e.moveTo(r,o),e.lineTo(r+0,o+14),e.lineTo(r+4,o+9),e.lineTo(r+11,o+8),e.closePath(),e.stroke(),e.fill()),e.fillStyle=Vd,e.strokeStyle=Vd,e.lineWidth=6,e.lineJoin="round",e.beginPath(),e.moveTo(r,o),e.lineTo(r+0,o+14),e.lineTo(r+4,o+9),e.lineTo(r+11,o+8),e.closePath(),e.stroke(),e.fill(),e.fillStyle=m,e.strokeStyle=m,e.lineWidth=2,e.lineJoin="round",e.beginPath(),g?(e.moveTo(r-1,o-1),e.lineTo(r-1,o+15),e.lineTo(r+5,o+10),e.lineTo(r+12,o+9),e.closePath(),e.fill()):(e.moveTo(r,o),e.lineTo(r+0,o+14),e.lineTo(r+4,o+9),e.lineTo(r+11,o+8),e.closePath(),e.fill(),e.stroke());let b=t.remotePointerUsernames.get(a)||"";if(!h&&b){e.font="600 12px sans-serif";let t=(f?r+0:r)+c/2,s=(f?o+0:o)+p+2,n=5,i=3,a=e.measureText(b),l=a.actualBoundingBoxDescent+a.actualBoundingBoxAscent,d=Math.max(l,12),h=t-1,u=s-1,g=a.width+2+2*n+2,E=d+2+2*i+2;if(e.roundRect?(e.beginPath(),e.roundRect(h,u,g,E,8),e.fillStyle=m,e.fill(),e.strokeStyle=Vd,e.stroke(),f&&(e.beginPath(),e.roundRect(h-2,u-2,g+4,E+4,8),e.strokeStyle=x,e.stroke())):pu(e,h,u,g,E,8,Vd),e.fillStyle=Wd,e.fillText(b,t+n+1,s+i+a.actualBoundingBoxAscent+Math.floor((d-l)/2)+2),f){e.fillStyle=x;let t=8,s=8,n=5;e.fillRect(h+g+s,u+(E/2-t/2),2,t),e.fillRect(h+g+s+n,u+(E/2-2*t/2),2,2*t),e.fillRect(h+g+s+2*n,u+(E/2-t/2),2,t)}}e.restore(),e.closePath()}})({context:h,renderConfig:r,appState:l,normalizedWidth:c,normalizedHeight:p}),r.renderScrollbars&&(m=((e,t,s,n)=>{if(!e.length)return{horizontal:null,vertical:null};let[i,a,l,r]=xt(e),o=t/n.zoom.value,d=s/n.zoom.value,c=t-o,p=s-d,h={top:parseInt(ec("sat"))||0,bottom:parseInt(ec("sab"))||0,left:parseInt(ec("sal"))||0,right:parseInt(ec("sar"))||0},m=Dp().rtl,u=-n.scrollX+c/2+h.left,g=-n.scrollY+p/2+h.top,x=u+o-h.right,f=g+d-h.bottom,b=Math.min(i,u),E=Math.min(a,g),y=Math.max(l,x),v=Math.max(r,f);return{horizontal:u===b&&x===y?null:{x:Math.max(h.left,4)+(u-b)/(y-b)*t,y:s-6-Math.max(4,h.bottom),width:(x-u)/(y-b)*t-Math.max(8,h.left+h.right),height:6},vertical:g===E&&f===v?null:{x:m?Math.max(h.left,4):t-6-Math.max(h.right,4),y:(g-E)/(v-E)*s+Math.max(h.top,4),width:6,height:(f-g)/(v-E)*s-Math.max(8,h.top+h.bottom)}}})(s,c,p,l),h.save(),h.fillStyle="rgba(0,0,0,0.3)",h.strokeStyle="rgba(255,255,255,0.8)",[m.horizontal,m.vertical].forEach((e=>{e&&pu(h,e.x,e.y,e.width,e.height,3)})),h.restore()),{scrollBars:m,atLeastOneVisibleElement:s.length>0,elementsMap:t}},Sy=Ia((e=>{let t=wy(e);e.callback?.(t)}),{trailing:!0}),Cy=e=>({zoom:e.zoom,scrollX:e.scrollX,scrollY:e.scrollY,width:e.width,height:e.height,viewModeEnabled:e.viewModeEnabled,openDialog:e.openDialog,editingGroupId:e.editingGroupId,editingLinearElement:e.editingLinearElement,selectedElementIds:e.selectedElementIds,frameToHighlight:e.frameToHighlight,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,theme:e.theme,pendingImageElementId:e.pendingImageElementId,selectionElement:e.selectionElement,selectedGroupIds:e.selectedGroupIds,selectedLinearElement:e.selectedLinearElement,multiElement:e.multiElement,isBindingEnabled:e.isBindingEnabled,suggestedBindings:e.suggestedBindings,isRotating:e.isRotating,elementsToHighlight:e.elementsToHighlight,collaborators:e.collaborators,activeEmbeddable:e.activeEmbeddable,snapLines:e.snapLines,zenModeEnabled:e.zenModeEnabled,editingTextElement:e.editingTextElement,isCropping:e.isCropping,croppingElementId:e.croppingElementId,searchMatches:e.searchMatches}),Iy=Tc.memo((e=>{let t=jc(!1);return Dc((()=>{if(!t.current)return void(t.current=!0);let s=new Map,n=new Map,i=new Map,a=new Map,l=new Map;e.appState.collaborators.forEach(((t,r)=>{if(t.selectedElementIds)for(let e of Object.keys(t.selectedElementIds))i.has(e)||i.set(e,[]),i.get(e).push(r);!t.pointer||!1===t.pointer.renderCursor||(t.username&&a.set(r,t.username),t.userState&&l.set(r,t.userState),n.set(r,ie({sceneX:t.pointer.x,sceneY:t.pointer.y},e.appState)),s.set(r,t.button))}));let r=e.containerRef?.current&&getComputedStyle(e.containerRef.current).getPropertyValue("--color-selection")||"#6965db";((e,t)=>{if(t)return void Sy(e);let s=wy(e);e.callback(s)})({canvas:e.canvas,elementsMap:e.elementsMap,visibleElements:e.visibleElements,selectedElements:e.selectedElements,allElementsMap:e.allElementsMap,scale:window.devicePixelRatio,appState:e.appState,renderConfig:{remotePointerViewportCoords:n,remotePointerButton:s,remoteSelectedElementIds:i,remotePointerUsernames:a,remotePointerUserStates:l,selectionColor:r,renderScrollbars:!1},device:e.device,callback:e.renderInteractiveSceneCallback},ry())})),gp.exports.jsx("canvas",{className:"excalidraw__canvas interactive",style:{width:e.appState.width,height:e.appState.height,cursor:e.appState.viewModeEnabled?en.GRAB:en.AUTO},width:e.appState.width*e.scale,height:e.appState.height*e.scale,ref:e.handleCanvasRef,onContextMenu:e.onContextMenu,onPointerMove:e.onPointerMove,onPointerUp:e.onPointerUp,onPointerCancel:e.onPointerCancel,onTouchMove:e.onTouchMove,onPointerDown:e.onPointerDown,onDoubleClick:e.appState.viewModeEnabled?void 0:e.onDoubleClick,children:Np("labels.drawingCanvas")})}),((e,t)=>e.selectionNonce===t.selectionNonce&&e.sceneNonce===t.sceneNonce&&e.scale===t.scale&&e.elementsMap===t.elementsMap&&e.visibleElements===t.visibleElements&&e.selectedElements===t.selectedElements&&R(Cy(e.appState),Cy(t.appState)))),ky=e=>({zoom:e.zoom,scrollX:e.scrollX,scrollY:e.scrollY,width:e.width,height:e.height,viewModeEnabled:e.viewModeEnabled,openDialog:e.openDialog,hoveredElementIds:e.hoveredElementIds,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,theme:e.theme,pendingImageElementId:e.pendingImageElementId,shouldCacheIgnoreZoom:e.shouldCacheIgnoreZoom,viewBackgroundColor:e.viewBackgroundColor,exportScale:e.exportScale,selectedElementsAreBeingDragged:e.selectedElementsAreBeingDragged,gridSize:e.gridSize,gridStep:e.gridStep,frameRendering:e.frameRendering,selectedElementIds:e.selectedElementIds,frameToHighlight:e.frameToHighlight,editingGroupId:e.editingGroupId,currentHoveredFontFamily:e.currentHoveredFontFamily,croppingElementId:e.croppingElementId}),Ty=Tc.memo((e=>{let t=jc(null),s=jc(!1);return Dc((()=>{let n=t.current;if(!n)return;let i=e.canvas;s.current||(s.current=!0,n.replaceChildren(i),i.classList.add("excalidraw__canvas","static"));let a=`${e.appState.width}px`,l=`${e.appState.height}px`;i.style.width!==a&&(i.style.width=a),i.style.height!==l&&(i.style.height=l);let r=e.appState.width*e.scale,o=e.appState.height*e.scale;i.width!==r&&(i.width=r),i.height!==o&&(i.height=o),ka({canvas:i,rc:e.rc,scale:e.scale,elementsMap:e.elementsMap,allElementsMap:e.allElementsMap,visibleElements:e.visibleElements,appState:e.appState,renderConfig:e.renderConfig},ry())})),gp.exports.jsx("div",{className:"excalidraw__canvas-wrapper",ref:t})}),((e,t)=>e.sceneNonce===t.sceneNonce&&e.scale===t.scale&&e.elementsMap===t.elementsMap&&e.visibleElements===t.visibleElements&&(R(ky(e.appState),ky(t.appState))&&R(e.renderConfig,t.renderConfig)))),My=class{constructor(e){Cc(this,"scene"),Cc(this,"getRenderableElements",(()=>Ta((({zoom:e,offsetLeft:t,offsetTop:s,scrollX:n,scrollY:i,height:a,width:l,editingTextElement:r,newElementId:o,pendingImageElementId:d,sceneNonce:c})=>{let p=(({elements:e,editingTextElement:t,newElementId:s,pendingImageElementId:n})=>{let i=Co(new Map);for(let a of e)B(a)&&n===a.id||s!==a.id&&(!t||"text"!==t.type||a.id!==t.id)&&i.set(a.id,a);return i})({elements:this.scene.getNonDeletedElements(),editingTextElement:r,newElementId:o,pendingImageElementId:d}),h=(({elementsMap:e,zoom:t,offsetLeft:s,offsetTop:n,scrollX:i,scrollY:a,height:l,width:r})=>{let o=[];for(let d of e.values())ae(d,r,l,{zoom:t,offsetLeft:s,offsetTop:n,scrollX:i,scrollY:a},e)&&o.push(d);return o})({elementsMap:p,zoom:e,offsetLeft:t,offsetTop:s,scrollX:n,scrollY:i,height:a,width:l});return{elementsMap:p,visibleElements:h}})))()),this.scene=e}destroy(){Sy.cancel(),Ma.cancel(),this.getRenderableElements.clear()}},jy=({trails:e})=>{let t=jc(null);return Dc((()=>{if(t.current)for(let s of e)s.start(t.current);return()=>{for(let t of e)t.stop()}}),e),gp.exports.jsx("div",{className:"SVGLayer",children:gp.exports.jsx("svg",{ref:t})})},Dy=({children:e,element:t,elementsMap:s})=>{let n=sv();if(n.contextMenu||n.newElement||n.resizingElement||n.isRotating||n.openMenu||n.viewModeEnabled)return null;let{x:i,y:a}=((e,t,s)=>{let[n,i]=mt(e,s),{x:a,y:l}=ie({sceneX:n+e.width,sceneY:i},t);return{x:a-t.offsetLeft+10,y:l-t.offsetTop}})(t,n,s);return gp.exports.jsx("div",{className:"excalidraw-canvas-buttons",style:{top:`${a}px`,left:`${i}px`,padding:5},children:e})},Ly=e=>gp.exports.jsxs("label",{className:Vc("ToolIcon ToolIcon__MagicButton","ToolIcon_size_small",{"is-mobile":e.isMobile}),title:`${e.title}`,children:[gp.exports.jsx("input",{className:"ToolIcon_type_checkbox",type:"checkbox",name:e.name,onChange:e.onChange,checked:e.checked,"aria-label":e.title}),gp.exports.jsx("div",{className:"ToolIcon__icon",children:e.icon})]}),Ny=({height:e,width:t,userToFollow:s,onDisconnect:n})=>gp.exports.jsx("div",{className:"follow-mode",style:{width:t,height:e},children:gp.exports.jsxs("div",{className:"follow-mode__badge",children:[gp.exports.jsxs("div",{className:"follow-mode__badge__label",children:["Following"," ",gp.exports.jsx("span",{className:"follow-mode__badge__username",title:s.username,children:s.username})]}),gp.exports.jsx("button",{type:"button",onClick:n,className:"follow-mode__disconnect-btn",children:H})]})}),Ay=class{constructor(){Cc(this,"targets",new WeakMap),Cc(this,"rafIds",new WeakMap)}register(e,t){this.targets.set(e,{callback:t,stopped:!0})}start(e){let t=this.targets.get(e);t&&(this.rafIds.has(e)||(this.targets.set(e,{...t,stopped:!1}),this.scheduleFrame(e)))}stop(e){let t=this.targets.get(e);t&&!t.stopped&&this.targets.set(e,{...t,stopped:!0}),this.cancelFrame(e)}constructFrame(e){return t=>{let s=this.targets.get(e);if(!s)return;let n=this.onFrame(s,t);s.stopped||n?this.cancelFrame(e):this.scheduleFrame(e)}}scheduleFrame(e){let t=requestAnimationFrame(this.constructFrame(e));this.rafIds.set(e,t)}cancelFrame(e){if(this.rafIds.has(e)){let t=this.rafIds.get(e);cancelAnimationFrame(t)}this.rafIds.delete(e)}onFrame(e,t){return e.callback(t)??!1}},_y=class{constructor(e,t,s){this.animationFrameHandler=e,this.app=t,this.options=s,Cc(this,"currentTrail"),Cc(this,"pastTrails",[]),Cc(this,"container"),Cc(this,"trailElement"),this.animationFrameHandler.register(this,this.onFrame.bind(this)),this.trailElement=document.createElementNS(ja,"path")}get hasCurrentTrail(){return!!this.currentTrail}hasLastPoint(e,t){if(this.currentTrail){let s=this.currentTrail.originalPoints.length;return this.currentTrail.originalPoints[s-1][0]===e&&this.currentTrail.originalPoints[s-1][1]===t}return!1}start(e){e&&(this.container=e),this.trailElement.parentNode!==this.container&&this.container&&this.container.appendChild(this.trailElement),this.animationFrameHandler.start(this)}stop(){this.animationFrameHandler.stop(this),this.trailElement.parentNode===this.container&&this.container?.removeChild(this.trailElement)}startPath(e,t){this.currentTrail=new mp(this.options),this.currentTrail.addPoint([e,t,performance.now()]),this.update()}addPointToPath(e,t){this.currentTrail&&(this.currentTrail.addPoint([e,t,performance.now()]),this.update())}endPath(){this.currentTrail&&(this.currentTrail.close(),this.currentTrail.options.keepHead=!1,this.pastTrails.push(this.currentTrail),this.currentTrail=void 0,this.update())}update(){this.start()}onFrame(){let e=[];for(let t of this.pastTrails)e.push(this.drawTrail(t,this.app.state));if(this.currentTrail){let t=this.drawTrail(this.currentTrail,this.app.state);e.push(t)}this.pastTrails=this.pastTrails.filter((e=>0!==e.getStrokeOutline().length)),0===e.length&&this.stop();let t=e.join(" ").trim();this.trailElement.setAttribute("d",t),this.trailElement.setAttribute("fill",(this.options.fill??(()=>"black"))(this))}drawTrail(e,t){let s=e.getStrokeOutline(e.options.size/t.zoom.value).map((([e,s])=>{let n=ie({sceneX:e,sceneY:s},t);return[n.x,n.y]}));return Da(s,!0)}},Py=class{constructor(e,t){this.animationFrameHandler=e,this.app=t,Cc(this,"localTrail"),Cc(this,"collabTrails",new Map),Cc(this,"container"),this.animationFrameHandler.register(this,this.onFrame.bind(this)),this.localTrail=new _y(e,t,{...this.getTrailOptions(),fill:()=>La})}getTrailOptions(){return{simplify:0,streamline:.4,sizeMapping:e=>{let t=Math.max(0,1-(performance.now()-e.pressure)/1e3),s=(50-Math.min(50,e.totalLength-e.currentIndex))/50;return Math.min(Z(s),Z(t))}}}startPath(e,t){this.localTrail.startPath(e,t)}addPointToPath(e,t){this.localTrail.addPointToPath(e,t)}endPath(){this.localTrail.endPath()}start(e){this.container=e,this.animationFrameHandler.start(this),this.localTrail.start(e)}stop(){this.animationFrameHandler.stop(this),this.localTrail.stop()}onFrame(){this.updateCollabTrails()}updateCollabTrails(){if(this.container&&0!==this.app.state.collaborators.size){for(let[e,t]of this.app.state.collaborators.entries()){let s;this.collabTrails.has(e)?s=this.collabTrails.get(e):(s=new _y(this.animationFrameHandler,this.app,{...this.getTrailOptions(),fill:()=>t.pointer?.laserColor||hu(e,t)}),s.start(this.container),this.collabTrails.set(e,s)),t.pointer&&"laser"===t.pointer.tool&&("down"===t.button&&!s.hasCurrentTrail&&s.startPath(t.pointer.x,t.pointer.y),"down"===t.button&&s.hasCurrentTrail&&!s.hasLastPoint(t.pointer.x,t.pointer.y)&&s.addPointToPath(t.pointer.x,t.pointer.y),"up"===t.button&&s.hasCurrentTrail&&(s.addPointToPath(t.pointer.x,t.pointer.y),s.endPath()))}for(let e of this.collabTrails.keys())this.app.state.collaborators.has(e)||(this.collabTrails.get(e).stop(),this.collabTrails.delete(e))}}},Ry=(e,t,s,n,i,a)=>{let{zoom:l}=n,r=180*s/Math.PI,o=e*(l.value-1)/2,d=t*(l.value-1)/2;return e>i&&1!==l.value&&(o=i*(l.value-1)/2),t>a&&1!==l.value&&(d=a*(l.value-1)/2),`translate(${o}px, ${d}px) scale(${l.value}) rotate(${r}deg)`},Oy=({id:e,onChange:t,onSubmit:s,getViewportCoords:n,element:i,canvas:a,excalidrawContainer:l,app:r,autoSelect:o=!0})=>{let d=()=>{let t=r.state,s=Q.getScene(i)?.getElement(e);if(!s)return;let{textAlign:a,verticalAlign:l}=s,o=r.scene.getNonDeletedElementsMap();if(s&&tt(s)){let e=s.x,i=s.y,d=Xt(s,r.scene.getNonDeletedElementsMap()),p=s.width,h=s.height,m=s.width,u=s.height;if(d&&s.containerId){if(ut(d)){let t=ze.getBoundTextElementPosition(d,s,o);e=t.x,i=t.y}let t,n=((e,t)=>{if(!t.style.fontFamily||!t.style.fontSize)return!1;let s=t.style.fontFamily.replace(/"/g,"");return ts({fontFamily:e.fontFamily})!==s||`${e.fontSize}px`!==t.style.fontSize})(s,c);if(n?t=Ii(d.id,d.height):(t=Po[d.id],t||(t=Ii(d.id,d.height))),m=Aa(d,s),u=Ro(d,s),!ut(d)&&h>u){let e=Mi(h,d.type);return void He(d,{height:e})}if(!ut(d)&&d.height>t.height&&h<u){let e=Mi(h,d.type);He(d,{height:e})}else{let{y:e}=Si(d,s,o);i=e}}let[g,x]=n(e,i),f=c.selectionStart,b=c.selectionEnd,E=c.value.length;if(f===b&&b!==E){let e=E-b;c.selectionStart=c.value.length-e,c.selectionEnd=c.value.length-e}d?p+=.5:(m=(t.width-8-g)/t.zoom.value,p=Math.min(p,m)),h*=1.05;let y=We(s),v=(t.height-x)/t.zoom.value;Object.assign(c.style,{font:y,lineHeight:s.lineHeight,width:`${p}px`,height:`${h}px`,left:`${g}px`,top:`${x}px`,transform:Ry(p,h,Oo(s,d),t,m,v),textAlign:a,verticalAlign:l,color:s.strokeColor,opacity:s.opacity/100,filter:"var(--theme-filter)",maxHeight:`${v}px`}),c.scrollTop=0,Ie()&&(c.style.fontFamily=ts(s)),He(s,{x:e,y:i})}},c=document.createElement("textarea");c.dir="auto",c.tabIndex=0,c.dataset.type="wysiwyg",c.wrap="off",c.classList.add("excalidraw-wysiwyg");let p="pre",h="normal";(Zt(i)||!i.autoResize)&&(p="pre-wrap",h="break-word"),Object.assign(c.style,{position:"absolute",display:"inline-block",minHeight:"1em",backfaceVisibility:"hidden",margin:0,padding:0,border:0,outline:0,resize:"none",background:"transparent",overflow:"hidden",zIndex:"var(--zIndex-wysiwyg)",wordBreak:h,whiteSpace:p,overflowWrap:"break-word",boxSizing:"content-box"}),c.value=i.originalText,d(),t&&(c.onpaste=async e=>{let t=await Na(e,!0);if(!t.text)return;let s=Xe(t.text);if(!s)return;let n=Xt(i,r.scene.getNonDeletedElementsMap()),a=We({fontSize:r.state.currentItemFontSize,fontFamily:r.state.currentItemFontFamily});if(n){let e=Kt(n,r.scene.getNonDeletedElementsMap()),t=Qe(`${c.value}${s}`,a,Aa(n,e)),i=_a(t,a);c.style.width=`${i}px`}},c.oninput=()=>{let e=Xe(c.value);if(c.value!==e){let t=c.selectionStart;c.value=e,c.selectionStart=t,c.selectionEnd=t}t(c.value)}),c.onkeydown=e=>{if(!e.shiftKey&&Rm.keyTest(e))e.preventDefault(),r.actionManager.executeAction(Rm),d();else if(!e.shiftKey&&Om.keyTest(e))e.preventDefault(),r.actionManager.executeAction(Om),d();else if(!e.shiftKey&&Fm.keyTest(e))e.preventDefault(),r.actionManager.executeAction(Fm),d();else if(Mm.keyTest(e))r.actionManager.executeAction(Mm);else if(jm.keyTest(e))r.actionManager.executeAction(jm);else if(e.key===j.ESCAPE)e.preventDefault(),E=!0,y();else if(e.key===j.ENTER&&e[j.CTRL_OR_CMD]){if(e.preventDefault(),e.isComposing||229===e.keyCode)return;E=!0,y()}else if(e.key===j.TAB||e[j.CTRL_OR_CMD]&&(e.code===Pt.BRACKET_LEFT||e.code===Pt.BRACKET_RIGHT)){if(e.preventDefault(),e.isComposing)return;e.shiftKey||e.code===Pt.BRACKET_LEFT?x():g(),c.dispatchEvent(new Event("input"))}};let m=" ".repeat(4),u=new RegExp("^ {1,4}"),g=()=>{let{selectionStart:e,selectionEnd:t}=c,s=f(),n=c.value;s.forEach((e=>{let t=n.slice(0,e),s=n.slice(e);n=`${t}${m}${s}`})),c.value=n,c.selectionStart=e+4,c.selectionEnd=t+4*s.length},x=()=>{let{selectionStart:e,selectionEnd:t}=c,s=f(),n=[],i=c.value;s.forEach((e=>{let t=i.slice(e,e+4).match(u);if(t){let s=i.slice(0,e),a=i.slice(e+t[0].length);i=`${s}${a}`,n.push(e)}})),c.value=i,n.length&&(e>n[n.length-1]?c.selectionStart=Math.max(e-4,n[n.length-1]):c.selectionStart=e,c.selectionEnd=Math.max(c.selectionStart,t-4*n.length))},f=()=>{let{selectionStart:e,selectionEnd:t,value:s}=c,n=s.slice(0,e).match(/[^\n]*$/)[0].length;return e-=n,s.slice(e,t).split("\n").reduce(((t,s,n,i)=>t.concat(n?t[n-1]+i[n-1].length+1:e)),[]).reverse()},b=e=>{e.target instanceof HTMLCanvasElement&&(e.preventDefault(),e.stopPropagation())},E=!1,y=()=>{if(T)return;T=!0,v();let e=Q.getScene(i)?.getElement(i.id);if(!e)return;let t=Xt(e,r.scene.getNonDeletedElementsMap());if(t){if(c.value.trim()){let e=Pa(t);e&&e===i.id?ut(t)&&Ra(t):He(t,{boundElements:(t.boundElements||[]).concat({type:"text",id:i.id})})}else He(t,{boundElements:t.boundElements?.filter((e=>!tt(e)))});Is(e,t,r.scene.getNonDeletedElementsMap())}s({viaKeyboard:E,nextOriginalText:c.value})},v=()=>{c.onblur=null,c.oninput=null,c.onkeydown=null,M&&M.disconnect(),window.removeEventListener("resize",d),window.removeEventListener("wheel",b,!0),window.removeEventListener("pointerdown",C),window.removeEventListener("pointerup",w),window.removeEventListener("blur",y),window.removeEventListener("beforeunload",y),I(),k(),c.remove()},w=e=>{window.removeEventListener("pointerup",w);let t=e?.target,s=t instanceof HTMLElement&&t.classList.contains("properties-trigger");setTimeout((()=>{c.onblur=y,s||c.focus()}))},S=()=>{c.onblur=null,window.addEventListener("pointerup",w),window.addEventListener("blur",y)},C=e=>{let t=e?.target;if(e.button===Oa.WHEEL)return t instanceof HTMLTextAreaElement&&(e.preventDefault(),r.handleCanvasPanUsingWheelOrSpaceDrag(e)),void S();let s=t instanceof HTMLElement&&t.classList.contains("properties-trigger");(e.target instanceof HTMLElement||e.target instanceof SVGElement)&&e.target.closest(`.${qi.SHAPE_ACTIONS_MENU}, .${qi.ZOOM_ACTIONS}`)&&!Ki(e.target)||s?S():e.target instanceof HTMLCanvasElement&&!Ie()&&requestAnimationFrame((()=>{y()}))},I=r.scene.onUpdate((()=>{d(),document.activeElement?.closest(".properties-content")||c.focus()})),k=r.onScrollChangeEmitter.on((()=>{d()})),T=!1;o&&c.select(),w();let M=null;a&&"ResizeObserver"in window?(M=new window.ResizeObserver((()=>{d()})),M.observe(a)):window.addEventListener("resize",d),c.onpointerdown=e=>e.stopPropagation(),requestAnimationFrame((()=>{window.addEventListener("pointerdown",C,{capture:!0})})),window.addEventListener("beforeunload",y),l?.querySelector(".excalidraw-textEditorContainer").appendChild(c)},Fy=e({name:"autoResize",label:"labels.autoResize",icon:null,trackEvent:{category:"element"},predicate:(e,t,s,n)=>{let i=S(e,t);return 1===i.length&&tt(i[0])&&!i[0].autoResize},perform:(e,t,s,n)=>{let i=S(e,t);return{appState:t,elements:e.map((e=>{if(e.id===i[0].id&&tt(e)){let t=qe(e.originalText,We(e),e.lineHeight);return Dt(e,{autoResize:!0,width:t.width,height:t.height,text:e.originalText})}return e})),captureUpdate:Lt.IMMEDIATELY}}}),By=({canvas:e,rc:t,newElement:s,elementsMap:n,allElementsMap:i,scale:a,appState:l,renderConfig:r})=>{if(e){let[o,d]=wd(e,a),c=Sd({canvas:e,scale:a,normalizedWidth:o,normalizedHeight:d});c.save(),c.scale(l.zoom.value,l.zoom.value),s&&"selection"!==s.type?oc(s,n,i,t,c,r,l):c.clearRect(0,0,o,d)}},zy=Ia((e=>{By(e)}),{trailing:!0}),Uy=e=>{let t=jc(null);return Dc((()=>{t.current&&((e,t)=>{t?zy(e):By(e)})({canvas:t.current,scale:e.scale,newElement:e.appState.newElement,elementsMap:e.elementsMap,allElementsMap:e.allElementsMap,rc:e.rc,renderConfig:e.renderConfig,appState:e.appState},ry())})),gp.exports.jsx("canvas",{className:"excalidraw__canvas",style:{width:e.appState.width,height:e.appState.height},width:e.appState.width*e.scale,height:e.appState.height*e.scale,ref:t})},Hy=Tc.createContext(null),Yy=Tc.createContext(null),Gy={viewport:{isMobile:!1,isLandscape:!1},editor:{isMobile:!1,canFitSidebar:!1},isTouchScreen:!1},$y=Tc.createContext(Gy);$y.displayName="DeviceContext";var Vy=Tc.createContext({container:null,id:null});Vy.displayName="ExcalidrawContainerContext";var Wy=Tc.createContext([]);Wy.displayName="ExcalidrawElementsContext";var Ky=Tc.createContext({...K(),width:0,height:0,offsetLeft:0,offsetTop:0});Ky.displayName="ExcalidrawAppStateContext";var Zy=Tc.createContext((()=>{console.warn("Uninitialized ExcalidrawSetAppStateContext context!")}));Zy.displayName="ExcalidrawSetAppStateContext";var Xy=Tc.createContext(null);Xy.displayName="ExcalidrawActionManagerContext";var qy=()=>Bc(Hy),Qy=()=>Bc(Yy),Jy=()=>Bc($y),ev=()=>Bc(Vy),tv=()=>Bc(Wy),sv=()=>Bc(Ky),nv=()=>Bc(Zy),iv=()=>Bc(Xy),av=!1,lv=0,rv=!1,ov=!1,dv=!1,cv={horizontal:null,vertical:null},pv=0,hv=!1,mv=new Map,uv=!1,gv=0,xv=!1,fv=null,bv={pointers:new Map,lastCenter:null,initialDistance:null,initialScale:null},Ev=class e extends Tc.Component{constructor(t){super(t),Cc(this,"canvas"),Cc(this,"interactiveCanvas",null),Cc(this,"rc"),Cc(this,"unmounted",!1),Cc(this,"actionManager"),Cc(this,"device",Gy),Cc(this,"excalidrawContainerRef",Tc.createRef()),Cc(this,"scene"),Cc(this,"fonts"),Cc(this,"renderer"),Cc(this,"visibleElements"),Cc(this,"resizeObserver"),Cc(this,"nearestScrollableContainer"),Cc(this,"library"),Cc(this,"libraryItemsFromStorage"),Cc(this,"id"),Cc(this,"store"),Cc(this,"history"),Cc(this,"excalidrawContainerValue"),Cc(this,"files",{}),Cc(this,"imageCache",new Map),Cc(this,"iFrameRefs",new Map),Cc(this,"embedsValidationStatus",new Map),Cc(this,"initializedEmbeds",new Set),Cc(this,"elementsPendingErasure",new Set),Cc(this,"flowChartCreator",new yf),Cc(this,"flowChartNavigator",new Ef),Cc(this,"hitLinkElement"),Cc(this,"lastPointerDownEvent",null),Cc(this,"lastPointerUpEvent",null),Cc(this,"lastPointerMoveEvent",null),Cc(this,"lastPointerMoveCoords",null),Cc(this,"lastViewportPosition",{x:0,y:0}),Cc(this,"animationFrameHandler",new Ay),Cc(this,"laserTrails",new Py(this.animationFrameHandler,this)),Cc(this,"eraserTrail",new _y(this.animationFrameHandler,this,{streamline:.2,size:5,keepHead:!0,sizeMapping:e=>{let t=Math.max(0,1-(performance.now()-e.pressure)/200),s=(10-Math.min(10,e.totalLength-e.currentIndex))/10;return Math.min(Z(s),Z(t))},fill:()=>this.state.theme===X.LIGHT?"rgba(0, 0, 0, 0.2)":"rgba(255, 255, 255, 0.2)"})),Cc(this,"onChangeEmitter",new c),Cc(this,"onPointerDownEmitter",new c),Cc(this,"onPointerUpEmitter",new c),Cc(this,"onUserFollowEmitter",new c),Cc(this,"onScrollChangeEmitter",new c),Cc(this,"missingPointerEventCleanupEmitter",new c),Cc(this,"onRemoveEventListenersEmitter",new c),Cc(this,"getEffectiveGridSize",(()=>Ee(this)?this.state.gridSize:null)),Cc(this,"updateEmbedValidationStatus",((e,t)=>{this.embedsValidationStatus.set(e.id,t),Se.delete(e)})),Cc(this,"updateEmbeddables",(()=>{let e=new Set,t=!1;this.scene.getNonDeletedElements().filter((s=>{if(ne(s)){if(e.add(s.id),!this.embedsValidationStatus.has(s.id)){t=!0;let e=Di(s.link,this.props.validateEmbeddable);this.updateEmbedValidationStatus(s,e)}}else se(s)&&e.add(s.id);return!1})),t&&this.scene.triggerUpdate(),this.iFrameRefs.forEach(((t,s)=>{e.has(s)||this.iFrameRefs.delete(s)}))})),Cc(this,"getFrameNameDOMId",(e=>`${this.id}-frame-name-${e.id}`)),Cc(this,"frameNameBoundsCache",{get:e=>{let t=this.frameNameBoundsCache._cache.get(e.id);if(!t||t.zoom!==this.state.zoom.value||t.versionNonce!==e.versionNonce){let s=document.getElementById(this.getFrameNameDOMId(e));if(s){let n=s.getBoundingClientRect(),i=Ge({clientX:n.x,clientY:n.y},this.state),a=Ge({clientX:n.right,clientY:n.bottom},this.state);return t={x:i.x,y:i.y,width:a.x-i.x,height:a.y-i.y,angle:0,zoom:this.state.zoom.value,versionNonce:e.versionNonce},this.frameNameBoundsCache._cache.set(e.id,t),t}return null}return t},_cache:new Map}),Cc(this,"resetEditingFrame",(e=>{e&&He(e,{name:e.name?.trim()||null}),this.setState({editingFrame:null})})),Cc(this,"renderFrameNames",(()=>{if(!this.state.frameRendering.enabled||!this.state.frameRendering.name)return this.state.editingFrame&&this.resetEditingFrame(null),null;let e=this.state.theme===X.DARK;return this.scene.getNonDeletedFramesLikes().map((t=>{if(!ae(t,this.canvas.width/window.devicePixelRatio,this.canvas.height/window.devicePixelRatio,{offsetLeft:this.state.offsetLeft,offsetTop:this.state.offsetTop,scrollX:this.state.scrollX,scrollY:this.state.scrollY,zoom:this.state.zoom},this.scene.getNonDeletedElementsMap()))return this.state.editingFrame===t.id&&this.resetEditingFrame(t),null;let s,{x:n,y:i}=ie({sceneX:t.x,sceneY:t.y},this.state),a=Fa(t);if(t.id===this.state.editingFrame){let i=a;s=gp.exports.jsx("input",{autoFocus:!0,value:i,onChange:e=>{He(t,{name:e.target.value})},onFocus:e=>e.target.select(),onBlur:()=>this.resetEditingFrame(t),onKeyDown:e=>{(e.key===j.ESCAPE||e.key===j.ENTER)&&this.resetEditingFrame(t)},style:{background:this.state.viewBackgroundColor,filter:e?Ba:"none",zIndex:2,border:"none",display:"block",padding:"6px",borderRadius:4,boxShadow:"inset 0 0 0 1px var(--color-primary)",fontFamily:"Assistant",fontSize:"14px",transform:"translate(-6px, 6px)",color:"var(--color-gray-80)",overflow:"hidden",maxWidth:document.body.clientWidth-n-6+"px"},size:i.length+1||1,dir:"auto",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off"})}else s=a;return gp.exports.jsx("div",{id:this.getFrameNameDOMId(t),style:{position:"absolute",bottom:`${this.state.height+za.nameOffsetY-i+this.state.offsetTop}px`,left:n-this.state.offsetLeft+"px",zIndex:2,fontSize:za.nameFontSize,color:e?za.nameColorDarkTheme:za.nameColorLightTheme,lineHeight:za.nameLineHeight,width:"max-content",maxWidth:`${t.width}px`,overflow:t.id===this.state.editingFrame?"visible":"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",cursor:en.MOVE,pointerEvents:this.state.viewModeEnabled?ue.disabled:ue.enabled},onPointerDown:e=>this.handleCanvasPointerDown(e),onWheel:e=>this.handleWheel(e),onContextMenu:this.handleCanvasContextMenu,onDoubleClick:()=>{this.setState({editingFrame:t.id})},children:s},t.id)}))})),Cc(this,"focusContainer",(()=>{this.excalidrawContainerRef.current?.focus()})),Cc(this,"getSceneElementsIncludingDeleted",(()=>this.scene.getElementsIncludingDeleted())),Cc(this,"getSceneElements",(()=>this.scene.getNonDeletedElements())),Cc(this,"onInsertElements",(e=>{this.addElementsFromPasteOrLibrary({elements:e,position:"center",files:null})})),Cc(this,"onExportImage",(async(e,t,s)=>{dh("export",e,"ui");let n=await Km(e,t,this.state,this.files,{exportBackground:this.state.exportBackground,name:this.getName(),viewBackgroundColor:this.state.viewBackgroundColor,exportingFrame:s.exportingFrame}).catch(Ua).catch((e=>{console.error(e),this.setState({errorMessage:e.message})}));this.state.exportEmbedScene&&n&&mn(n)&&this.setState({fileHandle:n})})),Cc(this,"magicGenerations",new Map),Cc(this,"updateMagicGeneration",(({frameElement:e,data:t})=>{"pending"===t.status?He(e,{customData:{generationData:void 0}},!1):He(e,{customData:{generationData:t}},!1),this.magicGenerations.set(e.id,t),this.triggerRender()})),Cc(this,"plugins",{}),Cc(this,"onMagicframeToolSelect",(()=>{let e=this.scene.getSelectedElements({selectedElementIds:this.state.selectedElementIds});if(0===e.length)this.setActiveTool({type:Ya.magicframe}),dh("ai","tool-select (empty-selection)","d2c");else{let t,s=1===e.length&&ge(e[0])&&e[0];if(!s&&e.some((e=>it(e)||e.frameId)))return void this.setActiveTool({type:Ya.magicframe});if(dh("ai","tool-select (existing selection)","d2c"),s)t=s;else{let[s,n,i,a]=xt(e),l=50;t=Ga({...za,x:s-l,y:n-l,width:i-s+2*l,height:a-n+2*l,opacity:100,locked:!1}),this.scene.insertElement(t);for(let s of e)He(s,{frameId:t.id});this.setState({selectedElementIds:{[t.id]:!0}})}this.onMagicFrameGenerate(t,"upstream")}})),Cc(this,"openEyeDropper",(({type:e})=>{wp.set(Uh,{swapPreviewOnAlt:!0,colorPickerType:"stroke"===e?"elementStroke":"elementBackground",onSelect:(t,s)=>{let n="background"===e&&s.altKey||"stroke"===e&&!s.altKey;this.scene.getSelectedElements(this.state).length&&"selection"===this.state.activeTool.type?this.updateScene({elements:this.scene.getElementsIncludingDeleted().map((e=>this.state.selectedElementIds[e.id]?Dt(e,{[n?"strokeColor":"backgroundColor"]:t}):e)),captureUpdate:Lt.IMMEDIATELY}):n?this.syncActionResult({appState:{...this.state,currentItemStrokeColor:t},captureUpdate:Lt.IMMEDIATELY}):this.syncActionResult({appState:{...this.state,currentItemBackgroundColor:t},captureUpdate:Lt.IMMEDIATELY})},keepOpenOnAlt:!1})})),Cc(this,"dismissLinearEditor",(()=>{setTimeout((()=>{this.setState({editingLinearElement:null})}))})),Cc(this,"syncActionResult",ay((e=>{if(this.unmounted||!1===e)return;e.captureUpdate===Lt.NEVER?this.store.shouldUpdateSnapshot():e.captureUpdate===Lt.IMMEDIATELY&&this.store.shouldCaptureIncrement();let t=!1,s=null;if(e.elements&&(this.scene.replaceAllElements(e.elements),t=!0),e.files&&(this.addMissingFiles(e.files,e.replaceFiles),this.addNewImagesToImageCache()),e.appState||s||this.state.contextMenu){let n=e?.appState?.viewModeEnabled||!1,i=e?.appState?.zenModeEnabled||!1,a=e?.appState?.theme||this.props.theme||X.LIGHT,l=e?.appState?.name??this.state.name,r=e?.appState?.errorMessage??this.state.errorMessage;typeof this.props.viewModeEnabled<"u"&&(n=this.props.viewModeEnabled),typeof this.props.zenModeEnabled<"u"&&(i=this.props.zenModeEnabled),s=e.appState?.editingTextElement||null,e.elements&&s&&e.elements.forEach((e=>{s?.id===e.id&&s!==e&&$a(e)&&tt(e)&&(s=e)})),s?.isDeleted&&(s=null),this.setState((t=>({...t,...e.appState||{},contextMenu:null,editingTextElement:s,viewModeEnabled:n,zenModeEnabled:i,theme:a,name:l,errorMessage:r}))),t=!0}!t&&e.captureUpdate!==Lt.EVENTUALLY&&this.scene.triggerUpdate()}))),Cc(this,"onBlur",ay((()=>{rv=!1,this.setState({isBindingEnabled:!0})}))),Cc(this,"onUnload",(()=>{this.onBlur()})),Cc(this,"disableEvent",(e=>{e.preventDefault()})),Cc(this,"resetHistory",(()=>{this.history.clear()})),Cc(this,"resetStore",(()=>{this.store.clear()})),Cc(this,"resetScene",ay((e=>{this.scene.replaceAllElements([]),this.setState((t=>({...K(),isLoading:!e?.resetLoadingState&&t.isLoading,theme:this.state.theme}))),this.resetStore(),this.resetHistory()}))),Cc(this,"initializeScene",(async()=>{"launchQueue"in window&&"LaunchParams"in window&&window.launchQueue.setConsumer((async e=>{if(!e.files.length)return;let t=e.files[0],s=await t.getFile();this.loadFileToCanvas(new File([s],s.name||"",{type:s.type}),t)})),this.props.theme&&this.setState({theme:this.props.theme}),this.state.isLoading||this.setState({isLoading:!0});let e=null;try{e="function"==typeof this.props.initialData?await this.props.initialData()||null:await this.props.initialData||null,e?.libraryItems&&this.library.updateLibrary({libraryItems:e.libraryItems,merge:!0}).catch((e=>{console.error(e)}))}catch(t){console.error(t),e={appState:{errorMessage:t.message||"Encountered an error during importing or restoring scene data"}}}let t=Va(e,null,null,{repairBindings:!0});t.appState={...t.appState,theme:this.props.theme||t.appState.theme,openSidebar:t.appState?.openSidebar||this.state.openSidebar,activeTool:"image"===t.appState.activeTool.type?{...t.appState.activeTool,type:"selection"}:t.appState.activeTool,isLoading:!1,toast:this.state.toast},e?.scrollToContent&&(t.appState={...t.appState,...Ea(t.elements,{...t.appState,width:this.state.width,height:this.state.height,offsetTop:this.state.offsetTop,offsetLeft:this.state.offsetLeft})}),this.resetStore(),this.resetHistory(),this.syncActionResult({...t,captureUpdate:Lt.NEVER}),this.clearImageShapeCache(),this.fonts.loadSceneFonts().then((e=>{this.fonts.onLoaded(e)})),Wa(window.location.href)&&this.scrollToContent(window.location.href,{animate:!1})})),Cc(this,"isMobileBreakpoint",((e,t)=>e<Ka||t<Za&&e<Xa)),Cc(this,"refreshViewportBreakpoints",(()=>{if(!this.excalidrawContainerRef.current)return;let{clientWidth:e,clientHeight:t}=document.body,s=this.device.viewport,n=O(s,{isLandscape:e>t,isMobile:this.isMobileBreakpoint(e,t)});return s!==n&&(this.device={...this.device,viewport:n},!0)})),Cc(this,"refreshEditorBreakpoints",(()=>{let e=this.excalidrawContainerRef.current;if(!e)return;let{width:t,height:s}=e.getBoundingClientRect(),n=null!=this.props.UIOptions.dockedSidebarBreakpoint?this.props.UIOptions.dockedSidebarBreakpoint:qa,i=this.device.editor,a=O(i,{isMobile:this.isMobileBreakpoint(t,s),canFitSidebar:t>n});return i!==a&&(this.device={...this.device,editor:a},!0)})),Cc(this,"onResize",ay((()=>{this.scene.getElementsIncludingDeleted().forEach((e=>Se.delete(e))),this.refreshViewportBreakpoints(),this.updateDOMRect(),P||this.refreshEditorBreakpoints(),this.setState({})}))),Cc(this,"onFullscreenChange",(()=>{!document.fullscreenElement&&"active"===this.state.activeEmbeddable?.state&&this.setState({activeEmbeddable:null})})),Cc(this,"renderInteractiveSceneCallback",(({atLeastOneVisibleElement:e,scrollBars:t,elementsMap:s})=>{t&&(cv=t);let n=!this.state.editingTextElement&&(!e&&s.size>0);this.state.scrolledOutside!==n&&this.setState({scrolledOutside:n}),this.scheduleImageRefresh()})),Cc(this,"onScroll",l((()=>{let{offsetTop:e,offsetLeft:t}=this.getCanvasOffsets();this.setState((s=>s.offsetLeft===t&&s.offsetTop===e?null:{offsetTop:e,offsetLeft:t}))}),Fo)),Cc(this,"onCut",ay((e=>{!this.excalidrawContainerRef.current?.contains(document.activeElement)||Ki(e.target)||(this.actionManager.executeAction(ku,"keyboard",e),e.preventDefault(),e.stopPropagation())}))),Cc(this,"onCopy",ay((e=>{!this.excalidrawContainerRef.current?.contains(document.activeElement)||Ki(e.target)||(this.actionManager.executeAction(Cu,"keyboard",e),e.preventDefault(),e.stopPropagation())}))),Cc(this,"onTouchStart",(t=>{if(Qa&&t.preventDefault(),!av)return av=!0,clearTimeout(lv),void(lv=window.setTimeout(e.resetTapTwice,Ja));if(av&&1===t.touches.length){let e=t.touches[0];this.handleCanvasDoubleClick({clientX:e.clientX,clientY:e.clientY}),av=!1,clearTimeout(lv)}2===t.touches.length&&this.setState({selectedElementIds:Ye({},this.state),activeEmbeddable:null})})),Cc(this,"onTouchEnd",(e=>{this.resetContextMenuTimer(),e.touches.length>0?this.setState({previousSelectedElementIds:{},selectedElementIds:Ye(this.state.previousSelectedElementIds,this.state)}):bv.pointers.clear()})),Cc(this,"pasteFromClipboard",ay((async e=>{let t=!!uv,s=document.activeElement,n=this.excalidrawContainerRef.current?.contains(s);if(e&&!n)return;let i=document.elementFromPoint(this.lastViewportPosition.x,this.lastViewportPosition.y);if(e&&(!(i instanceof HTMLCanvasElement)||Ki(s)))return;let{x:a,y:l}=Ge({clientX:this.lastViewportPosition.x,clientY:this.lastViewportPosition.y},this.state),r=e?.clipboardData?.files[0],o=await Na(e,t);if(!r&&!t){if(o.mixedContent)return this.addElementsFromMixedContentPaste(o.mixedContent,{isPlainPaste:t,sceneX:a,sceneY:l});if(o.text){let e=o.text.trim();e.startsWith("<svg")&&e.endsWith("</svg>")&&(r=el(e))}}if(tl(r)&&!o.spreadsheet){if(!this.isToolSupported("image"))return void this.setState({errorMessage:Np("errors.imageToolNotSupported")});let e=this.createImageElement({sceneX:a,sceneY:l});return this.insertImageElement(e,r),this.initializeImageDimensions(e),void this.setState({selectedElementIds:Ye({[e.id]:!0},this.state)})}if(this.props.onPaste)try{if(!1===await this.props.onPaste(o,e))return}catch(e){console.error(e)}if(o.errorMessage)this.setState({errorMessage:o.errorMessage});else if(o.spreadsheet&&!t)this.setState({pasteDialog:{data:o.spreadsheet,shown:!0}});else if(o.elements){let e=o.programmaticAPI?iy(o.elements):o.elements;this.addElementsFromPasteOrLibrary({elements:e,files:o.files||null,position:"cursor",retainSeed:t})}else if(o.text){if(o.text&&(e=>new RegExp(`^(?:%%{.*?}%%[\\s\\n]*)?\\b(?:${["flowchart","graph","sequenceDiagram","classDiagram","stateDiagram","stateDiagram-v2","erDiagram","journey","gantt","pie","quadrantChart","requirementDiagram","gitGraph","C4Context","mindmap","timeline","zenuml","sankey","xychart","block"].map((e=>`\\s*${e}(-beta)?`)).join("|")})\\b`).test(e.trim()))(o.text)){let e=await import("../../../mermaid-to-excalidraw/dist/index.js");try{let{elements:t,files:s}=await e.parseMermaidToExcalidraw(o.text),n=iy(t,{regenerateIds:!0});return void this.addElementsFromPasteOrLibrary({elements:n,files:s,position:"cursor"})}catch(e){console.warn(`parsing pasted text as mermaid definition failed: ${e.message}`)}}let e=sl(o.text).split(/\n+/).map((e=>e.trim())).filter(Boolean),s=e.map((e=>nl(e))).filter((e=>Di(e,this.props.validateEmbeddable)&&(/^(http|https):\/\/[^\s/$.?#].[^\s]*$/.test(e)||"video"===oe(e)?.type)));if(!uv&&s.length>0&&s.length===e.length){let e=[];for(let t of s){let s=e[e.length-1],n=this.insertEmbeddableElement({sceneX:s?s.x+s.width+20:a,sceneY:l,link:ji(t)});n&&e.push(n)}return void(e.length&&this.setState({selectedElementIds:Object.fromEntries(e.map((e=>[e.id,!0])))}))}this.addTextFromPaste(o.text,t)}this.setActiveTool({type:"selection"}),e?.preventDefault()}))),Cc(this,"addElementsFromPasteOrLibrary",(e=>{let t=il(e.elements,null,void 0),[s,i,a,l]=xt(t),r=vr(s,a)/2,o=vr(i,l)/2,d="object"==typeof e.position?e.position.clientX:"cursor"===e.position?this.lastViewportPosition.x:this.state.width/2+this.state.offsetLeft,c="object"==typeof e.position?e.position.clientY:"cursor"===e.position?this.lastViewportPosition.y:this.state.height/2+this.state.offsetTop,{x:p,y:h}=Ge({clientX:d,clientY:c},this.state),m=p-r,u=h-o,[g,x]=ft(m,u,this.getEffectiveGridSize()),f=Oi(t.map((e=>Dt(e,{x:e.x+g-s,y:e.y+x-i}))),{randomizeSeed:!e.retainSeed}),b=this.scene.getElementsIncludingDeleted(),E=[...b,...f];E=this.props.onDuplicate?.(E,b)||E,An(E,Ht(f));let y=this.getTopLayerFrameAtSceneCoords({x:p,y:h});if(y){let e=al(f,y);Ca(E,e,y,this.state)}this.scene.replaceAllElements(E),f.forEach((e=>{if(tt(e)&&Zt(e)){let t=Xt(e,this.scene.getElementsMapIncludingDeleted());Is(e,t,this.scene.getElementsMapIncludingDeleted())}})),ll&&n.loadElementsFonts(f).then((e=>{this.fonts.onLoaded(e)})),e.files&&this.addMissingFiles(e.files),this.store.shouldCaptureIncrement();let v=es(f);this.setState({...this.state,openSidebar:this.state.openSidebar&&this.device.editor.canFitSidebar&&wp.get(sb)?this.state.openSidebar:null,...De({editingGroupId:null,selectedElementIds:v.reduce(((e,t)=>(Zt(t)||(e[t.id]=!0),e)),{})},this.scene.getNonDeletedElements(),this.state,this)},(()=>{e.files&&this.addNewImagesToImageCache()})),this.setActiveTool({type:"selection"}),e.fitToContent&&this.scrollToContent(f,{fitToContent:!0,canvasOffsets:this.getEditorUIOffsets()})})),Cc(this,"setAppState",((e,t)=>{this.setState(e,t)})),Cc(this,"removePointer",(e=>{pv&&this.resetContextMenuTimer(),bv.pointers.delete(e.pointerId)})),Cc(this,"toggleLock",((e="ui")=>{this.state.activeTool.locked||dh("toolbar","toggleLock",`${e} (${this.device.editor.isMobile?"mobile":"desktop"})`),this.setState((e=>({activeTool:{...e.activeTool,..._e(this.state,e.activeTool.locked?{type:"selection"}:e.activeTool),locked:!e.activeTool.locked}})))})),Cc(this,"updateFrameRendering",(e=>{this.setState((t=>{let s="function"==typeof e?e(t.frameRendering):e;return{frameRendering:{enabled:s?.enabled??t.frameRendering.enabled,clip:s?.clip??t.frameRendering.clip,name:s?.name??t.frameRendering.name,outline:s?.outline??t.frameRendering.outline}}}))})),Cc(this,"togglePenMode",(e=>{this.setState((t=>({penMode:e??!t.penMode,penDetected:!0})))})),Cc(this,"onHandToolToggle",(()=>{this.actionManager.executeAction(Hm)})),Cc(this,"zoomCanvas",(e=>{this.setState({...Lm({viewportX:this.state.width/2+this.state.offsetLeft,viewportY:this.state.height/2+this.state.offsetTop,nextZoom:Ys(e)},this.state)})})),Cc(this,"cancelInProgressAnimation",null),Cc(this,"scrollToContent",((e=this.scene.getNonDeletedElements(),t)=>{if("string"==typeof e){let s;if(s=Wa(e)?rl(e):e,s){let n=this.scene.getElementsFromId(s);n?.length?this.scrollToContent(n,{fitToContent:t?.fitToContent??!0,animate:t?.animate??!0}):Wa(e)&&this.setState({toast:{message:Np("elementLink.notFound"),duration:3e3,closable:!0}})}return}this.cancelInProgressAnimation?.();let s=Array.isArray(e)?e:[e],n=this.state.zoom,i=this.state.scrollX,a=this.state.scrollY;if(t?.fitToContent||t?.fitToViewport){let{appState:e}=zm({canvasOffsets:t.canvasOffsets,targetElements:s,appState:this.state,fitToViewport:!!t?.fitToViewport,viewportZoomFactor:t?.viewportZoomFactor,minZoom:t?.minZoom,maxZoom:t?.maxZoom});n=e.zoom,i=e.scrollX,a=e.scrollY}else{let e=Ea(s,this.state);i=e.scrollX,a=e.scrollY}if(t?.animate){let e=this.state.scrollX,s=this.state.scrollY,l=this.state.zoom.value,r=ol({fromValues:{scrollX:e,scrollY:s,zoom:l},toValues:{scrollX:i,scrollY:a,zoom:n.value},interpolateValue:(e,t,s,n)=>{if("zoom"===n)return e*Math.pow(t/e,Z(s))},onStep:({scrollX:e,scrollY:t,zoom:s})=>{this.setState({scrollX:e,scrollY:t,zoom:{value:s}})},onStart:()=>{this.setState({shouldCacheIgnoreZoom:!0})},onEnd:()=>{this.setState({shouldCacheIgnoreZoom:!1})},onCancel:()=>{this.setState({shouldCacheIgnoreZoom:!1})},duration:t?.duration??500});this.cancelInProgressAnimation=()=>{r(),this.cancelInProgressAnimation=null}}else this.setState({scrollX:i,scrollY:a,zoom:n})})),Cc(this,"maybeUnfollowRemoteUser",(()=>{this.state.userToFollow&&this.setState({userToFollow:null})})),Cc(this,"translateCanvas",(e=>{this.cancelInProgressAnimation?.(),this.maybeUnfollowRemoteUser(),this.setState(e)})),Cc(this,"setToast",(e=>{this.setState({toast:e})})),Cc(this,"restoreFileFromShare",(async()=>{try{let e=await caches.open("web-share-target"),t=await e.match("shared-file");if(t){let s=await t.blob(),n=new File([s],s.name||"",{type:s.type});this.loadFileToCanvas(n,null),await e.delete("shared-file"),window.history.replaceState(null,dl,window.location.pathname)}}catch(e){this.setState({errorMessage:e.message})}})),Cc(this,"addFiles",ay((e=>{let{addedFiles:t}=this.addMissingFiles(e);this.clearImageShapeCache(t),this.scene.triggerUpdate(),this.addNewImagesToImageCache()}))),Cc(this,"addMissingFiles",((e,t=!1)=>{let s=t?{}:{...this.files},n={},i=Array.isArray(e)?e:Object.values(e);for(let e of i)if(!s[e.id]&&(n[e.id]=e,s[e.id]=e,e.mimeType===Fi.svg))try{let t=cl(pl(hl(e.dataURL)),Fi.svg);e.dataURL!==t&&(e.version=(e.version??1)+1,e.dataURL=t)}catch(e){console.error(e)}return this.files=s,{addedFiles:n}})),Cc(this,"updateScene",ay((e=>{let t=ml(e.elements??[]);if(e.captureUpdate&&e.captureUpdate!==Lt.EVENTUALLY){let s=this.store.snapshot.appState,n=this.store.snapshot.elements,i=e.appState?Object.assign({},s,e.appState):s,a=e.elements?this.store.filterUncomittedElements(this.scene.getElementsMapIncludingDeleted(),Ht(t)):n;e.captureUpdate===Lt.IMMEDIATELY?this.store.captureIncrement(a,i):e.captureUpdate===Lt.NEVER&&this.store.updateSnapshot(a,i)}e.appState&&this.setState(e.appState),e.elements&&this.scene.replaceAllElements(t),e.collaborators&&this.setState({collaborators:e.collaborators})}))),Cc(this,"triggerRender",(e=>{!0===e?this.scene.triggerUpdate():this.setState({})})),Cc(this,"toggleSidebar",(({name:e,tab:t,force:s})=>{let n;n=void 0===s?this.state.openSidebar?.name===e&&this.state.openSidebar?.tab===t?null:e:s?e:null;let i=n?{name:n}:null;return i&&t&&(i.tab=t),this.setState({openSidebar:i}),!!n})),Cc(this,"updateCurrentCursorPosition",ay((e=>{this.lastViewportPosition.x=e.clientX,this.lastViewportPosition.y=e.clientY}))),Cc(this,"getEditorUIOffsets",(()=>{let e=this.excalidrawContainerRef?.current?.querySelector(".App-toolbar")?.getBoundingClientRect()?.bottom??0,t=this.excalidrawContainerRef?.current?.querySelector(".sidebar")?.getBoundingClientRect(),s=this.excalidrawContainerRef?.current?.querySelector(".App-menu__left")?.getBoundingClientRect(),n=16;return Dp().rtl?{top:e+n,right:Math.max(this.state.width-(s?.left??this.state.width),0)+n,bottom:n,left:Math.max(t?.right??0,0)+n}:{top:e+n,right:Math.max(this.state.width-(t?.left??this.state.width)+n,0),bottom:n,left:Math.max(s?.right??0,0)+n}})),Cc(this,"onKeyDown",ay((e=>{if("Proxy"in window&&(!e.shiftKey&&/^[A-Z]$/.test(e.key)||e.shiftKey&&/^[a-z]$/.test(e.key))&&(e=new Proxy(e,{get(t,s){let n=t[s];return"function"==typeof n?n.bind(t):"key"===s?e.shiftKey?t.key.toUpperCase():t.key.toLowerCase():n}})),!ul(e.target)){if((e.key===j.ESCAPE||e.key===j.ENTER)&&this.state.croppingElementId)return void this.finishImageCropping();let t=S(this.scene.getNonDeletedElementsMap(),this.state);if(1===t.length&&B(t[0])&&e.key===j.ENTER)return void this.startImageCropping(t[0]);if(e.key===j.ESCAPE&&this.flowChartCreator.isCreatingChart)return this.flowChartCreator.clear(),void this.triggerRender(!0);let s=gl(e.key);if(e[j.CTRL_OR_CMD]&&s&&!e.shiftKey){e.preventDefault();let t=S(this.scene.getNonDeletedElementsMap(),this.state);return 1===t.length&&xl(t[0])&&this.flowChartCreator.createNodes(t[0],this.scene.getNonDeletedElementsMap(),this.state,mf(e.key)),void(this.flowChartCreator.pendingNodes?.length&&!fl(this.flowChartCreator.pendingNodes,this.canvas.width/window.devicePixelRatio,this.canvas.height/window.devicePixelRatio,{offsetLeft:this.state.offsetLeft,offsetTop:this.state.offsetTop,scrollX:this.state.scrollX,scrollY:this.state.scrollY,zoom:this.state.zoom},this.scene.getNonDeletedElementsMap(),this.getEditorUIOffsets())&&this.scrollToContent(this.flowChartCreator.pendingNodes,{animate:!0,duration:300,fitToContent:!0,canvasOffsets:this.getEditorUIOffsets()}))}if(e.altKey){let t=S(this.scene.getNonDeletedElementsMap(),this.state);if(1===t.length&&s){e.preventDefault();let s=this.flowChartNavigator.exploreByDirection(t[0],this.scene.getNonDeletedElementsMap(),mf(e.key));if(s){this.setState((e=>({selectedElementIds:Ye({[s]:!0},e)})));let e=this.scene.getNonDeletedElementsMap().get(s);e&&!fl([e],this.canvas.width/window.devicePixelRatio,this.canvas.height/window.devicePixelRatio,{offsetLeft:this.state.offsetLeft,offsetTop:this.state.offsetTop,scrollX:this.state.scrollX,scrollY:this.state.scrollY,zoom:this.state.zoom},this.scene.getNonDeletedElementsMap(),this.getEditorUIOffsets())&&this.scrollToContent(e,{animate:!0,duration:300,canvasOffsets:this.getEditorUIOffsets()})}return}}}if(e[j.CTRL_OR_CMD]&&e.key===j.P&&!e.shiftKey&&!e.altKey)return this.setToast({message:Np("commandPalette.shortcutHint",{shortcut:nx("commandPalette")})}),void e.preventDefault();if(e[j.CTRL_OR_CMD]&&e.key.toLowerCase()===j.V&&(uv=e.shiftKey,clearTimeout(gv),gv=window.setTimeout((()=>{uv=!1}),100)),e[j.CTRL_OR_CMD]&&Ki(e.target)&&(e.code===Pt.MINUS||e.code===Pt.EQUAL))return void e.preventDefault();if(Ki(e.target)&&e.key!==j.ESCAPE||gl(e.key)&&ul(e.target))return;if(e.key===j.QUESTION_MARK)return void this.setState({openDialog:{name:"help"}});if(e.key.toLowerCase()===j.E&&e.shiftKey&&e[j.CTRL_OR_CMD])return e.preventDefault(),void this.setState({openDialog:{name:"imageExport"}});if(e.key===j.PAGE_UP||e.key===j.PAGE_DOWN){let t=(e.shiftKey?this.state.width:this.state.height)/this.state.zoom.value;e.key===j.PAGE_DOWN&&(t=-t),e.shiftKey?this.translateCanvas((e=>({scrollX:e.scrollX+t}))):this.translateCanvas((e=>({scrollY:e.scrollY+t})))}if("elementLinkSelector"===this.state.openDialog?.name||this.actionManager.handleKeyDown(e)||this.state.viewModeEnabled)return;if(e[j.CTRL_OR_CMD]&&this.state.isBindingEnabled&&this.setState({isBindingEnabled:!1}),gl(e.key)){let t=this.scene.getSelectedElements({selectedElementIds:this.state.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0}),s=t.find(V),n=new Set;t.filter(V).filter((e=>{let s=e.startBinding&&!t.some((t=>t.id===e.startBinding?.elementId)),n=e.endBinding&&!t.some((t=>t.id===e.endBinding?.elementId));return s||n})).forEach((e=>n.add(e.id))),t=t.filter((e=>!n.has(e.id)));let i=this.getEffectiveGridSize()&&(e.shiftKey?bl:this.getEffectiveGridSize())||(e.shiftKey?El:bl),a=0,l=0;e.key===j.ARROW_LEFT?a=-i:e.key===j.ARROW_RIGHT?a=i:e.key===j.ARROW_UP?l=-i:e.key===j.ARROW_DOWN&&(l=i),t.forEach((e=>{He(e,{x:e.x+a,y:e.y+l},!1),yl(e,this.scene.getNonDeletedElementsMap(),{simultaneouslyUpdated:t})})),this.setState({suggestedBindings:vl(t.filter((e=>e.id!==s?.id||0!==i)),this.scene.getNonDeletedElementsMap(),this.state.zoom)}),this.scene.triggerUpdate(),e.preventDefault()}else if(e.key===j.ENTER){let t=this.scene.getSelectedElements(this.state);if(1===t.length){let s=t[0];if(e[j.CTRL_OR_CMD])zt(s)&&(!this.state.editingLinearElement||this.state.editingLinearElement.elementId!==t[0].id)&&(this.store.shouldCaptureIncrement(),V(s)||this.setState({editingLinearElement:new ze(s)}));else{if(tt(s)||wl(s)){let t;tt(s)||(t=s);let n=It(s,this.state,this.scene.getNonDeletedElementsMap()),i=n.x,a=n.y;return this.startTextEditing({sceneX:i,sceneY:a,container:t}),void e.preventDefault()}it(s)&&this.setState({editingFrame:s.id})}}}else if(!(e.ctrlKey||e.altKey||e.metaKey||this.state.newElement||this.state.selectionElement||this.state.selectedElementsAreBeingDragged)){let t=Sl(e.key);t?(this.state.activeTool.type!==t&&dh("toolbar",t,`keyboard (${this.device.editor.isMobile?"mobile":"desktop"})`),"arrow"===t&&"arrow"===this.state.activeTool.type&&this.setState((e=>({currentItemArrowType:e.currentItemArrowType===Os.sharp?Os.round:e.currentItemArrowType===Os.round?Os.elbow:Os.sharp}))),this.setActiveTool({type:t}),e.stopPropagation()):e.key===j.Q&&(this.toggleLock("keyboard"),e.stopPropagation())}if(e.key===j.SPACE&&0===bv.pointers.size&&(rv=!0,gt(this.interactiveCanvas,en.GRAB),e.preventDefault()),!(e.key!==j.G&&e.key!==j.S||e.altKey||e[j.CTRL_OR_CMD])){let t=this.scene.getSelectedElements(this.state);if("selection"===this.state.activeTool.type&&!t.length)return;e.key===j.G&&(Gi(this.state.activeTool.type)||t.some((e=>Gi(e.type))))&&(this.setState({openPopup:"elementBackground"}),e.stopPropagation()),e.key===j.S&&(this.setState({openPopup:"elementStroke"}),e.stopPropagation())}if(!e[j.CTRL_OR_CMD]&&e.shiftKey&&e.key.toLowerCase()===j.F){let t=this.scene.getSelectedElements(this.state);if("selection"===this.state.activeTool.type&&!t.length)return;("text"===this.state.activeTool.type||t.find((e=>tt(e)||Kt(e,this.scene.getNonDeletedElementsMap()))))&&(e.preventDefault(),this.setState({openPopup:"fontFamily"}))}if(e.key===j.K&&!e.altKey&&!e[j.CTRL_OR_CMD])return void("laser"===this.state.activeTool.type?this.setActiveTool({type:"selection"}):this.setActiveTool({type:"laser"}));e[j.CTRL_OR_CMD]&&(e.key===j.BACKSPACE||e.key===j.DELETE)&&wp.set(yx,"clearCanvas");let t=e.key.toLocaleLowerCase(),s=t===j.S&&e.shiftKey,n=e.key===j.I||t===j.G&&e.shiftKey;(s||n)&&this.openEyeDropper({type:s?"stroke":"background"})}))),Cc(this,"onKeyUp",ay((e=>{if(e.key===j.SPACE&&(this.state.viewModeEnabled||"elementLinkSelector"===this.state.openDialog?.name?gt(this.interactiveCanvas,en.GRAB):"selection"===this.state.activeTool.type?ln(this.interactiveCanvas):(wa(this.interactiveCanvas,this.state),this.setState({selectedElementIds:Ye({},this.state),selectedGroupIds:{},editingGroupId:null,activeEmbeddable:null})),rv=!1),!e[j.CTRL_OR_CMD]&&!this.state.isBindingEnabled&&this.setState({isBindingEnabled:!0}),gl(e.key)&&(si(this.scene.getSelectedElements(this.state).filter(zt),this.scene.getNonDeletedElementsMap(),this.scene.getNonDeletedElements(),this.scene,Re(this.state),this.state.selectedLinearElement?.selectedPointsIndices??[],this.state.zoom),this.setState({suggestedBindings:[]})),e.altKey||this.flowChartNavigator.isExploring&&(this.flowChartNavigator.clear(),this.syncActionResult({captureUpdate:Lt.IMMEDIATELY})),!e[j.CTRL_OR_CMD]&&this.flowChartCreator.isCreatingChart){this.flowChartCreator.pendingNodes?.length&&this.scene.insertElements(this.flowChartCreator.pendingNodes);let e=this.flowChartCreator.pendingNodes?.[0];e&&(this.setState((t=>({selectedElementIds:Ye({[e.id]:!0},t)}))),fl([e],this.canvas.width/window.devicePixelRatio,this.canvas.height/window.devicePixelRatio,{offsetLeft:this.state.offsetLeft,offsetTop:this.state.offsetTop,scrollX:this.state.scrollX,scrollY:this.state.scrollY,zoom:this.state.zoom},this.scene.getNonDeletedElementsMap(),this.getEditorUIOffsets())||this.scrollToContent(e,{animate:!0,duration:300,canvasOffsets:this.getEditorUIOffsets()})),this.flowChartCreator.clear(),this.syncActionResult({captureUpdate:Lt.IMMEDIATELY})}}))),Cc(this,"isToolSupported",(e=>!1!==this.props.UIOptions.tools?.[e])),Cc(this,"setActiveTool",(e=>{if(!this.isToolSupported(e.type))return void console.warn(`"${e.type}" tool is disabled via "UIOptions.canvasActions.tools.${e.type}"`);let t=_e(this.state,e);"hand"===t.type?gt(this.interactiveCanvas,en.GRAB):rv||wa(this.interactiveCanvas,{...this.state,activeTool:t}),Cl(document.activeElement)&&this.focusContainer(),Il(t.type)||this.setState({suggestedBindings:[]}),"image"===t.type&&this.onImageAction({insertOnCanvasDirectly:("image"===e.type&&e.insertOnCanvasDirectly)??!1}),this.setState((e=>{let s={snapLines:e.snapLines.length?[]:e.snapLines,originSnapOffset:null,activeEmbeddable:null};return"freedraw"===t.type&&this.store.shouldCaptureIncrement(),"selection"!==t.type?{...e,activeTool:t,selectedElementIds:Ye({},e),selectedGroupIds:Ye({},e),editingGroupId:null,multiElement:null,...s}:{...e,activeTool:t,...s}}))})),Cc(this,"setOpenDialog",(e=>{this.setState({openDialog:e})})),Cc(this,"setCursor",(e=>{gt(this.interactiveCanvas,e)})),Cc(this,"resetCursor",(()=>{ln(this.interactiveCanvas)})),Cc(this,"isTouchScreenMultiTouchGesture",(()=>bv.pointers.size>=2)),Cc(this,"getName",(()=>this.state.name||this.props.name||`${Np("labels.untitled")}-${q()}`)),Cc(this,"onGestureStart",ay((e=>{e.preventDefault(),this.isTouchScreenMultiTouchGesture()&&this.setState({selectedElementIds:Ye({},this.state),activeEmbeddable:null}),bv.initialScale=this.state.zoom.value}))),Cc(this,"onGestureChange",ay((e=>{if(e.preventDefault(),this.isTouchScreenMultiTouchGesture())return;let t=bv.initialScale;t&&this.setState((s=>({...Lm({viewportX:this.lastViewportPosition.x,viewportY:this.lastViewportPosition.y,nextZoom:Ys(t*e.scale)},s)})))}))),Cc(this,"onGestureEnd",ay((e=>{e.preventDefault(),this.isTouchScreenMultiTouchGesture()&&this.setState({previousSelectedElementIds:{},selectedElementIds:Ye(this.state.previousSelectedElementIds,this.state)}),bv.initialScale=null}))),Cc(this,"startTextEditing",(({sceneX:e,sceneY:t,insertAtParentCenter:s=!0,container:n,autoEdit:i=!0})=>{let a=!1,l=s&&this.getTextWysiwygSnappedToCenterPosition(e,t,this.state,n);n&&l&&(Kt(n,this.scene.getNonDeletedElementsMap())||(a=!0));let r=null,o=this.scene.getSelectedElements(this.state);r=1===o.length?tt(o[0])?o[0]:n?Kt(o[0],this.scene.getNonDeletedElementsMap()):this.getTextElementAtPosition(e,t):this.getTextElementAtPosition(e,t);let d=r?.fontFamily||this.state.currentItemFontFamily,c=r?.lineHeight||Ke(d),p=this.state.currentItemFontSize;if(!r&&a&&n&&!ut(n)){let s=kl(We({fontSize:p,fontFamily:d}),c),i=Bo(p,c),a=Math.max(n.height,i),r=Math.max(n.width,s);He(n,{height:a,width:r}),e=n.x+r/2,t=n.y+a/2,l&&(l=this.getTextWysiwygSnappedToCenterPosition(e,t,this.state,n))}let h=this.getTopLayerFrameAtSceneCoords({x:e,y:t}),m=r||Je({x:l?l.elementCenterX:e,y:l?l.elementCenterY:t,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,text:"",fontSize:p,fontFamily:d,textAlign:l?"center":this.state.currentItemTextAlign,verticalAlign:l?js.MIDDLE:Ve,containerId:a?n?.id:void 0,groupIds:n?.groupIds??[],lineHeight:c,angle:n?.angle??0,frameId:h?h.id:null});if(!r&&a&&n&&He(n,{boundElements:(n.boundElements||[]).concat({type:"text",id:m.id})}),this.setState({editingTextElement:m}),!r)if(n&&a){let e=this.scene.getElementIndex(n.id);this.scene.insertElementAtIndex(m,e+1)}else this.scene.insertElement(m);i||r||n?this.handleTextWysiwyg(m,{isExistingElement:!!r}):this.setState({newElement:m,multiElement:null})})),Cc(this,"startImageCropping",(e=>{this.store.shouldCaptureIncrement(),this.setState({croppingElementId:e.id})})),Cc(this,"finishImageCropping",(()=>{this.state.croppingElementId&&(this.store.shouldCaptureIncrement(),this.setState({croppingElementId:null}))})),Cc(this,"handleCanvasDoubleClick",(e=>{if(this.state.multiElement||"selection"!==this.state.activeTool.type)return;let t=this.scene.getSelectedElements(this.state),{x:s,y:n}=Ge(e,this.state);if(1===t.length&&zt(t[0])){if(!(!e[j.CTRL_OR_CMD]||this.state.editingLinearElement&&this.state.editingLinearElement.elementId===t[0].id||V(t[0])))return this.store.shouldCaptureIncrement(),void this.setState({editingLinearElement:new ze(t[0])});if(this.state.selectedLinearElement&&V(t[0])){let e=ze.getSegmentMidpointHitCoords(this.state.selectedLinearElement,{x:s,y:n},this.state,this.scene.getNonDeletedElementsMap()),i=e?ze.getSegmentMidPointIndex(this.state.selectedLinearElement,this.state,e,this.scene.getNonDeletedElementsMap()):-1;if(i&&i>-1){this.store.shouldCaptureIncrement(),ze.deleteFixedSegment(t[0],i);let a=ze.getSegmentMidpointHitCoords({...this.state.selectedLinearElement,segmentMidPointHoveredCoords:null},{x:s,y:n},this.state,this.scene.getNonDeletedElementsMap()),l=a?ze.getSegmentMidPointIndex(this.state.selectedLinearElement,this.state,a,this.scene.getNonDeletedElementsMap()):null;return void this.setState({selectedLinearElement:{...this.state.selectedLinearElement,pointerDownState:{...this.state.selectedLinearElement.pointerDownState,segmentMidpoint:{index:l,value:e,added:!1}},segmentMidPointHoveredCoords:a}})}}}if(1===t.length&&B(t[0]))this.startImageCropping(t[0]);else{if(ln(this.interactiveCanvas),jn(this.state).length>0){let e=this.getElementAtPosition(s,n),t=e&&Tl(e,this.state.selectedGroupIds);if(t)return this.store.shouldCaptureIncrement(),void this.setState((s=>({...s,...De({editingGroupId:t,selectedElementIds:{[e.id]:!0}},this.scene.getNonDeletedElements(),s,this)})))}if(ln(this.interactiveCanvas),!e[j.CTRL_OR_CMD]&&!this.state.viewModeEnabled){let t=this.getElementAtPosition(s,n);if(Ml(t))return void this.setState({activeEmbeddable:{element:t,state:"active"}});let i=this.getTextBindableContainerAtPosition(s,n);if(i&&(Wt(i)||!jl(i.backgroundColor)||st({x:s,y:n,element:i,shape:nt(i,this.scene.getNonDeletedElementsMap()),threshold:this.getElementHitThreshold()}))){let e=It(i,this.state,this.scene.getNonDeletedElementsMap());s=e.x,n=e.y}this.startTextEditing({sceneX:s,sceneY:n,insertAtParentCenter:!e.altKey,container:i})}}})),Cc(this,"getElementLinkAtPosition",((e,t)=>{let s=this.scene.getNonDeletedElements(),n=-1;for(let i=s.length-1;i>=0;i--){let a=s[i];if(t&&a.id===t.id&&(n=i),a.link&&i>=n&&Dl(a,this.scene.getNonDeletedElementsMap(),this.state,an(e.x,e.y),this.device.editor.isMobile))return a}})),Cc(this,"redirectToLink",((e,t)=>{let s=Ll(an(this.lastPointerDownEvent.clientX,this.lastPointerDownEvent.clientY),an(this.lastPointerUpEvent.clientX,this.lastPointerUpEvent.clientY));if(!this.hitLinkElement||s>Nl)return;let n=Ge(this.lastPointerDownEvent,this.state),i=this.scene.getNonDeletedElementsMap(),a=Dl(this.hitLinkElement,i,this.state,an(n.x,n.y),this.device.editor.isMobile),l=Ge(this.lastPointerUpEvent,this.state),r=Dl(this.hitLinkElement,i,this.state,an(l.x,l.y),this.device.editor.isMobile);if(a&&r){Vu();let t=this.hitLinkElement.link;if(t){let s;if(t=ji(t),this.props.onLinkOpen&&(s=Ni("excalidraw-link",e.nativeEvent),this.props.onLinkOpen({...this.hitLinkElement,link:t},s)),!s?.defaultPrevented){let e=Li(t)?"_self":"_blank",s=window.open(void 0,e);s&&(s.opener=null,s.location=t)}}}})),Cc(this,"getTopLayerFrameAtSceneCoords",(e=>{let t=this.scene.getNonDeletedElementsMap(),s=this.scene.getNonDeletedFramesLikes().filter((s=>at(e,s,t)));return s.length?s[s.length-1]:null})),Cc(this,"handleCanvasPointerMove",(e=>{this.savePointer(e.clientX,e.clientY,this.state.cursorButton),this.lastPointerMoveEvent=e.nativeEvent,bv.pointers.has(e.pointerId)&&bv.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});let t=bv.initialScale;if(2===bv.pointers.size&&bv.lastCenter&&t&&bv.initialDistance){let e=Kx(bv.pointers),s=e.x-bv.lastCenter.x,n=e.y-bv.lastCenter.y;bv.lastCenter=e;let i=Zx(Array.from(bv.pointers.values())),a="freedraw"===this.state.activeTool.type&&this.state.penMode?1:i/bv.initialDistance,l=a?Ys(t*a):this.state.zoom.value;this.setState((t=>{let i=Lm({viewportX:e.x,viewportY:e.y,nextZoom:l},t);this.translateCanvas({zoom:i.zoom,scrollX:i.scrollX+s/l*2,scrollY:i.scrollY+n/l*2,shouldCacheIgnoreZoom:!0})})),this.resetShouldCacheIgnoreZoomDebounced()}else bv.lastCenter=bv.initialDistance=bv.initialScale=null;if(rv||ov||dv||Js(this.state))return;let s=If(cv,e.clientX-this.state.offsetLeft,e.clientY-this.state.offsetTop).isOverEither;!this.state.newElement&&!this.state.selectionElement&&!this.state.selectedElementsAreBeingDragged&&!this.state.multiElement&&(s?ln(this.interactiveCanvas):wa(this.interactiveCanvas,this.state));let n=Ge(e,this.state),{x:i,y:a}=n;if(!this.state.newElement&&Al(this.state.activeTool.type)){let{originOffset:t,snapLines:s}=_l(this.scene.getNonDeletedElements(),this,{x:i,y:a},e,this.scene.getNonDeletedElementsMap());this.setState((e=>{let n=Pl(e.snapLines,s),i=e.originSnapOffset?Pl(e.originSnapOffset,t):t;return e.snapLines===n&&e.originSnapOffset===i?null:{snapLines:n,originSnapOffset:i}}))}else!this.state.newElement&&!this.state.selectedElementsAreBeingDragged&&!this.state.selectionElement&&this.setState((e=>e.snapLines.length?{snapLines:[]}:null));if(this.state.editingLinearElement&&!this.state.editingLinearElement.isDragging){let t=ze.handlePointerMove(e,i,a,this,this.scene.getNonDeletedElementsMap());t&&t!==this.state.editingLinearElement&&Kc((()=>{this.setState({editingLinearElement:t})})),null!=t?.lastUncommittedPoint?this.maybeSuggestBindingAtCursor(n,t.elbowed):Kc((()=>{this.setState({suggestedBindings:[]})}))}if(Rl(this.state.activeTool.type)){let{newElement:e}=this.state;Oe(e,!1)?this.maybeSuggestBindingsForLinearElementAtCoords(e,[n],this.state.startBoundElement):this.maybeSuggestBindingAtCursor(n,!1)}if(this.state.multiElement){let{multiElement:t}=this.state,{x:s,y:n}=t,{points:l,lastCommittedPoint:r}=t,o=l[l.length-1];if(wa(this.interactiveCanvas,this.state),o===r)Ll(an(i-s,a-n),o)>=Ol?He(t,{points:[...l,an(i-s,a-n)]},!1):gt(this.interactiveCanvas,en.POINTER);else if(l.length>2&&r&&Ll(an(i-s,a-n),r)<Ol)gt(this.interactiveCanvas,en.POINTER),He(t,{points:l.slice(0,-1)},!1);else{let[r,o]=ft(i,a,e[j.CTRL_OR_CMD]||V(t)?null:this.getEffectiveGridSize()),[d,c]=t?.lastCommittedPoint??[0,0],p=r-s-d,h=o-n-c;Fl(e)&&({width:p,height:h}=Bl(d+s,c+n,r,o)),nn(l,this.state.zoom.value)&&gt(this.interactiveCanvas,en.POINTER),He(t,{points:[...l.slice(0,-1),an(d+p,c+h)]},!1,{isDragging:!0}),this.triggerRender(!1)}return}if(e.buttons||"selection"!==this.state.activeTool.type&&"text"!==this.state.activeTool.type&&"eraser"!==this.state.activeTool.type)return;let l=this.scene.getNonDeletedElements(),r=this.scene.getSelectedElements(this.state);if(1!==r.length||s||this.state.editingLinearElement){if(r.length>1&&!s&&"elementLinkSelector"!==this.state.openDialog?.name){let t=Hl(xt(r),i,a,this.state.zoom,e.pointerType,this.device);if(t)return void gt(this.interactiveCanvas,Ul({transformHandleType:t}))}}else if(this.state.selectedLinearElement&&this.handleHoverSelectedLinearElement(this.state.selectedLinearElement,i,a),!(this.state.selectedLinearElement&&-1!==this.state.selectedLinearElement.hoverPointIndex||"elementLinkSelector"===this.state.openDialog?.name||1===r.length&&V(r[0]))){let t=zl(l,this.state,i,a,this.state.zoom,e.pointerType,this.scene.getNonDeletedElementsMap(),this.device);if(t&&t.transformHandleType)return void gt(this.interactiveCanvas,Ul(t))}let o=this.getElementAtPosition(n.x,n.y);this.hitLinkElement=this.getElementLinkAtPosition(n,o),!Ae(this.state)&&(this.hitLinkElement&&!this.state.selectedElementIds[this.hitLinkElement.id]?(gt(this.interactiveCanvas,en.POINTER),((e,t,s)=>{Gu&&clearTimeout(Gu),Gu=window.setTimeout((()=>$u(e,t,s)),xo)})(this.hitLinkElement,this.state,this.scene.getNonDeletedElementsMap())):(Vu(),o&&(o.link||ne(o))&&this.state.selectedElementIds[o.id]&&!this.state.contextMenu&&!this.state.showHyperlinkPopup?this.setState({showHyperlinkPopup:"info"}):"text"===this.state.activeTool.type?gt(this.interactiveCanvas,tt(o)?en.TEXT:en.CROSSHAIR):this.state.viewModeEnabled?gt(this.interactiveCanvas,en.GRAB):"elementLinkSelector"===this.state.openDialog?.name||s?gt(this.interactiveCanvas,en.AUTO):this.state.selectedLinearElement?this.handleHoverSelectedLinearElement(this.state.selectedLinearElement,i,a):e[j.CTRL_OR_CMD]?gt(this.interactiveCanvas,en.AUTO):(o||this.isHittingCommonBoundingBoxOfSelectedElements(n,r))&&!o?.locked&&(o&&Ml(o)&&this.isIframeLikeElementCenter(o,e,i,a)?(gt(this.interactiveCanvas,en.POINTER),this.setState({activeEmbeddable:{element:o,state:"hover"}})):(!o||!V(o))&&(gt(this.interactiveCanvas,en.MOVE),"hover"===this.state.activeEmbeddable?.state&&this.setState({activeEmbeddable:null})))),"elementLinkSelector"===this.state.openDialog?.name&&o?this.setState((e=>({hoveredElementIds:Pl(e.hoveredElementIds,De({editingGroupId:e.editingGroupId,selectedElementIds:{[o.id]:!0}},this.scene.getNonDeletedElements(),e,this).selectedElementIds)}))):"elementLinkSelector"===this.state.openDialog?.name&&!o&&this.setState((e=>({hoveredElementIds:Pl(e.hoveredElementIds,{})}))))})),Cc(this,"handleEraser",((e,t,s)=>{this.eraserTrail.addPointToPath(s.x,s.y);let n=!1,i=new Set,a=this.scene.getNonDeletedElements(),l=t=>{for(let s of t){if(s.locked)return;if(e.altKey?this.elementsPendingErasure.delete(s.id)&&(n=!0):this.elementsPendingErasure.has(s.id)||(n=!0,this.elementsPendingErasure.add(s.id)),n&&s.groupIds?.length){let t=s.groupIds.at(-1);if(!i.has(t)){i.add(t);let s=Gt(a,t);for(let t of s)e.altKey?this.elementsPendingErasure.delete(t.id):this.elementsPendingErasure.add(t.id)}}}},r=Ll(an(t.lastCoords.x,t.lastCoords.y),an(s.x,s.y)),o=this.getElementHitThreshold(),d={...t.lastCoords},c=0;for(;c<=r;){if(l(this.getElementsAtPosition(d.x,d.y)),c===r)break;c=Math.min(c+o,r);let e=c/r,t=(1-e)*d.x+e*s.x,n=(1-e)*d.y+e*s.y;d.x=t,d.y=n}if(t.lastCoords.x=s.x,t.lastCoords.y=s.y,n){for(let t of this.scene.getNonDeletedElements())Zt(t)&&(this.elementsPendingErasure.has(t.id)||this.elementsPendingErasure.has(t.containerId))&&(e.altKey?(this.elementsPendingErasure.delete(t.id),this.elementsPendingErasure.delete(t.containerId)):(this.elementsPendingErasure.add(t.id),this.elementsPendingErasure.add(t.containerId)));this.elementsPendingErasure=new Set(this.elementsPendingErasure),this.triggerRender()}})),Cc(this,"handleTouchMove",(e=>{hv=!0})),Cc(this,"handleCanvasPointerDown",(e=>{let t=e.target;if(t.setPointerCapture&&t.setPointerCapture(e.pointerId),this.maybeCleanupAfterMissingPointerUp(e.nativeEvent),this.maybeUnfollowRemoteUser(),this.state.searchMatches&&(this.setState((e=>({searchMatches:e.searchMatches.map((e=>({...e,focus:!1})))}))),wp.set(Db,null)),this.state.contextMenu&&this.setState({contextMenu:null}),this.state.snapLines&&this.setAppState({snapLines:[]}),this.updateGestureOnPointerDown(e),"touch"===e.pointerType&&this.state.newElement&&"freedraw"===this.state.newElement.type){let e=this.state.newElement;return void this.updateScene({...e.points.length<10?{elements:this.scene.getElementsIncludingDeleted().filter((t=>t.id!==e.id))}:{},appState:{newElement:null,editingTextElement:null,startBoundElement:null,suggestedBindings:[],selectedElementIds:Ye(Object.keys(this.state.selectedElementIds).filter((t=>t!==e.id)).reduce(((e,t)=>(e[t]=this.state.selectedElementIds[t],e)),{}),this.state)},captureUpdate:"elementLinkSelector"===this.state.openDialog?.name?Lt.EVENTUALLY:Lt.NEVER})}let s=document.getSelection();if(s?.anchorNode&&s.removeAllRanges(),this.maybeOpenContextMenuAfterPointerDownOnTouchDevices(e),!this.state.penDetected&&"pen"===e.pointerType&&this.setState((e=>({penMode:!0,penDetected:!0}))),!this.device.isTouchScreen&&["pen","touch"].includes(e.pointerType)&&(this.device=O(this.device,{isTouchScreen:!0})),ov||(this.lastPointerDownEvent=e,this.handleCanvasPanUsingWheelOrSpaceDrag(e)))return;if(this.setState({lastPointerDownWith:e.pointerType,cursorButton:"down"}),this.savePointer(e.clientX,e.clientY,"down"),e.button===Oa.ERASER&&this.state.activeTool.type!==Ya.eraser)return void this.setState({activeTool:_e(this.state,{type:Ya.eraser,lastActiveToolBeforeEraser:this.state.activeTool})},(()=>{this.handleCanvasPointerDown(e);let t,s=()=>{n(),t?.(),Ae(this.state)&&this.setState({activeTool:_e(this.state,{...this.state.activeTool.lastActiveTool||{type:Ya.selection},lastActiveToolBeforeEraser:null})})},n=Le(window,"pointerup",s,{once:!0});requestAnimationFrame((()=>{t=this.missingPointerEventCleanupEmitter.once(s)}))}));if(e.button!==Oa.MAIN&&e.button!==Oa.TOUCH&&e.button!==Oa.ERASER||bv.pointers.size>1)return;let n=this.initialPointerDownState(e);if(this.setState({selectedElementsAreBeingDragged:!1}),this.handleDraggingScrollBar(e,n)||(this.clearSelectionIfNotUsingSelection(),this.updateBindingEnabledOnPointerMove(e),this.handleSelectionOnPointerDown(e,n))||this.state.penMode&&"touch"===e.pointerType&&"selection"!==this.state.activeTool.type&&"text"!==this.state.activeTool.type&&"image"!==this.state.activeTool.type)return;if("text"===this.state.activeTool.type)this.handleTextOnPointerDown(e,n);else if("arrow"===this.state.activeTool.type||"line"===this.state.activeTool.type)this.handleLinearElementOnPointerDown(e,this.state.activeTool.type,n);else if("image"===this.state.activeTool.type){gt(this.interactiveCanvas,en.CROSSHAIR);let t=this.state.pendingImageElementId&&this.scene.getElement(this.state.pendingImageElementId);if(!t)return;this.setState({newElement:t,pendingImageElementId:null,multiElement:null});let{x:s,y:n}=Ge(e,this.state),i=this.getTopLayerFrameAtSceneCoords({x:s,y:n});He(t,{x:s,y:n,frameId:i?i.id:null})}else"freedraw"===this.state.activeTool.type?this.handleFreeDrawElementOnPointerDown(e,this.state.activeTool.type,n):"custom"===this.state.activeTool.type?wa(this.interactiveCanvas,this.state):this.state.activeTool.type===Ya.frame||this.state.activeTool.type===Ya.magicframe?this.createFrameElementOnPointerDown(n,this.state.activeTool.type):"laser"===this.state.activeTool.type?this.laserTrails.startPath(n.lastCoords.x,n.lastCoords.y):"eraser"!==this.state.activeTool.type&&"hand"!==this.state.activeTool.type&&this.createGenericElementOnPointerDown(this.state.activeTool.type,n);this.props?.onPointerDown?.(this.state.activeTool,n),this.onPointerDownEmitter.trigger(this.state.activeTool,n,e),"eraser"===this.state.activeTool.type&&this.eraserTrail.startPath(n.lastCoords.x,n.lastCoords.y);let i=this.onPointerMoveFromPointerDownHandler(n),a=this.onPointerUpFromPointerDownHandler(n),l=this.onKeyDownFromPointerDownHandler(n),r=this.onKeyUpFromPointerDownHandler(n);this.missingPointerEventCleanupEmitter.once((t=>a(t||e.nativeEvent))),(!this.state.viewModeEnabled||"laser"===this.state.activeTool.type)&&(window.addEventListener("pointermove",i),window.addEventListener("pointerup",a),window.addEventListener("keydown",l),window.addEventListener("keyup",r),n.eventListeners.onMove=i,n.eventListeners.onUp=a,n.eventListeners.onKeyUp=r,n.eventListeners.onKeyDown=l)})),Cc(this,"handleCanvasPointerUp",(e=>{this.removePointer(e),this.lastPointerUpEvent=e;let t=Ge({clientX:e.clientX,clientY:e.clientY},this.state),s=e.timeStamp-(this.lastPointerDownEvent?.timeStamp??0);if(this.device.editor.isMobile&&s<300){let s=this.getElementAtPosition(t.x,t.y);if(Ml(s)&&this.isIframeLikeElementCenter(s,e,t.x,t.y))return void this.handleEmbeddableCenterClick(s)}if(this.device.isTouchScreen){let e=this.getElementAtPosition(t.x,t.y);this.hitLinkElement=this.getElementLinkAtPosition(t,e)}this.hitLinkElement&&!this.state.selectedElementIds[this.hitLinkElement.id]?s<300&&Ml(this.hitLinkElement)&&!Yl(this.hitLinkElement,this.scene.getNonDeletedElementsMap(),this.state,an(t.x,t.y))?this.handleEmbeddableCenterClick(this.hitLinkElement):this.redirectToLink(e,this.device.isTouchScreen):this.state.viewModeEnabled&&this.setState({activeEmbeddable:null,selectedElementIds:{}})})),Cc(this,"maybeOpenContextMenuAfterPointerDownOnTouchDevices",(e=>{"touch"===e.pointerType&&(hv=!1,pv?hv=!0:pv=window.setTimeout((()=>{pv=0,hv||this.handleCanvasContextMenu(e)}),Gl))})),Cc(this,"resetContextMenuTimer",(()=>{clearTimeout(pv),pv=0,hv=!1})),Cc(this,"maybeCleanupAfterMissingPointerUp",(e=>{fv?.(),this.missingPointerEventCleanupEmitter.trigger(e).clear()})),Cc(this,"handleCanvasPanUsingWheelOrSpaceDrag",(e=>{if(!(bv.pointers.size<=1&&(e.button===Oa.WHEEL||e.button===Oa.MAIN&&rv||Js(this.state)||this.state.viewModeEnabled)))return!1;ov=!0,this.focusContainer(),this.state.editingTextElement||e.preventDefault();let t=!1,s=void 0!==typeof window&&/Linux/.test(window.navigator.platform);gt(this.interactiveCanvas,en.GRABBING);let{clientX:n,clientY:i}=e,a=ly((e=>{let a=n-e.clientX,l=i-e.clientY;if(n=e.clientX,i=e.clientY,s&&!t&&(Math.abs(a)>1||Math.abs(l)>1)){t=!0;let e=t=>{document.body.removeEventListener("paste",e),t.stopPropagation()},s=()=>{setTimeout((()=>{document.body.removeEventListener("paste",e),window.removeEventListener("pointerup",s)}),100)};document.body.addEventListener("paste",e),window.addEventListener("pointerup",s)}this.translateCanvas({scrollX:this.state.scrollX-a/this.state.zoom.value,scrollY:this.state.scrollY-l/this.state.zoom.value})})),l=ay(fv=()=>{fv=null,ov=!1,rv||(this.state.viewModeEnabled?gt(this.interactiveCanvas,en.GRAB):wa(this.interactiveCanvas,this.state)),this.setState({cursorButton:"up"}),this.savePointer(e.clientX,e.clientY,"up"),window.removeEventListener("pointermove",a),window.removeEventListener("pointerup",l),window.removeEventListener("blur",l),a.flush()});return window.addEventListener("blur",l),window.addEventListener("pointermove",a,{passive:!0}),window.addEventListener("pointerup",l),!0})),Cc(this,"clearSelectionIfNotUsingSelection",(()=>{"selection"!==this.state.activeTool.type&&this.setState({selectedElementIds:Ye({},this.state),selectedGroupIds:{},editingGroupId:null,activeEmbeddable:null})})),Cc(this,"handleSelectionOnPointerDown",((e,t)=>{if("selection"===this.state.activeTool.type){let s=this.scene.getNonDeletedElements(),n=this.scene.getNonDeletedElementsMap(),i=this.scene.getSelectedElements(this.state);if(1!==i.length||this.state.editingLinearElement||V(i[0])||this.state.selectedLinearElement&&-1!==this.state.selectedLinearElement.hoverPointIndex)i.length>1&&(t.resize.handleType=Hl(xt(i),t.origin.x,t.origin.y,this.state.zoom,e.pointerType,this.device));else{let n=zl(s,this.state,t.origin.x,t.origin.y,this.state.zoom,e.pointerType,this.scene.getNonDeletedElementsMap(),this.device);null!=n&&("rotation"===n.transformHandleType?(this.setState({resizingElement:n.element}),t.resize.handleType=n.transformHandleType):(this.state.croppingElementId||this.setState({resizingElement:n.element}),t.resize.handleType=n.transformHandleType))}if(t.resize.handleType)t.resize.isResizing=!0,t.resize.offset=Be($l(t.resize.handleType,i,n,t.origin.x,t.origin.y)),1===i.length&&zt(i[0])&&2===i[0].points.length&&(t.resize.arrowDirection=Vl(t.resize.handleType,i[0]));else{if(this.state.selectedLinearElement){let s=this.state.editingLinearElement||this.state.selectedLinearElement,n=ze.handlePointerDown(e,this,this.store,t.origin,s,this.scene);if(n.hitElement&&(t.hit.element=n.hitElement),n.linearElementEditor&&(this.setState({selectedLinearElement:n.linearElementEditor}),this.state.editingLinearElement&&this.setState({editingLinearElement:n.linearElementEditor})),n.didAddPoint)return!0}if(t.hit.element=t.hit.element??this.getElementAtPosition(t.origin.x,t.origin.y),this.hitLinkElement=this.getElementLinkAtPosition(t.origin,t.hit.element),this.hitLinkElement)return!0;if(this.state.croppingElementId&&t.hit.element?.id!==this.state.croppingElementId&&this.finishImageCropping(),t.hit.element&&this.getElementLinkAtPosition({x:t.origin.x,y:t.origin.y},t.hit.element))return!1;t.hit.allHitElements=this.getElementsAtPosition(t.origin.x,t.origin.y);let s=t.hit.element,n=t.hit.allHitElements.some((e=>this.isASelectedElement(e)));if((null===s||!n)&&!e.shiftKey&&!t.hit.hasHitCommonBoundingBoxOfSelectedElements&&this.clearSelection(s),this.state.editingLinearElement)this.setState({selectedElementIds:Ye({[this.state.editingLinearElement.elementId]:!0},this.state)});else if(null!=s){if(e[j.CTRL_OR_CMD])return this.state.selectedElementIds[s.id]||(t.hit.wasAddedToSelection=!0),this.setState((e=>({...Wl(e,s),previousSelectedElementIds:this.state.selectedElementIds}))),!1;this.state.selectedElementIds[s.id]||(this.state.editingGroupId&&!Ct(s,this.state.editingGroupId)&&this.setState({selectedElementIds:Ye({},this.state),selectedGroupIds:{},editingGroupId:null,activeEmbeddable:null}),!n&&!t.hit.hasHitCommonBoundingBoxOfSelectedElements&&(this.setState((e=>{let t={...e.selectedElementIds,[s.id]:!0},n=[];if(Object.keys(e.selectedElementIds).forEach((e=>{let t=this.scene.getElement(e);t&&n.push(t)})),it(s))$t(n,s.id).forEach((e=>{delete t[e.id]}));else if(s.frameId)t[s.frameId]&&delete t[s.id];else{let e=s.groupIds,i=new Set(e.flatMap((e=>Gt(this.scene.getNonDeletedElements(),e))).filter((e=>it(e))).map((e=>e.id)));i.size>0&&n.forEach((e=>{e.frameId&&i.has(e.frameId)&&(delete t[e.id],e.groupIds.flatMap((e=>Gt(this.scene.getNonDeletedElements(),e))).forEach((e=>{delete t[e.id]})))}))}return"elementLinkSelector"===e.openDialog?.name&&(s.groupIds.some((t=>e.selectedGroupIds[t]))||(t={[s.id]:!0})),{...De({editingGroupId:e.editingGroupId,selectedElementIds:t},this.scene.getNonDeletedElements(),e,this),showHyperlinkPopup:!(!s.link&&!ne(s))&&"info"}})),t.hit.wasAddedToSelection=!0))}this.setState({previousSelectedElementIds:this.state.selectedElementIds})}}return!1})),Cc(this,"handleTextOnPointerDown",((e,t)=>{if(this.state.editingTextElement)return;let s=t.origin.x,n=t.origin.y,i=this.getElementAtPosition(s,n,{includeBoundTextElement:!0}),a=this.getTextBindableContainerAtPosition(s,n);Wt(i)&&(a=i,s=i.x+i.width/2,n=i.y+i.height/2),this.startTextEditing({sceneX:s,sceneY:n,insertAtParentCenter:!e.altKey,container:a,autoEdit:!1}),ln(this.interactiveCanvas),this.state.activeTool.locked||this.setState({activeTool:_e(this.state,{type:"selection"})})})),Cc(this,"handleFreeDrawElementOnPointerDown",((e,t,s)=>{let[n,i]=ft(s.origin.x,s.origin.y,null),a=this.getTopLayerFrameAtSceneCoords({x:n,y:i}),l=.5===e.pressure,r=Kl({type:t,x:n,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,roundness:null,simulatePressure:l,locked:!1,frameId:a?a.id:null,points:[an(0,0)],pressures:l?[]:[e.pressure]});this.scene.insertElement(r),this.setState((e=>{let t={...e.selectedElementIds};return delete t[r.id],{selectedElementIds:Ye(t,e)}}));let o=Zl(s.origin,this.scene.getNonDeletedElements(),this.scene.getNonDeletedElementsMap(),this.state.zoom);this.setState({newElement:r,startBoundElement:o,suggestedBindings:[]})})),Cc(this,"insertIframeElement",(({sceneX:e,sceneY:t,width:s,height:n})=>{let[i,a]=ft(e,t,this.lastPointerDownEvent?.[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),l=Xl({type:"iframe",x:i,y:a,strokeColor:"transparent",backgroundColor:"transparent",fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,roundness:this.getCurrentItemRoundness("iframe"),opacity:this.state.currentItemOpacity,locked:!1,width:s,height:n});return this.scene.insertElement(l),l})),Cc(this,"insertEmbeddableElement",(({sceneX:e,sceneY:t,link:s})=>{let[n,i]=ft(e,t,this.lastPointerDownEvent?.[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),a=oe(s);if(!a)return;a.error instanceof URIError&&this.setToast({message:Np("toast.unrecognizedLinkFormat"),closable:!0});let l=ql({type:"embeddable",x:n,y:i,strokeColor:"transparent",backgroundColor:"transparent",fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,roundness:this.getCurrentItemRoundness("embeddable"),opacity:this.state.currentItemOpacity,locked:!1,width:a.intrinsicSize.w,height:a.intrinsicSize.h,link:s});return this.scene.insertElement(l),l})),Cc(this,"createImageElement",(({sceneX:e,sceneY:t,addToFrameUnderCursor:s=!0})=>{let[n,i]=ft(e,t,this.lastPointerDownEvent?.[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),a=s?this.getTopLayerFrameAtSceneCoords({x:n,y:i}):null;return Ql({type:"image",x:n,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,roundness:null,opacity:this.state.currentItemOpacity,locked:!1,frameId:a?a.id:null})})),Cc(this,"handleLinearElementOnPointerDown",((e,t,s)=>{if(this.state.multiElement){let{multiElement:e}=this.state;if("line"===e.type&&nn(e.points,this.state.zoom.value))return He(e,{lastCommittedPoint:e.points[e.points.length-1]}),void this.actionManager.executeAction(Ym);if(V(e)&&e.points.length>1)return He(e,{lastCommittedPoint:e.points[e.points.length-1]}),void this.actionManager.executeAction(Ym);let{x:t,y:n,lastCommittedPoint:i}=e;if(e.points.length>1&&i&&Ll(an(s.origin.x-t,s.origin.y-n),i)<Ol)return void this.actionManager.executeAction(Ym);this.setState((t=>({selectedElementIds:Ye({...t.selectedElementIds,[e.id]:!0},t)}))),He(e,{lastCommittedPoint:e.points[e.points.length-1]}),gt(this.interactiveCanvas,en.POINTER)}else{let[n,i]=ft(s.origin.x,s.origin.y,e[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),a=this.getTopLayerFrameAtSceneCoords({x:n,y:i}),{currentItemStartArrowhead:l,currentItemEndArrowhead:r}=this.state,[o,d]="arrow"===t?[l,r]:[null,null],c="arrow"===t?Jl({type:t,x:n,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,roundness:this.state.currentItemArrowType===Os.round?{type:yt.PROPORTIONAL_RADIUS}:null,startArrowhead:o,endArrowhead:d,locked:!1,frameId:a?a.id:null,elbowed:this.state.currentItemArrowType===Os.elbow,fixedSegments:this.state.currentItemArrowType===Os.elbow?[]:null}):er({type:t,x:n,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,roundness:"round"===this.state.currentItemRoundness?{type:yt.PROPORTIONAL_RADIUS}:null,locked:!1,frameId:a?a.id:null});this.setState((e=>{let t={...e.selectedElementIds};return delete t[c.id],{selectedElementIds:Ye(t,e)}})),He(c,{points:[...c.points,an(0,0)]});let p=Zl(s.origin,this.scene.getNonDeletedElements(),this.scene.getNonDeletedElementsMap(),this.state.zoom,V(c),V(c));this.scene.insertElement(c),this.setState({newElement:c,startBoundElement:p,suggestedBindings:[]})}})),Cc(this,"createGenericElementOnPointerDown",((e,t)=>{let s,[n,i]=ft(t.origin.x,t.origin.y,this.lastPointerDownEvent?.[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),a=this.getTopLayerFrameAtSceneCoords({x:n,y:i}),l={x:n,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,roundness:this.getCurrentItemRoundness(e),locked:!1,frameId:a?a.id:null};s="embeddable"===e?ql({type:"embeddable",...l}):ki({type:e,...l}),"selection"===s.type?this.setState({selectionElement:s}):(this.scene.insertElement(s),this.setState({multiElement:null,newElement:s}))})),Cc(this,"createFrameElementOnPointerDown",((e,t)=>{let[s,n]=ft(e.origin.x,e.origin.y,this.lastPointerDownEvent?.[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),i={x:s,y:n,opacity:this.state.currentItemOpacity,locked:!1,...za},a=t===Ya.magicframe?Ga(i):Sa(i);this.scene.insertElement(a),this.setState({multiElement:null,newElement:a})})),Cc(this,"restoreReadyToEraseElements",(()=>{this.elementsPendingErasure=new Set,this.triggerRender()})),Cc(this,"eraseElements",(()=>{let e=!1,t=this.scene.getElementsIncludingDeleted().map((t=>this.elementsPendingErasure.has(t.id)||t.frameId&&this.elementsPendingErasure.has(t.frameId)||Zt(t)&&this.elementsPendingErasure.has(t.containerId)?(e=!0,Dt(t,{isDeleted:!0})):t));this.elementsPendingErasure=new Set,e&&(this.store.shouldCaptureIncrement(),this.scene.replaceAllElements(t))})),Cc(this,"initializeImage",(async({imageFile:e,imageElement:t,showCursorImagePreview:s=!1})=>{if(!tl(e))throw new Error(Np("errors.unsupportedFileType"));let n=e.type;if(gt(this.interactiveCanvas,"wait"),n===Fi.svg)try{e=el(pl(await e.text()),e.name)}catch(e){throw console.warn(e),new Error(Np("errors.svgImageInsertError"))}let i=await(this.props.generateIdForFile?.(e)||tr(e));if(!i)throw console.warn("Couldn't generate file id or the supplied `generateIdForFile` didn't resolve to one."),new Error(Np("errors.imageInsertError"));if(!this.files[i]?.dataURL){try{e=await sr(e,{maxWidthOrHeight:nr})}catch(e){console.error("Error trying to resizing image file on insertion",e)}if(e.size>ir)throw new Error(Np("errors.fileTooBig",{maxSize:`${Math.trunc(ir/1024/1024)}MB`}))}if(s){let t=this.files[i]?.dataURL,s=t&&ar(t);this.setImagePreviewCursor(s||e)}let a=this.files[i]?.dataURL||await lr(e),l=He(t,{fileId:i},!1);return new Promise((async(e,t)=>{try{this.addMissingFiles([{mimeType:n,id:i,dataURL:a,created:Date.now(),lastRetrieved:Date.now()}]);let t=this.imageCache.get(i);t||(this.addNewImagesToImageCache(),await this.updateImageCache([l])),t?.image instanceof Promise&&await t.image,this.state.pendingImageElementId!==l.id&&this.state.newElement?.id!==l.id&&this.initializeImageDimensions(l,!0),e(l)}catch(e){console.error(e),t(new Error(Np("errors.imageInsertError")))}finally{s||ln(this.interactiveCanvas)}}))})),Cc(this,"insertImageElement",(async(e,t,s)=>{if(this.isToolSupported("image")){this.scene.insertElement(e);try{return await this.initializeImage({imageFile:t,imageElement:e,showCursorImagePreview:s})}catch(t){return He(e,{isDeleted:!0}),this.actionManager.executeAction(Ym),this.setState({errorMessage:t.message||Np("errors.imageInsertError")}),null}}else this.setState({errorMessage:Np("errors.imageToolNotSupported")})})),Cc(this,"setImagePreviewCursor",(async e=>{let t;try{t=await sr(e,{maxWidthOrHeight:96})}catch(e){throw"UNSUPPORTED"===e.cause?new Error(Np("errors.unsupportedFileType")):e}let s=await lr(t);if(e.type===Fi.svg){let e=await rr(s),t=Math.min(e.height,96),n=t*(e.width/e.height);n>96&&(n=96,t=n*(e.height/e.width));let i=document.createElement("canvas");i.height=t,i.width=n,i.getContext("2d").drawImage(e,0,0,n,t),s=i.toDataURL(Fi.svg)}this.state.pendingImageElementId&&gt(this.interactiveCanvas,`url(${s}) 4 4, auto`)})),Cc(this,"onImageAction",(async({insertOnCanvasDirectly:e})=>{try{let t=this.state.width/2+this.state.offsetLeft,s=this.state.height/2+this.state.offsetTop,{x:n,y:i}=Ge({clientX:t,clientY:s},this.state),a=await or({description:"Image",extensions:Object.keys(dr)}),l=this.createImageElement({sceneX:n,sceneY:i,addToFrameUnderCursor:!1});e?(this.insertImageElement(l,a),this.initializeImageDimensions(l),this.setState({selectedElementIds:Ye({[l.id]:!0},this.state)},(()=>{this.actionManager.executeAction(Ym)}))):this.setState({pendingImageElementId:l.id},(()=>{this.insertImageElement(l,a,!0)}))}catch(e){"AbortError"!==e.name?console.error(e):console.warn(e),this.setState({pendingImageElementId:null,newElement:null,activeTool:_e(this.state,{type:"selection"})},(()=>{this.actionManager.executeAction(Ym)}))}})),Cc(this,"initializeImageDimensions",((e,t=!1)=>{let s=we(e)&&this.imageCache.get(e.fileId)?.image;if(!s||s instanceof Promise){if(e.width<Nl/this.state.zoom.value&&e.height<Nl/this.state.zoom.value){let t=100/this.state.zoom.value;He(e,{x:e.x-t/2,y:e.y-t/2,width:t,height:t})}}else if(t||e.width<Nl/this.state.zoom.value&&e.height<Nl/this.state.zoom.value){let t=Math.max(this.state.height-120,160),n=Math.min(t,Math.floor(.5*this.state.height)/this.state.zoom.value),i=Math.min(s.naturalHeight,n),a=i*(s.naturalWidth/s.naturalHeight),l=e.x+e.width/2-a/2,r=e.y+e.height/2-i/2;He(e,{x:l,y:r,width:a,height:i,crop:null})}})),Cc(this,"updateImageCache",(async(e,t=this.files)=>{let{updatedFiles:s,erroredFiles:n}=await cr({imageCache:this.imageCache,fileIds:e.map((e=>e.fileId)),files:t});if(s.size||n.size)for(let t of e)s.has(t.fileId)&&Se.delete(t);return n.size&&this.scene.replaceAllElements(this.scene.getElementsIncludingDeleted().map((e=>we(e)&&n.has(e.fileId)?Dt(e,{status:"error"}):e))),{updatedFiles:s,erroredFiles:n}})),Cc(this,"addNewImagesToImageCache",(async(e=pr(this.scene.getNonDeletedElements()),t=this.files)=>{let s=e.filter((e=>!e.isDeleted&&!this.imageCache.has(e.fileId)));if(s.length){let{updatedFiles:e}=await this.updateImageCache(s,t);e.size&&this.scene.triggerUpdate()}})),Cc(this,"scheduleImageRefresh",ap((()=>{this.addNewImagesToImageCache()}),jd)),Cc(this,"updateBindingEnabledOnPointerMove",(e=>{let t=hr(e);this.state.isBindingEnabled!==t&&this.setState({isBindingEnabled:t})})),Cc(this,"maybeSuggestBindingAtCursor",((e,t)=>{let s=Zl(e,this.scene.getNonDeletedElements(),this.scene.getNonDeletedElementsMap(),this.state.zoom,!1,t);this.setState({suggestedBindings:null!=s?[s]:[]})})),Cc(this,"maybeSuggestBindingsForLinearElementAtCoords",((e,t,s)=>{if(!t.length)return;let n=t.reduce(((t,n)=>{let i=Zl(n,this.scene.getNonDeletedElements(),this.scene.getNonDeletedElementsMap(),this.state.zoom,V(e),V(e));return null!=i&&!mr(e,s?.id,i)&&t.push(i),t}),[]);this.setState({suggestedBindings:n})})),Cc(this,"handleInteractiveCanvasRef",(e=>{null!==e?(this.interactiveCanvas=e,this.interactiveCanvas.addEventListener("touchstart",this.onTouchStart,{passive:!1}),this.interactiveCanvas.addEventListener("touchend",this.onTouchEnd)):(this.interactiveCanvas?.removeEventListener("touchstart",this.onTouchStart),this.interactiveCanvas?.removeEventListener("touchend",this.onTouchEnd))})),Cc(this,"handleAppOnDrop",(async e=>{let{file:t,fileHandle:s}=await ur(e),{x:n,y:i}=Ge(e,this.state);try{if(tl(t)&&this.isToolSupported("image")){if(t?.type===Fi.png||t?.type===Fi.svg)try{let e=await gr(t,this.state,this.scene.getElementsIncludingDeleted(),s);return void this.syncActionResult({...e,appState:{...e.appState||this.state,isLoading:!1},replaceFiles:!0,captureUpdate:Lt.IMMEDIATELY})}catch(e){if("EncodingError"!==e.name)throw new Error(Np("alerts.couldNotLoadInvalidFile"))}let e=this.createImageElement({sceneX:n,sceneY:i});return this.insertImageElement(e,t),this.initializeImageDimensions(e),void this.setState({selectedElementIds:Ye({[e.id]:!0},this.state)})}}catch(e){return this.setState({isLoading:!1,errorMessage:e.message})}let a=e.dataTransfer.getData(Fi.excalidrawlib);if(a&&"string"==typeof a)try{let t=xr(a);this.addElementsFromPasteOrLibrary({elements:og(t),position:e,files:null})}catch(e){this.setState({errorMessage:e.message})}else if(t&&await this.loadFileToCanvas(t,s),e.dataTransfer?.types?.includes("text/plain")){let t=e.dataTransfer?.getData("text");if(t&&Di(t,this.props.validateEmbeddable)&&(/^(http|https):\/\/[^\s/$.?#].[^\s]*$/.test(t)||"video"===oe(t)?.type)){let e=this.insertEmbeddableElement({sceneX:n,sceneY:i,link:ji(t)});e&&this.setState({selectedElementIds:{[e.id]:!0}})}}})),Cc(this,"loadFileToCanvas",(async(e,t)=>{e=await fr(e);try{let s,n=this.scene.getElementsIncludingDeleted();try{s=await br(e,this.state,n,t)}catch(e){let t=e instanceof Er;if(t&&"IMAGE_NOT_CONTAINS_SCENE_DATA"===e.code&&!this.isToolSupported("image"))return void this.setState({isLoading:!1,errorMessage:Np("errors.imageToolNotSupported")});let s=Np(t?"alerts.cannotRestoreFromImage":"alerts.couldNotLoadInvalidFile");this.setState({isLoading:!1,errorMessage:s})}if(!s)return;s.type===Fi.excalidraw?(ml(n.concat(s.data.elements)),this.store.updateSnapshot(Ht(n),this.state),this.setState({isLoading:!0}),this.syncActionResult({...s.data,appState:{...s.data.appState||this.state,isLoading:!1},replaceFiles:!0,captureUpdate:Lt.IMMEDIATELY})):s.type===Fi.excalidrawlib&&await this.library.updateLibrary({libraryItems:e,merge:!0,openLibraryMenu:!0}).catch((e=>{console.error(e),this.setState({errorMessage:Np("errors.importLibraryError")})}))}catch(e){this.setState({isLoading:!1,errorMessage:e.message})}})),Cc(this,"handleCanvasContextMenu",(e=>{if(e.preventDefault(),("pointerType"in e.nativeEvent&&"touch"===e.nativeEvent.pointerType||"pointerType"in e.nativeEvent&&"pen"===e.nativeEvent.pointerType&&e.button!==Oa.SECONDARY)&&"selection"!==this.state.activeTool.type)return;let{x:t,y:s}=Ge(e,this.state),n=this.getElementAtPosition(t,s,{preferSelected:!0,includeLockedElements:!0}),i=this.scene.getSelectedElements(this.state),a=this.isHittingCommonBoundingBoxOfSelectedElements({x:t,y:s},i),l=n||a?"element":"canvas",r=this.excalidrawContainerRef.current,{top:o,left:d}=r.getBoundingClientRect(),c=e.clientX-d,p=e.clientY-o;dh("contextMenu","openContextMenu",l),this.setState({...n&&!this.state.selectedElementIds[n.id]?{...this.state,...De({editingGroupId:this.state.editingGroupId,selectedElementIds:{[n.id]:!0}},this.scene.getNonDeletedElements(),this.state,this),selectedLinearElement:zt(n)?new ze(n):null}:this.state,showHyperlinkPopup:!1},(()=>{this.setState({contextMenu:{top:p,left:c,items:this.getContextMenuItems(l)}})}))})),Cc(this,"maybeDragNewGenericElement",((e,t,s=!0)=>{let n=this.state.selectionElement,i=e.lastCoords;if(n&&"eraser"!==this.state.activeTool.type)return void yr({newElement:n,elementType:this.state.activeTool.type,originX:e.origin.x,originY:e.origin.y,x:i.x,y:i.y,width:vr(e.origin.x,i.x),height:vr(e.origin.y,i.y),shouldMaintainAspectRatio:wr(t),shouldResizeFromCenter:Sr(t),zoom:this.state.zoom.value,informMutation:s});let a=this.state.newElement;if(!a)return;let[l,r]=ft(i.x,i.y,t[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),o=we(a)&&this.imageCache.get(a.fileId)?.image,d=!o||o instanceof Promise?null:o.width/o.height;this.maybeCacheReferenceSnapPoints(t,[a]);let{snapOffset:c,snapLines:p}=Cr(a,this,t,{x:e.originInGrid.x+(this.state.originSnapOffset?.x??0),y:e.originInGrid.y+(this.state.originSnapOffset?.y??0)},{x:l-e.originInGrid.x,y:r-e.originInGrid.y},this.scene.getNonDeletedElementsMap());l+=c.x,r+=c.y,this.setState({snapLines:p}),yr({newElement:a,elementType:this.state.activeTool.type,originX:e.originInGrid.x,originY:e.originInGrid.y,x:l,y:r,width:vr(e.originInGrid.x,l),height:vr(e.originInGrid.y,r),shouldMaintainAspectRatio:B(a)?!wr(t):wr(t),shouldResizeFromCenter:Sr(t),zoom:this.state.zoom.value,widthAspectRatio:d,originOffset:this.state.originSnapOffset,informMutation:s}),this.setState({newElement:a}),(this.state.activeTool.type===Ya.frame||this.state.activeTool.type===Ya.magicframe)&&this.setState({elementsToHighlight:Bn(this.scene.getNonDeletedElements(),a,this.state,this.scene.getNonDeletedElementsMap())})})),Cc(this,"maybeHandleCrop",((e,t)=>{if(!this.state.croppingElementId)return!1;let s=e.resize.handleType,n=e.lastCoords,[i,a]=ft(n.x-e.resize.offset.x,n.y-e.resize.offset.y,t[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),l=this.scene.getNonDeletedElementsMap().get(this.state.croppingElementId);if(s&&l&&B(l)){let r=e.originalElements.get(l.id),o=we(l)&&this.imageCache.get(l.fileId)?.image;if(r&&B(r)&&o&&!(o instanceof Promise)){let[d,c]=ft(n.x,n.y,t[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),p={x:d-e.originInGrid.x,y:c-e.originInGrid.y};this.maybeCacheReferenceSnapPoints(t,[l]);let{snapOffset:h,snapLines:m}=Ir([l],[r],this,t,p,s);He(l,kr(l,s,o.naturalWidth,o.naturalHeight,i+h.x,a+h.y,t.shiftKey?r.width/r.height:void 0)),yl(l,this.scene.getNonDeletedElementsMap(),{newSize:{width:l.width,height:l.height}}),this.setState({isCropping:s&&"rotation"!==s,snapLines:m})}return!0}return!1})),Cc(this,"maybeHandleResize",((e,t)=>{let s=this.scene.getSelectedElements(this.state),n=s.filter((e=>it(e))),i=e.resize.handleType;if(n.length>0&&"rotation"===i||1===s.length&&V(s[0])||this.state.croppingElementId)return!1;this.setState({isResizing:i&&"rotation"!==i,isRotating:"rotation"===i,activeEmbeddable:null});let a=e.lastCoords,[l,r]=ft(a.x-e.resize.offset.x,a.y-e.resize.offset.y,t[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),o=new Map;if(n.forEach((e=>{$t(this.scene.getNonDeletedElements(),e.id).forEach((t=>{o.set(e.id+t.id,{x:t.x-e.x,y:t.y-e.y})}))})),!this.state.selectedElementsAreBeingDragged){let[n,o]=ft(a.x,a.y,t[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),d={x:n-e.originInGrid.x,y:o-e.originInGrid.y},c=[...e.originalElements.values()];this.maybeCacheReferenceSnapPoints(t,s);let{snapOffset:p,snapLines:h}=Ir(s,S(c,this.state),this,t,d,i);l+=p.x,r+=p.y,this.setState({snapLines:h})}if(Tr(e.originalElements,i,s,this.scene.getElementsMapIncludingDeleted(),this.scene,Fl(t),Sr(t),s.some((e=>B(e)))?!wr(t):wr(t),l,r,e.resize.center.x,e.resize.center.y)){let e=vl(s,this.scene.getNonDeletedElementsMap(),this.state.zoom),t=new Set;return n.forEach((e=>{Bn(this.scene.getNonDeletedElements(),e,this.state,this.scene.getNonDeletedElementsMap()).forEach((e=>t.add(e)))})),this.setState({elementsToHighlight:[...t],suggestedBindings:e}),!0}return!1})),Cc(this,"getContextMenuItems",(e=>{let t=[];return t.push(Mu,Tu),"canvas"===e?this.state.viewModeEnabled?[...t,Du,Lu,VE,Au]:[Iu,Qx,Mu,Tu,ju,Qx,nh,qu,Qx,Du,Nu,Lu,VE,Au]:(t.push(ju),this.state.viewModeEnabled?[Cu,...t]:[Qx,ku,Cu,Iu,Qx,KE,ZE,XE,Qx,zx,Qx,...t,Qx,au,lu,Qx,du,Fy,_u,Pu,Fu,cu,Qx,uu,Qx,Jp,eh,th,sh,Qx,yu,vu,Qx,Fx,Qx,Ku,Cx,Qx,ah,Xu,Qx,zp])})),Cc(this,"handleWheel",ay((e=>{if(!(e.target instanceof HTMLCanvasElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLIFrameElement))return void(e[j.CTRL_OR_CMD]&&e.preventDefault());if(e.preventDefault(),ov)return;let{deltaX:t,deltaY:s}=e;if(e.metaKey||e.ctrlKey){let e=Math.sign(s),t=100*Gs,n=Math.abs(s),i=s;n>t&&(i=t*e);let a=this.state.zoom.value-i/100;return a+=Math.log10(Math.max(1,this.state.zoom.value))*-e*Math.min(1,n/20),this.translateCanvas((e=>({...Lm({viewportX:this.lastViewportPosition.x,viewportY:this.lastViewportPosition.y,nextZoom:Ys(a)},e),shouldCacheIgnoreZoom:!0}))),void this.resetShouldCacheIgnoreZoomDebounced()}e.shiftKey?this.translateCanvas((({zoom:e,scrollX:n})=>({scrollX:n-(s||t)/e.value}))):this.translateCanvas((({zoom:e,scrollX:n,scrollY:i})=>({scrollX:n-t/e.value,scrollY:i-s/e.value})))}))),Cc(this,"savePointer",((e,t,s)=>{if(!e||!t)return;let{x:n,y:i}=Ge({clientX:e,clientY:t},this.state),a={x:n,y:i,tool:"laser"===this.state.activeTool.type?"laser":"pointer"};this.props.onPointerUpdate?.({pointer:a,button:s,pointersMap:bv.pointers})})),Cc(this,"resetShouldCacheIgnoreZoomDebounced",l((()=>{this.unmounted||this.setState({shouldCacheIgnoreZoom:!1})}),300)),Cc(this,"updateDOMRect",(e=>{if(this.excalidrawContainerRef?.current){let t=this.excalidrawContainerRef.current,{width:s,height:n,left:i,top:a}=t.getBoundingClientRect(),{width:l,height:r,offsetTop:o,offsetLeft:d}=this.state;if(s===l&&n===r&&i===d&&a===o)return void(e&&e());this.setState({width:s,height:n,offsetLeft:i,offsetTop:a},(()=>{e&&e()}))}})),Cc(this,"refresh",(()=>{this.setState({...this.getCanvasOffsets()})}));let s=K(),{excalidrawAPI:i,viewModeEnabled:a=!1,zenModeEnabled:r=!1,gridModeEnabled:o=!1,objectsSnapModeEnabled:d=!1,theme:p=s.theme,name:h=`${Np("labels.untitled")}-${q()}`}=t;if(this.state={...s,theme:p,isLoading:!0,...this.getCanvasOffsets(),viewModeEnabled:a,zenModeEnabled:r,objectsSnapModeEnabled:d,gridModeEnabled:o??s.gridModeEnabled,name:h,width:window.innerWidth,height:window.innerHeight},this.id=Qc(),this.library=new rg(this),this.actionManager=new Wx(this.syncActionResult,(()=>this.state),(()=>this.scene.getElementsIncludingDeleted()),this),this.scene=new Q,this.canvas=document.createElement("canvas"),this.rc=qc.canvas(this.canvas),this.renderer=new My(this.scene),this.visibleElements=[],this.store=new J,this.history=new Hx,i){let e={updateScene:this.updateScene,updateLibrary:this.library.updateLibrary,addFiles:this.addFiles,resetScene:this.resetScene,getSceneElementsIncludingDeleted:this.getSceneElementsIncludingDeleted,history:{clear:this.resetHistory},scrollToContent:this.scrollToContent,getSceneElements:this.getSceneElements,getAppState:()=>this.state,getFiles:()=>this.files,getName:this.getName,registerAction:e=>{this.actionManager.registerAction(e)},refresh:this.refresh,setToast:this.setToast,id:this.id,setActiveTool:this.setActiveTool,setCursor:this.setCursor,resetCursor:this.resetCursor,updateFrameRendering:this.updateFrameRendering,toggleSidebar:this.toggleSidebar,onChange:e=>this.onChangeEmitter.on(e),onPointerDown:e=>this.onPointerDownEmitter.on(e),onPointerUp:e=>this.onPointerUpEmitter.on(e),onScrollChange:e=>this.onScrollChangeEmitter.on(e),onUserFollow:e=>this.onUserFollowEmitter.on(e)};"function"==typeof i?i(e):console.error("excalidrawAPI should be a function!")}this.excalidrawContainerValue={container:this.excalidrawContainerRef.current,id:this.id},this.fonts=new n(this.scene),this.history=new Hx,this.actionManager.registerAll(ee),this.actionManager.registerAction(((e,t)=>({name:"undo",label:"buttons.undo",icon:Ji,trackEvent:{category:"history"},viewMode:!1,perform:(s,n,i,a)=>$x(a,n,(()=>e.undo(Ht(s),n,t.snapshot))),keyTest:e=>e[j.CTRL_OR_CMD]&&ea(e,j.Z)&&!e.shiftKey,PanelComponent:({updateData:t,data:s})=>{let{isUndoStackEmpty:n}=Gx(e.onHistoryChangedEmitter,new Ux(e.isUndoStackEmpty,e.isRedoStackEmpty));return gp.exports.jsx(Fp,{type:"button",icon:Ji,"aria-label":Np("buttons.undo"),onClick:t,size:s?.size||"medium",disabled:n,"data-testid":"button-undo"})}}))(this.history,this.store)),this.actionManager.registerAction(((e,t)=>({name:"redo",label:"buttons.redo",icon:ta,trackEvent:{category:"history"},viewMode:!1,perform:(s,n,i,a)=>$x(a,n,(()=>e.redo(Ht(s),n,t.snapshot))),keyTest:e=>e[j.CTRL_OR_CMD]&&e.shiftKey&&ea(e,j.Z)||sa&&e.ctrlKey&&!e.shiftKey&&ea(e,j.Y),PanelComponent:({updateData:t,data:s})=>{let{isRedoStackEmpty:n}=Gx(e.onHistoryChangedEmitter,new Ux(e.isUndoStackEmpty,e.isRedoStackEmpty));return gp.exports.jsx(Fp,{type:"button",icon:ta,"aria-label":Np("buttons.redo"),onClick:t,size:s?.size||"medium",disabled:n,"data-testid":"button-redo"})}}))(this.history,this.store))}onWindowMessage(e){if("https://player.vimeo.com"!==e.origin&&"https://www.youtube.com"!==e.origin)return;let t=null;try{t=JSON.parse(e.data)}catch{}if(t)switch(e.origin){case"https://player.vimeo.com":if("paused"===t.method){let s=null,n=document.body.querySelectorAll("iframe.excalidraw__embeddable");if(!n)break;for(let t of n)t.contentWindow===e.source&&(s=t.contentWindow);s?.postMessage(JSON.stringify({method:t.value?"play":"pause",value:!0}),"*")}break;case"https://www.youtube.com":if("infoDelivery"===t.event&&t.info&&t.id&&"number"==typeof t.info.playerState){let e=t.id,s=t.info.playerState;Object.values(te).includes(s)&&mv.set(e,s)}}}cacheEmbeddableRef(e,t){t&&this.iFrameRefs.set(e.id,t)}getHTMLIFrameElement(e){return this.iFrameRefs.get(e.id)}handleEmbeddableCenterClick(e){if(this.state.activeEmbeddable?.element===e&&"active"===this.state.activeEmbeddable?.state||(setTimeout((()=>{this.setState({activeEmbeddable:{element:e,state:"active"},selectedElementIds:{[e.id]:!0},newElement:null,selectionElement:null})}),100),se(e)))return;let t=this.getHTMLIFrameElement(e);if(t?.contentWindow){if(t.src.includes("youtube")){let s=mv.get(e.id);switch(s||(mv.set(e.id,te.UNSTARTED),t.contentWindow.postMessage(JSON.stringify({event:"listening",id:e.id}),"*")),s){case te.PLAYING:case te.BUFFERING:t.contentWindow?.postMessage(JSON.stringify({event:"command",func:"pauseVideo",args:""}),"*");break;default:t.contentWindow?.postMessage(JSON.stringify({event:"command",func:"playVideo",args:""}),"*")}}t.src.includes("player.vimeo.com")&&t.contentWindow.postMessage(JSON.stringify({method:"paused"}),"*")}}isIframeLikeElementCenter(e,t,s,n){return e&&!t.altKey&&!t.shiftKey&&!t.metaKey&&!t.ctrlKey&&(this.state.activeEmbeddable?.element!==e||"hover"===this.state.activeEmbeddable?.state||!this.state.activeEmbeddable)&&s>=e.x+e.width/3&&s<=e.x+2*e.width/3&&n>=e.y+e.height/3&&n<=e.y+2*e.height/3}renderEmbeddables(){let e=this.state.zoom.value,t=this.state.width,s=this.state.height,n=this.scene.getNonDeletedElements().filter((e=>ne(e)&&!0===this.embedsValidationStatus.get(e.id)||se(e)));return gp.exports.jsx(gp.exports.Fragment,{children:n.map((n=>{let i,{x:a,y:l}=ie({sceneX:n.x,sceneY:n.y},this.state),r=ae(n,t,s,this.state,this.scene.getNonDeletedElementsMap()),o=this.initializedEmbeds.has(n.id);if(r&&!o&&this.initializedEmbeds.add(n.id),!r&&!o)return null;if(se(n)){i=null;let e=(n.customData?.generationData??this.magicGenerations.get(n.id))||{status:"error",message:"No generation data",code:"ERR_NO_GENERATION_DATA"};if("done"===e.status){let t=e.html;i={intrinsicSize:{w:n.width,h:n.height},type:"document",srcdoc:()=>t}}else if("pending"===e.status)i={intrinsicSize:{w:n.width,h:n.height},type:"document",srcdoc:()=>le(`\n                    <style>\n                      html, body {\n                        width: 100%;\n                        height: 100%;\n                        color: ${this.state.theme===X.DARK?"white":"black"};\n                      }\n                      body {\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        flex-direction: column;\n                        gap: 1rem;\n                      }\n\n                      .Spinner {\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        margin-left: auto;\n                        margin-right: auto;\n                      }\n\n                      .Spinner svg {\n                        animation: rotate 1.6s linear infinite;\n                        transform-origin: center center;\n                        width: 40px;\n                        height: 40px;\n                      }\n\n                      .Spinner circle {\n                        stroke: currentColor;\n                        animation: dash 1.6s linear 0s infinite;\n                        stroke-linecap: round;\n                      }\n\n                      @keyframes rotate {\n                        100% {\n                          transform: rotate(360deg);\n                        }\n                      }\n\n                      @keyframes dash {\n                        0% {\n                          stroke-dasharray: 1, 300;\n                          stroke-dashoffset: 0;\n                        }\n                        50% {\n                          stroke-dasharray: 150, 300;\n                          stroke-dashoffset: -200;\n                        }\n                        100% {\n                          stroke-dasharray: 1, 300;\n                          stroke-dashoffset: -280;\n                        }\n                      }\n                    </style>\n                    <div class="Spinner">\n                      <svg\n                        viewBox="0 0 100 100"\n                      >\n                        <circle\n                          cx="50"\n                          cy="50"\n                          r="46"\n                          stroke-width="8"\n                          fill="none"\n                          stroke-miter-limit="10"\n                        />\n                      </svg>\n                    </div>\n                    <div>Generating...</div>\n                  `)};else{let t;t="ERR_GENERATION_INTERRUPTED"===e.code?"Generation was interrupted...":e.message||"Generation failed",i={intrinsicSize:{w:n.width,h:n.height},type:"document",srcdoc:()=>le(`\n                    <style>\n                    html, body {\n                      height: 100%;\n                    }\n                      body {\n                        display: flex;\n                        flex-direction: column;\n                        align-items: center;\n                        justify-content: center;\n                        color: ${re.red[3]};\n                      }\n                      h1, h3 {\n                        margin-top: 0;\n                        margin-bottom: 0.5rem;\n                      }\n                    </style>\n                    <h1>Error!</h1>\n                    <h3>${t}</h3>\n                  `)}}}else i=oe(de(n.link||""));let d=this.state.activeEmbeddable?.element===n&&"active"===this.state.activeEmbeddable?.state,c=this.state.activeEmbeddable?.element===n&&"hover"===this.state.activeEmbeddable?.state;return gp.exports.jsx("div",{className:Vc("excalidraw__embeddable-container",{"is-hovered":c}),style:{transform:r?`translate(${a-this.state.offsetLeft}px, ${l-this.state.offsetTop}px) scale(${e})`:"none",display:r?"block":"none",opacity:ce(n,he(n,this.scene.getNonDeletedElementsMap()),this.elementsPendingErasure,null,"elementLinkSelector"===this.state.openDialog?.name?pe:1),"--embeddable-radius":`${me(Math.min(n.width,n.height),n)}px`},children:gp.exports.jsxs("div",{className:"excalidraw__embeddable-container__inner",style:{width:r?`${n.width}px`:0,height:r?`${n.height}px`:0,transform:r?`rotate(${n.angle}rad)`:"none",pointerEvents:d?ue.enabled:ue.disabled},children:[c&&gp.exports.jsx("div",{className:"excalidraw__embeddable-hint",children:Np("buttons.embeddableInteractionButton")}),gp.exports.jsx("div",{className:"excalidraw__embeddable__outer",style:{padding:`${n.strokeWidth}px`},children:(ne(n)?this.props.renderEmbeddable?.(n,this.state):null)??gp.exports.jsx("iframe",{ref:e=>this.cacheEmbeddableRef(n,e),className:"excalidraw__embeddable",srcDoc:"document"===i?.type?i.srcdoc(this.state.theme):void 0,src:"document"!==i?.type?i?.link??"":void 0,scrolling:"no",referrerPolicy:"no-referrer-when-downgrade",title:"Excalidraw Embedded Content",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,sandbox:(i?.sandbox?.allowSameOrigin?"allow-same-origin":"")+" allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation allow-downloads"})})]})},n.id)}))})}toggleOverscrollBehavior(e){document.documentElement.style.overscrollBehaviorX="pointerenter"===e.type?"none":"auto"}render(){let e=this.scene.getSelectedElements(this.state),{renderTopRightUI:t,renderCustomStats:s}=this.props,n=this.scene.getSceneNonce(),{elementsMap:i,visibleElements:a}=this.renderer.getRenderableElements({sceneNonce:n,zoom:this.state.zoom,offsetLeft:this.state.offsetLeft,offsetTop:this.state.offsetTop,scrollX:this.state.scrollX,scrollY:this.state.scrollY,height:this.state.height,width:this.state.width,editingTextElement:this.state.editingTextElement,newElementId:this.state.newElement?.id,pendingImageElementId:this.state.pendingImageElementId});this.visibleElements=a;let l=this.scene.getNonDeletedElementsMap(),r=!("setPointerCapture"in HTMLElement.prototype)&&(this.state.selectionElement||this.state.newElement||this.state.selectedElementsAreBeingDragged||this.state.resizingElement||"laser"===this.state.activeTool.type&&"down"===this.state.cursorButton),o=e[0];return gp.exports.jsx("div",{className:Vc("excalidraw excalidraw-container",{"excalidraw--view-mode":this.state.viewModeEnabled||"elementLinkSelector"===this.state.openDialog?.name,"excalidraw--mobile":this.device.editor.isMobile}),style:{"--ui-pointerEvents":r?ue.disabled:ue.enabled,"--right-sidebar-width":"302px"},ref:this.excalidrawContainerRef,onDrop:this.handleAppOnDrop,tabIndex:0,onKeyDown:this.props.handleKeyboardGlobally?void 0:this.onKeyDown,onPointerEnter:this.toggleOverscrollBehavior,onPointerLeave:this.toggleOverscrollBehavior,children:gp.exports.jsx(Hy.Provider,{value:this,children:gp.exports.jsx(Yy.Provider,{value:this.props,children:gp.exports.jsx(Vy.Provider,{value:this.excalidrawContainerValue,children:gp.exports.jsx($y.Provider,{value:this.device,children:gp.exports.jsx(Zy.Provider,{value:this.setAppState,children:gp.exports.jsx(Ky.Provider,{value:this.state,children:gp.exports.jsxs(Wy.Provider,{value:this.scene.getNonDeletedElements(),children:[gp.exports.jsxs(Xy.Provider,{value:this.actionManager,children:[gp.exports.jsx(GE,{canvas:this.canvas,appState:this.state,files:this.files,setAppState:this.setAppState,actionManager:this.actionManager,elements:this.scene.getNonDeletedElements(),onLockToggle:this.toggleLock,onPenModeToggle:this.togglePenMode,onHandToolToggle:this.onHandToolToggle,langCode:Dp().code,renderTopRightUI:t,renderCustomStats:s,showExitZenModeBtn:typeof this.props?.zenModeEnabled>"u"&&this.state.zenModeEnabled,UIOptions:this.props.UIOptions,onExportImage:this.onExportImage,renderWelcomeScreen:!this.state.isLoading&&this.state.showWelcomeScreen&&"selection"===this.state.activeTool.type&&!this.state.zenModeEnabled&&!this.scene.getElementsIncludingDeleted().length,app:this,isCollaborating:this.props.isCollaborating,generateLinkForSelection:this.props.generateLinkForSelection,children:this.props.children}),gp.exports.jsx("div",{className:"excalidraw-textEditorContainer"}),gp.exports.jsx("div",{className:"excalidraw-contextMenuContainer"}),gp.exports.jsx("div",{className:"excalidraw-eye-dropper-container"}),gp.exports.jsx(jy,{trails:[this.laserTrails,this.eraserTrail]}),1===e.length&&"elementLinkSelector"!==this.state.openDialog?.name&&this.state.showHyperlinkPopup&&gp.exports.jsx(Uu,{element:o,elementsMap:l,setAppState:this.setAppState,onLinkOpen:this.props.onLinkOpen,setToast:this.setToast,updateEmbedValidationStatus:this.updateEmbedValidationStatus},o.id),!1!==this.props.aiEnabled&&1===e.length&&ge(o)&&gp.exports.jsx(Dy,{element:o,elementsMap:i,children:gp.exports.jsx(Ly,{title:Np("labels.convertToCode"),icon:xe,checked:!1,onChange:()=>this.onMagicFrameGenerate(o,"button")})}),1===e.length&&se(o)&&"done"===o.customData?.generationData?.status&&gp.exports.jsxs(Dy,{element:o,elementsMap:i,children:[gp.exports.jsx(Ly,{title:Np("labels.copySource"),icon:fe,checked:!1,onChange:()=>this.onIframeSrcCopy(o)}),gp.exports.jsx(Ly,{title:"Enter fullscreen",icon:be,checked:!1,onChange:()=>{let e=this.getHTMLIFrameElement(o);if(e)try{e.requestFullscreen(),this.setState({activeEmbeddable:{element:o,state:"active"},selectedElementIds:{[o.id]:!0},newElement:null,selectionElement:null})}catch(e){console.warn(e),this.setState({errorMessage:"Couldn't enter fullscreen"})}}})]}),null!==this.state.toast&&gp.exports.jsx($E,{message:this.state.toast.message,onClose:()=>this.setToast(null),duration:this.state.toast.duration,closable:this.state.toast.closable}),this.state.contextMenu&&gp.exports.jsx(Jx,{items:this.state.contextMenu.items,top:this.state.contextMenu.top,left:this.state.contextMenu.left,actionManager:this.actionManager,onClose:e=>{this.setState({contextMenu:null},(()=>{this.focusContainer(),e?.()}))}}),gp.exports.jsx(Ty,{canvas:this.canvas,rc:this.rc,elementsMap:i,allElementsMap:l,visibleElements:a,sceneNonce:n,selectionNonce:this.state.selectionElement?.versionNonce,scale:window.devicePixelRatio,appState:this.state,renderConfig:{imageCache:this.imageCache,isExporting:!1,renderGrid:Ee(this),canvasBackgroundColor:this.state.viewBackgroundColor,embedsValidationStatus:this.embedsValidationStatus,elementsPendingErasure:this.elementsPendingErasure,pendingFlowchartNodes:this.flowChartCreator.pendingNodes}}),this.state.newElement&&gp.exports.jsx(Uy,{appState:this.state,scale:window.devicePixelRatio,rc:this.rc,elementsMap:i,allElementsMap:l,renderConfig:{imageCache:this.imageCache,isExporting:!1,renderGrid:!1,canvasBackgroundColor:this.state.viewBackgroundColor,embedsValidationStatus:this.embedsValidationStatus,elementsPendingErasure:this.elementsPendingErasure,pendingFlowchartNodes:null}}),gp.exports.jsx(Iy,{containerRef:this.excalidrawContainerRef,canvas:this.interactiveCanvas,elementsMap:i,visibleElements:a,allElementsMap:l,selectedElements:e,sceneNonce:n,selectionNonce:this.state.selectionElement?.versionNonce,scale:window.devicePixelRatio,appState:this.state,device:this.device,renderInteractiveSceneCallback:this.renderInteractiveSceneCallback,handleCanvasRef:this.handleInteractiveCanvasRef,onContextMenu:this.handleCanvasContextMenu,onPointerMove:this.handleCanvasPointerMove,onPointerUp:this.handleCanvasPointerUp,onPointerCancel:this.removePointer,onTouchMove:this.handleTouchMove,onPointerDown:this.handleCanvasPointerDown,onDoubleClick:this.handleCanvasDoubleClick}),this.state.userToFollow&&gp.exports.jsx(Ny,{width:this.state.width,height:this.state.height,userToFollow:this.state.userToFollow,onDisconnect:this.maybeUnfollowRemoteUser}),this.renderFrameNames()]}),this.renderEmbeddables()]})})})})})})})})}setPlugins(e){Object.assign(this.plugins,e)}async onMagicFrameGenerate(e,t){let s=this.plugins.diagramToCode?.generate;if(!s)return void this.setState({errorMessage:"No diagram to code plugin found"});let n=ye(this.scene.getNonDeletedElements(),e).filter((e=>!ge(e)));if(!n.length)return void("button"===t?(this.setState({errorMessage:"Cannot generate from an empty frame"}),dh("ai","generate (no-children)","d2c")):this.setActiveTool({type:"magicframe"}));let i=this.insertIframeElement({sceneX:e.x+e.width+30,sceneY:e.y,width:e.width,height:e.height});if(i){this.updateMagicGeneration({frameElement:i,data:{status:"pending"}}),this.setState({selectedElementIds:{[i.id]:!0}}),dh("ai","generate (start)","d2c");try{let{html:t}=await s({frame:e,children:n});if(dh("ai","generate (success)","d2c"),!t.trim())return void this.updateMagicGeneration({frameElement:i,data:{status:"error",code:"ERR_OAI",message:"Nothing genereated :("}});let a=t.includes("<!DOCTYPE html>")&&t.includes("</html>")?t.slice(t.indexOf("<!DOCTYPE html>"),t.indexOf("</html>")+7):t;this.updateMagicGeneration({frameElement:i,data:{status:"done",html:a}})}catch(e){dh("ai","generate (failed)","d2c"),this.updateMagicGeneration({frameElement:i,data:{status:"error",code:"ERR_OAI",message:e.message||"Unknown error during generation"}})}}}onIframeSrcCopy(e){"done"===e.customData?.generationData?.status&&(ve(e.customData.generationData.html),this.setToast({message:"copied to clipboard",closable:!1,duration:1500}))}clearImageShapeCache(e){let t=e??this.files;this.scene.getNonDeletedElements().forEach((e=>{we(e)&&t[e.fileId]&&(this.imageCache.delete(e.fileId),Se.delete(e))}))}async componentDidMount(){this.unmounted=!1,this.excalidrawContainerValue.container=this.excalidrawContainerRef.current,(vc.MODE===Ce.TEST||vc.DEV)&&(this.setState.bind(this),Object.defineProperties(window.h,{state:{configurable:!0,get:()=>this.state},setState:{configurable:!0,value:(...e)=>this.setState(...e)},app:{configurable:!0,value:this},history:{configurable:!0,value:this.history},store:{configurable:!0,value:this.store},fonts:{configurable:!0,value:this.fonts}})),this.store.onStoreIncrementEmitter.on((e=>{this.history.record(e.elementsChange,e.appStateChange)})),this.scene.onUpdate(this.triggerRender),this.addEventListeners(),this.props.autoFocus&&this.excalidrawContainerRef.current&&this.focusContainer(),Ie()||(this.refreshViewportBreakpoints(),this.refreshEditorBreakpoints()),P&&this.excalidrawContainerRef.current&&(this.resizeObserver=new ResizeObserver((()=>{this.refreshEditorBreakpoints(),this.updateDOMRect()})),this.resizeObserver?.observe(this.excalidrawContainerRef.current)),new URLSearchParams(window.location.search.slice(1)).has("web-share-target")?this.restoreFileFromShare():this.updateDOMRect(this.initializeScene),ke()&&!Te()&&this.setState({errorMessage:gp.exports.jsx(qE,{})})}componentWillUnmount(){window.launchQueue?.setConsumer((()=>{})),this.renderer.destroy(),this.scene.destroy(),this.scene=new Q,this.fonts=new n(this.scene),this.renderer=new My(this.scene),this.files={},this.imageCache.clear(),this.resizeObserver?.disconnect(),this.unmounted=!0,this.removeEventListeners(),this.library.destroy(),this.laserTrails.stop(),this.eraserTrail.stop(),this.onChangeEmitter.clear(),this.store.onStoreIncrementEmitter.clear(),Se.destroy(),Me.destroy(),clearTimeout(pv),je.clearCache(),De.clearCache(),pv=0,document.documentElement.style.overscrollBehaviorX=""}removeEventListeners(){this.onRemoveEventListenersEmitter.trigger()}addEventListeners(){this.removeEventListeners(),this.props.handleKeyboardGlobally&&this.onRemoveEventListenersEmitter.once(Le(document,"keydown",this.onKeyDown,!1)),this.onRemoveEventListenersEmitter.once(Le(this.excalidrawContainerRef.current,"wheel",this.handleWheel,{passive:!1}),Le(window,"message",this.onWindowMessage,!1),Le(document,"pointerup",this.removePointer,{passive:!1}),Le(document,"copy",this.onCopy,{passive:!1}),Le(document,"keyup",this.onKeyUp,{passive:!0}),Le(document,"pointermove",this.updateCurrentCursorPosition,{passive:!1}),Le(document.fonts,"loadingdone",(e=>{let t=e.fontfaces;this.fonts.onLoaded(t)}),{passive:!1}),Le(document,"gesturestart",this.onGestureStart,!1),Le(document,"gesturechange",this.onGestureChange,!1),Le(document,"gestureend",this.onGestureEnd,!1),Le(window,"focus",(()=>{this.maybeCleanupAfterMissingPointerUp(null),this.triggerRender(!0)}),{passive:!1})),!this.state.viewModeEnabled&&(this.onRemoveEventListenersEmitter.once(Le(document,"fullscreenchange",this.onFullscreenChange,{passive:!1}),Le(document,"paste",this.pasteFromClipboard,{passive:!1}),Le(document,"cut",this.onCut,{passive:!1}),Le(window,"resize",this.onResize,!1),Le(window,"unload",this.onUnload,!1),Le(window,"blur",this.onBlur,!1),Le(this.excalidrawContainerRef.current,"wheel",this.handleWheel,{passive:!1}),Le(this.excalidrawContainerRef.current,"dragover",this.disableEvent,!1),Le(this.excalidrawContainerRef.current,"drop",this.disableEvent,!1)),this.props.detectScroll&&this.onRemoveEventListenersEmitter.once(Le(Ne(this.excalidrawContainerRef.current),"scroll",this.onScroll,{passive:!1})))}componentDidUpdate(e,t){this.updateEmbeddables();let s=this.scene.getElementsIncludingDeleted(),n=this.scene.getElementsMapIncludingDeleted(),i=this.scene.getNonDeletedElementsMap();!this.state.showWelcomeScreen&&!s.length&&this.setState({showWelcomeScreen:!0}),e.UIOptions.dockedSidebarBreakpoint!==this.props.UIOptions.dockedSidebarBreakpoint&&this.refreshEditorBreakpoints(),t.userToFollow&&!this.state.collaborators.has(t.userToFollow.socketId)&&this.maybeUnfollowRemoteUser(),(t.zoom.value!==this.state.zoom.value||t.scrollX!==this.state.scrollX||t.scrollY!==this.state.scrollY)&&(this.props?.onScrollChange?.(this.state.scrollX,this.state.scrollY,this.state.zoom),this.onScrollChangeEmitter.trigger(this.state.scrollX,this.state.scrollY,this.state.zoom)),t.userToFollow!==this.state.userToFollow&&(t.userToFollow&&this.onUserFollowEmitter.trigger({userToFollow:t.userToFollow,action:"UNFOLLOW"}),this.state.userToFollow&&this.onUserFollowEmitter.trigger({userToFollow:this.state.userToFollow,action:"FOLLOW"})),Object.keys(this.state.selectedElementIds).length&&Ae(this.state)&&this.setState({activeTool:_e(this.state,{type:"selection"})}),"eraser"===this.state.activeTool.type&&t.theme!==this.state.theme&&Pe(this.interactiveCanvas,this.state.theme),"selection"===t.activeTool.type&&"selection"!==this.state.activeTool.type&&this.state.showHyperlinkPopup&&this.setState({showHyperlinkPopup:!1}),e.langCode!==this.props.langCode&&this.updateLanguage(),Ae(t)&&!Ae(this.state)&&this.eraserTrail.endPath(),e.viewModeEnabled!==this.props.viewModeEnabled&&this.setState({viewModeEnabled:!!this.props.viewModeEnabled}),t.viewModeEnabled!==this.state.viewModeEnabled&&(this.addEventListeners(),this.deselectElements()),("elementLinkSelector"===t.openDialog?.name||"elementLinkSelector"===this.state.openDialog?.name)&&t.openDialog?.name!==this.state.openDialog?.name&&(this.deselectElements(),this.setState({hoveredElementIds:{}})),e.zenModeEnabled!==this.props.zenModeEnabled&&this.setState({zenModeEnabled:!!this.props.zenModeEnabled}),e.theme!==this.props.theme&&this.props.theme&&this.setState({theme:this.props.theme}),this.excalidrawContainerRef.current?.classList.toggle("theme--dark",this.state.theme===X.DARK),this.state.editingLinearElement&&!this.state.selectedElementIds[this.state.editingLinearElement.elementId]&&setTimeout((()=>{this.state.editingLinearElement&&this.actionManager.executeAction(Ym)})),this.state.editingTextElement?.isDeleted&&this.setState({editingTextElement:null}),this.state.selectedLinearElement&&!this.state.selectedElementIds[this.state.selectedLinearElement.elementId]&&this.setState({selectedLinearElement:null});let{multiElement:a}=t;t.activeTool!==this.state.activeTool&&null!=a&&Re(this.state)&&Oe(a,!1)&&Fe(a,this.state,Be(ze.getPointAtIndexGlobalCoordinates(a,-1,i)),this.scene.getNonDeletedElementsMap(),this.scene.getNonDeletedElements()),this.store.commit(n,this.state),this.state.isLoading||(this.props.onChange?.(s,this.state,this.files),this.onChangeEmitter.trigger(s,this.state,this.files))}static resetTapTwice(){av=!1}async addElementsFromMixedContentPaste(e,{isPlainPaste:t,sceneX:s,sceneY:n}){if(!t&&e.some((e=>"imageUrl"===e.type))&&this.isToolSupported("image")){let t=e.filter((e=>"imageUrl"===e.type)).map((e=>e.value)),i=await Promise.all(t.map((async e=>{try{return{file:await Ue(e)}}catch(e){let t=e.message;return"FETCH_ERROR"===e.cause?t=Np("errors.failedToFetchImage"):"UNSUPPORTED"===e.cause&&(t=Np("errors.unsupportedFileType")),{errorMessage:t}}}))),a=n,l=!1,r={};for(let e of i)if(e.file){let t=this.createImageElement({sceneX:s,sceneY:a}),n=await this.insertImageElement(t,e.file);n&&(l||(l=!0,a-=n.height/2),He(n,{y:a},!1),a=t.y+t.height+25,r[t.id]=!0)}this.setState({selectedElementIds:Ye(r,this.state)});let o=i.find((e=>!!e.errorMessage));o&&o.errorMessage&&this.setState({errorMessage:o.errorMessage})}else{let s=e.filter((e=>"text"===e.type));s.length&&this.addTextFromPaste(s.map((e=>e.value)).join("\n\n"),t)}}addTextFromPaste(e,t=!1){let{x:s,y:n}=Ge({clientX:this.lastViewportPosition.x,clientY:this.lastViewportPosition.y},this.state),i={x:s,y:n,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roundness:null,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,text:e,fontSize:this.state.currentItemFontSize,fontFamily:this.state.currentItemFontFamily,textAlign:$e,verticalAlign:Ve,locked:!1},a=We({fontSize:i.fontSize,fontFamily:i.fontFamily}),l=Ke(i.fontFamily),[r,,o]=Ze(this.state),d=Math.max(Math.min(.5*(o-r),800),200),c=n,p=t?[e]:e.split("\n"),h=p.reduce(((e,t,n)=>{let r=Xe(t).trim();if(r.length){let t=this.getTopLayerFrameAtSceneCoords({x:s,y:c}),n=qe(r,a,l),o=n.width>d,p=o?Qe(r,a,d):r;n=o?qe(p,a,l):n;let h=s-n.width/2,m=c-n.height/2,u=Je({...i,x:h,y:m,text:p,originalText:r,lineHeight:l,autoResize:!o,frameId:t?t.id:null});e.push(u),c+=u.height+10}else p[n-1]?.trim()&&(c+=et(i.fontSize,l)+10);return e}),[]);0!==h.length&&(this.scene.insertElements(h),this.setState({selectedElementIds:Ye(Object.fromEntries(h.map((e=>[e.id,!0]))),this.state)}),!t&&h.length>1&&!1===xv&&!this.device.editor.isMobile&&(this.setToast({message:Np("toast.pasteAsSingleElement",{shortcut:x("CtrlOrCmd+Shift+V")}),duration:5e3}),xv=!0),this.store.shouldCaptureIncrement())}handleTextWysiwyg(e,{isExistingElement:t=!1}){let s=this.scene.getElementsMapIncludingDeleted(),n=(t,n)=>{this.scene.replaceAllElements([...this.scene.getElementsIncludingDeleted().map((i=>i.id===e.id&&tt(i)?Dt(i,{originalText:t,isDeleted:n??i.isDeleted,...Mr(i,Xt(i,s),s,t)}):i))])};Oy({id:e.id,canvas:this.canvas,getViewportCoords:(e,t)=>{let{x:s,y:n}=ie({sceneX:e,sceneY:t},this.state);return[s-this.state.offsetLeft,n-this.state.offsetTop]},onChange:ay((t=>{n(t,!1),$a(e)&&yl(e,this.scene.getNonDeletedElementsMap())})),onSubmit:ay((({viaKeyboard:s,nextOriginalText:i})=>{let a=!i.trim();if(n(i,a),!a&&s){let t=e.containerId?e.containerId:e.id;Kc((()=>{this.setState((e=>({selectedElementIds:Ye({...e.selectedElementIds,[t]:!0},e)})))}))}a&&Nt(this.scene.getNonDeletedElements(),[e]),(!a||t)&&this.store.shouldCaptureIncrement(),Kc((()=>{this.setState({newElement:null,editingTextElement:null})})),this.state.activeTool.locked&&wa(this.interactiveCanvas,this.state),this.focusContainer()})),element:e,excalidrawContainer:this.excalidrawContainerRef.current,app:this,autoSelect:!this.device.isTouchScreen}),this.deselectElements(),n(e.originalText,!1)}deselectElements(){this.setState({selectedElementIds:Ye({},this.state),selectedGroupIds:{},editingGroupId:null,activeEmbeddable:null})}getTextElementAtPosition(e,t){let s=this.getElementAtPosition(e,t,{includeBoundTextElement:!0});return s&&tt(s)&&!s.isDeleted?s:null}getElementAtPosition(e,t,s){let n=this.getElementsAtPosition(e,t,s?.includeBoundTextElement,s?.includeLockedElements);if(n.length>1){if(s?.preferSelected)for(let e=n.length-1;e>-1;e--)if(this.state.selectedElementIds[n[e].id])return n[e];let i=n[n.length-1];return st({x:e,y:t,element:i,shape:nt(i,this.scene.getNonDeletedElementsMap()),threshold:this.getElementHitThreshold()/2,frameNameBound:it(i)?this.frameNameBoundsCache.get(i):null})?i:n[n.length-2]}return 1===n.length?n[0]:null}getElementsAtPosition(e,t,s=!1,n=!1){let i=[],a=this.scene.getNonDeletedElementsMap();return(s&&n?this.scene.getNonDeletedElements():this.scene.getNonDeletedElements().filter((e=>(n||!e.locked)&&(s||!(tt(e)&&e.containerId))))).filter((s=>this.hitElement(e,t,s))).filter((s=>{let n=he(s,a);return!(n&&this.state.frameRendering.enabled&&this.state.frameRendering.clip)||at({x:e,y:t},n,a)})).filter((e=>!se(e)||(i.push(e),!1))).concat(i)}getElementHitThreshold(){return lt/this.state.zoom.value}hitElement(e,t,s,n=!0){if(n&&this.state.selectedElementIds[s.id]&&rt([s],this.state)){let n=ot(s,this.scene.getNonDeletedElementsMap(),B(s)?0:this.getElementHitThreshold());if(dt(an(e,t),n))return!0}return!!ct(e,t,pt(s,this.scene.getNonDeletedElementsMap()))||st({x:e,y:t,element:s,shape:nt(s,this.scene.getNonDeletedElementsMap()),threshold:this.getElementHitThreshold(),frameNameBound:it(s)?this.frameNameBoundsCache.get(s):null})}getTextBindableContainerAtPosition(e,t){let s=this.scene.getNonDeletedElements(),n=this.scene.getSelectedElements(this.state);if(1===n.length)return ht(n[0],!1)?n[0]:null;let i=null;for(let n=s.length-1;n>=0;--n){if(s[n].isDeleted)continue;let[a,l,r,o]=mt(s[n],this.scene.getNonDeletedElementsMap());if(ut(s[n])&&st({x:e,y:t,element:s[n],shape:nt(s[n],this.scene.getNonDeletedElementsMap()),threshold:this.getElementHitThreshold()})){i=s[n];break}if(a<e&&e<r&&l<t&&t<o){i=s[n];break}}return ht(i,!1)?i:null}handleHoverSelectedLinearElement(e,t,s){let n=this.scene.getNonDeletedElementsMap(),i=ze.getElement(e.elementId,n);if(i)if(this.state.selectedLinearElement){let a=-1,l=null;st({x:t,y:s,element:i,shape:nt(i,this.scene.getNonDeletedElementsMap())})?(a=ze.getPointIndexUnderCursor(i,n,this.state.zoom,t,s),l=ze.getSegmentMidpointHitCoords(e,{x:t,y:s},this.state,this.scene.getNonDeletedElementsMap()),(V(i)?0===a||a===i.points.length-1:a>=0)||l?gt(this.interactiveCanvas,en.POINTER):this.hitElement(t,s,i)&&gt(this.interactiveCanvas,en.MOVE)):this.hitElement(t,s,i)&&(!V(i)||!(i.startBinding||i.endBinding))&&gt(this.interactiveCanvas,en.MOVE),this.state.selectedLinearElement.hoverPointIndex!==a&&this.setState({selectedLinearElement:{...this.state.selectedLinearElement,hoverPointIndex:a}}),ze.arePointsEqual(this.state.selectedLinearElement.segmentMidPointHoveredCoords,l)||this.setState({selectedLinearElement:{...this.state.selectedLinearElement,segmentMidPointHoveredCoords:l}})}else gt(this.interactiveCanvas,en.AUTO)}updateGestureOnPointerDown(e){bv.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===bv.pointers.size&&(bv.lastCenter=Kx(bv.pointers),bv.initialScale=this.state.zoom.value,bv.initialDistance=Zx(Array.from(bv.pointers.values())))}initialPointerDownState(e){let t=Ge(e,this.state),s=this.scene.getSelectedElements(this.state),[n,i,a,l]=xt(s),r=0===s.findIndex(V);return{origin:t,withCmdOrCtrl:e[j.CTRL_OR_CMD],originInGrid:Be(ft(t.x,t.y,e[j.CTRL_OR_CMD]||r?null:this.getEffectiveGridSize())),scrollbars:If(cv,e.clientX-this.state.offsetLeft,e.clientY-this.state.offsetTop),lastCoords:{...t},originalElements:this.scene.getNonDeletedElements().reduce(((e,t)=>(e.set(t.id,bt(t)),e)),new Map),resize:{handleType:!1,isResizing:!1,offset:{x:0,y:0},arrowDirection:"origin",center:{x:(a+n)/2,y:(l+i)/2}},hit:{element:null,allHitElements:[],wasAddedToSelection:!1,hasBeenDuplicated:!1,hasHitCommonBoundingBoxOfSelectedElements:this.isHittingCommonBoundingBoxOfSelectedElements(t,s)},drag:{hasOccurred:!1,offset:null},eventListeners:{onMove:null,onUp:null,onKeyUp:null,onKeyDown:null},boxSelection:{hasOccurred:!1}}}handleDraggingScrollBar(e,t){if(!t.scrollbars.isOverEither||this.state.multiElement)return!1;dv=!0,t.lastCoords.x=e.clientX,t.lastCoords.y=e.clientY;let s=ly((e=>{e.target instanceof HTMLElement&&this.handlePointerMoveOverScrollbars(e,t)})),n=ay((()=>{fv=null,dv=!1,wa(this.interactiveCanvas,this.state),this.setState({cursorButton:"up"}),this.savePointer(e.clientX,e.clientY,"up"),window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",n),s.flush()}));return fv=n,window.addEventListener("pointermove",s),window.addEventListener("pointerup",n),!0}isASelectedElement(e){return null!=e&&this.state.selectedElementIds[e.id]}isHittingCommonBoundingBoxOfSelectedElements(e,t){if(t.length<2)return!1;let s=this.getElementHitThreshold(),[n,i,a,l]=xt(t);return e.x>n-s&&e.x<a+s&&e.y>i-s&&e.y<l+s}getCurrentItemRoundness(e){return"round"===this.state.currentItemRoundness?{type:Et(e)?yt.ADAPTIVE_RADIUS:yt.PROPORTIONAL_RADIUS}:null}maybeCacheReferenceSnapPoints(e,t,s=!1){vt({event:e,app:this,selectedElements:t})&&(s||!Me.getReferenceSnapPoints())&&Me.setReferenceSnapPoints(wt(this.scene.getNonDeletedElements(),t,this.state,this.scene.getNonDeletedElementsMap()))}maybeCacheVisibleGaps(e,t,s=!1){vt({event:e,app:this,selectedElements:t})&&(s||!Me.getVisibleGaps())&&Me.setVisibleGaps(St(this.scene.getNonDeletedElements(),t,this.state,this.scene.getNonDeletedElementsMap()))}onKeyDownFromPointerDownHandler(e){return ay((t=>{this.maybeHandleResize(e,t)||this.maybeDragNewGenericElement(e,t)}))}onKeyUpFromPointerDownHandler(e){return ay((t=>{t.key===j.ALT&&t.preventDefault(),!this.maybeHandleResize(e,t)&&this.maybeDragNewGenericElement(e,t)}))}onPointerMoveFromPointerDownHandler(e){return ly((t=>{if("elementLinkSelector"===this.state.openDialog?.name)return;let s=Ge(t,this.state);if(this.state.selectedLinearElement&&this.state.selectedLinearElement.elbowed&&this.state.selectedLinearElement.pointerDownState.segmentMidpoint.index){let[e,n]=ft(s.x,s.y,t[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),i=this.state.selectedLinearElement.pointerDownState.segmentMidpoint.index;if(i<0){let t=ze.getSegmentMidpointHitCoords({...this.state.selectedLinearElement,segmentMidPointHoveredCoords:null},{x:e,y:n},this.state,this.scene.getNonDeletedElementsMap());i=t?ze.getSegmentMidPointIndex(this.state.selectedLinearElement,this.state,t,this.scene.getNonDeletedElementsMap()):-1}let a=ze.moveFixedSegment(this.state.selectedLinearElement,i,e,n,this.scene.getNonDeletedElementsMap());return void Kc((()=>{this.state.selectedLinearElement&&this.setState({selectedLinearElement:{...this.state.selectedLinearElement,segmentMidPointHoveredCoords:a.segmentMidPointHoveredCoords,pointerDownState:a.pointerDownState}})}))}let n=this.lastPointerMoveCoords??e.origin;if(this.lastPointerMoveCoords=s,null===e.drag.offset&&(e.drag.offset=Be(Dd(this.scene.getSelectedElements(this.state),e.origin.x,e.origin.y))),!(t.target instanceof HTMLElement)||this.handlePointerMoveOverScrollbars(t,e))return;if(Ae(this.state))return void this.handleEraser(t,e,s);"laser"===this.state.activeTool.type&&this.laserTrails.addPointToPath(s.x,s.y);let[i,a]=ft(s.x,s.y,t[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize());if(!e.drag.hasOccurred&&("arrow"===this.state.activeTool.type||"line"===this.state.activeTool.type)&&Ll(an(s.x,s.y),an(e.origin.x,e.origin.y))<Nl)return;if(e.resize.isResizing&&(e.lastCoords.x=s.x,e.lastCoords.y=s.y,this.maybeHandleCrop(e,t)||this.maybeHandleResize(e,t)))return!0;let l=this.scene.getNonDeletedElementsMap();if(this.state.selectedLinearElement){let n=this.state.editingLinearElement||this.state.selectedLinearElement;if(ze.shouldAddMidpoint(this.state.selectedLinearElement,s,this.state,l)){let e=ze.addMidpoint(this.state.selectedLinearElement,s,this,!t[j.CTRL_OR_CMD],l);if(!e)return;return void Kc((()=>{this.state.selectedLinearElement&&this.setState({selectedLinearElement:{...this.state.selectedLinearElement,pointerDownState:e.pointerDownState,selectedPointsIndices:e.selectedPointsIndices}}),this.state.editingLinearElement&&this.setState({editingLinearElement:{...this.state.editingLinearElement,pointerDownState:e.pointerDownState,selectedPointsIndices:e.selectedPointsIndices}})}))}if(null!==n.pointerDownState.segmentMidpoint.value&&!n.pointerDownState.segmentMidpoint.added)return;if(ze.handlePointDragging(t,this,s.x,s.y,((e,t)=>{this.maybeSuggestBindingsForLinearElementAtCoords(e,t)}),n,this.scene))return e.lastCoords.x=s.x,e.lastCoords.y=s.y,e.drag.hasOccurred=!0,this.state.editingLinearElement&&!this.state.editingLinearElement.isDragging&&this.setState({editingLinearElement:{...this.state.editingLinearElement,isDragging:!0}}),void(this.state.selectedLinearElement.isDragging||this.setState({selectedLinearElement:{...this.state.selectedLinearElement,isDragging:!0}}))}let r=e.hit.allHitElements.some((e=>this.isASelectedElement(e))),o=this.state.editingLinearElement&&t.shiftKey&&this.state.editingLinearElement.elementId===e.hit.element?.id;if((r||e.hit.hasHitCommonBoundingBoxOfSelectedElements)&&!o){let i=this.scene.getSelectedElements(this.state);if(i.every((e=>e.locked)))return;let a=i.find((e=>it(e))),r=this.getTopLayerFrameAtSceneCoords(s),o=r&&!a?r:null;if(this.state.frameToHighlight!==o&&Kc((()=>{this.setState({frameToHighlight:o})})),e.drag.hasOccurred=!0,i.length>0&&!e.withCmdOrCtrl&&!this.state.editingTextElement&&"active"!==this.state.activeEmbeddable?.state){let a={x:s.x-e.origin.x,y:s.y-e.origin.y},r=[...e.originalElements.values()],o=t.shiftKey;if(o){let e=Math.abs(a.x),t=Math.abs(a.y),s=o&&e>t;o&&e<t&&(a.x=0),s&&(a.y=0)}if(this.state.croppingElementId){let t=this.scene.getNonDeletedElementsMap().get(this.state.croppingElementId);if(t&&B(t)&&null!==t.crop&&e.hit.element===t){let e=t.crop,i=we(t)&&this.imageCache.get(t.fileId)?.image;if(i&&!(i instanceof Promise)){let a=Ld(Nd(s.x-n.x,s.y-n.y),Math.max(this.state.zoom.value,2)),[r,o,d,c,p,h]=mt(t,l),m=Ad(jo(an(r,o),an(p,h),t.angle)),u=Ad(jo(an(d,o),an(p,h),t.angle)),g=Ad(jo(an(r,c),an(p,h),t.angle)),x=_d(Pd(u,m)),f=_d(Pd(g,m)),b=Nd(Rd(a,x),Rd(a,f)),E={...e,x:$o(e.x-b[0]*Math.sign(t.scale[0]),0,i.naturalWidth-e.width),y:$o(e.y-b[1]*Math.sign(t.scale[1]),0,i.naturalHeight-e.height)};return void He(t,{crop:E})}}}this.maybeCacheVisibleGaps(t,i),this.maybeCacheReferenceSnapPoints(t,i);let{snapOffset:d,snapLines:c}=Od(r,a,this,t,this.scene.getNonDeletedElementsMap());if(this.setState({snapLines:c}),this.state.editingFrame||Fd(e,i,a,this.scene,d,t[j.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),this.setState({selectedElementsAreBeingDragged:!0,selectionElement:null}),(1!==i.length||!V(i[0]))&&this.setState({suggestedBindings:vl(i,this.scene.getNonDeletedElementsMap(),this.state.zoom)}),t.altKey&&!e.hit.hasBeenDuplicated){e.hit.hasBeenDuplicated=!0;let s=[],n=[],a=new Map,l=new Map,r=e.hit.element,o=new Set(this.scene.getSelectedElements({selectedElementIds:this.state.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0}).map((e=>e.id))),d=this.scene.getElementsIncludingDeleted();for(let t of d){let i=o.has(t.id)||t.id===r?.id&&e.hit.wasAddedToSelection;if(Math.abs(t.x)>1e7||Math.abs(t.x)>1e7||Math.abs(t.width)>1e7||Math.abs(t.height)>1e7)return void console.error("Alt+dragging element in scene with invalid dimensions",t.x,t.y,t.width,t.height,i);if(i){let i=Or(this.state.editingGroupId,a,t);if(Math.abs(i.x)>1e7||Math.abs(i.x)>1e7||Math.abs(i.width)>1e7||Math.abs(i.height)>1e7)return void console.error("Alt+dragging duplicated element with invalid dimensions",i.x,i.y,i.width,i.height);let r=e.originalElements.get(t.id);if(Math.abs(r.x)>1e7||Math.abs(r.x)>1e7||Math.abs(r.width)>1e7||Math.abs(r.height)>1e7)return void console.error("Alt+dragging duplicated element with invalid dimensions",r.x,r.y,r.width,r.height);He(i,{x:r.x,y:r.y}),e.originalElements.set(i.id,i),s.push(i),n.push(t),l.set(t.id,i.id)}else s.push(t)}let c=[...s,...n];c=this.props.onDuplicate?.(c,d)||c,An(c,Ht(n)),qt(s,n,l),Qt(c,n,l,"duplicatesServeAsOld"),Jt(c,n,l),this.scene.replaceAllElements(c),this.maybeCacheVisibleGaps(t,i,!0),this.maybeCacheReferenceSnapPoints(t,i,!0)}return}}if(this.state.selectionElement)e.lastCoords.x=s.x,e.lastCoords.y=s.y,this.maybeDragNewGenericElement(e,t);else{let n=this.state.newElement;if(!n)return;if("freedraw"===n.type){let e=n.points,i=s.x-n.x,a=s.y-n.y,l=e.length>0&&e[e.length-1];if(!l||l[0]!==i||l[1]!==a){let s=n.simulatePressure?n.pressures:[...n.pressures,t.pressure];He(n,{points:[...e,an(i,a)],pressures:s},!1),this.setState({newElement:n})}}else if(zt(n)){e.drag.hasOccurred=!0;let l=n.points,r=i-n.x,o=a-n.y;Fl(t)&&2===l.length&&({width:r,height:o}=Bl(n.x,n.y,s.x,s.y)),1===l.length?He(n,{points:[...l,an(r,o)]},!1):(2===l.length||l.length>1&&V(n))&&He(n,{points:[...l.slice(0,-1),an(r,o)]},!1,{isDragging:!0}),this.setState({newElement:n}),Oe(n,!1)&&this.maybeSuggestBindingsForLinearElementAtCoords(n,[s],this.state.startBoundElement)}else e.lastCoords.x=s.x,e.lastCoords.y=s.y,this.maybeDragNewGenericElement(e,t,!1)}if("selection"===this.state.activeTool.type){e.boxSelection.hasOccurred=!0;let s=this.scene.getNonDeletedElements();if(this.state.editingLinearElement)ze.handleBoxSelection(t,this.state,this.setState.bind(this),this.scene.getNonDeletedElementsMap());else{let n=!0;!t.shiftKey&&je(s,this.state)&&(e.withCmdOrCtrl&&e.hit.element?this.setState((t=>De({...t,selectedElementIds:{[e.hit.element.id]:!0}},this.scene.getNonDeletedElements(),t,this))):n=!1);let i=this.state.selectionElement?Bd(s,this.state.selectionElement,this.scene.getNonDeletedElementsMap(),!1):[];this.setState((t=>{let s={...n&&t.selectedElementIds,...i.reduce(((e,t)=>(e[t.id]=!0,e)),{})};return e.hit.element&&(i.length?delete s[e.hit.element.id]:s[e.hit.element.id]=!0),t=n?t:{...t,selectedGroupIds:{},editingGroupId:null},{...De({editingGroupId:t.editingGroupId,selectedElementIds:s},this.scene.getNonDeletedElements(),t,this),selectedLinearElement:1===i.length&&zt(i[0])?new ze(i[0]):null,showHyperlinkPopup:!(1!==i.length||!i[0].link&&!ne(i[0]))&&"info"}}))}}}))}handlePointerMoveOverScrollbars(e,t){if(t.scrollbars.isOverHorizontal){let s=e.clientX,n=s-t.lastCoords.x;return this.translateCanvas({scrollX:this.state.scrollX-n/this.state.zoom.value}),t.lastCoords.x=s,!0}if(t.scrollbars.isOverVertical){let s=e.clientY,n=s-t.lastCoords.y;return this.translateCanvas({scrollY:this.state.scrollY-n/this.state.zoom.value}),t.lastCoords.y=s,!0}return!1}onPointerUpFromPointerDownHandler(e){return ay((t=>{this.removePointer(t),e.eventListeners.onMove&&e.eventListeners.onMove.flush();let{newElement:s,resizingElement:n,croppingElementId:i,multiElement:a,activeTool:l,isResizing:r,isRotating:o,isCropping:d}=this.state;this.setState((e=>({isResizing:!1,isRotating:!1,isCropping:!1,resizingElement:null,selectionElement:null,frameToHighlight:null,elementsToHighlight:null,cursorButton:"up",snapLines:Pl(e.snapLines,[]),originSnapOffset:null}))),this.lastPointerMoveCoords=null,Me.setReferenceSnapPoints(null),Me.setVisibleGaps(null),this.savePointer(t.clientX,t.clientY,"up"),this.setState({selectedElementsAreBeingDragged:!1});let c=this.scene.getNonDeletedElementsMap();if(e.drag.hasOccurred&&e.hit?.element?.id){let t=c.get(e.hit.element.id);na(t)&&t.boundElements?.filter((e=>"arrow"===e.type)).map((e=>c.get(e.id))).filter((e=>V(e))).forEach((e=>{e&&He(e,{},!0)}))}if(this.state.editingLinearElement)if(e.boxSelection.hasOccurred||e.hit?.element?.id===this.state.editingLinearElement.elementId){let e=ze.handlePointerUp(t,this.state.editingLinearElement,this.state,this.scene);e!==this.state.editingLinearElement&&this.setState({editingLinearElement:e,suggestedBindings:[]})}else this.actionManager.executeAction(Ym);else if(this.state.selectedLinearElement){if(this.state.selectedLinearElement.elbowed){let e=ze.getElement(this.state.selectedLinearElement.elementId,this.scene.getNonDeletedElementsMap());e&&He(e,{},!0)}if(e.hit?.element?.id!==this.state.selectedLinearElement.elementId)this.scene.getSelectedElements(this.state).length>1&&this.setState({selectedLinearElement:null});else{let e=ze.handlePointerUp(t,this.state.selectedLinearElement,this.state,this.scene),{startBindingElement:s,endBindingElement:n}=e,i=this.scene.getElement(e.elementId);Oe(i)&&tn(i,s,n,c,this.scene),e!==this.state.selectedLinearElement&&this.setState({selectedLinearElement:{...e,selectedPointsIndices:null},suggestedBindings:[]})}}if(this.missingPointerEventCleanupEmitter.clear(),window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp),window.removeEventListener("keydown",e.eventListeners.onKeyDown),window.removeEventListener("keyup",e.eventListeners.onKeyUp),this.state.pendingImageElementId&&this.setState({pendingImageElementId:null}),this.props?.onPointerUp?.(l,e),this.onPointerUpEmitter.trigger(this.state.activeTool,e,t),"freedraw"===s?.type){let e=Ge(t,this.state),n=s.points,i=e.x-s.x,a=e.y-s.y;i===n[0][0]&&a===n[0][1]&&(a+=1e-4,i+=1e-4);let l=s.simulatePressure?[]:[...s.pressures,t.pressure];return He(s,{points:[...n,an(i,a)],pressures:l,lastCommittedPoint:an(i,a)}),void this.actionManager.executeAction(Ym)}if(B(s)){let e=s;try{this.initializeImageDimensions(e),this.setState({selectedElementIds:Ye({[e.id]:!0},this.state)},(()=>{this.actionManager.executeAction(Ym)}))}catch(t){console.error(t),this.scene.replaceAllElements(this.scene.getElementsIncludingDeleted().filter((t=>t.id!==e.id))),this.actionManager.executeAction(Ym)}return}if(zt(s)){s.points.length>1&&this.store.shouldCaptureIncrement();let n=Ge(t,this.state);return void(e.drag.hasOccurred||!s||a?e.drag.hasOccurred&&!a&&(Re(this.state)&&Oe(s,!1)&&Fe(s,this.state,n,this.scene.getNonDeletedElementsMap(),this.scene.getNonDeletedElements()),this.setState({suggestedBindings:[],startBoundElement:null}),l.locked?this.setState((e=>({newElement:null}))):(ln(this.interactiveCanvas),this.setState((e=>({newElement:null,activeTool:_e(this.state,{type:"selection"}),selectedElementIds:Ye({...e.selectedElementIds,[s.id]:!0},e),selectedLinearElement:new ze(s)})))),this.scene.triggerUpdate()):(He(s,{points:[...s.points,an(n.x-s.x,n.y-s.y)]}),this.setState({multiElement:s,newElement:s})))}if(tt(s)){let e=jr(We({fontSize:s.fontSize,fontFamily:s.fontFamily}),s.lineHeight);s.width<e&&He(s,{autoResize:!0}),this.resetCursor(),this.handleTextWysiwyg(s,{isExistingElement:!0})}if("selection"!==l.type&&s&&sn(s))return void this.updateScene({elements:this.scene.getElementsIncludingDeleted().filter((e=>e.id!==s.id)),appState:{newElement:null},captureUpdate:Lt.NEVER});if(it(s)){let e=Dr(this.scene.getElementsIncludingDeleted(),s,this.scene.getNonDeletedElementsMap());this.scene.replaceAllElements(Ca(this.scene.getElementsMapIncludingDeleted(),e,s,this.state))}if(s&&(He(s,Lr(s)),this.scene.triggerUpdate()),e.drag.hasOccurred){let e=Ge(t,this.state);if(this.state.selectedLinearElement&&this.state.selectedLinearElement.isDragging){let e=this.scene.getElement(this.state.selectedLinearElement.elementId);if(e?.frameId){let t=he(e,c);t&&e&&(ra(e,t,this.scene.getNonDeletedElementsMap())||(He(e,{groupIds:[]}),Ln([e],this.scene.getNonDeletedElementsMap()),this.scene.triggerUpdate()))}}else{let t=this.getTopLayerFrameAtSceneCoords(e),s=this.scene.getSelectedElements(this.state),n=this.scene.getElementsMapIncludingDeleted(),i=e=>{if(e.length>0){for(let t of e){let e=t.groupIds.indexOf(this.state.editingGroupId);He(t,{groupIds:t.groupIds.slice(0,e)},!1)}n.forEach((e=>{e.groupIds.length&&Gt(n,e.groupIds[e.groupIds.length-1]).length<2&&He(e,{groupIds:[]},!1)})),this.setState({editingGroupId:null})}};if(t&&!this.state.selectedElementIds[t.id]){let e=s.filter((e=>e.frameId!==t.id&&Nr(e,n,this.state)));this.state.editingGroupId&&i(e),n=Ca(n,e,t,this.state)}else if(!t&&this.state.editingGroupId){i(s.filter((e=>e.frameId&&!Nr(e,n,this.state))))}n=qn(n,this.state,this),this.scene.replaceAllElements(n)}}if(n&&this.store.shouldCaptureIncrement(),n&&sn(n)&&this.updateScene({elements:this.scene.getElementsIncludingDeleted().filter((e=>e.id!==n.id)),captureUpdate:Lt.NEVER}),e.resize.isResizing){let e=qn(this.scene.getElementsIncludingDeleted(),this.state,this),t=this.scene.getSelectedElements(this.state).filter((e=>it(e)));for(let s of t)e=Fn(e,Bn(this.scene.getElementsIncludingDeleted(),s,this.state,c),s,this);this.scene.replaceAllElements(e)}let p=e.hit.element;this.state.selectedLinearElement?.elementId!==p?.id&&zt(p)&&1===this.scene.getSelectedElements(this.state).length&&this.setState({selectedLinearElement:new ze(p)}),(!i||i&&(!p&&!d||p&&p.id!==i))&&this.finishImageCropping();let h=this.lastPointerDownEvent,m=this.lastPointerUpEvent||this.lastPointerMoveEvent;if(Ae(this.state)&&h&&m){if(this.eraserTrail.endPath(),0===Ll(an(h.clientX,h.clientY),an(m.clientX,m.clientY))){let e=Ge({clientX:m.clientX,clientY:m.clientY},this.state);this.getElementsAtPosition(e.x,e.y).forEach((e=>this.elementsPendingErasure.add(e.id)))}this.eraseElements()}else{if(this.elementsPendingErasure.size&&this.restoreReadyToEraseElements(),p&&!e.drag.hasOccurred&&!e.hit.wasAddedToSelection&&(!this.state.editingLinearElement||!e.boxSelection.hasOccurred)&&(t.shiftKey&&!this.state.editingLinearElement?this.state.selectedElementIds[p.id]?Ar(this.state,p)?this.setState((e=>{let t={...e.selectedElementIds};for(let e of p.groupIds.flatMap((e=>Gt(this.scene.getNonDeletedElements(),e))))delete t[e.id];return{selectedGroupIds:{...e.selectedElementIds,...p.groupIds.map((e=>({[e]:!1}))).reduce(((e,t)=>({...e,...t})),{})},selectedElementIds:Ye(t,e)}})):this.state.selectedLinearElement?.isDragging||this.setState((e=>{let t={...e.selectedElementIds};delete t[p.id];let s=S(this.scene.getNonDeletedElements(),{selectedElementIds:t});return{...De({editingGroupId:e.editingGroupId,selectedElementIds:t},this.scene.getNonDeletedElements(),e,this),selectedLinearElement:1===s.length&&zt(s[0])?new ze(s[0]):e.selectedLinearElement}})):p.frameId&&this.state.selectedElementIds[p.frameId]?this.setState((e=>{let t={...e.selectedElementIds,[p.id]:!0};return delete t[p.frameId],(this.scene.getElement(p.frameId)?.groupIds??[]).flatMap((e=>Gt(this.scene.getNonDeletedElements(),e))).forEach((e=>{delete t[e.id]})),{...De({editingGroupId:e.editingGroupId,selectedElementIds:t},this.scene.getNonDeletedElements(),e,this),showHyperlinkPopup:!(!p.link&&!ne(p))&&"info"}})):this.setState((e=>({selectedElementIds:Ye({...e.selectedElementIds,[p.id]:!0},e)}))):this.setState((e=>({...De({editingGroupId:e.editingGroupId,selectedElementIds:{[p.id]:!0}},this.scene.getNonDeletedElements(),e,this),selectedLinearElement:zt(p)&&e.selectedLinearElement?.elementId!==p.id?new ze(p):e.selectedLinearElement})))),(!p||!V(p))&&!e.drag.hasOccurred&&!this.state.isResizing&&(p&&_r({x:e.origin.x,y:e.origin.y,element:p,shape:nt(p,this.scene.getNonDeletedElementsMap()),threshold:this.getElementHitThreshold(),frameNameBound:it(p)?this.frameNameBoundsCache.get(p):null},c)||!p&&e.hit.hasHitCommonBoundingBoxOfSelectedElements))return this.state.editingLinearElement?this.setState({editingLinearElement:null}):this.setState({selectedElementIds:Ye({},this.state),selectedGroupIds:{},editingGroupId:null,activeEmbeddable:null}),void gt(this.interactiveCanvas,en.AUTO);if(!l.locked&&"freedraw"!==l.type&&s&&this.setState((e=>({selectedElementIds:Ye({...e.selectedElementIds,[s.id]:!0},e),showHyperlinkPopup:ne(s)&&!s.link?"editor":e.showHyperlinkPopup}))),("selection"!==l.type||je(this.scene.getNonDeletedElements(),this.state)||!R(this.state.previousSelectedElementIds,this.state.selectedElementIds))&&this.store.shouldCaptureIncrement(),e.drag.hasOccurred||r||o||d){let e=this.scene.getSelectedElements(this.state).filter(zt);si(e,this.scene.getNonDeletedElementsMap(),this.scene.getNonDeletedElements(),this.scene,Re(this.state),this.state.selectedLinearElement?.selectedPointsIndices??[],this.state.zoom)}"laser"!==l.type?(l.locked||"freedraw"===l.type?this.setState({newElement:null,suggestedBindings:[]}):(ln(this.interactiveCanvas),this.setState({newElement:null,suggestedBindings:[],activeTool:_e(this.state,{type:"selection"})})),p&&this.lastPointerUpEvent&&this.lastPointerDownEvent&&this.lastPointerUpEvent.timeStamp-this.lastPointerDownEvent.timeStamp<300&&bv.pointers.size<=1&&Ml(p)&&this.isIframeLikeElementCenter(p,this.lastPointerUpEvent,e.origin.x,e.origin.y)&&this.handleEmbeddableCenterClick(p)):this.laserTrails.endPath()}}))}clearSelection(e){this.setState((t=>({selectedElementIds:Ye({},t),activeEmbeddable:null,selectedGroupIds:{},editingGroupId:t.editingGroupId&&null!=e&&Ct(e,t.editingGroupId)?t.editingGroupId:null}))),this.setState({selectedElementIds:Ye({},this.state),activeEmbeddable:null,previousSelectedElementIds:this.state.selectedElementIds})}getTextWysiwygSnappedToCenterPosition(e,t,s,n){if(n){let i=n.x+n.width/2,a=n.y+n.height/2,l=It(n,s,this.scene.getNonDeletedElementsMap());if(l&&(i=l.x,a=l.y),Math.hypot(e-i,t-a)<kt){let{x:e,y:t}=ie({sceneX:i,sceneY:a},s);return{viewportX:e,viewportY:t,elementCenterX:i,elementCenterY:a}}}}getCanvasOffsets(){if(this.excalidrawContainerRef?.current){let e=this.excalidrawContainerRef.current,{left:t,top:s}=e.getBoundingClientRect();return{offsetLeft:t,offsetTop:s}}return{offsetLeft:0,offsetTop:0}}async updateLanguage(){let e=Ip.find((e=>e.code===this.props.langCode))||Cp;await jp(e),this.setAppState({})}};(vc.MODE===Ce.TEST||vc.DEV)&&(window.h=window.h||{},Object.defineProperties(window.h,{elements:{configurable:!0,get(){return this.app?.scene.getElementsIncludingDeleted()},set(e){return this.app?.scene.replaceAllElements(ml(e))}},scene:{configurable:!0,get(){return this.app?.scene}}}));var yv=Ev,vv=()=>{Array.prototype.at||Object.defineProperty(Array.prototype,"at",{value:function(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]},writable:!0,enumerable:!1,configurable:!0}),Element.prototype.replaceChildren||(Element.prototype.replaceChildren=function(...e){this.innerHTML="",this.append(...e)})},wv=()=>gp.exports.jsx("svg",{viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"ExcalidrawLogo-icon",children:gp.exports.jsx("path",{d:"M39.9 32.889a.326.326 0 0 0-.279-.056c-2.094-3.083-4.774-6-7.343-8.833l-.419-.472a.212.212 0 0 0-.056-.139.586.586 0 0 0-.167-.111l-.084-.083-.056-.056c-.084-.167-.28-.278-.475-.167-.782.39-1.507.973-2.206 1.528-.92.722-1.842 1.445-2.708 2.25a8.405 8.405 0 0 0-.977 1.028c-.14.194-.028.361.14.444-.615.611-1.23 1.223-1.843 1.861a.315.315 0 0 0-.084.223c0 .083.056.166.111.194l1.09.833v.028c1.535 1.528 4.244 3.611 7.12 5.861.418.334.865.667 1.284 1 .195.223.39.473.558.695.084.11.28.139.391.055.056.056.14.111.196.167a.398.398 0 0 0 .167.056.255.255 0 0 0 .224-.111.394.394 0 0 0 .055-.167c.029 0 .028.028.056.028a.318.318 0 0 0 .224-.084l5.082-5.528a.309.309 0 0 0 0-.444Zm-14.63-1.917a.485.485 0 0 0 .111.14c.586.5 1.2 1 1.843 1.555l-2.569-1.945-.251-.166c-.056-.028-.112-.084-.168-.111l-.195-.167.056-.056.055-.055.112-.111c.866-.861 2.346-2.306 3.1-3.028-.81.805-2.43 3.167-2.095 3.944Zm8.767 6.89-2.122-1.612a44.713 44.713 0 0 0-2.625-2.5c1.145.861 2.122 1.611 2.262 1.75 1.117.972 1.06.806 1.815 1.445l.921.666a1.06 1.06 0 0 1-.251.25Zm.558.416-.056-.028c.084-.055.168-.111.252-.194l-.196.222ZM1.089 5.75c.055.361.14.722.195 1.056.335 1.833.67 3.5 1.284 4.75l.252.944c.084.361.223.806.363.917 1.424 1.25 3.602 3.11 5.947 4.889a.295.295 0 0 0 .363 0s0 .027.028.027a.254.254 0 0 0 .196.084.318.318 0 0 0 .223-.084c2.988-3.305 5.221-6.027 6.813-8.305.112-.111.14-.278.14-.417.111-.111.195-.25.307-.333.111-.111.111-.306 0-.39l-.028-.027c0-.055-.028-.139-.084-.167-.698-.666-1.2-1.138-1.731-1.638-.922-.862-1.871-1.75-3.881-3.75l-.028-.028c-.028-.028-.056-.056-.112-.056-.558-.194-1.703-.389-3.127-.639C6.087 2.223 3.21 1.723.614.944c0 0-.168 0-.196.028l-.083.084c-.028.027-.056.055-.224.11h.056-.056c.028.167.028.278.084.473 0 .055.112.5.112.555l.782 3.556Zm15.496 3.278-.335-.334c.084.112.196.195.335.334Zm-3.546 4.666-.056.056c0-.028.028-.056.056-.056Zm-2.038-10c.168.167.866.834 1.033.973-.726-.334-2.54-1.167-3.379-1.445.838.167 1.983.334 2.346.472ZM1.424 2.306c.419.722.754 3.222 1.089 5.666-.196-.778-.335-1.555-.503-2.278-.251-1.277-.503-2.416-.838-3.416.056 0 .14 0 .252.028Zm-.168-.584c-.112 0-.223-.028-.307-.028 0-.027 0-.055-.028-.055.14 0 .223.028.335.083Zm-1.089.222c0-.027 0-.027 0 0ZM39.453 1.333c.028-.11-.558-.61-.363-.639.42-.027.42-.666 0-.666-.558.028-1.144.166-1.675.25-.977.194-1.982.389-2.96.61-2.205.473-4.383.973-6.561 1.557-.67.194-1.424.333-2.066.666-.224.111-.196.333-.084.472-.056.028-.084.028-.14.056-.195.028-.363.056-.558.083-.168.028-.252.167-.224.334 0 .027.028.083.028.11-1.173 1.556-2.485 3.195-3.909 4.945-1.396 1.611-2.876 3.306-4.356 5.056-4.719 5.5-10.052 11.75-15.943 17.25a.268.268 0 0 0 0 .389c.028.027.056.055.084.055-.084.084-.168.14-.252.222-.056.056-.084.111-.084.167a.605.605 0 0 0-.111.139c-.112.111-.112.305.028.389.111.11.307.11.39-.028.029-.028.029-.056.056-.056a.44.44 0 0 1 .615 0c.335.362.67.723.977 1.028l-.698-.583c-.112-.111-.307-.083-.39.028-.113.11-.085.305.027.389l7.427 6.194c.056.056.112.056.196.056s.14-.028.195-.084l.168-.166c.028.027.083.027.111.027.084 0 .14-.027.196-.083 10.052-10.055 18.15-17.639 27.42-24.417.083-.055.111-.166.111-.25.112 0 .196-.083.251-.194 1.704-5.194 2.039-9.806 2.15-12.083v-.028c0-.028.028-.056.028-.083.028-.056.028-.084.028-.084a1.626 1.626 0 0 0-.111-1.028ZM21.472 9.5c.446-.5.893-1.028 1.34-1.5-2.876 3.778-7.65 9.583-14.408 16.5 4.607-5.083 9.242-10.333 13.068-15ZM5.193 35.778h.084-.084Zm3.462 3.194c-.027-.028-.027-.028 0-.028v.028Zm4.16-3.583c.224-.25.448-.472.699-.722 0 0 0 .027.028.027-.252.223-.475.445-.726.695Zm1.146-1.111c.14-.14.279-.334.446-.5l.028-.028c1.648-1.694 3.351-3.389 5.082-5.111l.028-.028c.419-.333.921-.694 1.368-1.028a379.003 379.003 0 0 0-6.952 6.695ZM24.794 6.472c-.921 1.195-1.954 2.778-2.82 4.028-2.736 3.944-11.532 13.583-11.727 13.75a1976.983 1976.983 0 0 1-8.042 7.639l-.167.167c-.14-.167-.14-.417.028-.556C14.49 19.861 22.03 10.167 25.074 5.917c-.084.194-.14.36-.28.555Zm4.83 5.695c-1.116-.64-1.646-1.64-1.34-2.611l.084-.334c.028-.083.084-.194.14-.277.307-.5.754-.917 1.257-1.167.027 0 .055 0 .083-.028-.028-.056-.028-.139-.028-.222.028-.167.14-.278.335-.278.335 0 1.369.306 1.76.639.111.083.223.194.335.305.14.167.363.445.474.667.056.028.112.306.196.445.056.222.111.472.084.694-.028.028 0 .194-.028.194a2.668 2.668 0 0 1-.363 1.028c-.028.028-.028.056-.056.084l-.028.027c-.14.223-.335.417-.53.556-.643.444-1.369.583-2.095.389 0 0-.195-.084-.28-.111Zm8.154-.834a39.098 39.098 0 0 1-.893 3.167c0 .028-.028.083 0 .111-.056 0-.084.028-.14.056-2.206 1.61-4.356 3.305-6.506 5.028 1.843-1.64 3.686-3.306 5.613-4.945.558-.5.949-1.139 1.06-1.861l.28-1.667v-.055c.14-.334.67-.195.586.166Z",fill:"currentColor"})}),Sv=()=>gp.exports.jsxs("svg",{viewBox:"0 0 450 55",xmlns:"http://www.w3.org/2000/svg",fill:"none",className:"ExcalidrawLogo-text",children:[gp.exports.jsx("path",{d:"M429.27 96.74c2.47-1.39 4.78-3.02 6.83-4.95 1.43-1.35 2.73-2.86 3.81-4.51-.66.9-1.4 1.77-2.23 2.59-2.91 2.84-5.72 5.09-8.42 6.87h.01ZM343.6 69.36c.33 3.13.58 6.27.79 9.4.09 1.37.18 2.75.25 4.12-.12-4.46-.27-8.93-.5-13.39-.11-2.08-.24-4.16-.4-6.24-.06 1.79-.11 3.85-.13 6.11h-.01ZM378.47 98.34c.01-.37.07-1.13.01-6.51-.11 1.9-.22 3.81-.31 5.71-.07 1.42-.22 2.91-.16 4.35.39.03.78.07 1.17.1-.92-.85-.76-2.01-.72-3.66l.01.01ZM344.09 86.12c-.09-2.41-.22-4.83-.39-7.24v12.21c.15-.05.32-.09.47-.14.05-1.61-.03-3.23-.09-4.83h.01ZM440.69 66.79c-.22-.34-.45-.67-.69-.99-3.71-4.87-9.91-7.14-15.65-8.55-1.05-.26-2.12-.49-3.18-.71 2.29.59 4.48 1.26 6.64 2.02 7.19 2.54 10.57 5.41 12.88 8.23ZM305.09 72.46l1.2 3.6c.84 2.53 1.67 5.06 2.46 7.61.24.78.5 1.57.73 2.36.22-.04.44-.08.67-.12a776.9 776.9 0 0 1-5.01-13.57c-.02.04-.03.09-.05.13v-.01ZM345.49 90.25v.31c1.48-.42 3.05-.83 4.66-1.2-1.56.25-3.12.52-4.66.89ZM371.02 90.22c0-.57-.04-1.14-.11-1.71-.06-.02-.12-.04-.19-.05-.21-.05-.43-.08-.65-.11.42.16.74.88.95 1.87ZM398.93 54.23c-.13 0-.27-.01-.4-.02l.03.4c.11-.15.23-.27.37-.38ZM401.57 62.28v-.15c-1.22-.24-2.86-.61-3.23-1.25-.09-.15-.18-.51-.27-.98-.09.37-.2.73-.33 1.09 1.24.56 2.52.98 3.83 1.29ZM421.73 88.68c-2.97 1.65-6.28 3.12-9.69 3.68v.18c4.72-.14 11.63-3.85 16.33-8.38-2.04 1.75-4.33 3.24-6.63 4.53l-.01-.01ZM411.28 80.92c-.05-1.2-.09-2.4-.15-3.6-.21 5.66-.46 11.38-.47 14.51.24-.02.48-.04.71-.07.15-3.61.05-7.23-.09-10.83v-.01Z",transform:"translate(-144.023 -51.76)"}),gp.exports.jsx("path",{d:"M425.38 67.41c-3.5-1.45-7.19-2.57-14.06-3.62.09 1.97.06 4.88-.03 8.12.03.04.06.09.06.15.19 1.36.28 2.73.37 4.1.25 3.77.39 7.55.41 11.33 0 1.38-.01 2.76-.07 4.13 1.4-.25 2.78-.65 4.12-1.15 4.07-1.5 7.94-3.78 11.28-6.54 2.33-1.92 5.13-4.49 5.88-7.58.63-3.53-2.45-6.68-7.97-8.96l.01.02ZM411.35 92.53v-.06l-.34.03c.11.01.22.03.34.03ZM314.26 64.06c-.23-.59-.47-1.17-.7-1.75.57 1.62 1.11 3.25 1.6 4.9l.15.54 2.35 6.05c.32.82.66 1.64.98 2.46-1.38-4.1-2.83-8.17-4.39-12.2h.01ZM156.82 103.07c-.18.13-.38.23-.58.33 1.32-.03 2.66-.2 3.93-.34.86-.09 1.72-.22 2.58-.33-2.12.1-4.12.17-5.94.34h.01ZM210.14 68.88s.03.04.05.07c.18-.31.39-.64.58-.96-.21.3-.42.6-.64.89h.01ZM201.65 82.8c-.5.77-1.02 1.56-1.49 2.37 1.11-1.55 2.21-3.1 3.2-4.59-.23.23-.49.51-.75.79-.32.47-.65.95-.96 1.43ZM194.03 98.66c-.33-.4-.65-.84-1.05-1.17-.24-.2-.07-.49.17-.56-.23-.26-.42-.5-.63-.75 1.51-2.55 3.93-5.87 6.4-9.28-.17-.08-.29-.28-.2-.49.04-.09.09-.17.13-.26-1.21 1.78-2.42 3.55-3.61 5.33-.87 1.31-1.74 2.64-2.54 4-.29.5-.63 1.04-.87 1.61.81.65 1.63 1.27 2.47 1.88-.09-.11-.18-.21-.27-.32v.01ZM307.79 82.93c-1-3.17-2.05-6.32-3.1-9.48-1.62 4.08-3.69 9.17-6.16 15.19 3.32-1.04 6.77-1.87 10.27-2.5-.32-1.08-.67-2.15-1.01-3.21ZM149.5 80.7c.05-1.71.04-3.43 0-5.14-.1 2.26-.16 4.51-.22 6.77-.02.73-.03 1.46-.04 2.19.14-1.27.2-2.55.24-3.82h.02ZM228.98 98.3c.39 1.25.91 3.03.94 3.91.06-.03.12-.07.17-.1.08-1.29-.55-2.65-1.11-3.81ZM307.72 53.36c.81.5 1.53 1.04 2.07 1.49-.38-.8-.78-1.58-1.21-2.35-.17.03-.34.06-.51.11-.43.12-.86.26-1.29.41.35-.01.53.1.94.34ZM283.69 96.14c3.91-7.25 6.89-13.35 8.88-18.15l1.1-2.66c-1.27 2.64-2.56 5.27-3.83 7.9-1.53 3.15-3.06 6.31-4.58 9.47-.87 1.81-1.76 3.62-2.54 5.47.04.02.07.04.11.07.05.05.1.09.15.14.05-.73.27-1.48.71-2.24ZM289.92 103.23s-.04.01-.05.03c0-.02.04-.03.05-.04.05-.05.11-.1.16-.15l.21-.21c-.55 0-1.5-.27-2.55-.72.4.26.8.51 1.22.74.24.13.48.26.73.37.05.02.1.03.14.05a.27.27 0 0 1 .08-.07h.01ZM269.23 68.49c-.39-.19-.82-.48-1.33-.87-3.06-1.56-6.31-2.78-9.36-2.35-3.5.49-5.7 1.11-7.74 2.44 5.71-2.6 12.82-2.07 18.44.79l-.01-.01ZM177.87 53.69l1.06.03c-.96-.22-2-.25-2.89-.3-4.95-.26-9.99.33-14.86 1.19-2.44.43-4.88.95-7.28 1.59 9.09-1.76 15.69-2.77 23.97-2.51ZM219.85 55.51c-.18.12-.36.27-.56.45-.45.53-.86 1.11-1.26 1.66-1.91 2.61-3.71 5.31-5.57 7.95l-.12.18 8.05-10.11c-.18-.05-.36-.1-.55-.13h.01ZM510.71 54.1c.12-.15.29-.3.53-.45.69-.4 3.72-.63 5.87-.74-.36-.02-.73-.04-1.09-.05-1.84-.03-3.67.09-5.49.35.05.3.12.59.18.88v.01ZM510.76 86.02c1.37-3.07 2.49-6.27 3.57-9.46.55-1.64 1.12-3.3 1.6-4.97-1.59 4.01-3.67 9.14-6.2 15.3.24-.08.5-.14.74-.22.1-.22.19-.44.29-.65ZM566.95 75.76c.11-.02.23.03.31.11-.05-.13-.09-.26-.14-.39-.05.09-.11.18-.17.28ZM511.33 86.41c3.08-.89 6.24-1.62 9.46-2.14-1.51-3.98-2.98-7.96-4.39-11.87-.05.15-.09.31-.14.46-1.02 3.32-2.15 6.61-3.39 9.85-.48 1.25-.98 2.49-1.53 3.7h-.01ZM578.24 74.45c.11-.44.23-.87.35-1.31-.31.7-.64 1.39-.97 2.08.09.21.19.4.28.61.12-.46.23-.92.35-1.38h-.01ZM520.62 53.11c-.09 0-.18-.01-.28-.02.38.34.29 1.08.93 2.53l6.65 17.15c2.2 5.68 4.69 11.36 7.41 16.87l1.06 2.17c-2.95-7.05-5.92-14.08-8.87-21.13-1.58-3.79-3.16-7.59-4.7-11.4-.78-1.92-1.73-3.89-2.25-5.91-.03-.1 0-.19.04-.26h.01ZM578.78 77.87c1.45-5.77 3.07-10.43 3.58-13.36.05-.34.16-.88.31-1.55-.67 1.79-1.37 3.56-2.08 5.33-.12.43-.23.86-.35 1.29-.65 2.43-1.29 4.86-1.9 7.3.14.33.29.65.43 1l.01-.01ZM545.3 94.66c.02-.44.03-.83.05-1.12.02-1.01.05-2.02.11-3.02.03-6.66-.46-14.33-1.46-22.8-.13-.42-.27-1.24-.56-2.89 0-.02 0-.04-.01-.06.62 6.61.95 13.25 1.32 19.87.17 3.08.33 6.16.52 9.23.02.25.03.52.04.78l-.01.01ZM580.77 102.81c.13.2.27.38.37.49.27-.11.53-.22.8-.32-.43.09-.82.05-1.17-.16v-.01ZM530.48 104.07h.33c-.36-.13-.71-.32-1.04-.56.14.24.3.47.45.7.06-.08.14-.13.26-.13v-.01ZM542.63 58.82c.06.23.11.47.15.71.14-.33.36-.62.7-.86-.28.05-.57.11-.85.15ZM583.81 57.87c.15-.7.29-1.41.42-2.11-.14.45-.28.9-.42 1.34-.46 1.44-.89 2.89-1.31 4.34.44-1.19.88-2.37 1.31-3.57ZM523.62 91.48c-4.66 1.17-9.05 2.89-14.02 5.27 4.65-1.84 9.48-3.29 14.28-4.63-.09-.22-.17-.41-.26-.64ZM460.64 78.3c-.04-2.9-.11-5.81-.28-8.71-.1-1.68-.17-3.43-.5-5.09-.07.02-.14.03-.2.05.3 6.54.45 12.17.51 17.12.17-.07.34-.14.51-.2 0-1.06-.01-2.11-.03-3.17h-.01ZM470.63 63.24c-3.38-.26-6.81.32-10.1 1.1.41 2.01.47 4.14.57 6.18.18 3.55.25 7.11.27 10.67 3.31-1.38 6.5-3.12 9.3-5.35 1.96-1.56 3.86-3.41 5.02-5.66.73-1.41 1.19-3.22.26-4.65-1.09-1.7-3.46-2.14-5.32-2.29ZM460.29 63.68c1-.24 2.01-.46 3.04-.65-1.15.16-2.37.38-3.71.69v.13c.07-.02.15-.04.22-.05.11-.13.3-.18.45-.11v-.01ZM457.24 100.96c.43-.03.86-.07 1.29-.11.14-.49.27-.99.38-1.49-.44.7-1 1.23-1.67 1.6ZM482.88 104.98c-.18.23-.36.38-.55.47.14.09.27.19.4.28a70.76 70.76 0 0 0 4.37-4.63c.76-.89 1.52-1.81 2.19-2.77-.3-.27-.61-.53-.92-.79-.07 1.94-4.62 6.32-5.49 7.45v-.01Z",transform:"translate(-144.023 -51.76)"}),gp.exports.jsx("path",{d:"M474.36 63.31c-.4-.16-.84-.27-1.29-.37 1.56.42 3.08 1.22 3.76 2.74.62 1.4.32 2.95-.28 4.32.7-1.22.94-2.34.74-3.47-.24-1.33-1.19-2.54-2.93-3.21v-.01ZM477.34 89.18c-1.2-.81-2.4-1.62-3.6-2.42-.14.1-.26.19-.4.29 1.4.67 2.73 1.39 4 2.13ZM465.88 93.85c.37.25.74.5 1.1.75.46.32.92.65 1.38.97-1.57-1.2-2.01-1.61-2.49-1.72h.01ZM574.92 90.06c-2.28-5.21-4.93-11.13-5.67-12.26-.1-.15-1.57-3.01-1.63-3.08 0 0-.01.02-.02.02.4 1.37 1.09 2.69 1.65 3.99 2.14 4.95 4.36 9.86 6.67 14.73.6 1.26 1.21 2.52 1.83 3.78-.75-2.01-1.64-4.45-2.83-7.18ZM448.73 65.29c.1.2.22.38.34.57.22-.02.43-.06.65-.08v-.08c-.14-.05-.25 0-.99-.41ZM460.16 94.81c-.02.31-.06.59-.1.89-.03 1.71-.33 3.43-.79 5.07.15-.02.3-.03.45-.05.01-.04.02-.08.03-.11.09-.34.15-.69.2-1.03.17-1.07.25-2.16.33-3.24.05-.69.08-1.39.12-2.08-.27.1-.27.26-.24.57v-.02Z",transform:"translate(-144.023 -51.76)"}),gp.exports.jsx("path",{d:"m328.67 98.12-3.22-6.58c-1.29-2.63-2.53-5.29-3.72-7.97-.25-.85-.52-1.69-.79-2.53-.81-2.57-1.67-5.12-2.55-7.67-1.92-5.53-3.9-11.08-6.32-16.41-.72-1.58-1.46-3.44-2.63-4.79-.03-.17-.16-.29-.34-.36a.282.282 0 0 0-.23-.04c-.06-.01-.12 0-.18.01-.74.06-1.5.38-2.19.61-2.22.77-4.4 1.64-6.63 2.38-.03-.08-.06-.16-.09-.25-.15-.42-.82-.24-.67.19.03.09.07.19.1.28l-.18.06c-.36.11-.28.6 0 .68.18 1.18.63 2.36.98 3.49.03.09.06.17.08.26-.08.23-.17.46-.24.64-.37.98-.79 1.94-1.21 2.9-1.27 2.89-2.62 5.75-3.98 8.6-3.18 6.67-6.44 13.31-9.64 19.97-1.08 2.25-2.2 4.5-3.15 6.81-.13.32.24.5.5.37 1.34 1.33 2.84 2.5 4.4 3.57.65.44 1.31.87 2.01 1.24.4.22.86.48 1.33.5.24.01.35-.19.33-.37.11-.1.21-.21.28-.28.41-.41.81-.84 1.2-1.26.85-.92 1.69-1.87 2.5-2.84 6.31-2.34 12.6-4.31 18.71-5.84 2.14 5.3 3.43 8.43 3.97 9.58.55 1.05 1.15 1.88 1.82 2.52 1.32.56 6.96-.03 9.23-1.96.87-1.28 1.19-2.67.93-4.15-.09-.5-.22-.95-.4-1.33l-.01-.03Zm-20.09-45.61c.43.77.83 1.56 1.21 2.35-.54-.45-1.27-.99-2.07-1.49-.42-.24-.6-.35-.94-.34.43-.15.85-.29 1.29-.41.17-.05.34-.08.51-.11Zm-25.86 45.66c.78-1.85 1.67-3.66 2.54-5.47 1.51-3.16 3.05-6.31 4.58-9.47 1.28-2.63 2.56-5.26 3.83-7.9l-1.1 2.66c-1.99 4.79-4.97 10.9-8.88 18.15-.43.76-.66 1.51-.71 2.24-.05-.05-.1-.09-.15-.14a.259.259 0 0 0-.11-.07Zm6.24 4.71c-.42-.23-.82-.48-1.22-.74 1.05.45 2 .72 2.55.72l-.21.21c-.05.05-.11.1-.16.15-.01.01-.04.03-.05.04 0-.02.03-.02.05-.03a.27.27 0 0 0-.08.07c-.05-.02-.1-.03-.14-.05-.25-.1-.49-.24-.73-.37h-.01Zm15.73-29.43c1.05 3.15 2.1 6.31 3.1 9.48.34 1.06.69 2.13 1.01 3.21-3.5.63-6.95 1.46-10.27 2.5 2.48-6.03 4.54-11.11 6.16-15.19Zm4.79 12.57c-.23-.79-.49-1.58-.73-2.36-.79-2.54-1.63-5.08-2.46-7.61l-1.2-3.6c.02-.04.04-.09.05-.13 1.6 4.45 3.28 9 5.01 13.57l-.67.12v.01Zm5.83-18.27-.15-.54c-.49-1.64-1.03-3.28-1.6-4.9.23.58.47 1.17.7 1.75 1.56 4.03 3.01 8.1 4.39 12.2-.33-.82-.67-1.64-.98-2.46l-2.35-6.05h-.01ZM390.43 79.37c-.13-10.43-.22-17.5-.24-19.97-.24-1.6.21-2.88-.65-3.65-.14-.13-.32-.23-.52-.32h.03c.45 0 .45-.69 0-.7-1.75-.03-3.5-.04-5.25-.14-1.38-.08-2.76-.21-4.15-.31-.07 0-.12.01-.17.04-.21-.07-.47.03-.45.31l.03.45c-.11.14-.19.3-.22.5-.21 1.26-.32 13.67-.36 23.59-.32 5.79-.67 11.57-.97 17.36-.09 1.73-.29 3.54-.21 5.3-.39.02-.38.64.04.69v.12c.05.44.74.45.7 0v-.06c1.1.09 2.2.21 3.3.3 1.14.19 2.44.2 3.29.17 1.73-.05 2.92-.05 3.8-.37.45-.05.9-.11 1.35-.17.44-.06.25-.73-.19-.67h-.01c.24-.32.45-.72.62-1.25.66-1.84.41-6.36.34-11.33l-.13-9.9.02.01Zm-12.26 18.17c.09-1.91.2-3.81.31-5.71.06 5.38 0 6.14-.01 6.51-.05 1.65-.21 2.81.72 3.66-.39-.04-.78-.07-1.17-.1-.06-1.44.09-2.93.16-4.35l-.01-.01ZM588.97 53.85c-2.06-.25-3.17-.51-3.76-.6a.3.3 0 0 1 .04-.08c.22-.39-.39-.75-.6-.35-.56 1.02-.9 2.19-1.26 3.29-.61 1.88-1.17 3.78-1.72 5.68-.63 2.19-1.24 4.39-1.83 6.59-.81 2.03-1.67 4.05-2.61 6.03-1.7-3.64-3.11-6.04-4.03-7.57-2.26-3.74-2.85-5.48-3.57-6.08l.31-.09c.43-.12.25-.8-.19-.67-1.06.3-2.12.6-3.17.95-.93.32-1.85.69-2.76 1.07-.13.05-.19.16-.22.27-.04.02-.08.05-.11.07-.04-.06-.07-.12-.11-.18a.354.354 0 0 0-.48-.12c-.16.09-.22.32-.13.48l.33.54c0 .09.02.18.06.28.51 1.16.78 1.38.72 1.47-2.42 3.44-5.41 7.86-6.2 9.1-1.27 1.97-2.01 3.14-2.45 3.84l-.91-6.56-.43-4.1c-.19-1.85-.37-3.23-.53-4.13-.19-1.1-.3-2.15-.45-3.16-.2-1.36-.29-2.06-.47-2.42h.04c.45.02.45-.68 0-.7-3.43-.16-6.81.94-10.17 1.48-.24-.22-.73-.04-.58.32.24.59.33 1.25.43 1.87.17 1.06.29 2.13.4 3.2.32 3.09.53 6.2.74 9.3.44 6.75.77 13.51 1.17 20.26.11 1.95.13 3.96.46 5.89.05.3.37.31.55.14.74 1.71 2.87 1.27 6.13 1.27 1.34 0 2.39.04 2.99-.11.02.32.48.53.63.18 3.61-8.26 7.41-16.46 12.05-24.2.03-.05.04-.1.05-.15.3.73.64 1.45.94 2.16.97 2.26 1.97 4.52 2.98 6.76 2.26 5.03 4.54 10.07 7.09 14.96.47.9.94 1.79 1.47 2.65.2.32.4.67.66.96-.18.25 0 .68.34.54.91-.38 1.82-.75 2.76-1.07 1.04-.35 2.11-.65 3.17-.95.39-.11.28-.66-.07-.68.62-.4.95-.96.87-1.91-.3-3.34.72-7.47.86-8.52l2.14-11.43c1.75-10.74 3.13-17.51 3.23-20.86.02-.49.08-2.84.13-3.24.17-1.25.48-1-4.96-1.65l.03-.02Zm-46.19 5.67c-.04-.24-.09-.48-.15-.71l.85-.15c-.34.24-.56.53-.7.86Zm1.95 25.12c-.36-6.63-.7-13.26-1.32-19.87 0 .02 0 .04.01.06.29 1.65.44 2.47.56 2.89 1 8.46 1.5 16.14 1.46 22.8-.06.99-.1 2-.11 3.02-.01.29-.03.68-.05 1.12-.01-.26-.03-.53-.04-.78-.19-3.08-.35-6.16-.52-9.23l.01-.01Zm36.4 18.66c-.11-.11-.24-.29-.37-.49.35.21.74.26 1.17.16-.27.11-.53.22-.8.32v.01Zm-.89-33.72c.12-.43.23-.86.35-1.29.71-1.77 1.41-3.55 2.08-5.33-.15.68-.26 1.22-.31 1.55-.5 2.94-2.13 7.59-3.58 13.36-.15-.35-.29-.66-.43-1 .61-2.44 1.25-4.87 1.9-7.3l-.01.01Zm3.56-12.48c.14-.44.28-.89.42-1.34-.13.7-.27 1.41-.42 2.11-.43 1.19-.86 2.38-1.31 3.57.42-1.45.85-2.9 1.31-4.34Zm-5.22 16.05c-.11.44-.23.87-.35 1.31-.12.46-.23.92-.35 1.38-.1-.22-.19-.4-.28-.61.34-.69.66-1.38.97-2.08h.01Zm-11.64 2.62c.06-.1.12-.19.17-.28.05.13.09.26.14.39a.398.398 0 0 0-.31-.11Zm2.3 2.98c-.56-1.3-1.25-2.63-1.65-3.99 0 0 .01-.02.02-.02.06.08 1.52 2.93 1.63 3.08.73 1.13 3.38 7.04 5.67 12.26 1.2 2.73 2.08 5.17 2.83 7.18-.62-1.25-1.23-2.51-1.83-3.78-2.31-4.87-4.53-9.78-6.67-14.73ZM275.92 87.03c-1.06-2.18-1.13-3.45-2.44-2.93-1.52.57-2.94 1.3-4.5 2.1-1.4.72-2.68 1.44-3.92 2.12.01-.25-.24-.5-.51-.34-4.8 2.93-12.41 4.7-17.28 1.31-1.98-1.77-3.32-4.15-3.97-5.78-.29-.95-.49-1.94-.63-2.93-.14-3.34 1.58-6.53 3.9-9.12.8-.79 1.68-1.51 2.66-2.12 3.7-2.3 8.22-3.07 12.51-2.51 2.71.35 5.32 1.24 7.71 2.55.39.22.75-.39.35-.6-.18-.1-.37-.18-.55-.27.56.27 1.03.33 1.51.19l-.48.39c-.15.11-.23.3-.13.48.09.15.33.24.48.13 1.3-.97 2.46-2.09 3.45-3.37.37-.29.64-.6.65-.97v-.02c.08-.33-.03-.7-.21-1.08-.31-.87-.98-2.01-2.19-3.26-2.43-2.52-3.79-3.45-5.68-4.26-1.14-.49-3.12-1.06-4.42-1.23-3.28-.42-10.64-1.21-18.18 4.11-7.74 5.46-11.94 12.3-12.23 20.61-.08 2.06.04 3.98.34 5.71.74 4.18 2.57 8 5.44 11.34 4.26 4.99 9.76 7.52 16.34 7.52 4.85 0 9.69-1.77 14.89-4.62.23-.12.45-.23.68-.35 2.19-1.1 4.37-2.23 6.46-3.5.49-.3 1.03-.61 1.5-.98 1.47-.87 1.11-1.12.49-2.95-.39-1.14-.76-2.7-2.06-5.36l.02-.01Zm-17.38-21.76c3.05-.42 6.31.79 9.36 2.35.51.39.94.68 1.33.87-5.61-2.86-12.72-3.39-18.44-.79 2.05-1.33 4.24-1.95 7.74-2.44l.01.01ZM443.67 72.67c-.4-2.2-1.15-4.33-2.37-6.22-1.49-2.32-3.58-4.19-5.91-5.64-6.17-3.81-13.75-5.11-20.83-6.01-3.23-.41-6.47-.69-9.72-.92l-1.39-.12c-.85-.07-1.52-.1-2.05-.1-1.08-.06-2.17-.12-3.25-.17-.08 0-.14.02-.19.05-.1.05-.18.14-.16.3.27 2.55-.01 5.12-.92 7.52-.15.38.4.56.62.28 1.32.59 2.68 1.05 4.08 1.37 0 2.78-.14 7.58-.33 12.91 0 0 0 .02-.01.03-.61 3.66-.79 7.42-1 11.12-.23 4.01-.43 8.03-.44 12.05 0 .64 0 1.28.03 1.93.02.31 0 .68.15.96.06.11.14.16.24.17-.2.17-.21.54.11.59 3.83.67 7.78.71 11.68.25 2.3-.19 4.87-.65 7.65-1.56 1.85-.54 3.67-1.18 5.43-1.91 7.2-3.02 14.31-8.07 17.35-15.53.76-1.86 1.17-3.8 1.31-5.75.3-1.93.28-3.82-.09-5.58l.01-.02Zm-19.32-15.42c5.74 1.41 11.94 3.68 15.65 8.55.25.32.47.65.69.99-2.3-2.82-5.68-5.69-12.88-8.23-2.16-.76-4.35-1.43-6.64-2.02 1.06.21 2.13.45 3.18.71Zm-25.82-3.04c.13 0 .27.01.4.02-.14.1-.26.23-.37.38 0-.13-.02-.26-.03-.4Zm34.82 22.17c-.75 3.09-3.55 5.66-5.88 7.58-3.35 2.76-7.21 5.03-11.28 6.54-1.33.49-2.71.9-4.12 1.15.06-1.38.08-2.76.07-4.13-.02-3.78-.16-7.56-.41-11.33-.09-1.37-.18-2.74-.37-4.1 0-.06-.03-.11-.06-.15.09-3.25.12-6.16.03-8.12 6.86 1.05 10.56 2.17 14.06 3.62 5.52 2.28 8.59 5.44 7.97 8.96l-.01-.02Zm-22 16.15c-.12 0-.23-.02-.34-.03l.34-.03v.06Zm-.69-.7c0-3.13.26-8.84.47-14.51.06 1.2.11 2.41.15 3.6.15 3.6.25 7.23.09 10.83-.24.03-.48.05-.71.07v.01Zm-12.33-30.94c.37.63 2.01 1.01 3.23 1.25v.15c-1.31-.31-2.59-.73-3.83-1.29.12-.36.23-.72.33-1.09.08.48.18.84.27.98Zm13.7 31.65v-.18c3.41-.56 6.71-2.02 9.69-3.68 2.31-1.28 4.59-2.78 6.63-4.53-4.69 4.53-11.61 8.24-16.33 8.38l.01.01Zm24.07-.75c-2.05 1.93-4.37 3.56-6.83 4.95 2.7-1.78 5.52-4.03 8.42-6.87.82-.82 1.56-1.69 2.23-2.59-1.08 1.65-2.38 3.16-3.81 4.51h-.01ZM187.16 92.14c-.79-2.47-2.1-7.12-3.1-6.87-.19-.01-2.09.77-4.08 1.54-3.06 1.18-5.91 2.13-10.09 2.82-2.74.42-5.87 1.01-10.61 1.06.04-3.34.05-6.01.05-7.99 7.97-.65 12.33-2.11 16.37-3.55 1.11-.39 2.69-1.01 2.63-1.8-.08-.35-.55-1.39-1.17-2.61-.47-1.16-.98-2.31-1.61-3.38-.42-.71-1.04-1.69-1.86-2.06-.11-.08-.22-.13-.29-.12-.02 0-.04 0-.07.01-.19-.04-.39-.05-.6-.01-.17.03-.24.15-.25.28-.04.02-.09.04-.14.05-4.33 1.48-8.85 2.33-13.24 3.61a499.1 499.1 0 0 0-.31-8.19c4.51-.99 8.88-1.38 13.11-1.82 3.68-.38 6.28.12 7.47.34.59.11.9.16 1.16.18h.1c-.1.37.44.66.62.28.02-.04.03-.08.05-.13.15.2.53.22.62-.1.17-.58.19-1.21.21-1.81v-.36c.03-.15.05-.3.07-.45.52-2.47.33-5.09-.64-7.44-.11-.27-.44-.28-.6-.14-.08-.21-.15-.42-.24-.62-.19-.41-.79-.05-.6.35.03.07.05.15.09.22-.98-.42-2.15-.54-3.17-.63-2.17-.19-4.37-.14-6.54 0-5.7.35-11.4 1.3-16.91 2.79-2.08.56-4.13 1.22-6.14 2-4.54 1.05-3.79 1.51-2.17 6.07.18.51.46 1.68.54 1.94.82 2.47 1.08 2.13 3.1 2.13s0 .05 0 .08h.52c-.48 2.66-.51 5.45-.62 8.13-.15 3.48-.22 6.96-.28 10.45 0 .41-.01.82-.02 1.23-.16.29-.33.57-.51.85-.05.38-.09.77-.14 1.18-.42 3.52-.59 6.48-.52 8.8v.34c.02.47.05.76.06.87.16 1.57-.26 3.47 1.35 3.79 1.61.32 3.5.55 4.85.55.11 0 .22-.02.33-.02 1.79.24 3.67.05 5.45-.12 2.85-.28 5.69-.7 8.51-1.19 3.03-.53 6.05-1.14 9.04-1.86 2.4-.58 4.82-1.19 7.13-2.06.51-.19 1.73-.57 2.46-1.14 1.81-.68 2.18-1 1.57-2.67-.23-.62-.48-1.49-.91-2.78l-.03-.02Zm-11.12-38.71c.89.05 1.93.08 2.89.3-.33 0-.68-.02-1.06-.03-8.28-.26-14.88.75-23.97 2.51 2.41-.64 4.85-1.16 7.28-1.59 4.87-.86 9.91-1.45 14.86-1.19Zm-26.53 22.13c.03 1.71.04 3.43 0 5.14-.04 1.27-.11 2.55-.24 3.82 0-.73.02-1.46.04-2.19.05-2.26.12-4.51.22-6.77h-.02Zm6.73 27.85c.2-.1.4-.21.58-.33 1.82-.17 3.82-.24 5.94-.34-.86.11-1.72.24-2.58.33-1.27.14-2.61.31-3.93.34h-.01ZM534.48 85.44c-3.52-8.38-7.07-16.75-10.5-25.17-.63-1.54-1.25-3.09-1.86-4.65-.31-.8-.65-1.6-.87-2.43-.04-.17-.17-.24-.31-.25.1-.2 0-.51-.29-.53-1.59-.08-3.18-.22-4.78-.25-1.96-.03-3.91.13-5.84.42-.31.05-.31.38-.13.56-.03.06-.05.14-.04.22.23 1.54.63 3.06 1.16 4.53.13.35.27.7.41 1.06l-2.68 6.18c-.11.03-.2.09-.25.22-.67 1.9-1.52 3.73-2.34 5.56a536.85 536.85 0 0 1-3.9 8.45c-2.64 5.64-5.34 11.25-7.91 16.93-.44.97-.88 1.94-1.29 2.93-.2.48-.47 1-.55 1.52v.05c-.02.12.02.26.16.34 1.19.73 2.41 1.41 3.66 2.05 1.2.62 2.45 1.25 3.76 1.61.43.12.62-.55.19-.67-1.13-.31-2.2-.83-3.24-1.36 1.09.36 2.1.69 2.75.93 2.82 1.01 2.38 1.1 4.3-3.75 2.1-1.09 4.34-1.96 6.53-2.79 4.35-1.64 8.8-3.03 13.27-4.29.82 2.01 1.77 3.97 2.72 5.92.35.83.62 1.45.79 1.82.22.42.45.8.69 1.15.17.33.33.67.5 1 .42.8.84 1.63 1.4 2.35.23.29.6 0 .55-.31 1.53-.02 3.06-.07 4.58-.27.92-.12 1.82-.32 2.71-.54 1.39-.27 3.85-1.11 3.74-1.42-.67-1.96-1.55-3.87-2.34-5.78-1.57-3.78-3.16-7.56-4.75-11.33v-.01Zm-11.65-26.16c1.54 3.81 3.12 7.6 4.7 11.4 2.94 7.05 5.91 14.09 8.87 21.13l-1.06-2.17c-2.71-5.51-5.2-11.19-7.41-16.87l-6.65-17.15c-.65-1.45-.55-2.19-.93-2.53.09 0 .18.01.28.02a.29.29 0 0 0-.04.26c.52 2.02 1.47 3.98 2.25 5.91h-.01Zm-6.58 13.58c.05-.15.09-.31.14-.46 1.41 3.92 2.88 7.9 4.39 11.87-3.22.52-6.38 1.25-9.46 2.14.55-1.22 1.05-2.46 1.53-3.7 1.24-3.24 2.37-6.53 3.39-9.85h.01Zm-.23-20c.36 0 .73.03 1.09.05-2.15.1-5.18.33-5.87.74-.24.15-.41.3-.53.45-.06-.29-.13-.58-.18-.88 1.82-.26 3.65-.39 5.49-.35v-.01Zm-.09 18.72c-.49 1.67-1.05 3.33-1.6 4.97-1.07 3.19-2.19 6.38-3.57 9.46-.09.21-.19.43-.29.65-.25.07-.5.14-.74.22 2.53-6.16 4.61-11.29 6.2-15.3Zm-6.34 25.16c4.97-2.38 9.37-4.1 14.02-5.27l.26.64c-4.8 1.35-9.63 2.8-14.28 4.63Zm20.17 6.76c.33.23.68.42 1.04.56h-.33c-.12 0-.21.06-.26.13-.15-.23-.31-.45-.45-.7v.01ZM226.57 91.75c-3.55-4.74-6.68-9.11-9.31-12.99 9.2-15.25 10.05-17.81 10.35-18.38.17-.34 1.09-2.27.64-2.53-1.13-.65-1.03-.65-2.97-1.71-1.19-.65-3.04-1.61-4.53-2.12-1.71-.59-1.24-.36-3 2.77-.06.1-.11.2-.17.3-.75 1.02-1.48 2.05-2.2 3.09-1.88 2.71-3.73 5.45-5.69 8.1-3.68-4.91-6.88-8.76-9.51-11.43-.15-.15-.3-.29-.46-.42-1.27-1.28-7.24 3.53-7.93 5.58-.09.09-.19.16-.28.25-.27.26.03.64.33.58.19.65.5 1.29.94 1.91 3.85 5.06 7.19 9.76 9.94 14-1.23 2.61-3.06 5-4.67 7.38l-2.28 3.33c-.5.66-.93 1.23-1.29 1.69-.67.93-2.09 2.61-2.3 3.87-.51.85-1.16 1.84-1.29 2.83-.06.44.61.63.67.19.01-.08.04-.15.06-.22 1.36 1.08 2.76 2.11 4.19 3.11 1.3.91 2.62 1.85 4.04 2.56.21.1.4 0 .48-.17.24.07.48.14.72.2.44.1.62-.57.19-.67-2.02-.48-3.77-1.57-5.23-3.02-.47-.46-.9-.96-1.32-1.46 1.74 1.35 4.2 2.89 5.89 4.14 1.39 1.03 2.85-2.27 4.22-4.2 1.86-2.64 3.96-5.86 5.52-8.29l10.39 14.51c.67.81 1.14 1.21 1.57 1.36-.05.24.12.51.41.4 1.53-.58 3.05-1.19 4.54-1.87 1.52-.69 3.06-1.45 4.36-2.5a.28.28 0 0 0 .12-.23c1.66-1.1.81-1.74-1.41-4.91-1.13-1.58-1.71-2.36-3.7-5.01l-.03-.02Zm2.41 6.54c.56 1.15 1.19 2.52 1.11 3.81-.06.04-.12.07-.17.1-.03-.88-.55-2.66-.94-3.91Zm-16.51-32.73c1.86-2.65 3.65-5.35 5.57-7.95.4-.55.81-1.13 1.26-1.66.19-.18.38-.33.56-.45.18.03.36.08.55.13l-8.05 10.11.12-.18h-.01ZM192.7 95.48c.79-1.37 1.66-2.69 2.54-4 1.19-1.79 2.4-3.56 3.61-5.33-.04.09-.09.17-.13.26-.1.22.03.41.2.49-2.47 3.42-4.89 6.73-6.4 9.28.21.24.4.48.63.75-.24.07-.4.36-.17.56.4.33.72.77 1.05 1.17.09.11.18.21.27.32-.84-.61-1.66-1.24-2.47-1.88.24-.57.58-1.11.87-1.61v-.01Zm7.46-10.32c.47-.81.98-1.59 1.49-2.37.31-.48.64-.95.96-1.43.26-.29.52-.56.75-.79-.99 1.48-2.09 3.03-3.2 4.59Zm10.03-16.22s-.03-.05-.05-.07c.22-.29.43-.59.64-.89-.2.32-.4.65-.58.96h-.01ZM371.54 87.96c-.01-.08-.01-.16-.03-.23-.06-.38-.58-.29-.66.03-.3-.05-.6-.08-.81-.11-1.14-.15-2.29-.19-3.44-.2 1.04-.09 2.09-.18 3.14-.23.45-.02.45-.72 0-.7-6.57.35-13.14 1.23-19.65 2.11-1.53.21-3.05.42-4.57.68-.01 0-.02.01-.04.01-.04-3.33-.13-6.66-.24-9.99-.19-5.7-.4-11.41-.88-17.1-.13-1.51-.23-3.07-.49-4.58 0-.25 0-.48-.02-.68-.06-1.19-.04-2.61-.68-2.78-.16-.07-.72-.16-1.5-.24.22-.17.16-.62-.2-.63-1.19-.04-2.39.09-3.57.23-1.2.14-2.41.32-3.59.6-.16-.1-.41-.06-.5.12-.06.02-.13.03-.19.05-.35.1-.29.55-.03.66-.26.6-.19 2.27-.21 3-.02.66-.66 33.73-.9 40.3-.03.65.06 1.12.04 1.45-.16 3.05.87 4.96 6.34 3.93 1.09-.08 2.75-.77 5.36-1.43 4.13-1.04 5.78-1.52 6.2-1.65 6.43-1.69 6.78-1.97 11.72-2.43.55-.05 4.8-.38 6.03-.3.64.04 1.19.07 1.65.1.09 0 .16-.03.24-.05.1.27.56.33.66-.02.39-1.32.61-2.71.78-4.08.2-1.61.29-3.24.15-4.86.24.03.52-.23.38-.53-.09-.2-.27-.33-.49-.43v-.02Zm-.63.56c.07.57.11 1.14.11 1.71-.21-.99-.53-1.71-.95-1.87.22.03.44.06.65.11.06.01.12.04.19.05Zm-25.41 1.73c1.54-.36 3.1-.64 4.66-.89-1.61.37-3.18.77-4.66 1.2v-.31Zm-.86-7.37c-.07-1.37-.16-2.75-.25-4.12-.21-3.13-.45-6.27-.79-9.4.02-2.25.08-4.31.13-6.11.16 2.08.29 4.16.4 6.24.23 4.46.38 8.93.5 13.39h.01Zm-.94-4c.16 2.41.29 4.83.39 7.24.06 1.6.14 3.22.09 4.83-.15.05-.32.09-.47.14V78.88h-.01ZM483.72 92.83c-3.05-2.28-6.22-4.4-9.38-6.51 8.86-6.49 13.49-12.95 13.73-19.23.04-.76 0-1.5-.13-2.2-.67-3.82-3.5-6.68-8.39-8.48.13.04.27.08.4.13 3.92 1.39 7.74 4.23 8.5 8.56.34 1.95-.05 3.96-.98 5.69-.21.4.39.75.6.35 1.86-3.46 1.46-7.55-.97-10.63-3.53-4.47-9.76-5.88-15.16-6.16-2.32-.12-4.64-.04-6.95.19-6 .32-12.71 1.68-17.63 3.21-.37.11-.67.23-.92.35-.2-.17-.62.02-.57.37v.03c-.64.68-.18 1.64.48 3.21.38.91.67 1.89 1.15 2.58.32.76.68 1.51 1.13 2.19.14.21.38.19.53.07.19-.02.38-.05.57-.08v1.57c-.06.06-.1.13-.11.23-.27 4.18-.34 8.38-.48 12.57l-.3 9.03c-.24 3.91-.44 6.77-.46 7.26-.05.88-.11 1.95.07 2.81-.01.22-.02.43-.04.65 0 .11-.02.23-.03.35 0 .05-.03.27-.01.16-.05.4.5.59.64.28.05.04.12.08.2.08 1.75.13 3.5.28 5.25.3 1.69.02 3.38-.12 5.06-.32.08.23.36.39.55.15.06-.08.11-.17.16-.26.18-.09.24-.32.18-.48.05-.2.1-.4.13-.6.16-.86.25-1.74.33-2.62.11-1.17.17-2.34.23-3.51.15-.01.32-.03.52-.04.36-.03 1.73-.15 2.06-.15.39 0 .7-.02.95-.04 1.76 1.11 3.45 2.35 5.14 3.55 2.83 2.01 5.64 4.04 8.47 6.04 1.42 1 2.85 2 4.29 2.97.1.06.19.07.27.04.08 0 .17-.02.25-.1 1.61-1.56 3.15-3.18 4.6-4.88.75-.88 1.49-1.78 2.15-2.73.01.01.03.02.04.03.34.3.83-.2.49-.49-2.16-1.9-4.34-3.76-6.64-5.48l.03-.01Zm-6.38-3.65a55.72 55.72 0 0 0-4-2.13c.14-.1.26-.19.4-.29 1.2.81 2.4 1.61 3.6 2.42Zm-20.1 11.78c.67-.37 1.23-.91 1.67-1.6-.11.5-.24 1-.38 1.49-.43.04-.86.08-1.29.11Zm2.38-37.24c1.34-.31 2.56-.52 3.71-.69-1.03.19-2.04.41-3.04.65-.14-.07-.34-.02-.45.11-.07.02-.15.04-.22.05v-.13.01Zm.04.84c.07-.02.14-.03.2-.05.34 1.66.41 3.41.5 5.09.17 2.9.24 5.81.28 8.71l.03 3.17c-.17.07-.34.14-.51.2-.06-4.96-.21-10.58-.51-17.12h.01Zm16.04 5.62c-1.16 2.25-3.06 4.1-5.02 5.66-2.8 2.23-5.99 3.97-9.3 5.35-.01-3.56-.09-7.12-.27-10.67-.1-2.04-.16-4.16-.57-6.18 3.3-.78 6.72-1.36 10.1-1.1 1.85.14 4.23.59 5.32 2.29.92 1.43.46 3.24-.26 4.65Zm.85-.18c.6-1.37.9-2.92.28-4.32-.67-1.52-2.2-2.32-3.76-2.74.46.1.89.21 1.29.37 1.74.67 2.69 1.88 2.93 3.21.2 1.13-.05 2.25-.74 3.47V70Zm-27.47-4.14c-.12-.19-.23-.38-.34-.57.74.42.85.36.99.41v.08c-.22.03-.43.06-.65.08Zm11.21 30.46c-.08 1.08-.16 2.17-.33 3.24-.05.35-.11.69-.2 1.03 0 .04-.02.07-.03.11-.15.02-.3.04-.45.05.45-1.64.76-3.36.79-5.07.03-.29.08-.57.1-.89-.03-.31-.03-.47.24-.57-.04.69-.07 1.39-.12 2.08v.02Zm5.6-2.47c.48.11.92.52 2.49 1.72-.46-.32-.92-.65-1.38-.97-.37-.25-.73-.5-1.1-.75h-.01Zm21.23 7.24a70.76 70.76 0 0 1-4.37 4.63c-.14-.09-.27-.19-.4-.28.19-.09.37-.24.55-.47.87-1.14 5.43-5.51 5.49-7.45.31.26.62.53.92.79-.67.97-1.42 1.88-2.19 2.77v.01Z",fill:"currentColor",transform:"translate(-144.023 -51.76)"})]}),Cv=({style:e,size:t="small",withText:s})=>gp.exports.jsxs("div",{className:`ExcalidrawLogo is-${t}`,style:e,children:[gp.exports.jsx(wv,{}),s&&gp.exports.jsx(Sv,{})]}),Iv=({icon:e,shortcut:t,children:s})=>{let n=Jy();return gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsx("div",{className:"welcome-screen-menu-item__icon",children:e}),gp.exports.jsx("div",{className:"welcome-screen-menu-item__text",children:s}),t&&!n.editor.isMobile&&gp.exports.jsx("div",{className:"welcome-screen-menu-item__shortcut",children:t})]})};Iv.displayName="WelcomeScreenMenuItemContent";var kv=({onSelect:e,children:t,icon:s,shortcut:n,className:i="",...a})=>gp.exports.jsx("button",{...a,type:"button",className:`welcome-screen-menu-item ${i}`,onClick:e,children:gp.exports.jsx(Iv,{icon:s,shortcut:n,children:t})});kv.displayName="WelcomeScreenMenuItem";var Tv=({children:e,href:t,icon:s,shortcut:n,className:i="",...a})=>gp.exports.jsx("a",{...a,className:`welcome-screen-menu-item ${i}`,href:t,target:"_blank",rel:"noreferrer",children:gp.exports.jsx(Iv,{icon:s,shortcut:n,children:e})});Tv.displayName="WelcomeScreenMenuItemLink";var Mv=({children:e})=>{let{WelcomeScreenCenterTunnel:t}=dx();return gp.exports.jsx(t.In,{children:gp.exports.jsx("div",{className:"welcome-screen-center",children:e||gp.exports.jsxs(gp.exports.Fragment,{children:[gp.exports.jsx(jv,{}),gp.exports.jsx(Dv,{children:Np("welcomeScreen.defaults.center_heading")}),gp.exports.jsxs(Lv,{children:[gp.exports.jsx(Av,{}),gp.exports.jsx(Nv,{})]})]})})})};Mv.displayName="Center";var jv=({children:e})=>gp.exports.jsx("div",{className:"welcome-screen-center__logo excalifont welcome-screen-decor",children:e||gp.exports.jsx(Cv,{withText:!0})});jv.displayName="Logo";var Dv=({children:e})=>gp.exports.jsx("div",{className:"welcome-screen-center__heading welcome-screen-decor excalifont",children:e});Dv.displayName="Heading";var Lv=({children:e})=>gp.exports.jsx("div",{className:"welcome-screen-menu",children:e});Lv.displayName="Menu";var Nv=()=>{let e=iv();return gp.exports.jsx(kv,{onSelect:()=>e.executeAction(ru),shortcut:"?",icon:pa,children:Np("helpDialog.title")})};Nv.displayName="MenuItemHelp";var Av=()=>{let e=Oh(),t=iv();return e.viewModeEnabled?null:gp.exports.jsx(kv,{onSelect:()=>t.executeAction(su),shortcut:nx("loadScene"),icon:da,children:Np("buttons.load")})};Av.displayName="MenuItemLoadScene";var _v=({onSelect:e})=>{let{t:t}=_p();return gp.exports.jsx(kv,{shortcut:null,onSelect:e,icon:fa,children:t("labels.liveCollaboration")})};_v.displayName="MenuItemLiveCollaborationTrigger",Mv.Logo=jv,Mv.Heading=Dv,Mv.Menu=Lv,Mv.MenuItem=kv,Mv.MenuItemLink=Tv,Mv.MenuItemHelp=Nv,Mv.MenuItemLoadScene=Av,Mv.MenuItemLiveCollaborationTrigger=_v;ap(((e,t,s)=>{if(vc.DEV||vc.MODE===Ce.TEST||window?.DEBUG_FRACTIONAL_INDICES){let n=ml(e.map((e=>({...e}))));Yo(n,{shouldThrow:vc.DEV||vc.MODE===Ce.TEST,includeBoundTextValidation:!0,reconciliationContext:{localElements:t,remoteElements:s}})}}),6e4,{leading:!0,trailing:!1}),vv();var Pv=Tc.memo((e=>{let{onChange:t,initialData:s,excalidrawAPI:n,isCollaborating:i=!1,onPointerUpdate:a,renderTopRightUI:l,langCode:r=Cp.code,viewModeEnabled:o,zenModeEnabled:d,gridModeEnabled:c,libraryReturnUrl:p,theme:h,name:m,renderCustomStats:u,onPaste:g,detectScroll:x=!0,handleKeyboardGlobally:f=!1,onLibraryChange:b,autoFocus:E=!1,generateIdForFile:y,onLinkOpen:v,generateLinkForSelection:w,onPointerDown:S,onPointerUp:C,onScrollChange:I,onDuplicate:k,children:T,validateEmbeddable:M,renderEmbeddable:j,aiEnabled:D,showDeprecatedFonts:L}=e,N=e.UIOptions?.canvasActions,A={...e.UIOptions,canvasActions:{...Pr.canvasActions,...N},tools:{image:e.UIOptions?.tools?.image??!0}};return N?.export&&(A.canvasActions.export.saveFileToDisk=N.export?.saveFileToDisk??Pr.canvasActions.export.saveFileToDisk),null===A.canvasActions.toggleTheme&&typeof h>"u"&&(A.canvasActions.toggleTheme=!0),Dc((()=>{(async()=>{await import("../../../../canvas-roundrect-polyfill/roundRect.js")})();let e=e=>{"number"==typeof e.scale&&1!==e.scale&&e.preventDefault()};return document.addEventListener("touchmove",e,{passive:!1}),()=>{document.removeEventListener("touchmove",e)}}),[]),gp.exports.jsx(vp,{store:wp,children:gp.exports.jsx(Op,{langCode:r,theme:h,children:gp.exports.jsx(yv,{onChange:t,initialData:s,excalidrawAPI:n,isCollaborating:i,onPointerUpdate:a,renderTopRightUI:l,langCode:r,viewModeEnabled:o,zenModeEnabled:d,gridModeEnabled:c,libraryReturnUrl:p,theme:h,name:m,renderCustomStats:u,UIOptions:A,onPaste:g,detectScroll:x,handleKeyboardGlobally:f,onLibraryChange:b,autoFocus:E,generateIdForFile:y,onLinkOpen:v,generateLinkForSelection:w,onPointerDown:S,onPointerUp:C,onScrollChange:I,onDuplicate:k,validateEmbeddable:M,renderEmbeddable:j,aiEnabled:!1!==D,showDeprecatedFonts:L,children:T})})})}),((e,t)=>{if(e.children!==t.children)return!1;let{initialData:s,UIOptions:n={},...i}=e,{initialData:a,UIOptions:l={},...r}=t,o=Object.keys(n),d=Object.keys(l);return o.length===d.length&&(o.every((e=>"canvasActions"===e?Object.keys(n.canvasActions).every((e=>"export"===e&&n?.canvasActions?.export&&l?.canvasActions?.export?n.canvasActions.export.saveFileToDisk===l.canvasActions.export.saveFileToDisk:n?.canvasActions?.[e]===l?.canvasActions?.[e])):n[e]===l[e]))&&R(i,r))}));Pv.displayName="Excalidraw";export{ex as Button,Bb as DefaultSidebar,Pv as Excalidraw,Ib as MainMenu,ib as Sidebar,RE as Stats,lE as TTDDialog,iy as convertToExcalidrawElements,Cp as defaultLang,Ip as languages,lg as mergeLibraryItems,Jy as useDevice,_p as useI18n,Bm as zoomToFitBounds};
//# sourceMappingURL=index.js.map
