import{Children as e,cloneElement as n,useState as t,useRef as r,useEffect as o,useCallback as u,useReducer as s}from"react";import{flushSync as i}from"react-dom";import{useComposedRefs as m}from"../../react-compose-refs/dist/index.module.js";import{useLayoutEffect as c}from"../../react-use-layout-effect/dist/index.module.js";const d=d=>{const{present:f,children:N}=d,l=function(e){const[n,m]=t(),d=r({}),f=r(e),N=r("none"),l=e?"mounted":"unmounted",[p,O]=function(e,n){return s(((e,t)=>{const r=n[e][t];return null!=r?r:e}),e)}(l,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return o((()=>{const e=a(d.current);N.current="mounted"===p?e:"none"}),[p]),c((()=>{const n=d.current,t=f.current;if(t!==e){const r=N.current,o=a(n);if(e)O("MOUNT");else if("none"===o||"none"===(null==n?void 0:n.display))O("UNMOUNT");else{O(t&&r!==o?"ANIMATION_OUT":"UNMOUNT")}f.current=e}}),[e,O]),c((()=>{if(n){const e=e=>{const t=a(d.current).includes(e.animationName);e.target===n&&t&&i((()=>O("ANIMATION_END")))},t=e=>{e.target===n&&(N.current=a(d.current))};return n.addEventListener("animationstart",t),n.addEventListener("animationcancel",e),n.addEventListener("animationend",e),()=>{n.removeEventListener("animationstart",t),n.removeEventListener("animationcancel",e),n.removeEventListener("animationend",e)}}O("ANIMATION_END")}),[n,O]),{isPresent:["mounted","unmountSuspended"].includes(p),ref:u((e=>{e&&(d.current=getComputedStyle(e)),m(e)}),[])}}(f),p="function"==typeof N?N({present:l.isPresent}):e.only(N),O=m(l.ref,p.ref);return"function"==typeof N||l.isPresent?n(p,{ref:O}):null};function a(e){return(null==e?void 0:e.animationName)||"none"}d.displayName="Presence";export{d as Presence};
//# sourceMappingURL=index.module.js.map
