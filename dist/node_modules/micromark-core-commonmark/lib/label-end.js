import{factoryDestination as e}from"../../micromark-factory-destination/index.js";import{factoryLabel as r}from"../../micromark-factory-label/index.js";import{factoryTitle as t}from"../../micromark-factory-title/index.js";import{factoryWhitespace as n}from"../../micromark-factory-whitespace/index.js";import{markdownLineEndingOrSpace as i}from"../../micromark-util-character/index.js";import{push as a,splice as c}from"../../micromark-util-chunked/index.js";import{normalizeIdentifier as o}from"../../micromark-util-normalize-identifier/index.js";import{resolveAll as l}from"../../micromark-util-resolve-all/index.js";const s={name:"labelEnd",tokenize:function(e,r,t){const n=this;let i,a,c=n.events.length;for(;c--;)if(("labelImage"===n.events[c][1].type||"labelLink"===n.events[c][1].type)&&!n.events[c][1]._balanced){i=n.events[c][1];break}return function(r){if(!i)return t(r);if(i._inactive)return p(r);return a=n.parser.defined.includes(o(n.sliceSerialize({start:i.end,end:n.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(r),e.exit("labelMarker"),e.exit("labelEnd"),l};function l(r){return 40===r?e.attempt(u,k,a?k:p)(r):91===r?e.attempt(f,k,a?s:p)(r):a?k(r):p(r)}function s(r){return e.attempt(m,k,p)(r)}function k(e){return r(e)}function p(e){return i._balanced=!0,t(e)}},resolveTo:function(e,r){let t,n,i,o,s=e.length,u=0;for(;s--;)if(t=e[s][1],n){if("link"===t.type||"labelLink"===t.type&&t._inactive)break;"enter"===e[s][0]&&"labelLink"===t.type&&(t._inactive=!0)}else if(i){if("enter"===e[s][0]&&("labelImage"===t.type||"labelLink"===t.type)&&!t._balanced&&(n=s,"labelLink"!==t.type)){u=2;break}}else"labelEnd"===t.type&&(i=s);const f={type:"labelLink"===e[n][1].type?"link":"image",start:Object.assign({},e[n][1].start),end:Object.assign({},e[e.length-1][1].end)},m={type:"label",start:Object.assign({},e[n][1].start),end:Object.assign({},e[i][1].end)},k={type:"labelText",start:Object.assign({},e[n+u+2][1].end),end:Object.assign({},e[i-2][1].start)};return o=[["enter",f,r],["enter",m,r]],o=a(o,e.slice(n+1,n+u+3)),o=a(o,[["enter",k,r]]),o=a(o,l(r.parser.constructs.insideSpan.null,e.slice(n+u+4,i-3),r)),o=a(o,[["exit",k,r],e[i-2],e[i-1],["exit",m,r]]),o=a(o,e.slice(i+1)),o=a(o,[["exit",f,r]]),c(e,n,e.length,o),e},resolveAll:function(e){let r=-1;for(;++r<e.length;){const t=e[r][1];"labelImage"!==t.type&&"labelLink"!==t.type&&"labelEnd"!==t.type||(e.splice(r+1,"labelImage"===t.type?4:2),t.type="data",r++)}return e}},u={tokenize:function(r,a,c){return function(e){return r.enter("resource"),r.enter("resourceMarker"),r.consume(e),r.exit("resourceMarker"),o};function o(e){return i(e)?n(r,l)(e):l(e)}function l(t){return 41===t?k(t):e(r,s,u,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(t)}function s(e){return i(e)?n(r,f)(e):k(e)}function u(e){return c(e)}function f(e){return 34===e||39===e||40===e?t(r,m,c,"resourceTitle","resourceTitleMarker","resourceTitleString")(e):k(e)}function m(e){return i(e)?n(r,k)(e):k(e)}function k(e){return 41===e?(r.enter("resourceMarker"),r.consume(e),r.exit("resourceMarker"),r.exit("resource"),a):c(e)}}},f={tokenize:function(e,t,n){const i=this;return function(t){return r.call(i,e,a,c,"reference","referenceMarker","referenceString")(t)};function a(e){return i.parser.defined.includes(o(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?t(e):n(e)}function c(e){return n(e)}}},m={tokenize:function(e,r,t){return function(r){return e.enter("reference"),e.enter("referenceMarker"),e.consume(r),e.exit("referenceMarker"),n};function n(n){return 93===n?(e.enter("referenceMarker"),e.consume(n),e.exit("referenceMarker"),e.exit("reference"),r):t(n)}}};export{s as labelEnd};
//# sourceMappingURL=label-end.js.map
