import{commonjsGlobal as t}from"../../_virtual/_commonjsHelpers.js";import{e}from"../../_virtual/es6-promise-pool.js";e.exports=function(){var t=function(){this._listeners={}};t.prototype.addEventListener=function(t,e){this._listeners[t]=this._listeners[t]||[],this._listeners[t].indexOf(e)<0&&this._listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){if(this._listeners[t]){var i=this._listeners[t].indexOf(e);i>=0&&this._listeners[t].splice(i,1)}},t.prototype.dispatchEvent=function(t){if(this._listeners[t.type]&&this._listeners[t.type].length)for(var e=this._listeners[t.type].slice(),i=0,o=e.length;i<o;++i)e[i].call(this,t)};var e=function(t){return"function"==typeof t.constructor&&"GeneratorFunction"===t.constructor.name},i=function(t){return{next:function(){var e=t();return e?{value:e}:{done:!0}}}},o=function(t){var e=!1;return{next:function(){return e?{done:!0}:(e=!0,{value:t})}}},r=function(t,r){var n=typeof t;if("object"===n){if("function"==typeof t.next)return t;if("function"==typeof t.then)return o(t)}return"function"===n?e(t)?t():i(t):o(r.resolve(t))},n=function(t,e,i){this.target=t,this.type=e,this.data=i},s=function(e,i,o){if(t.call(this),"number"!=typeof i||Math.floor(i)!==i||i<1)throw new Error("Invalid concurrency");this._concurrency=i,this._options=o||{},this._options.promise=this._options.promise||Promise,this._iterator=r(e,this._options.promise),this._done=!1,this._size=0,this._promise=null,this._callbacks=null};return s.prototype=new t,s.prototype.constructor=s,s.prototype.concurrency=function(t){return void 0!==t&&(this._concurrency=t,this.active()&&this._proceed()),this._concurrency},s.prototype.size=function(){return this._size},s.prototype.active=function(){return!!this._promise},s.prototype.promise=function(){return this._promise},s.prototype.start=function(){var t=this,e=this._options.promise;return this._promise=new e((function(e,i){t._callbacks={reject:i,resolve:e},t._proceed()})),this._promise},s.prototype._fireEvent=function(t,e){this.dispatchEvent(new n(this,t,e))},s.prototype._settle=function(t){t?this._callbacks.reject(t):this._callbacks.resolve(),this._promise=null,this._callbacks=null},s.prototype._onPooledPromiseFulfilled=function(t,e){this._size--,this.active()&&(this._fireEvent("fulfilled",{promise:t,result:e}),this._proceed())},s.prototype._onPooledPromiseRejected=function(t,e){this._size--,this.active()&&(this._fireEvent("rejected",{promise:t,error:e}),this._settle(e||new Error("Unknown error")))},s.prototype._trackPromise=function(t){var e=this;t.then((function(i){e._onPooledPromiseFulfilled(t,i)}),(function(i){e._onPooledPromiseRejected(t,i)})).catch((function(t){e._settle(new Error("Promise processing failed: "+t))}))},s.prototype._proceed=function(){if(!this._done){for(var t={done:!1};this._size<this._concurrency&&!(t=this._iterator.next()).done;)this._size++,this._trackPromise(t.value);this._done=null===t||!!t.done}this._done&&0===this._size&&this._settle()},s.PromisePoolEvent=n,s.PromisePool=s,s}();var i=e.exports;export{i as default};
//# sourceMappingURL=es6-promise-pool.js.map
