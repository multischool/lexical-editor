import{INSERT_CHECK_LIST_COMMAND as e,insertList as t,$isListItemNode as n,$isListNode as r}from"@lexical/list";import{useLexicalComposerContext as i}from"./LexicalComposerContext.mjs.js";import{mergeRegister as o,$findMatchingParent as l,isHTMLElement as s,calculateZoomLevel as c}from"@lexical/utils";import{COMMAND_PRIORITY_LOW as u,KEY_ARROW_DOWN_COMMAND as a,KEY_ARROW_UP_COMMAND as g,KEY_ESCAPE_COMMAND as f,KEY_SPACE_COMMAND as m,$getNearestNodeFromDOMNode as d,KEY_ARROW_LEFT_COMMAND as p,$getSelection as C,$isRangeSelection as h,$isElementNode as v,getNearestEditorFromDOMNode as L}from"lexical";import{useEffect as E}from"react";function k(){const[s]=i();return E((()=>o(s.registerCommand(e,(()=>(t(s,"check"),!0)),u),s.registerCommand(a,(e=>b(e,s,!1)),u),s.registerCommand(g,(e=>b(e,s,!0)),u),s.registerCommand(f,(e=>{if(null!=_()){const e=s.getRootElement();return null!=e&&e.focus(),!0}return!1}),u),s.registerCommand(m,(e=>{const t=_();return!(null==t||!s.isEditable())&&(s.update((()=>{const r=d(t);n(r)&&(e.preventDefault(),r.toggleChecked())})),!0)}),u),s.registerCommand(p,(e=>s.getEditorState().read((()=>{const t=C();if(h(t)&&t.isCollapsed()){const{anchor:i}=t,o="element"===i.type;if(o||0===i.offset){const t=i.getNode(),c=l(t,(e=>v(e)&&!e.isInline()));if(n(c)){const n=c.getParent();if(r(n)&&"check"===n.getListType()&&(o||c.getFirstDescendant()===t)){const t=s.getElementByKey(c.__key);if(null!=t&&document.activeElement!==t)return t.focus(),e.preventDefault(),!0}}}}return!1}))),u),s.registerRootListener(((e,t)=>{null!==e&&(e.addEventListener("click",y),e.addEventListener("pointerdown",N)),null!==t&&(t.removeEventListener("click",y),t.removeEventListener("pointerdown",N))}))))),null}function x(e,t){const n=e.target;if(!s(n))return;const r=n.firstChild;if(s(r)&&("UL"===r.tagName||"OL"===r.tagName))return;const i=n.parentNode;if(!i||"check"!==i.__lexicalListType)return;const o=n.getBoundingClientRect(),l=e.pageX/c(n);("rtl"===n.dir?l<o.right&&l>o.right-20:l>o.left&&l<o.left+20)&&t()}function y(e){x(e,(()=>{if(s(e.target)){const t=e.target,r=L(t);null!=r&&r.isEditable()&&r.update((()=>{const e=d(t);n(e)&&(t.focus(),e.toggleChecked())}))}}))}function N(e){x(e,(()=>{e.preventDefault()}))}function _(){const e=document.activeElement;return s(e)&&"LI"===e.tagName&&null!=e.parentNode&&"check"===e.parentNode.__lexicalListType?e:null}function b(e,t,i){const o=_();return null!=o&&t.update((()=>{const l=d(o);if(!n(l))return;const s=function(e,t){let i=t?e.getPreviousSibling():e.getNextSibling(),o=e;for(;null==i&&n(o);)o=o.getParentOrThrow().getParent(),null!=o&&(i=t?o.getPreviousSibling():o.getNextSibling());for(;n(i);){const e=t?i.getLastChild():i.getFirstChild();if(!r(e))return i;i=t?e.getLastChild():e.getFirstChild()}return null}(l,i);if(null!=s){s.selectStart();const n=t.getElementByKey(s.__key);null!=n&&(e.preventDefault(),setTimeout((()=>{n.focus()}),0))}})),!1}export{k as CheckListPlugin};
//# sourceMappingURL=LexicalCheckListPlugin.dev.mjs.js.map
