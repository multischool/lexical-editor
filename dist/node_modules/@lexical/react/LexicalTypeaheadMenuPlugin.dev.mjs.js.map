{"version":3,"file":"LexicalTypeaheadMenuPlugin.dev.mjs.js","sources":["../../../../node_modules/@lexical/react/LexicalTypeaheadMenuPlugin.dev.mjs"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { createCommand, KEY_ARROW_DOWN_COMMAND, KEY_ARROW_UP_COMMAND, KEY_ESCAPE_COMMAND, KEY_TAB_COMMAND, KEY_ENTER_COMMAND, COMMAND_PRIORITY_LOW, $getSelection, $isRangeSelection, getDOMSelection, $isTextNode } from 'lexical';\nimport React, { useLayoutEffect, useEffect, useState, useCallback, useMemo, useRef } from 'react';\nimport { mergeRegister } from '@lexical/utils';\nimport { jsx } from 'react/jsx-runtime';\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n\n// Webpack + React 17 fails to compile on the usage of `React.startTransition` or\n// `React[\"startTransition\"]` even if it's behind a feature detection of\n// `\"startTransition\" in React`. Moving this to a constant avoids the issue :/\nconst START_TRANSITION = 'startTransition';\nfunction startTransition(callback) {\n  if (START_TRANSITION in React) {\n    React[START_TRANSITION](callback);\n  } else {\n    callback();\n  }\n}\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nconst CAN_USE_DOM = typeof window !== 'undefined' && typeof window.document !== 'undefined' && typeof window.document.createElement !== 'undefined';\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n\n// This workaround is no longer necessary in React 19,\n// but we currently support React >=17.x\n// https://github.com/facebook/react/pull/26395\nconst useLayoutEffectImpl = CAN_USE_DOM ? useLayoutEffect : useEffect;\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nclass MenuOption {\n  constructor(key) {\n    this.key = key;\n    this.ref = {\n      current: null\n    };\n    this.setRefElement = this.setRefElement.bind(this);\n  }\n  setRefElement(element) {\n    this.ref = {\n      current: element\n    };\n  }\n}\nconst scrollIntoViewIfNeeded = target => {\n  const typeaheadContainerNode = document.getElementById('typeahead-menu');\n  if (!typeaheadContainerNode) {\n    return;\n  }\n  const typeaheadRect = typeaheadContainerNode.getBoundingClientRect();\n  if (typeaheadRect.top + typeaheadRect.height > window.innerHeight) {\n    typeaheadContainerNode.scrollIntoView({\n      block: 'center'\n    });\n  }\n  if (typeaheadRect.top < 0) {\n    typeaheadContainerNode.scrollIntoView({\n      block: 'center'\n    });\n  }\n  target.scrollIntoView({\n    block: 'nearest'\n  });\n};\n\n/**\n * Walk backwards along user input and forward through entity title to try\n * and replace more of the user's text with entity.\n */\nfunction getFullMatchOffset(documentText, entryText, offset) {\n  let triggerOffset = offset;\n  for (let i = triggerOffset; i <= entryText.length; i++) {\n    if (documentText.slice(-i) === entryText.substring(0, i)) {\n      triggerOffset = i;\n    }\n  }\n  return triggerOffset;\n}\n\n/**\n * Split Lexical TextNode and return a new TextNode only containing matched text.\n * Common use cases include: removing the node, replacing with a new node.\n */\nfunction $splitNodeContainingQuery(match) {\n  const selection = $getSelection();\n  if (!$isRangeSelection(selection) || !selection.isCollapsed()) {\n    return null;\n  }\n  const anchor = selection.anchor;\n  if (anchor.type !== 'text') {\n    return null;\n  }\n  const anchorNode = anchor.getNode();\n  if (!anchorNode.isSimpleText()) {\n    return null;\n  }\n  const selectionOffset = anchor.offset;\n  const textContent = anchorNode.getTextContent().slice(0, selectionOffset);\n  const characterOffset = match.replaceableString.length;\n  const queryOffset = getFullMatchOffset(textContent, match.matchingString, characterOffset);\n  const startOffset = selectionOffset - queryOffset;\n  if (startOffset < 0) {\n    return null;\n  }\n  let newNode;\n  if (startOffset === 0) {\n    [newNode] = anchorNode.splitText(selectionOffset);\n  } else {\n    [, newNode] = anchorNode.splitText(startOffset, selectionOffset);\n  }\n  return newNode;\n}\n\n// Got from https://stackoverflow.com/a/42543908/2013580\nfunction getScrollParent$1(element, includeHidden) {\n  let style = getComputedStyle(element);\n  const excludeStaticParent = style.position === 'absolute';\n  const overflowRegex = /(auto|scroll)/;\n  if (style.position === 'fixed') {\n    return document.body;\n  }\n  for (let parent = element; parent = parent.parentElement;) {\n    style = getComputedStyle(parent);\n    if (excludeStaticParent && style.position === 'static') {\n      continue;\n    }\n    if (overflowRegex.test(style.overflow + style.overflowY + style.overflowX)) {\n      return parent;\n    }\n  }\n  return document.body;\n}\nfunction isTriggerVisibleInNearestScrollContainer(targetElement, containerElement) {\n  const tRect = targetElement.getBoundingClientRect();\n  const cRect = containerElement.getBoundingClientRect();\n  return tRect.top > cRect.top && tRect.top < cRect.bottom;\n}\n\n// Reposition the menu on scroll, window resize, and element resize.\nfunction useDynamicPositioning(resolution, targetElement, onReposition, onVisibilityChange) {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    if (targetElement != null && resolution != null) {\n      const rootElement = editor.getRootElement();\n      const rootScrollParent = rootElement != null ? getScrollParent$1(rootElement) : document.body;\n      let ticking = false;\n      let previousIsInView = isTriggerVisibleInNearestScrollContainer(targetElement, rootScrollParent);\n      const handleScroll = function () {\n        if (!ticking) {\n          window.requestAnimationFrame(function () {\n            onReposition();\n            ticking = false;\n          });\n          ticking = true;\n        }\n        const isInView = isTriggerVisibleInNearestScrollContainer(targetElement, rootScrollParent);\n        if (isInView !== previousIsInView) {\n          previousIsInView = isInView;\n          if (onVisibilityChange != null) {\n            onVisibilityChange(isInView);\n          }\n        }\n      };\n      const resizeObserver = new ResizeObserver(onReposition);\n      window.addEventListener('resize', onReposition);\n      document.addEventListener('scroll', handleScroll, {\n        capture: true,\n        passive: true\n      });\n      resizeObserver.observe(targetElement);\n      return () => {\n        resizeObserver.unobserve(targetElement);\n        window.removeEventListener('resize', onReposition);\n        document.removeEventListener('scroll', handleScroll, true);\n      };\n    }\n  }, [targetElement, editor, onVisibilityChange, onReposition, resolution]);\n}\nconst SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND$1 = createCommand('SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND');\nfunction LexicalMenu({\n  close,\n  editor,\n  anchorElementRef,\n  resolution,\n  options,\n  menuRenderFn,\n  onSelectOption,\n  shouldSplitNodeWithQuery = false,\n  commandPriority = COMMAND_PRIORITY_LOW\n}) {\n  const [selectedIndex, setHighlightedIndex] = useState(null);\n  const matchingString = resolution.match && resolution.match.matchingString;\n  useEffect(() => {\n    setHighlightedIndex(0);\n  }, [matchingString]);\n  const selectOptionAndCleanUp = useCallback(selectedEntry => {\n    editor.update(() => {\n      const textNodeContainingQuery = resolution.match != null && shouldSplitNodeWithQuery ? $splitNodeContainingQuery(resolution.match) : null;\n      onSelectOption(selectedEntry, textNodeContainingQuery, close, resolution.match ? resolution.match.matchingString : '');\n    });\n  }, [editor, shouldSplitNodeWithQuery, resolution.match, onSelectOption, close]);\n  const updateSelectedIndex = useCallback(index => {\n    const rootElem = editor.getRootElement();\n    if (rootElem !== null) {\n      rootElem.setAttribute('aria-activedescendant', 'typeahead-item-' + index);\n      setHighlightedIndex(index);\n    }\n  }, [editor]);\n  useEffect(() => {\n    return () => {\n      const rootElem = editor.getRootElement();\n      if (rootElem !== null) {\n        rootElem.removeAttribute('aria-activedescendant');\n      }\n    };\n  }, [editor]);\n  useLayoutEffectImpl(() => {\n    if (options === null) {\n      setHighlightedIndex(null);\n    } else if (selectedIndex === null) {\n      updateSelectedIndex(0);\n    }\n  }, [options, selectedIndex, updateSelectedIndex]);\n  useEffect(() => {\n    return mergeRegister(editor.registerCommand(SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND$1, ({\n      option\n    }) => {\n      if (option.ref && option.ref.current != null) {\n        scrollIntoViewIfNeeded(option.ref.current);\n        return true;\n      }\n      return false;\n    }, commandPriority));\n  }, [editor, updateSelectedIndex, commandPriority]);\n  useEffect(() => {\n    return mergeRegister(editor.registerCommand(KEY_ARROW_DOWN_COMMAND, payload => {\n      const event = payload;\n      if (options !== null && options.length && selectedIndex !== null) {\n        const newSelectedIndex = selectedIndex !== options.length - 1 ? selectedIndex + 1 : 0;\n        updateSelectedIndex(newSelectedIndex);\n        const option = options[newSelectedIndex];\n        if (option.ref != null && option.ref.current) {\n          editor.dispatchCommand(SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND$1, {\n            index: newSelectedIndex,\n            option\n          });\n        }\n        event.preventDefault();\n        event.stopImmediatePropagation();\n      }\n      return true;\n    }, commandPriority), editor.registerCommand(KEY_ARROW_UP_COMMAND, payload => {\n      const event = payload;\n      if (options !== null && options.length && selectedIndex !== null) {\n        const newSelectedIndex = selectedIndex !== 0 ? selectedIndex - 1 : options.length - 1;\n        updateSelectedIndex(newSelectedIndex);\n        const option = options[newSelectedIndex];\n        if (option.ref != null && option.ref.current) {\n          scrollIntoViewIfNeeded(option.ref.current);\n        }\n        event.preventDefault();\n        event.stopImmediatePropagation();\n      }\n      return true;\n    }, commandPriority), editor.registerCommand(KEY_ESCAPE_COMMAND, payload => {\n      const event = payload;\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      close();\n      return true;\n    }, commandPriority), editor.registerCommand(KEY_TAB_COMMAND, payload => {\n      const event = payload;\n      if (options === null || selectedIndex === null || options[selectedIndex] == null) {\n        return false;\n      }\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      selectOptionAndCleanUp(options[selectedIndex]);\n      return true;\n    }, commandPriority), editor.registerCommand(KEY_ENTER_COMMAND, event => {\n      if (options === null || selectedIndex === null || options[selectedIndex] == null) {\n        return false;\n      }\n      if (event !== null) {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n      }\n      selectOptionAndCleanUp(options[selectedIndex]);\n      return true;\n    }, commandPriority));\n  }, [selectOptionAndCleanUp, close, editor, options, selectedIndex, updateSelectedIndex, commandPriority]);\n  const listItemProps = useMemo(() => ({\n    options,\n    selectOptionAndCleanUp,\n    selectedIndex,\n    setHighlightedIndex\n  }), [selectOptionAndCleanUp, selectedIndex, options]);\n  return menuRenderFn(anchorElementRef, listItemProps, resolution.match ? resolution.match.matchingString : '');\n}\nfunction setContainerDivAttributes(containerDiv, className) {\n  if (className != null) {\n    containerDiv.className = className;\n  }\n  containerDiv.setAttribute('aria-label', 'Typeahead menu');\n  containerDiv.setAttribute('role', 'listbox');\n  containerDiv.style.display = 'block';\n  containerDiv.style.position = 'absolute';\n}\nfunction useMenuAnchorRef(resolution, setResolution, className, parent = CAN_USE_DOM ? document.body : undefined, shouldIncludePageYOffset__EXPERIMENTAL = true) {\n  const [editor] = useLexicalComposerContext();\n  const anchorElementRef = useRef(CAN_USE_DOM ? document.createElement('div') : null);\n  const positionMenu = useCallback(() => {\n    if (anchorElementRef.current === null || parent === undefined) {\n      return;\n    }\n    anchorElementRef.current.style.top = anchorElementRef.current.style.bottom;\n    const rootElement = editor.getRootElement();\n    const containerDiv = anchorElementRef.current;\n    const menuEle = containerDiv.firstChild;\n    if (rootElement !== null && resolution !== null) {\n      const {\n        left,\n        top,\n        width,\n        height\n      } = resolution.getRect();\n      const anchorHeight = anchorElementRef.current.offsetHeight; // use to position under anchor\n      containerDiv.style.top = `${top + anchorHeight + 3 + (shouldIncludePageYOffset__EXPERIMENTAL ? window.pageYOffset : 0)}px`;\n      containerDiv.style.left = `${left + window.pageXOffset}px`;\n      containerDiv.style.height = `${height}px`;\n      containerDiv.style.width = `${width}px`;\n      if (menuEle !== null) {\n        menuEle.style.top = `${top}`;\n        const menuRect = menuEle.getBoundingClientRect();\n        const menuHeight = menuRect.height;\n        const menuWidth = menuRect.width;\n        const rootElementRect = rootElement.getBoundingClientRect();\n        if (left + menuWidth > rootElementRect.right) {\n          containerDiv.style.left = `${rootElementRect.right - menuWidth + window.pageXOffset}px`;\n        }\n        if ((top + menuHeight > window.innerHeight || top + menuHeight > rootElementRect.bottom) && top - rootElementRect.top > menuHeight + height) {\n          containerDiv.style.top = `${top - menuHeight - height + (shouldIncludePageYOffset__EXPERIMENTAL ? window.pageYOffset : 0)}px`;\n        }\n      }\n      if (!containerDiv.isConnected) {\n        setContainerDivAttributes(containerDiv, className);\n        parent.append(containerDiv);\n      }\n      containerDiv.setAttribute('id', 'typeahead-menu');\n      anchorElementRef.current = containerDiv;\n      rootElement.setAttribute('aria-controls', 'typeahead-menu');\n    }\n  }, [editor, resolution, shouldIncludePageYOffset__EXPERIMENTAL, className, parent]);\n  useEffect(() => {\n    const rootElement = editor.getRootElement();\n    if (resolution !== null) {\n      positionMenu();\n    }\n    return () => {\n      if (rootElement !== null) {\n        rootElement.removeAttribute('aria-controls');\n      }\n      const containerDiv = anchorElementRef.current;\n      if (containerDiv !== null && containerDiv.isConnected) {\n        containerDiv.remove();\n        containerDiv.removeAttribute('id');\n      }\n    };\n  }, [editor, positionMenu, resolution]);\n  const onVisibilityChange = useCallback(isInView => {\n    if (resolution !== null) {\n      if (!isInView) {\n        setResolution(null);\n      }\n    }\n  }, [resolution, setResolution]);\n  useDynamicPositioning(resolution, anchorElementRef.current, positionMenu, onVisibilityChange);\n\n  // Append the context for the menu immediately\n  const containerDiv = anchorElementRef.current;\n  if (containerDiv != null) {\n    setContainerDivAttributes(containerDiv, className);\n    if (parent != null) {\n      parent.append(containerDiv);\n    }\n  }\n  return anchorElementRef;\n}\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nconst PUNCTUATION = '\\\\.,\\\\+\\\\*\\\\?\\\\$\\\\@\\\\|#{}\\\\(\\\\)\\\\^\\\\-\\\\[\\\\]\\\\\\\\/!%\\'\"~=<>_:;';\nfunction getTextUpToAnchor(selection) {\n  const anchor = selection.anchor;\n  if (anchor.type !== 'text') {\n    return null;\n  }\n  const anchorNode = anchor.getNode();\n  if (!anchorNode.isSimpleText()) {\n    return null;\n  }\n  const anchorOffset = anchor.offset;\n  return anchorNode.getTextContent().slice(0, anchorOffset);\n}\nfunction tryToPositionRange(leadOffset, range, editorWindow) {\n  const domSelection = getDOMSelection(editorWindow);\n  if (domSelection === null || !domSelection.isCollapsed) {\n    return false;\n  }\n  const anchorNode = domSelection.anchorNode;\n  const startOffset = leadOffset;\n  const endOffset = domSelection.anchorOffset;\n  if (anchorNode == null || endOffset == null) {\n    return false;\n  }\n  try {\n    range.setStart(anchorNode, startOffset);\n    range.setEnd(anchorNode, endOffset);\n  } catch (error) {\n    return false;\n  }\n  return true;\n}\nfunction getQueryTextForSearch(editor) {\n  let text = null;\n  editor.getEditorState().read(() => {\n    const selection = $getSelection();\n    if (!$isRangeSelection(selection)) {\n      return;\n    }\n    text = getTextUpToAnchor(selection);\n  });\n  return text;\n}\nfunction isSelectionOnEntityBoundary(editor, offset) {\n  if (offset !== 0) {\n    return false;\n  }\n  return editor.getEditorState().read(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const anchor = selection.anchor;\n      const anchorNode = anchor.getNode();\n      const prevSibling = anchorNode.getPreviousSibling();\n      return $isTextNode(prevSibling) && prevSibling.isTextEntity();\n    }\n    return false;\n  });\n}\n\n// Got from https://stackoverflow.com/a/42543908/2013580\nfunction getScrollParent(element, includeHidden) {\n  let style = getComputedStyle(element);\n  const excludeStaticParent = style.position === 'absolute';\n  const overflowRegex = includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/;\n  if (style.position === 'fixed') {\n    return document.body;\n  }\n  for (let parent = element; parent = parent.parentElement;) {\n    style = getComputedStyle(parent);\n    if (excludeStaticParent && style.position === 'static') {\n      continue;\n    }\n    if (overflowRegex.test(style.overflow + style.overflowY + style.overflowX)) {\n      return parent;\n    }\n  }\n  return document.body;\n}\nconst SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND = createCommand('SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND');\nfunction useBasicTypeaheadTriggerMatch(trigger, {\n  minLength = 1,\n  maxLength = 75\n}) {\n  return useCallback(text => {\n    const validChars = '[^' + trigger + PUNCTUATION + '\\\\s]';\n    const TypeaheadTriggerRegex = new RegExp('(^|\\\\s|\\\\()(' + '[' + trigger + ']' + '((?:' + validChars + '){0,' + maxLength + '})' + ')$');\n    const match = TypeaheadTriggerRegex.exec(text);\n    if (match !== null) {\n      const maybeLeadingWhitespace = match[1];\n      const matchingString = match[3];\n      if (matchingString.length >= minLength) {\n        return {\n          leadOffset: match.index + maybeLeadingWhitespace.length,\n          matchingString,\n          replaceableString: match[2]\n        };\n      }\n    }\n    return null;\n  }, [maxLength, minLength, trigger]);\n}\nfunction LexicalTypeaheadMenuPlugin({\n  options,\n  onQueryChange,\n  onSelectOption,\n  onOpen,\n  onClose,\n  menuRenderFn,\n  triggerFn,\n  anchorClassName,\n  commandPriority = COMMAND_PRIORITY_LOW,\n  parent\n}) {\n  const [editor] = useLexicalComposerContext();\n  const [resolution, setResolution] = useState(null);\n  const anchorElementRef = useMenuAnchorRef(resolution, setResolution, anchorClassName, parent);\n  const closeTypeahead = useCallback(() => {\n    setResolution(null);\n    if (onClose != null && resolution !== null) {\n      onClose();\n    }\n  }, [onClose, resolution]);\n  const openTypeahead = useCallback(res => {\n    setResolution(res);\n    if (onOpen != null && resolution === null) {\n      onOpen(res);\n    }\n  }, [onOpen, resolution]);\n  useEffect(() => {\n    const updateListener = () => {\n      editor.getEditorState().read(() => {\n        // Check if editor is in read-only mode\n        if (!editor.isEditable()) {\n          closeTypeahead();\n          return;\n        }\n        const editorWindow = editor._window || window;\n        const range = editorWindow.document.createRange();\n        const selection = $getSelection();\n        const text = getQueryTextForSearch(editor);\n        if (!$isRangeSelection(selection) || !selection.isCollapsed() || text === null || range === null) {\n          closeTypeahead();\n          return;\n        }\n        const match = triggerFn(text, editor);\n        onQueryChange(match ? match.matchingString : null);\n        if (match !== null && !isSelectionOnEntityBoundary(editor, match.leadOffset)) {\n          const isRangePositioned = tryToPositionRange(match.leadOffset, range, editorWindow);\n          if (isRangePositioned !== null) {\n            startTransition(() => openTypeahead({\n              getRect: () => range.getBoundingClientRect(),\n              match\n            }));\n            return;\n          }\n        }\n        closeTypeahead();\n      });\n    };\n    const removeUpdateListener = editor.registerUpdateListener(updateListener);\n    return () => {\n      removeUpdateListener();\n    };\n  }, [editor, triggerFn, onQueryChange, resolution, closeTypeahead, openTypeahead]);\n  useEffect(() => editor.registerEditableListener(isEditable => {\n    if (!isEditable) {\n      closeTypeahead();\n    }\n  }), [editor, closeTypeahead]);\n  return resolution === null || editor === null || anchorElementRef.current === null ? null : /*#__PURE__*/jsx(LexicalMenu, {\n    close: closeTypeahead,\n    resolution: resolution,\n    editor: editor,\n    anchorElementRef: anchorElementRef,\n    options: options,\n    menuRenderFn: menuRenderFn,\n    shouldSplitNodeWithQuery: true,\n    onSelectOption: onSelectOption,\n    commandPriority: commandPriority\n  });\n}\n\nexport { LexicalTypeaheadMenuPlugin, MenuOption, PUNCTUATION, SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND, getScrollParent, useBasicTypeaheadTriggerMatch, useDynamicPositioning };\n"],"names":["START_TRANSITION","CAN_USE_DOM","window","document","createElement","useLayoutEffectImpl","useLayoutEffect","useEffect","MenuOption","constructor","key","this","ref","current","setRefElement","bind","element","scrollIntoViewIfNeeded","target","typeaheadContainerNode","getElementById","typeaheadRect","getBoundingClientRect","top","height","innerHeight","scrollIntoView","block","isTriggerVisibleInNearestScrollContainer","targetElement","containerElement","tRect","cRect","bottom","useDynamicPositioning","resolution","onReposition","onVisibilityChange","editor","useLexicalComposerContext","rootElement","getRootElement","rootScrollParent","style","getComputedStyle","excludeStaticParent","position","overflowRegex","body","parent","parentElement","test","overflow","overflowY","overflowX","getScrollParent$1","ticking","previousIsInView","handleScroll","requestAnimationFrame","isInView","resizeObserver","ResizeObserver","addEventListener","capture","passive","observe","unobserve","removeEventListener","SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND$1","createCommand","LexicalMenu","close","anchorElementRef","options","menuRenderFn","onSelectOption","shouldSplitNodeWithQuery","commandPriority","COMMAND_PRIORITY_LOW","selectedIndex","setHighlightedIndex","useState","matchingString","match","selectOptionAndCleanUp","useCallback","selectedEntry","update","textNodeContainingQuery","selection","$getSelection","$isRangeSelection","isCollapsed","anchor","type","anchorNode","getNode","isSimpleText","selectionOffset","offset","textContent","getTextContent","slice","characterOffset","replaceableString","length","startOffset","documentText","entryText","triggerOffset","i","substring","getFullMatchOffset","newNode","splitText","$splitNodeContainingQuery","updateSelectedIndex","index","rootElem","setAttribute","removeAttribute","mergeRegister","registerCommand","option","KEY_ARROW_DOWN_COMMAND","payload","event","newSelectedIndex","dispatchCommand","preventDefault","stopImmediatePropagation","KEY_ARROW_UP_COMMAND","KEY_ESCAPE_COMMAND","KEY_TAB_COMMAND","KEY_ENTER_COMMAND","useMemo","setContainerDivAttributes","containerDiv","className","display","PUNCTUATION","getScrollParent","includeHidden","SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND","useBasicTypeaheadTriggerMatch","trigger","minLength","maxLength","text","RegExp","exec","maybeLeadingWhitespace","leadOffset","LexicalTypeaheadMenuPlugin","onQueryChange","onOpen","onClose","triggerFn","anchorClassName","setResolution","undefined","shouldIncludePageYOffset__EXPERIMENTAL","useRef","positionMenu","menuEle","firstChild","left","width","getRect","anchorHeight","offsetHeight","pageYOffset","pageXOffset","menuRect","menuHeight","menuWidth","rootElementRect","right","isConnected","append","remove","useMenuAnchorRef","closeTypeahead","openTypeahead","res","removeUpdateListener","registerUpdateListener","getEditorState","read","isEditable","editorWindow","_window","range","createRange","anchorOffset","getTextUpToAnchor","getQueryTextForSearch","prevSibling","getPreviousSibling","$isTextNode","isTextEntity","isSelectionOnEntityBoundary","isRangePositioned","domSelection","getDOMSelection","endOffset","setStart","setEnd","error","tryToPositionRange","callback","React","registerEditableListener","jsx","exports"],"mappings":"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"}