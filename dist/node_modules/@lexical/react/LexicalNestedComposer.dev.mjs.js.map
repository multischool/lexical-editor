{"version":3,"file":"LexicalNestedComposer.dev.mjs.js","sources":["../../../../node_modules/@lexical/react/LexicalNestedComposer.dev.mjs"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { LexicalComposerContext, createLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useRef, useContext, useMemo, useEffect } from 'react';\nimport { jsx } from 'react/jsx-runtime';\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// Do not require this module directly! Use normal `invariant` calls.\n\nfunction formatDevErrorMessage(message) {\n  throw new Error(message);\n}\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n/*@__INLINE__*/\nfunction warnOnlyOnce(message) {\n  {\n    let run = false;\n    return () => {\n      if (!run) {\n        console.warn(message);\n      }\n      run = true;\n    };\n  }\n}\n\nfunction getTransformSetFromKlass(klass) {\n  const transform = klass.transform();\n  return new Set(transform ? [transform] : []);\n}\nconst initialNodesWarning = warnOnlyOnce(`LexicalNestedComposer initialNodes is deprecated and will be removed in v0.32.0, it has never worked correctly.\\nYou can configure your editor's nodes with createEditor({nodes: [], parentEditor: $getEditor()})`);\nconst explicitNamespaceWarning = warnOnlyOnce(`LexicalNestedComposer initialEditor should explicitly initialize its namespace when the node configuration differs from the parentEditor. For backwards compatibility, the namespace will be initialized from parentEditor until v0.32.0, but this has always had incorrect copy/paste behavior when the configuration differed.\\nYou can configure your editor's namespace with createEditor({namespace: 'nested-editor-namespace', nodes: [], parentEditor: $getEditor()}).`);\nfunction LexicalNestedComposer({\n  initialEditor,\n  children,\n  initialNodes,\n  initialTheme,\n  skipCollabChecks,\n  skipEditableListener\n}) {\n  const wasCollabPreviouslyReadyRef = useRef(false);\n  const parentContext = useContext(LexicalComposerContext);\n  if (parentContext == null) {\n    {\n      formatDevErrorMessage(`Unexpected parent context null on a nested composer`);\n    }\n  }\n  const [parentEditor, {\n    getTheme: getParentTheme\n  }] = parentContext;\n  const composerContext = useMemo(() => {\n    const composerTheme = initialTheme || getParentTheme() || undefined;\n    const context = createLexicalComposerContext(parentContext, composerTheme);\n    if (composerTheme !== undefined) {\n      initialEditor._config.theme = composerTheme;\n    }\n    initialEditor._parentEditor = initialEditor._parentEditor || parentEditor;\n    const createEditorArgs = initialEditor._createEditorArgs;\n    const explicitNamespace = createEditorArgs && createEditorArgs.namespace;\n    if (!initialNodes) {\n      if (!(createEditorArgs && createEditorArgs.nodes)) {\n        const parentNodes = initialEditor._nodes = new Map(parentEditor._nodes);\n        if (!explicitNamespace) {\n          // This is the only safe situation to inherit the parent's namespace\n          initialEditor._config.namespace = parentEditor._config.namespace;\n        }\n        for (const [type, entry] of parentNodes) {\n          initialEditor._nodes.set(type, {\n            exportDOM: entry.exportDOM,\n            klass: entry.klass,\n            replace: entry.replace,\n            replaceWithKlass: entry.replaceWithKlass,\n            transforms: getTransformSetFromKlass(entry.klass)\n          });\n        }\n      } else if (!explicitNamespace) {\n        explicitNamespaceWarning();\n        initialEditor._config.namespace = parentEditor._config.namespace;\n      }\n    } else {\n      initialNodesWarning();\n      if (!explicitNamespace) {\n        explicitNamespaceWarning();\n        initialEditor._config.namespace = parentEditor._config.namespace;\n      }\n      for (let klass of initialNodes) {\n        let replace = null;\n        let replaceWithKlass = null;\n        if (typeof klass !== 'function') {\n          const options = klass;\n          klass = options.replace;\n          replace = options.with;\n          replaceWithKlass = options.withKlass || null;\n        }\n        const registeredKlass = initialEditor._nodes.get(klass.getType());\n        initialEditor._nodes.set(klass.getType(), {\n          exportDOM: registeredKlass ? registeredKlass.exportDOM : undefined,\n          klass,\n          replace,\n          replaceWithKlass,\n          transforms: getTransformSetFromKlass(klass)\n        });\n      }\n    }\n    return [initialEditor, context];\n  },\n  // We only do this for init\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n\n  // If collaboration is enabled, make sure we don't render the children until the collaboration subdocument is ready.\n  const {\n    isCollabActive,\n    yjsDocMap\n  } = useCollaborationContext();\n  const isCollabReady = skipCollabChecks || wasCollabPreviouslyReadyRef.current || yjsDocMap.has(initialEditor.getKey());\n  useEffect(() => {\n    if (isCollabReady) {\n      wasCollabPreviouslyReadyRef.current = true;\n    }\n  }, [isCollabReady]);\n\n  // Update `isEditable` state of nested editor in response to the same change on parent editor.\n  useEffect(() => {\n    if (!skipEditableListener) {\n      const editableListener = editable => initialEditor.setEditable(editable);\n      editableListener(parentEditor.isEditable());\n      return parentEditor.registerEditableListener(editableListener);\n    }\n  }, [initialEditor, parentEditor, skipEditableListener]);\n  return /*#__PURE__*/jsx(LexicalComposerContext.Provider, {\n    value: composerContext,\n    children: !isCollabActive || isCollabReady ? children : null\n  });\n}\n\nexport { LexicalNestedComposer };\n"],"names":["warnOnlyOnce","message","run","console","warn","getTransformSetFromKlass","klass","transform","Set","initialNodesWarning","explicitNamespaceWarning","LexicalNestedComposer","initialEditor","children","initialNodes","initialTheme","skipCollabChecks","skipEditableListener","wasCollabPreviouslyReadyRef","useRef","parentContext","useContext","LexicalComposerContext","Error","formatDevErrorMessage","parentEditor","getTheme","getParentTheme","composerContext","useMemo","composerTheme","undefined","context","createLexicalComposerContext","_config","theme","_parentEditor","createEditorArgs","_createEditorArgs","explicitNamespace","namespace","replace","replaceWithKlass","options","with","withKlass","registeredKlass","_nodes","get","getType","set","exportDOM","transforms","nodes","parentNodes","Map","type","entry","isCollabActive","yjsDocMap","useCollaborationContext","isCollabReady","current","has","getKey","useEffect","editableListener","editable","setEditable","isEditable","registerEditableListener","jsx","exports","Provider","value"],"mappings":"6VAoCA,SAASA,EAAaC,GACpB,CACE,IAAIC,GAAM,EACV,MAAO,KACAA,GACHC,QAAQC,KAAKH,GAEfC,GAAM,CAAI,CAEb,CACH,CAEA,SAASG,EAAyBC,GAChC,MAAMC,EAAYD,EAAMC,YACxB,OAAO,IAAIC,IAAID,EAAY,CAACA,GAAa,GAC3C,CACA,MAAME,EAAsBT,EAAa,qNACnCU,EAA2BV,EAAa,idAC9C,SAASW,GAAsBC,cAC7BA,EAAaC,SACbA,EAAQC,aACRA,EAAYC,aACZA,EAAYC,iBACZA,EAAgBC,qBAChBA,IAEA,MAAMC,EAA8BC,GAAO,GACrCC,EAAgBC,EAAWC,GACZ,MAAjBF,GAzCN,SAA+BnB,GAC7B,MAAM,IAAIsB,MAAMtB,EAClB,CAyCMuB,CAAsB,uDAG1B,MAAOC,GACLC,SAAUC,IACPP,EACCQ,EAAkBC,GAAQ,KAC9B,MAAMC,EAAgBf,GAAgBY,UAAoBI,EACpDC,EAAUC,EAA6Bb,EAAeU,QACtCC,IAAlBD,IACFlB,EAAcsB,QAAQC,MAAQL,GAEhClB,EAAcwB,cAAgBxB,EAAcwB,eAAiBX,EAC7D,MAAMY,EAAmBzB,EAAc0B,kBACjCC,EAAoBF,GAAoBA,EAAiBG,UAC/D,GAAK1B,EAoBE,CACLL,IACK8B,IACH7B,IACAE,EAAcsB,QAAQM,UAAYf,EAAaS,QAAQM,WAEzD,IAAK,IAAIlC,KAASQ,EAAc,CAC9B,IAAI2B,EAAU,KACVC,EAAmB,KACvB,GAAqB,mBAAVpC,EAAsB,CAC/B,MAAMqC,EAAUrC,EAChBA,EAAQqC,EAAQF,QAChBA,EAAUE,EAAQC,KAClBF,EAAmBC,EAAQE,WAAa,IACzC,CACD,MAAMC,EAAkBlC,EAAcmC,OAAOC,IAAI1C,EAAM2C,WACvDrC,EAAcmC,OAAOG,IAAI5C,EAAM2C,UAAW,CACxCE,UAAWL,EAAkBA,EAAgBK,eAAYpB,EACzDzB,QACAmC,UACAC,mBACAU,WAAY/C,EAAyBC,IAExC,CACF,MA3CC,GAAM+B,GAAoBA,EAAiBgB,MAe/Bd,IACV7B,IACAE,EAAcsB,QAAQM,UAAYf,EAAaS,QAAQM,eAjBN,CACjD,MAAMc,EAAc1C,EAAcmC,OAAS,IAAIQ,IAAI9B,EAAasB,QAC3DR,IAEH3B,EAAcsB,QAAQM,UAAYf,EAAaS,QAAQM,WAEzD,IAAK,MAAOgB,EAAMC,KAAUH,EAC1B1C,EAAcmC,OAAOG,IAAIM,EAAM,CAC7BL,UAAWM,EAAMN,UACjB7C,MAAOmD,EAAMnD,MACbmC,QAASgB,EAAMhB,QACfC,iBAAkBe,EAAMf,iBACxBU,WAAY/C,EAAyBoD,EAAMnD,QAGvD,CA6BI,MAAO,CAACM,EAAeoB,EAAQ,GAIjC,KAGM0B,eACJA,EAAcC,UACdA,GACEC,IACEC,EAAgB7C,GAAoBE,EAA4B4C,SAAWH,EAAUI,IAAInD,EAAcoD,UAe7G,OAdAC,GAAU,KACJJ,IACF3C,EAA4B4C,SAAU,EACvC,GACA,CAACD,IAGJI,GAAU,KACR,IAAKhD,EAAsB,CACzB,MAAMiD,EAAmBC,GAAYvD,EAAcwD,YAAYD,GAE/D,OADAD,EAAiBzC,EAAa4C,cACvB5C,EAAa6C,yBAAyBJ,EAC9C,IACA,CAACtD,EAAea,EAAcR,IACbsD,EAAGC,QAAAD,IAACjD,EAAuBmD,SAAU,CACvDC,MAAO9C,EACPf,UAAW6C,GAAkBG,EAAgBhD,EAAW,MAE5D"}