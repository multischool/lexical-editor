{"version":3,"file":"LexicalNodeMenuPlugin.dev.mjs.js","sources":["../../../../node_modules/@lexical/react/LexicalNodeMenuPlugin.dev.mjs"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { createCommand, KEY_ARROW_DOWN_COMMAND, KEY_ARROW_UP_COMMAND, KEY_ESCAPE_COMMAND, KEY_TAB_COMMAND, KEY_ENTER_COMMAND, COMMAND_PRIORITY_LOW, $getSelection, $isRangeSelection, $getNodeByKey } from 'lexical';\nimport React, { useLayoutEffect, useEffect, useState, useCallback, useMemo, useRef } from 'react';\nimport { mergeRegister } from '@lexical/utils';\nimport { jsx } from 'react/jsx-runtime';\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n\n// Webpack + React 17 fails to compile on the usage of `React.startTransition` or\n// `React[\"startTransition\"]` even if it's behind a feature detection of\n// `\"startTransition\" in React`. Moving this to a constant avoids the issue :/\nconst START_TRANSITION = 'startTransition';\nfunction startTransition(callback) {\n  if (START_TRANSITION in React) {\n    React[START_TRANSITION](callback);\n  } else {\n    callback();\n  }\n}\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nconst CAN_USE_DOM = typeof window !== 'undefined' && typeof window.document !== 'undefined' && typeof window.document.createElement !== 'undefined';\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n\n// This workaround is no longer necessary in React 19,\n// but we currently support React >=17.x\n// https://github.com/facebook/react/pull/26395\nconst useLayoutEffectImpl = CAN_USE_DOM ? useLayoutEffect : useEffect;\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nclass MenuOption {\n  constructor(key) {\n    this.key = key;\n    this.ref = {\n      current: null\n    };\n    this.setRefElement = this.setRefElement.bind(this);\n  }\n  setRefElement(element) {\n    this.ref = {\n      current: element\n    };\n  }\n}\nconst scrollIntoViewIfNeeded = target => {\n  const typeaheadContainerNode = document.getElementById('typeahead-menu');\n  if (!typeaheadContainerNode) {\n    return;\n  }\n  const typeaheadRect = typeaheadContainerNode.getBoundingClientRect();\n  if (typeaheadRect.top + typeaheadRect.height > window.innerHeight) {\n    typeaheadContainerNode.scrollIntoView({\n      block: 'center'\n    });\n  }\n  if (typeaheadRect.top < 0) {\n    typeaheadContainerNode.scrollIntoView({\n      block: 'center'\n    });\n  }\n  target.scrollIntoView({\n    block: 'nearest'\n  });\n};\n\n/**\n * Walk backwards along user input and forward through entity title to try\n * and replace more of the user's text with entity.\n */\nfunction getFullMatchOffset(documentText, entryText, offset) {\n  let triggerOffset = offset;\n  for (let i = triggerOffset; i <= entryText.length; i++) {\n    if (documentText.slice(-i) === entryText.substring(0, i)) {\n      triggerOffset = i;\n    }\n  }\n  return triggerOffset;\n}\n\n/**\n * Split Lexical TextNode and return a new TextNode only containing matched text.\n * Common use cases include: removing the node, replacing with a new node.\n */\nfunction $splitNodeContainingQuery(match) {\n  const selection = $getSelection();\n  if (!$isRangeSelection(selection) || !selection.isCollapsed()) {\n    return null;\n  }\n  const anchor = selection.anchor;\n  if (anchor.type !== 'text') {\n    return null;\n  }\n  const anchorNode = anchor.getNode();\n  if (!anchorNode.isSimpleText()) {\n    return null;\n  }\n  const selectionOffset = anchor.offset;\n  const textContent = anchorNode.getTextContent().slice(0, selectionOffset);\n  const characterOffset = match.replaceableString.length;\n  const queryOffset = getFullMatchOffset(textContent, match.matchingString, characterOffset);\n  const startOffset = selectionOffset - queryOffset;\n  if (startOffset < 0) {\n    return null;\n  }\n  let newNode;\n  if (startOffset === 0) {\n    [newNode] = anchorNode.splitText(selectionOffset);\n  } else {\n    [, newNode] = anchorNode.splitText(startOffset, selectionOffset);\n  }\n  return newNode;\n}\n\n// Got from https://stackoverflow.com/a/42543908/2013580\nfunction getScrollParent(element, includeHidden) {\n  let style = getComputedStyle(element);\n  const excludeStaticParent = style.position === 'absolute';\n  const overflowRegex = /(auto|scroll)/;\n  if (style.position === 'fixed') {\n    return document.body;\n  }\n  for (let parent = element; parent = parent.parentElement;) {\n    style = getComputedStyle(parent);\n    if (excludeStaticParent && style.position === 'static') {\n      continue;\n    }\n    if (overflowRegex.test(style.overflow + style.overflowY + style.overflowX)) {\n      return parent;\n    }\n  }\n  return document.body;\n}\nfunction isTriggerVisibleInNearestScrollContainer(targetElement, containerElement) {\n  const tRect = targetElement.getBoundingClientRect();\n  const cRect = containerElement.getBoundingClientRect();\n  return tRect.top > cRect.top && tRect.top < cRect.bottom;\n}\n\n// Reposition the menu on scroll, window resize, and element resize.\nfunction useDynamicPositioning(resolution, targetElement, onReposition, onVisibilityChange) {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    if (targetElement != null && resolution != null) {\n      const rootElement = editor.getRootElement();\n      const rootScrollParent = rootElement != null ? getScrollParent(rootElement) : document.body;\n      let ticking = false;\n      let previousIsInView = isTriggerVisibleInNearestScrollContainer(targetElement, rootScrollParent);\n      const handleScroll = function () {\n        if (!ticking) {\n          window.requestAnimationFrame(function () {\n            onReposition();\n            ticking = false;\n          });\n          ticking = true;\n        }\n        const isInView = isTriggerVisibleInNearestScrollContainer(targetElement, rootScrollParent);\n        if (isInView !== previousIsInView) {\n          previousIsInView = isInView;\n          if (onVisibilityChange != null) {\n            onVisibilityChange(isInView);\n          }\n        }\n      };\n      const resizeObserver = new ResizeObserver(onReposition);\n      window.addEventListener('resize', onReposition);\n      document.addEventListener('scroll', handleScroll, {\n        capture: true,\n        passive: true\n      });\n      resizeObserver.observe(targetElement);\n      return () => {\n        resizeObserver.unobserve(targetElement);\n        window.removeEventListener('resize', onReposition);\n        document.removeEventListener('scroll', handleScroll, true);\n      };\n    }\n  }, [targetElement, editor, onVisibilityChange, onReposition, resolution]);\n}\nconst SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND = createCommand('SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND');\nfunction LexicalMenu({\n  close,\n  editor,\n  anchorElementRef,\n  resolution,\n  options,\n  menuRenderFn,\n  onSelectOption,\n  shouldSplitNodeWithQuery = false,\n  commandPriority = COMMAND_PRIORITY_LOW\n}) {\n  const [selectedIndex, setHighlightedIndex] = useState(null);\n  const matchingString = resolution.match && resolution.match.matchingString;\n  useEffect(() => {\n    setHighlightedIndex(0);\n  }, [matchingString]);\n  const selectOptionAndCleanUp = useCallback(selectedEntry => {\n    editor.update(() => {\n      const textNodeContainingQuery = resolution.match != null && shouldSplitNodeWithQuery ? $splitNodeContainingQuery(resolution.match) : null;\n      onSelectOption(selectedEntry, textNodeContainingQuery, close, resolution.match ? resolution.match.matchingString : '');\n    });\n  }, [editor, shouldSplitNodeWithQuery, resolution.match, onSelectOption, close]);\n  const updateSelectedIndex = useCallback(index => {\n    const rootElem = editor.getRootElement();\n    if (rootElem !== null) {\n      rootElem.setAttribute('aria-activedescendant', 'typeahead-item-' + index);\n      setHighlightedIndex(index);\n    }\n  }, [editor]);\n  useEffect(() => {\n    return () => {\n      const rootElem = editor.getRootElement();\n      if (rootElem !== null) {\n        rootElem.removeAttribute('aria-activedescendant');\n      }\n    };\n  }, [editor]);\n  useLayoutEffectImpl(() => {\n    if (options === null) {\n      setHighlightedIndex(null);\n    } else if (selectedIndex === null) {\n      updateSelectedIndex(0);\n    }\n  }, [options, selectedIndex, updateSelectedIndex]);\n  useEffect(() => {\n    return mergeRegister(editor.registerCommand(SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND, ({\n      option\n    }) => {\n      if (option.ref && option.ref.current != null) {\n        scrollIntoViewIfNeeded(option.ref.current);\n        return true;\n      }\n      return false;\n    }, commandPriority));\n  }, [editor, updateSelectedIndex, commandPriority]);\n  useEffect(() => {\n    return mergeRegister(editor.registerCommand(KEY_ARROW_DOWN_COMMAND, payload => {\n      const event = payload;\n      if (options !== null && options.length && selectedIndex !== null) {\n        const newSelectedIndex = selectedIndex !== options.length - 1 ? selectedIndex + 1 : 0;\n        updateSelectedIndex(newSelectedIndex);\n        const option = options[newSelectedIndex];\n        if (option.ref != null && option.ref.current) {\n          editor.dispatchCommand(SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND, {\n            index: newSelectedIndex,\n            option\n          });\n        }\n        event.preventDefault();\n        event.stopImmediatePropagation();\n      }\n      return true;\n    }, commandPriority), editor.registerCommand(KEY_ARROW_UP_COMMAND, payload => {\n      const event = payload;\n      if (options !== null && options.length && selectedIndex !== null) {\n        const newSelectedIndex = selectedIndex !== 0 ? selectedIndex - 1 : options.length - 1;\n        updateSelectedIndex(newSelectedIndex);\n        const option = options[newSelectedIndex];\n        if (option.ref != null && option.ref.current) {\n          scrollIntoViewIfNeeded(option.ref.current);\n        }\n        event.preventDefault();\n        event.stopImmediatePropagation();\n      }\n      return true;\n    }, commandPriority), editor.registerCommand(KEY_ESCAPE_COMMAND, payload => {\n      const event = payload;\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      close();\n      return true;\n    }, commandPriority), editor.registerCommand(KEY_TAB_COMMAND, payload => {\n      const event = payload;\n      if (options === null || selectedIndex === null || options[selectedIndex] == null) {\n        return false;\n      }\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      selectOptionAndCleanUp(options[selectedIndex]);\n      return true;\n    }, commandPriority), editor.registerCommand(KEY_ENTER_COMMAND, event => {\n      if (options === null || selectedIndex === null || options[selectedIndex] == null) {\n        return false;\n      }\n      if (event !== null) {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n      }\n      selectOptionAndCleanUp(options[selectedIndex]);\n      return true;\n    }, commandPriority));\n  }, [selectOptionAndCleanUp, close, editor, options, selectedIndex, updateSelectedIndex, commandPriority]);\n  const listItemProps = useMemo(() => ({\n    options,\n    selectOptionAndCleanUp,\n    selectedIndex,\n    setHighlightedIndex\n  }), [selectOptionAndCleanUp, selectedIndex, options]);\n  return menuRenderFn(anchorElementRef, listItemProps, resolution.match ? resolution.match.matchingString : '');\n}\nfunction setContainerDivAttributes(containerDiv, className) {\n  if (className != null) {\n    containerDiv.className = className;\n  }\n  containerDiv.setAttribute('aria-label', 'Typeahead menu');\n  containerDiv.setAttribute('role', 'listbox');\n  containerDiv.style.display = 'block';\n  containerDiv.style.position = 'absolute';\n}\nfunction useMenuAnchorRef(resolution, setResolution, className, parent = CAN_USE_DOM ? document.body : undefined, shouldIncludePageYOffset__EXPERIMENTAL = true) {\n  const [editor] = useLexicalComposerContext();\n  const anchorElementRef = useRef(CAN_USE_DOM ? document.createElement('div') : null);\n  const positionMenu = useCallback(() => {\n    if (anchorElementRef.current === null || parent === undefined) {\n      return;\n    }\n    anchorElementRef.current.style.top = anchorElementRef.current.style.bottom;\n    const rootElement = editor.getRootElement();\n    const containerDiv = anchorElementRef.current;\n    const menuEle = containerDiv.firstChild;\n    if (rootElement !== null && resolution !== null) {\n      const {\n        left,\n        top,\n        width,\n        height\n      } = resolution.getRect();\n      const anchorHeight = anchorElementRef.current.offsetHeight; // use to position under anchor\n      containerDiv.style.top = `${top + anchorHeight + 3 + (shouldIncludePageYOffset__EXPERIMENTAL ? window.pageYOffset : 0)}px`;\n      containerDiv.style.left = `${left + window.pageXOffset}px`;\n      containerDiv.style.height = `${height}px`;\n      containerDiv.style.width = `${width}px`;\n      if (menuEle !== null) {\n        menuEle.style.top = `${top}`;\n        const menuRect = menuEle.getBoundingClientRect();\n        const menuHeight = menuRect.height;\n        const menuWidth = menuRect.width;\n        const rootElementRect = rootElement.getBoundingClientRect();\n        if (left + menuWidth > rootElementRect.right) {\n          containerDiv.style.left = `${rootElementRect.right - menuWidth + window.pageXOffset}px`;\n        }\n        if ((top + menuHeight > window.innerHeight || top + menuHeight > rootElementRect.bottom) && top - rootElementRect.top > menuHeight + height) {\n          containerDiv.style.top = `${top - menuHeight - height + (shouldIncludePageYOffset__EXPERIMENTAL ? window.pageYOffset : 0)}px`;\n        }\n      }\n      if (!containerDiv.isConnected) {\n        setContainerDivAttributes(containerDiv, className);\n        parent.append(containerDiv);\n      }\n      containerDiv.setAttribute('id', 'typeahead-menu');\n      anchorElementRef.current = containerDiv;\n      rootElement.setAttribute('aria-controls', 'typeahead-menu');\n    }\n  }, [editor, resolution, shouldIncludePageYOffset__EXPERIMENTAL, className, parent]);\n  useEffect(() => {\n    const rootElement = editor.getRootElement();\n    if (resolution !== null) {\n      positionMenu();\n    }\n    return () => {\n      if (rootElement !== null) {\n        rootElement.removeAttribute('aria-controls');\n      }\n      const containerDiv = anchorElementRef.current;\n      if (containerDiv !== null && containerDiv.isConnected) {\n        containerDiv.remove();\n        containerDiv.removeAttribute('id');\n      }\n    };\n  }, [editor, positionMenu, resolution]);\n  const onVisibilityChange = useCallback(isInView => {\n    if (resolution !== null) {\n      if (!isInView) {\n        setResolution(null);\n      }\n    }\n  }, [resolution, setResolution]);\n  useDynamicPositioning(resolution, anchorElementRef.current, positionMenu, onVisibilityChange);\n\n  // Append the context for the menu immediately\n  const containerDiv = anchorElementRef.current;\n  if (containerDiv != null) {\n    setContainerDivAttributes(containerDiv, className);\n    if (parent != null) {\n      parent.append(containerDiv);\n    }\n  }\n  return anchorElementRef;\n}\n\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nfunction LexicalNodeMenuPlugin({\n  options,\n  nodeKey,\n  onClose,\n  onOpen,\n  onSelectOption,\n  menuRenderFn,\n  anchorClassName,\n  commandPriority = COMMAND_PRIORITY_LOW,\n  parent\n}) {\n  const [editor] = useLexicalComposerContext();\n  const [resolution, setResolution] = useState(null);\n  const anchorElementRef = useMenuAnchorRef(resolution, setResolution, anchorClassName, parent);\n  const closeNodeMenu = useCallback(() => {\n    setResolution(null);\n    if (onClose != null && resolution !== null) {\n      onClose();\n    }\n  }, [onClose, resolution]);\n  const openNodeMenu = useCallback(res => {\n    setResolution(res);\n    if (onOpen != null && resolution === null) {\n      onOpen(res);\n    }\n  }, [onOpen, resolution]);\n  const positionOrCloseMenu = useCallback(() => {\n    if (nodeKey) {\n      editor.update(() => {\n        const node = $getNodeByKey(nodeKey);\n        const domElement = editor.getElementByKey(nodeKey);\n        if (node != null && domElement != null) {\n          if (resolution == null) {\n            startTransition(() => openNodeMenu({\n              getRect: () => domElement.getBoundingClientRect()\n            }));\n          }\n        }\n      });\n    } else if (nodeKey == null && resolution != null) {\n      closeNodeMenu();\n    }\n  }, [closeNodeMenu, editor, nodeKey, openNodeMenu, resolution]);\n  useEffect(() => {\n    positionOrCloseMenu();\n  }, [positionOrCloseMenu, nodeKey]);\n  useEffect(() => {\n    if (nodeKey != null) {\n      return editor.registerUpdateListener(({\n        dirtyElements\n      }) => {\n        if (dirtyElements.get(nodeKey)) {\n          positionOrCloseMenu();\n        }\n      });\n    }\n  }, [editor, positionOrCloseMenu, nodeKey]);\n  return anchorElementRef.current === null || resolution === null || editor === null ? null : /*#__PURE__*/jsx(LexicalMenu, {\n    close: closeNodeMenu,\n    resolution: resolution,\n    editor: editor,\n    anchorElementRef: anchorElementRef,\n    options: options,\n    menuRenderFn: menuRenderFn,\n    onSelectOption: onSelectOption,\n    commandPriority: commandPriority\n  });\n}\n\nexport { LexicalNodeMenuPlugin, MenuOption };\n"],"names":["START_TRANSITION","CAN_USE_DOM","window","document","createElement","useLayoutEffectImpl","useLayoutEffect","useEffect","MenuOption","constructor","key","this","ref","current","setRefElement","bind","element","scrollIntoViewIfNeeded","target","typeaheadContainerNode","getElementById","typeaheadRect","getBoundingClientRect","top","height","innerHeight","scrollIntoView","block","isTriggerVisibleInNearestScrollContainer","targetElement","containerElement","tRect","cRect","bottom","useDynamicPositioning","resolution","onReposition","onVisibilityChange","editor","useLexicalComposerContext","rootElement","getRootElement","rootScrollParent","style","getComputedStyle","excludeStaticParent","position","overflowRegex","body","parent","parentElement","test","overflow","overflowY","overflowX","getScrollParent","ticking","previousIsInView","handleScroll","requestAnimationFrame","isInView","resizeObserver","ResizeObserver","addEventListener","capture","passive","observe","unobserve","removeEventListener","SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND","createCommand","LexicalMenu","close","anchorElementRef","options","menuRenderFn","onSelectOption","shouldSplitNodeWithQuery","commandPriority","COMMAND_PRIORITY_LOW","selectedIndex","setHighlightedIndex","useState","matchingString","match","selectOptionAndCleanUp","useCallback","selectedEntry","update","textNodeContainingQuery","selection","$getSelection","$isRangeSelection","isCollapsed","anchor","type","anchorNode","getNode","isSimpleText","selectionOffset","offset","textContent","getTextContent","slice","characterOffset","replaceableString","length","startOffset","documentText","entryText","triggerOffset","i","substring","getFullMatchOffset","newNode","splitText","$splitNodeContainingQuery","updateSelectedIndex","index","rootElem","setAttribute","removeAttribute","mergeRegister","registerCommand","option","KEY_ARROW_DOWN_COMMAND","payload","event","newSelectedIndex","dispatchCommand","preventDefault","stopImmediatePropagation","KEY_ARROW_UP_COMMAND","KEY_ESCAPE_COMMAND","KEY_TAB_COMMAND","KEY_ENTER_COMMAND","useMemo","setContainerDivAttributes","containerDiv","className","display","LexicalNodeMenuPlugin","nodeKey","onClose","onOpen","anchorClassName","setResolution","undefined","shouldIncludePageYOffset__EXPERIMENTAL","useRef","positionMenu","menuEle","firstChild","left","width","getRect","anchorHeight","offsetHeight","pageYOffset","pageXOffset","menuRect","menuHeight","menuWidth","rootElementRect","right","isConnected","append","remove","useMenuAnchorRef","closeNodeMenu","openNodeMenu","res","positionOrCloseMenu","node","$getNodeByKey","domElement","getElementByKey","callback","React","registerUpdateListener","dirtyElements","get","jsx","exports"],"mappings":"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"}