{"version":3,"file":"LexicalCharacterLimitPlugin.prod.mjs.js","sources":["../../../../node_modules/@lexical/react/LexicalCharacterLimitPlugin.prod.mjs"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport{useLexicalComposerContext as e}from\"@lexical/react/LexicalComposerContext\";import{useEffect as t,useState as n,useMemo as r}from\"react\";import{OverflowNode as o,$isOverflowNode as i,$createOverflowNode as s}from\"@lexical/overflow\";import{$rootTextContent as l}from\"@lexical/text\";import{mergeRegister as c,$dfs as a,$unwrapNode as f}from\"@lexical/utils\";import{DELETE_CHARACTER_COMMAND as g,$getSelection as m,$isRangeSelection as u,$isElementNode as d,COMMAND_PRIORITY_LOW as h,$isTextNode as p,$isLeafNode as x,$setSelection as C}from\"lexical\";import{jsx as S}from\"react/jsx-runtime\";function v(e,n,r=Object.freeze({})){const{strlen:s=(e=>e.length),remainingCharacters:S=(()=>{})}=r;t((()=>{e.hasNodes([o])||function(e,...t){const n=new URL(\"https://lexical.dev/docs/error\"),r=new URLSearchParams;r.append(\"code\",e);for(const e of t)r.append(\"v\",e);throw n.search=r.toString(),Error(`Minified Lexical error #${e}; visit ${n.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(57)}),[e]),t((()=>{let t=e.getEditorState().read(l),r=0;return c(e.registerTextContentListener((e=>{t=e})),e.registerUpdateListener((({dirtyLeaves:o,dirtyElements:l})=>{const c=e.isComposing(),g=o.size>0||l.size>0;if(c||!g)return;const d=s(t),h=d>n||null!==r&&r>n;if(S(n-d),null===r||h){const r=function(e,t,n){const r=Intl.Segmenter;let o=0,i=0;if(\"function\"==typeof r){const s=(new r).segment(e);for(const{segment:e}of s){const r=i+n(e);if(r>t)break;i=r,o+=e.length}}else{const r=Array.from(e),s=r.length;for(let e=0;e<s;e++){const s=r[e],l=i+n(s);if(l>t)break;i=l,o+=s.length}}return o}(t,n,s);e.update((()=>{!function(e){const t=a(),n=t.length;let r=0;for(let o=0;o<n;o+=1){const{node:n}=t[o];if(i(n)){const t=r;if(r+n.getTextContentSize()<=e){const e=n.getParent(),t=n.getPreviousSibling(),r=n.getNextSibling();f(n);const o=m();!u(o)||o.anchor.getNode().isAttached()&&o.focus.getNode().isAttached()||(p(t)?t.select():p(r)?r.select():null!==e&&e.select())}else if(t<e){const r=n.getFirstDescendant(),o=t+(null!==r?r.getTextContentSize():0);(p(r)&&r.isSimpleText()||o<=e)&&f(n)}}else if(x(n)){const t=r;if(r+=n.getTextContentSize(),r>e&&!i(n.getParent())){const r=m();let o;if(t<e&&p(n)&&n.isSimpleText()){const[,r]=n.splitText(e-t);o=w(r)}else o=w(n);null!==r&&C(r),T(o)}}}}(r)}),{tag:\"history-merge\"})}r=d})),e.registerCommand(g,(e=>{const t=m();if(!u(t))return!1;const n=t.anchor.getNode().getParent(),r=n?n.getParent():null,o=r?r.getNextSibling():null;return t.deleteCharacter(e),r&&r.isEmpty()?r.remove():d(o)&&o.isEmpty()&&o.remove(),!0}),h))}),[e,n,S,s])}function w(e){const t=s();return e.replace(t),t.append(e),t}function T(e){const t=e.getPreviousSibling();if(!i(t))return;const n=e.getFirstChild(),r=t.getChildren(),o=r.length;if(null===n)e.append(...r);else for(let e=0;e<o;e++)n.insertBefore(r[e]);const s=m();if(u(s)){const n=s.anchor,r=n.getNode(),i=s.focus,l=n.getNode();r.is(t)?n.set(e.getKey(),n.offset,\"element\"):r.is(e)&&n.set(e.getKey(),o+n.offset,\"element\"),l.is(t)?i.set(e.getKey(),i.offset,\"element\"):l.is(e)&&i.set(e.getKey(),o+i.offset,\"element\")}t.remove()}let y=null;function N(e){const t=void 0===window.TextEncoder?null:(null===y&&(y=new window.TextEncoder),y);if(null===t){const t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)}return t.encode(e).length}function b({remainingCharacters:e}){return S(\"span\",{className:\"characters-limit \"+(e<0?\"characters-limit-exceeded\":\"\"),children:e})}function E({charset:t=\"UTF-16\",maxLength:o=5,renderer:i=b}){const[s]=e(),[l,c]=n(o);return v(s,o,r((()=>({remainingCharacters:c,strlen:e=>{if(\"UTF-8\"===t)return N(e);if(\"UTF-16\"===t)return e.length;throw new Error(\"Unrecognized charset\")}})),[t])),i({remainingCharacters:l})}export{E as CharacterLimitPlugin};\n"],"names":["w","e","t","s","replace","append","T","getPreviousSibling","i","n","getFirstChild","r","getChildren","o","length","insertBefore","m","u","anchor","getNode","focus","l","is","set","getKey","offset","remove","y","b","remainingCharacters","S","className","children","E","charset","maxLength","renderer","c","Object","freeze","strlen","hasNodes","URL","URLSearchParams","search","toString","Error","getEditorState","read","registerTextContentListener","registerUpdateListener","dirtyLeaves","dirtyElements","isComposing","g","size","d","h","Intl","Segmenter","segment","Array","from","update","a","node","getTextContentSize","getParent","getNextSibling","f","isAttached","p","select","getFirstDescendant","isSimpleText","x","splitText","C","tag","registerCommand","deleteCharacter","isEmpty","v","window","TextEncoder","encodeURIComponent","match","encode","N"],"mappings":"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"}