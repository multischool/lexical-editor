import*as e from"react";import{useState as r,useRef as t,useCallback as n,useEffect as o}from"react";import{useLexicalComposerContext as i}from"../../../../node_modules/@lexical/react/LexicalComposerContext.mjs.js";import{useLexicalEditable as a}from"../../../../node_modules/@lexical/react/useLexicalEditable.mjs.js";import{mergeRegister as u}from"@lexical/utils";import{$getNodeByKey as m,SELECTION_CHANGE_COMMAND as l,COMMAND_PRIORITY_HIGH as c,KEY_ESCAPE_COMMAND as s,$getSelection as d,$isNodeSelection as f}from"lexical";import{ErrorBoundary as p}from"../../../../node_modules/react-error-boundary/dist/react-error-boundary.esm.js";import{$isEquationNode as E}from"../nodes/equation-node.js";import x from"./equation-editor.js";import j from"./katex-renderer.js";function q(q){var v=q.equation,g=q.inline,b=q.nodeKey,C=i()[0],_=a(),k=r(v),y=k[0],L=k[1],h=r(!1),N=h[0],D=h[1],F=t(null),K=n((function(e){D(!1),C.update((function(){var r=m(b);E(r)&&(r.setEquation(y),e&&r.selectNext(0,0))}))}),[C,y,b]);return o((function(){N||y===v||L(v)}),[N,v,y]),o((function(){if(_)return N?u(C.registerCommand(l,(function(e){var r=document.activeElement;return F.current!==r&&K(),!1}),c),C.registerCommand(s,(function(e){var r=document.activeElement;return F.current===r&&(K(!0),!0)}),c)):C.registerUpdateListener((function(e){e.editorState.read((function(){var e=d();return f(e)&&e.has(b)&&1===e.getNodes().length}))&&D(!0)}))}),[C,b,K,N,_]),e.createElement(e.Fragment,null,N&&_?e.createElement(x,{equation:y,setEquation:L,inline:g,ref:F}):e.createElement(p,{onError:function(e){return C._onError(e)},fallback:null},e.createElement(j,{equation:y,inline:g,onDoubleClick:function(){_&&D(!0)}})))}export{q as default};
//# sourceMappingURL=equation-component.js.map
