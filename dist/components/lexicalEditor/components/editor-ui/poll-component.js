import*as e from"react";import{useMemo as t,useState as r,useRef as o,useCallback as n,useEffect as a}from"react";import{useCollaborationContext as i}from"../../../../node_modules/@lexical/react/LexicalCollaborationContext.mjs.js";import{useLexicalComposerContext as l}from"../../../../node_modules/@lexical/react/LexicalComposerContext.mjs.js";import{useLexicalNodeSelection as c}from"../../../../node_modules/@lexical/react/useLexicalNodeSelection.mjs.js";import{mergeRegister as s}from"@lexical/utils";import{$getSelection as f,$isNodeSelection as u,CLICK_COMMAND as d,COMMAND_PRIORITY_LOW as m,KEY_DELETE_COMMAND as p,KEY_BACKSPACE_COMMAND as b,$getNodeByKey as x}from"lexical";import{Button as g}from"../../ui/button.js";import{Input as v}from"../../ui/input.js";import{$isPollNode as h,createPollOption as y}from"../nodes/poll-node.js";function E(t){var r=t.option,n=t.index,a=t.options,l=t.totalVotes,c=t.withPollNode,s=i().clientID,f=o(null),u=r.votes,d=-1!==u.indexOf(s),m=u.length,p=r.text;return e.createElement("div",{className:"mb-2.5 flex flex-row items-center"},e.createElement("div",{className:"relative mr-2.5 flex h-[22px] w-[22px] rounded-md border border-gray-400 ".concat(d?'border-primary bg-primary after:pointer-events-none after:absolute after:left-2 after:top-1 after:m-0 after:block after:h-[9px] after:w-[5px] after:rotate-45 after:cursor-pointer after:border-b-2 after:border-r-2 after:border-solid after:border-white after:content-[""]':"")},e.createElement("input",{ref:f,className:"absolute block h-full w-full cursor-pointer border-0 opacity-0",type:"checkbox",onChange:function(e){c((function(e){e.toggleVote(r,s)}))},checked:d})),e.createElement("div",{className:"relative flex flex-[10px] cursor-pointer overflow-hidden rounded-md border border-primary"},e.createElement("div",{className:"transition-width absolute left-0 top-0 z-0 h-full bg-accent duration-1000 ease-in-out",style:{width:"".concat(0===m?0:m/l*100,"%")}}),e.createElement("span",{className:"absolute right-4 top-1.5 text-xs text-primary"},m>0&&(1===m?"1 vote":"".concat(m," votes"))),e.createElement(v,{type:"text",value:p,onChange:function(e){var t=e.target,o=t.value,n=t.selectionStart,a=t.selectionEnd;c((function(e){e.setOptionText(r,o)}),(function(){t.selectionStart=n,t.selectionEnd=a}))},placeholder:"Option ".concat(n+1)})),e.createElement("button",{disabled:a.length<3,className:"relative z-0 ml-1.5 flex h-7 w-7 cursor-pointer rounded-md border-0 bg-transparent bg-[position:6px_6px] bg-no-repeat opacity-30 before:absolute before:left-[13px] before:top-1.5 before:block before:h-[15px] before:w-0.5 before:-rotate-45 before:bg-gray-400 before:content-[''] after:absolute after:left-[13px] after:top-1.5 after:block after:h-[15px] after:w-0.5 after:rotate-45 after:bg-gray-400 after:content-[''] hover:bg-gray-100 hover:opacity-100 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:opacity-30","aria-label":"Remove",onClick:function(){c((function(e){e.deleteOption(r)}))}}))}function w(i){var v=i.question,w=i.options,N=i.nodeKey,C=l()[0],j=t((function(){return function(e){return e.reduce((function(e,t){return e+t.votes.length}),0)}(w)}),[w]),k=c(N),O=k[0],L=k[1],S=k[2],_=r(null),z=_[0],V=_[1],D=o(null),K=n((function(e){var t=f();O&&u(t)&&(e.preventDefault(),C.update((function(){t.getNodes().forEach((function(e){h(e)&&e.remove()}))})));return!1}),[C,O]);a((function(){return s(C.registerUpdateListener((function(e){var t=e.editorState;V(t.read((function(){return f()})))})),C.registerCommand(d,(function(e){var t=e;return t.target===D.current&&(t.shiftKey||S(),L(!O),!0)}),m),C.registerCommand(p,K,m),C.registerCommand(b,K,m))}),[S,C,O,N,K,L]);var P=function(e,t){C.update((function(){var t=x(N);h(t)&&e(t)}),{onUpdate:t})},U=u(z)&&O;return e.createElement("div",{className:"min-w-[400px] max-w-[600px] cursor-pointer select-none rounded-lg border border-gray-200 bg-background ".concat(U?"outline outline-2 outline-primary":""),ref:D},e.createElement("div",{className:"m-4 cursor-default"},e.createElement("h2",{className:"m-0 mb-4 text-center text-lg text-gray-600"},v),w.map((function(t,r){var o=t.uid;return e.createElement(E,{key:o,withPollNode:P,option:t,index:r,options:w,totalVotes:j})})),e.createElement("div",{className:"flex justify-center"},e.createElement(g,{onClick:function(){P((function(e){e.addOption(y())}))},size:"sm"},"Add Option"))))}export{w as default};
//# sourceMappingURL=poll-component.js.map
