import*as e from"react";import{useRef as t,useState as r,useCallback as n,useEffect as o,Suspense as a}from"react";import{AutoFocusPlugin as l}from"../../../../node_modules/@lexical/react/LexicalAutoFocusPlugin.mjs.js";import{useLexicalComposerContext as i}from"../../../../node_modules/@lexical/react/LexicalComposerContext.mjs.js";import{LexicalErrorBoundary as c}from"../../../../node_modules/@lexical/react/LexicalErrorBoundary.mjs.js";import{LexicalNestedComposer as m}from"../../../../node_modules/@lexical/react/LexicalNestedComposer.mjs.js";import{RichTextPlugin as s}from"../../../../node_modules/@lexical/react/LexicalRichTextPlugin.mjs.js";import{useLexicalEditable as u}from"../../../../node_modules/@lexical/react/useLexicalEditable.mjs.js";import{useLexicalNodeSelection as d}from"../../../../node_modules/@lexical/react/useLexicalNodeSelection.mjs.js";import{mergeRegister as f}from"@lexical/utils";import{$getSelection as p,$isNodeSelection as g,$setSelection as h,SELECTION_CHANGE_COMMAND as E,COMMAND_PRIORITY_LOW as v,CLICK_COMMAND as x,DRAGSTART_COMMAND as b,KEY_DELETE_COMMAND as j,KEY_BACKSPACE_COMMAND as w,KEY_ENTER_COMMAND as C,KEY_ESCAPE_COMMAND as N,$getNodeByKey as k}from"lexical";import{Button as y}from"../../ui/button.js";import{Checkbox as _}from"../../ui/checkbox.js";import{DialogFooter as L}from"../../ui/dialog.js";import{Input as S}from"../../ui/input.js";import{Label as T}from"../../ui/label.js";import{Select as F,SelectTrigger as D,SelectValue as I,SelectContent as P,SelectItem as R}from"../../ui/select.js";import{useEditorModal as K}from"../editor-hooks/use-modal.js";import{$isInlineImageNode as A}from"../nodes/inline-image-node.js";import{LinkPlugin as B}from"../plugins/link-plugin.js";import{ContentEditable as U}from"./content-editable.js";var z=new Set;function V(t){var r=t.altText,n=t.className,o=t.imageRef,a=t.src,l=t.width,i=t.height,c=t.position;return function(e){if(!z.has(e))throw new Promise((function(t){var r=new Image;r.src=e,r.onload=function(){z.add(e),t(null)}}))}(a),e.createElement("img",{className:n||void 0,src:a,alt:r,ref:o,"data-position":c,style:{display:"block",height:i,width:l},draggable:"false"})}function W(t){var n=t.activeEditor,o=t.nodeKey,a=t.onClose,l=n.getEditorState().read((function(){return k(o)})),i=r(l.getAltText()),c=i[0],m=i[1],s=r(l.getShowCaption()),u=s[0],d=s[1],f=r(l.getPosition()),p=f[0],g=f[1];return e.createElement("div",{className:"space-y-4"},e.createElement("div",{className:"space-y-2"},e.createElement(T,{htmlFor:"alt-text"},"Alt Text"),e.createElement(S,{id:"alt-text",placeholder:"Descriptive alternative text",onChange:function(e){return m(e.target.value)},value:c,"data-test-id":"image-modal-alt-text-input"})),e.createElement("div",{className:"space-y-2"},e.createElement(T,{htmlFor:"position-select"},"Position"),e.createElement(F,{value:p,onValueChange:function(e){return g(e)}},e.createElement(D,{id:"position-select"},e.createElement(I,{placeholder:"Select position"})),e.createElement(P,null,e.createElement(R,{value:"left"},"Left"),e.createElement(R,{value:"right"},"Right"),e.createElement(R,{value:"full"},"Full Width")))),e.createElement("div",{className:"flex items-center space-x-2"},e.createElement(_,{id:"caption",checked:u,onCheckedChange:function(e){return d(e)}}),e.createElement(T,{htmlFor:"caption"},"Show Caption")),e.createElement(L,null,e.createElement(y,{"data-test-id":"image-modal-file-upload-btn",onClick:function(){var e={altText:c,position:p,showCaption:u};l&&n.update((function(){l.update(e)})),a()}},"Confirm")))}function q(k){var _=k.src,L=k.altText,S=k.nodeKey,T=k.width,F=k.height,D=k.showCaption,I=k.caption,P=k.position,R=K(),z=R[0],q=R[1],G=t(null),H=t(null),J=d(S),M=J[0],O=J[1],Q=J[2],X=i()[0],Y=r(null),Z=Y[0],$=Y[1],ee=t(null),te=u(),re=n((function(e){var t=p();M&&g(t)&&(e.preventDefault(),M&&g(t)&&X.update((function(){t.getNodes().forEach((function(e){A(e)&&e.remove()}))})));return!1}),[X,M]),ne=n((function(e){var t=p(),r=H.current;if(M&&g(t)&&1===t.getNodes().length){if(D)return h(null),e.preventDefault(),I.focus(),!0;if(null!==r&&r!==document.activeElement)return e.preventDefault(),r.focus(),!0}return!1}),[I,M,D]),oe=n((function(e){return(ee.current===I||H.current===e.target)&&(h(null),X.update((function(){O(!0);var e=X.getRootElement();null!==e&&e.focus()})),!0)}),[I,X,O]);o((function(){var e=!0,t=f(X.registerUpdateListener((function(t){var r=t.editorState;e&&$(r.read((function(){return p()})))})),X.registerCommand(E,(function(e,t){return ee.current=t,!1}),v),X.registerCommand(x,(function(e){var t=e;return t.target===G.current&&(t.shiftKey?O(!M):(Q(),O(!0)),!0)}),v),X.registerCommand(b,(function(e){return e.target===G.current&&(e.preventDefault(),!0)}),v),X.registerCommand(j,re,v),X.registerCommand(w,re,v),X.registerCommand(C,ne,v),X.registerCommand(N,oe,v));return function(){e=!1,t()}}),[Q,X,M,S,re,ne,oe,O]);var ae=M&&g(Z),le=M&&te;return e.createElement(a,{fallback:null},e.createElement(e.Fragment,null,e.createElement("span",{draggable:ae},te&&e.createElement(y,{className:"image-edit-button absolute right-1 top-1",variant:"outline",ref:H,onClick:function(){q("Update Inline Image",(function(t){return e.createElement(W,{activeEditor:X,nodeKey:S,onClose:t})}))}},"Edit"),e.createElement(V,{className:"max-w-full cursor-default ".concat(le?"".concat(g(Z)?"draggable cursor-grab active:cursor-grabbing":""," focused ring-2 ring-primary ring-offset-2"):null),src:_,altText:L,imageRef:G,width:T,height:F,position:P})),D&&e.createElement("div",{className:"image-caption-container absolute bottom-1 left-0 right-0 m-0 block min-w-[100px] overflow-hidden border-t bg-white/90 p-0"},e.createElement(m,{initialEditor:I},e.createElement(l,null),e.createElement(B,null),e.createElement(s,{contentEditable:e.createElement(U,{placeholder:"Enter a caption...",className:"ImageNode__contentEditable user-select-text word-break-break-word relative block min-h-5 w-[calc(100%-20px)] cursor-text resize-none whitespace-pre-wrap border-0 p-2.5 text-sm caret-primary outline-none",placeholderClassName:"ImageNode__placeholder text-sm text-muted-foreground overflow-hidden absolute top-2.5 left-2.5 pointer-events-none text-ellipsis user-select-none whitespace-nowrap inline-block"}),ErrorBoundary:c})))),z)}export{W as UpdateInlineImageDialog,q as default};
//# sourceMappingURL=inline-image-component.js.map
