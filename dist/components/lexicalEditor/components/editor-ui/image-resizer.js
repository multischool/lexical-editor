import*as e from"react";import{useRef as t}from"react";import{calculateZoomLevel as r}from"@lexical/utils";import{Button as i}from"../../ui/button.js";function n(e,t,r){return Math.min(Math.max(e,t),r)}var o=1,s=8,a=2,c=4;function l(l){var u=l.onResizeStart,m=l.onResizeEnd,d=l.buttonRef,g=l.imageRef,h=l.maxWidth,p=l.editor,y=l.showCaption,f=l.setShowCaption,w=l.captionsEnabled,b=t(null),v=t({priority:"",value:"default"}),z=t({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),E=p.getRootElement(),P=h||(null!==E?E.getBoundingClientRect().width-20:100),x=null!==E?E.getBoundingClientRect().height-20:100,R=function(e,t){if(p.isEditable()){var i=g.current,n=b.current;if(null!==i&&null!==n){e.preventDefault();var l=i.getBoundingClientRect(),m=l.width,d=l.height,h=r(i),y=z.current;y.startWidth=m,y.startHeight=d,y.ratio=m/d,y.currentWidth=m,y.currentHeight=d,y.startX=e.clientX/h,y.startY=e.clientY/h,y.isResizing=!0,y.direction=t,function(e){var t=e===o||e===c?"ew":e===s||e===a?"ns":e&s&&e&c||e&a&&e&o?"nwse":"nesw";null!==E&&E.style.setProperty("cursor","".concat(t,"-resize"),"important"),null!==document.body&&(document.body.style.setProperty("cursor","".concat(t,"-resize"),"important"),v.current.value=document.body.style.getPropertyValue("-webkit-user-select"),v.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))}(t),u(),n.classList.add("touch-action-none"),i.style.height="".concat(d,"px"),i.style.width="".concat(m,"px"),document.addEventListener("pointermove",W),document.addEventListener("pointerup",H)}}},W=function(e){var t=g.current,i=z.current,l=i.direction&(o|c),u=i.direction&(a|s);if(null!==t&&i.isResizing){var m=r(t);if(l&&u){var d=Math.floor(i.startX-e.clientX/m);d=i.direction&o?-d:d;var h=(p=n(i.startWidth+d,100,P))/i.ratio;t.style.width="".concat(p,"px"),t.style.height="".concat(h,"px"),i.currentHeight=h,i.currentWidth=p}else if(u){d=Math.floor(i.startY-e.clientY/m);d=i.direction&a?-d:d;h=n(i.startHeight+d,100,x);t.style.height="".concat(h,"px"),i.currentHeight=h}else{d=Math.floor(i.startX-e.clientX/m);d=i.direction&o?-d:d;var p=n(i.startWidth+d,100,P);t.style.width="".concat(p,"px"),i.currentWidth=p}}},H=function(){var e=g.current,t=z.current,r=b.current;if(null!==e&&null!==r&&t.isResizing){var i=t.currentWidth,n=t.currentHeight;t.startWidth=0,t.startHeight=0,t.ratio=0,t.startX=0,t.startY=0,t.currentWidth=0,t.currentHeight=0,t.isResizing=!1,r.classList.remove("touch-action-none"),null!==E&&E.style.setProperty("cursor","text"),null!==document.body&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",v.current.value,v.current.priority)),m(i,n),document.removeEventListener("pointermove",W),document.removeEventListener("pointerup",H)}};return e.createElement("div",{ref:b},!y&&w&&e.createElement(i,{className:"image-caption-button absolute bottom-1 left-1/2 -translate-x-1/2",ref:d,variant:"outline",onClick:function(){f(!y)}},"Add Caption"),e.createElement("div",{className:"image-resizer image-resizer-n absolute -top-2.5 left-1/2 h-3 w-3 -translate-x-1/2 cursor-ns-resize bg-primary",onPointerDown:function(e){R(e,s)}}),e.createElement("div",{className:"image-resizer image-resizer-ne absolute -right-2.5 -top-2.5 h-3 w-3 cursor-nesw-resize bg-primary",onPointerDown:function(e){R(e,s|o)}}),e.createElement("div",{className:"image-resizer image-resizer-e absolute -right-2.5 top-1/2 h-3 w-3 -translate-y-1/2 cursor-ew-resize bg-primary",onPointerDown:function(e){R(e,o)}}),e.createElement("div",{className:"image-resizer image-resizer-se absolute -bottom-2.5 -right-2.5 h-3 w-3 cursor-nwse-resize bg-primary",onPointerDown:function(e){R(e,a|o)}}),e.createElement("div",{className:"image-resizer image-resizer-s absolute -bottom-2.5 left-1/2 h-3 w-3 -translate-x-1/2 cursor-ns-resize bg-primary",onPointerDown:function(e){R(e,a)}}),e.createElement("div",{className:"image-resizer image-resizer-sw absolute -bottom-2.5 -left-2.5 h-3 w-3 cursor-nesw-resize bg-primary",onPointerDown:function(e){R(e,a|c)}}),e.createElement("div",{className:"image-resizer image-resizer-w absolute -left-2.5 top-1/2 h-3 w-3 -translate-y-1/2 cursor-ew-resize bg-primary",onPointerDown:function(e){R(e,c)}}),e.createElement("div",{className:"image-resizer image-resizer-nw absolute -left-2.5 -top-2.5 h-3 w-3 cursor-nwse-resize bg-primary",onPointerDown:function(e){R(e,s|c)}}))}export{l as ImageResizer};
//# sourceMappingURL=image-resizer.js.map
