import{__assign as e}from"../../../../node_modules/tslib/tslib.es6.mjs.js";import*as t from"react";import{useState as r,useRef as n,useMemo as o,useEffect as i}from"react";import{useLexicalComposerContext as l}from"../../../../node_modules/@lexical/react/LexicalComposerContext.mjs.js";import{useLexicalEditable as c}from"../../../../node_modules/@lexical/react/useLexicalEditable.mjs.js";import{TableNode as a,$isTableCellNode as s,$isTableNode as u,$getTableRowIndexFromTableCellNode as m,$getTableColumnIndexFromTableCellNode as d,$insertTableRow__EXPERIMENTAL as f,$insertTableColumn__EXPERIMENTAL as b}from"@lexical/table";import{mergeRegister as h,$findMatchingParent as v}from"@lexical/utils";import{$getNearestNodeFromDOMNode as E}from"lexical";import{createPortal as g}from"react-dom";import{useDebounce as p}from"../editor-hooks/use-debounce.js";import _ from"../../../../node_modules/lucide-react/dist/esm/icons/plus.js";function y(g){var y=g.anchorElem,x=l()[0],C=c(),w=r(!1),j=w[0],z=w[1],T=r(!1),N=T[0],O=T[1],A=r(!1),L=A[0],R=A[1],k=r({}),B=k[0],M=k[1],K=n(new Set),S=n(null),D=p((function(e){var t=function(e){var t=e.target;if(t&&t instanceof HTMLElement){var r=t.closest("td.EditorTheme__tableCell, th.EditorTheme__tableCell");return{isOutside:!(r||t.closest("button.EditorTheme__tableAddRows")||t.closest("button.EditorTheme__tableAddColumns")||t.closest("div.TableCellResizer__resizer")),tableDOMNode:r}}return{isOutside:!0,tableDOMNode:null}}(e),r=t.isOutside,n=t.tableDOMNode;if(r)return z(!1),void O(!1);if(n){S.current=n;var o=null,i=null,l=null;if(x.update((function(){var e,t=E(n);if(s(t)){var r=v(t,(function(e){return u(e)}));if(!u(r))return;if(l=x.getElementByKey(null==r?void 0:r.getKey())){var c=r.getChildrenSize(),a=null===(e=r.getChildAtIndex(0))||void 0===e?void 0:e.getChildrenSize(),f=m(t),b=d(t);f===c-1?o=t:b===a-1&&(i=t)}}})),l){var c=l.getBoundingClientRect(),a=c.width,f=c.y,b=c.right,h=c.left,g=c.bottom,p=c.height,_=y.getBoundingClientRect(),C=_.y,w=_.left;o?(O(!1),z(!0),M({height:20,left:h-w,top:g-C+5,width:a})):i&&(O(!0),z(!1),M({height:p,left:b-w+5,top:f-C,width:20}))}}}),50,250),I=o((function(){return new ResizeObserver((function(){z(!1),O(!1)}))}),[]);i((function(){if(L)return document.addEventListener("mousemove",D),function(){z(!1),O(!1),D.cancel(),document.removeEventListener("mousemove",D)}}),[L,D]),i((function(){return h(x.registerMutationListener(a,(function(e){x.getEditorState().read((function(){for(var t=0,r=Array.from(e);t<r.length;t++){var n=r[t],o=n[0],i=n[1],l=x.getElementByKey(o);switch(i){case"created":K.current.add(o),R(K.current.size>0),l&&I.observe(l);break;case"destroyed":K.current.delete(o),R(K.current.size>0),I.disconnect(),K.current.forEach((function(e){var t=x.getElementByKey(e);t&&I.observe(t)}))}}}))}),{skipInitialization:!1}))}),[x,I]);var F=function(e){x.update((function(){if(S.current){var t=E(S.current);null==t||t.selectEnd(),e?(f(),z(!1)):(b(),O(!1))}}))};return C?t.createElement(t.Fragment,null,j&&t.createElement("button",{className:"EditorTheme__tableAddRows absolute flex w-[calc(100%-25px)] cursor-pointer items-center justify-center border-0 bg-accent hover:bg-accent/80",style:e({},B),onClick:function(){return F(!0)}},t.createElement(_,{className:"h-4 w-4"})),N&&t.createElement("button",{className:"EditorTheme__tableAddColumns absolute flex w-[calc(100%-25px)] cursor-pointer items-center justify-center border-0 bg-accent hover:bg-accent/80",style:e({},B),onClick:function(){return F(!1)}},t.createElement(_,{className:"h-4 w-4"}))):null}function x(e){var r=e.anchorElem,n=c();return r&&n?g(t.createElement(y,{anchorElem:r}),r):null}export{x as TableHoverActionsPlugin};
//# sourceMappingURL=table-hover-actions-plugin.js.map
