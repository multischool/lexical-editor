import{__assign as e}from"../../../../node_modules/tslib/tslib.es6.mjs.js";import*as t from"react";import{useState as r,useRef as o,useEffect as n}from"react";import{CodeNode as i,normalizeCodeLang as c,getLanguageFriendlyName as a,$isCodeNode as u}from"@lexical/code";import{useLexicalComposerContext as l}from"../../../../node_modules/@lexical/react/LexicalComposerContext.mjs.js";import{$getNearestNodeFromDOMNode as s}from"lexical";import{createPortal as m}from"react-dom";import{useDebounce as d}from"../editor-hooks/use-debounce.js";import{CopyButton as f}from"../editor-ui/code-button.js";function v(m){var v=m.anchorElem,g=l()[0],p=r(""),x=p[0],E=p[1],h=r(!1),O=h[0],b=h[1],j=r(!1),L=j[0],M=j[1],y=r({right:"0",top:"0"}),C=y[0],N=y[1],D=o(new Set),_=o(null);var k=d((function(e){var t=function(e){var t=e.target;if(t&&t instanceof HTMLElement){var r=t.closest("code.EditorTheme__code");return{codeDOMNode:r,isOutside:!(r||t.closest("div.code-action-menu-container"))}}return{codeDOMNode:null,isOutside:!0}}(e),r=t.codeDOMNode;if(t.isOutside)b(!1);else if(r){_.current=r;var o=null,n="";if(g.update((function(){var e=s(r);u(e)&&(n=(o=e).getLanguage()||"")})),o){var i=v.getBoundingClientRect(),c=i.y,a=i.right,l=r.getBoundingClientRect(),m=l.y,d=l.right;E(n),b(!0),N({right:"".concat(a-d+8,"px"),top:"".concat(m-c,"px")})}}}),50,1e3);n((function(){if(L)return document.addEventListener("mousemove",k),function(){b(!1),k.cancel(),document.removeEventListener("mousemove",k)}}),[L,k]),n((function(){return g.registerMutationListener(i,(function(e){g.getEditorState().read((function(){for(var t=0,r=Array.from(e);t<r.length;t++){var o=r[t],n=o[0];switch(o[1]){case"created":D.current.add(n);break;case"destroyed":D.current.delete(n)}}})),M(D.current.size>0)}),{skipInitialization:!1})}),[g]),c(x);var w=a(x);return t.createElement(t.Fragment,null,O?t.createElement("div",{className:"code-action-menu-container user-select-none absolute flex h-9 flex-row items-center space-x-1 text-xs text-foreground/50",style:e({},C)},t.createElement("div",null,w),t.createElement(f,{editor:g,getCodeDOMNode:function(){return _.current}})):null)}function g(e){var r=e.anchorElem;return r?m(t.createElement(v,{anchorElem:r}),r):null}export{g as CodeActionMenuPlugin};
//# sourceMappingURL=code-action-menu-plugin.js.map
