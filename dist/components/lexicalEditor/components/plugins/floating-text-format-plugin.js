import{__awaiter as e,__generator as t}from"../../../../node_modules/tslib/tslib.es6.mjs.js";import*as n from"react";import{useRef as r,useState as i,useEffect as o,useCallback as a}from"react";import{$isCodeHighlightNode as l}from"@lexical/code";import{$isLinkNode as s,TOGGLE_LINK_COMMAND as c}from"@lexical/link";import{useLexicalComposerContext as m}from"../../../../node_modules/@lexical/react/LexicalComposerContext.mjs.js";import{mergeRegister as u}from"@lexical/utils";import{createCommand as d,$getSelection as f,$isRangeSelection as p,$isTextNode as E,$isParagraphNode as g,COMMAND_PRIORITY_LOW as h,SELECTION_CHANGE_COMMAND as v,FORMAT_TEXT_COMMAND as C}from"lexical";import{createPortal as k}from"react-dom";import{Separator as w}from"../../ui/separator.js";import{ToggleGroup as b,ToggleGroupItem as x}from"../../ui/toggle-group.js";import{DropdownMenu as j,DropdownMenuTrigger as N,DropdownMenuContent as y,DropdownMenuLabel as _,DropdownMenuGroup as T,DropdownMenuItem as I,DropdownMenuSeparator as L,DropdownMenuSub as z,DropdownMenuSubTrigger as S,DropdownMenuSubContent as A}from"../../ui/dropdown-menu.js";import{useFloatingLinkContext as F}from"../context/floating-link-context.js";import{getDOMRangeRect as R}from"../utils/get-dom-range-rect.js";import{getSelectedNode as M}from"../utils/get-selected-node.js";import{setFloatingElemPosition as G}from"../utils/set-floating-elem-position.js";import{Button as P}from"../../ui/button.js";import B from"../../../../node_modules/lucide-react/dist/esm/icons/loader-circle.js";import U from"../../../../node_modules/lucide-react/dist/esm/icons/sparkles.js";import W from"../../../../node_modules/lucide-react/dist/esm/icons/chevron-down.js";import q from"../../../../node_modules/lucide-react/dist/esm/icons/pen-tool.js";import O from"../../../../node_modules/lucide-react/dist/esm/icons/scissors.js";import V from"../../../../node_modules/lucide-react/dist/esm/icons/maximize.js";import X from"../../../../node_modules/lucide-react/dist/esm/icons/minimize.js";import D from"../../../../node_modules/lucide-react/dist/esm/icons/align-justify.js";import H from"../../../../node_modules/lucide-react/dist/esm/icons/message-square.js";import J from"../../../../node_modules/lucide-react/dist/esm/icons/file-digit.js";import Y from"../../../../node_modules/lucide-react/dist/esm/icons/languages.js";import K from"../../../../node_modules/lucide-react/dist/esm/icons/square-pen.js";import Q from"../../../../node_modules/lucide-react/dist/esm/icons/bold.js";import Z from"../../../../node_modules/lucide-react/dist/esm/icons/italic.js";import $ from"../../../../node_modules/lucide-react/dist/esm/icons/underline.js";import ee from"../../../../node_modules/lucide-react/dist/esm/icons/strikethrough.js";import te from"../../../../node_modules/lucide-react/dist/esm/icons/code.js";import ne from"../../../../node_modules/lucide-react/dist/esm/icons/link.js";import re from"../../../../node_modules/lucide-react/dist/esm/icons/subscript.js";import ie from"../../../../node_modules/lucide-react/dist/esm/icons/superscript.js";function oe(e){return e.visible?n.createElement("div",{className:"fixed inset-0 flex items-center justify-center bg-black/10 z-50"},n.createElement("div",{className:"bg-white rounded-md p-4 shadow-lg flex items-center gap-2"},n.createElement(B,{className:"h-5 w-5 animate-spin text-primary"}),n.createElement("span",null,"Generating text with AI..."))):null}var ae=d("AI_TEXT_TRANSFORM_COMMAND");function le(e){var t=e.editor,i=e.anchorElem,l=e.isLink,s=e.isBold,m=e.isItalic,d=e.isUnderline,E=e.isCode,g=e.isStrikethrough,k=e.isSubscript,F=e.isSuperscript,M=e.setIsLinkEditMode,B=e.editorRef,oe=e.setIsAILoading;e.onAIGeneration;var le=r(null),se=a((function(){l?(M(!1),t.dispatchCommand(c,null)):(M(!0),t.dispatchCommand(c,"https://"))}),[t,l,M]),ce=a((function(e){oe(!0),t.dispatchCommand(ae,{transformType:e,editorRef:B})}),[t,oe,B]);function me(e){if((null==le?void 0:le.current)&&(1===e.buttons||3===e.buttons)&&"none"!==le.current.style.pointerEvents){var t=e.clientX,n=e.clientY,r=document.elementFromPoint(t,n);le.current.contains(r)||(le.current.style.pointerEvents="none")}}function ue(e){(null==le?void 0:le.current)&&"auto"!==le.current.style.pointerEvents&&(le.current.style.pointerEvents="auto")}o((function(){if(null==le?void 0:le.current)return document.addEventListener("mousemove",me),document.addEventListener("mouseup",ue),function(){document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",ue)}}),[le]);var de=a((function(){var e=f(),n=le.current,r=window.getSelection();if(null!==n){var o=t.getRootElement();if(null!==e&&null!==r&&!r.isCollapsed&&null!==o&&o.contains(r.anchorNode)){var a=R(r,o);G(a,n,i,l)}}}),[t,i,l]);return o((function(){var e=i.parentElement,n=function(){t.getEditorState().read((function(){de()}))};return window.addEventListener("resize",n),e&&e.addEventListener("scroll",n),function(){window.removeEventListener("resize",n),e&&e.removeEventListener("scroll",n)}}),[t,de,i]),o((function(){return t.getEditorState().read((function(){de()})),u(t.registerUpdateListener((function(e){e.editorState.read((function(){de()}))})),t.registerCommand(v,(function(){return de(),!1}),h))}),[t,de]),n.createElement("div",{ref:le,className:"absolute left-0 top-0 z-10 flex gap-1 rounded-md border p-1 opacity-0 shadow-md transition-opacity duration-300 will-change-transform bg-background"},t.isEditable()&&n.createElement(n.Fragment,null,n.createElement(j,null,n.createElement(N,{asChild:!0},n.createElement(P,{variant:"ghost",className:"flex items-center gap-1"},n.createElement(U,{className:"h-4 w-4"}),"AI",n.createElement(W,{className:"h-3 w-3 opacity-50"}))),n.createElement(y,{align:"start",className:"w-56"},n.createElement(_,null,"Generate from selection"),n.createElement(T,null,n.createElement(I,{onClick:function(){return ce("improve")}},n.createElement(q,{className:"mr-2 h-4 w-4"}),n.createElement("span",null,"Improve writing")),n.createElement(I,{onClick:function(){return ce("shorter")}},n.createElement(O,{className:"mr-2 h-4 w-4"}),n.createElement("span",null,"Make shorter")),n.createElement(I,{onClick:function(){return ce("longer")}},n.createElement(V,{className:"mr-2 h-4 w-4"}),n.createElement("span",null,"Make longer")),n.createElement(I,{onClick:function(){return ce("summarize")}},n.createElement(X,{className:"mr-2 h-4 w-4"}),n.createElement("span",null,"Summarize")),n.createElement(I,{onClick:function(){return ce("continue")}},n.createElement(D,{className:"mr-2 h-4 w-4"}),n.createElement("span",null,"Continue writing"))),n.createElement(L,null),n.createElement(z,null,n.createElement(S,null,n.createElement(H,{className:"mr-2 h-4 w-4"}),n.createElement("span",null,"Change tone")),n.createElement(A,null,n.createElement(I,{onClick:function(){return ce("tone-professional")}},"Professional"),n.createElement(I,{onClick:function(){return ce("tone-casual")}},"Casual"),n.createElement(I,{onClick:function(){return ce("tone-friendly")}},"Friendly"),n.createElement(I,{onClick:function(){return ce("tone-confident")}},"Confident"))),n.createElement(z,null,n.createElement(S,null,n.createElement(J,{className:"mr-2 h-4 w-4"}),n.createElement("span",null,"Change style")),n.createElement(A,null,n.createElement(I,{onClick:function(){return ce("style-academic")}},"Academic"),n.createElement(I,{onClick:function(){return ce("style-technical")}},"Technical"),n.createElement(I,{onClick:function(){return ce("style-creative")}},"Creative"),n.createElement(I,{onClick:function(){return ce("style-persuasive")}},"Persuasive"))),n.createElement(L,null),n.createElement(z,null,n.createElement(S,null,n.createElement(Y,{className:"mr-2 h-4 w-4"}),n.createElement("span",null,"Translate")),n.createElement(A,null,n.createElement(I,{onClick:function(){return ce("translate-english")}},"English"),n.createElement(I,{onClick:function(){return ce("translate-spanish")}},"Spanish"),n.createElement(I,{onClick:function(){return ce("translate-french")}},"French"),n.createElement(I,{onClick:function(){return ce("translate-german")}},"German"),n.createElement(I,{onClick:function(){return ce("translate-chinese")}},"Chinese"),n.createElement(I,{onClick:function(){return ce("translate-japanese")}},"Japanese"),n.createElement(I,{onClick:function(){return ce("translate-arabic")}},"Arabic"),n.createElement(I,{onClick:function(){return ce("translate-hindi")}},"Hindi"),n.createElement(I,{onClick:function(){return ce("translate-portuguese")}},"Portuguese"),n.createElement(I,{onClick:function(){return ce("translate-bangla")}},"Bangla (Bengali)"))),n.createElement(I,{onClick:function(){t.update((function(){var e=f();if(p(e)){var t=e.getTextContent(),n=window.prompt("Custom AI instruction:",'Transform the following text: "'.concat(t,'"'));n&&ce("custom:".concat(n))}}))}},n.createElement(K,{className:"mr-2 h-4 w-4"}),n.createElement("span",null,"Custom instruction")))),n.createElement(b,{type:"multiple",defaultValue:[s?"bold":"",m?"italic":"",d?"underline":"",g?"strikethrough":"",k?"subscript":"",F?"superscript":"",E?"code":"",l?"link":""]},n.createElement(x,{value:"bold","aria-label":"Toggle bold",onClick:function(){t.dispatchCommand(C,"bold")},size:"sm"},n.createElement(Q,{className:"h-4 w-4"})),n.createElement(x,{value:"italic","aria-label":"Toggle italic",onClick:function(){t.dispatchCommand(C,"italic")},size:"sm"},n.createElement(Z,{className:"h-4 w-4"})),n.createElement(x,{value:"underline","aria-label":"Toggle underline",onClick:function(){t.dispatchCommand(C,"underline")},size:"sm"},n.createElement($,{className:"h-4 w-4"})),n.createElement(x,{value:"strikethrough","aria-label":"Toggle strikethrough",onClick:function(){t.dispatchCommand(C,"strikethrough")},size:"sm"},n.createElement(ee,{className:"h-4 w-4"})),n.createElement(w,{orientation:"vertical"}),n.createElement(x,{value:"code","aria-label":"Toggle code",onClick:function(){t.dispatchCommand(C,"code")},size:"sm"},n.createElement(te,{className:"h-4 w-4"})),n.createElement(x,{value:"link","aria-label":"Toggle link",onClick:se,size:"sm"},n.createElement(ne,{className:"h-4 w-4"})),n.createElement(w,{orientation:"vertical"})),n.createElement(b,{type:"single",defaultValue:k?"subscript":F?"superscript":""},n.createElement(x,{value:"subscript","aria-label":"Toggle subscript",onClick:function(){t.dispatchCommand(C,"subscript")},size:"sm"},n.createElement(re,{className:"h-4 w-4"})),n.createElement(x,{value:"superscript","aria-label":"Toggle superscript",onClick:function(){t.dispatchCommand(C,"superscript")},size:"sm"},n.createElement(ie,{className:"h-4 w-4"})))))}function se(r,c,m,d,v,C){var w=i(!1),b=w[0],x=w[1],j=i(!1),N=j[0],y=j[1],_=i(!1),T=_[0],I=_[1],L=i(!1),z=L[0],S=L[1],A=i(!1),F=A[0],R=A[1],G=i(!1),P=G[0],B=G[1],U=i(!1),W=U[0],q=U[1],O=i(!1),V=O[0],X=O[1],D=i(!1),H=D[0],J=D[1],Y=a((function(){r.getEditorState().read((function(){if(!r.isComposing()){var e=f(),t=window.getSelection(),n=r.getRootElement();if(null===t||p(e)&&null!==n&&n.contains(t.anchorNode)){if(p(e)){var i=M(e);I(e.hasFormat("bold")),S(e.hasFormat("italic")),R(e.hasFormat("underline")),B(e.hasFormat("strikethrough")),q(e.hasFormat("subscript")),X(e.hasFormat("superscript")),J(e.hasFormat("code"));var o=i.getParent();s(o)||s(i)?y(!0):y(!1),l(e.anchor.getNode())||""===e.getTextContent()?x(!1):x(E(i)||g(i));var a=e.getTextContent().replace(/\n/g,"");e.isCollapsed()||""!==a||x(!1)}}else x(!1)}}))}),[r]);return o((function(){return document.addEventListener("selectionchange",Y),function(){document.removeEventListener("selectionchange",Y)}}),[Y]),o((function(){return u(r.registerUpdateListener((function(){Y()})),r.registerRootListener((function(){null===r.getRootElement()&&x(!1)})),r.registerCommand(ae,(function(n){n.transformType;var i="",o=!1;return r.getEditorState().read((function(){var e=f();p(e)&&(i=e.getTextContent(),o=!e.isCollapsed())})),o&&i.trim()?(function(n,r,i,o){e(this,void 0,void 0,(function(){var e,a,l,s,c,m,u,d,E;return t(this,(function(t){switch(t.label){case 0:if(e=n.transformType,a=n.editorRef,l="",e.startsWith("translate-"))s=e.split("-")[1],l="Translate the following text to ".concat(s,': "').concat(r,'"');else if(e.startsWith("custom:"))l=e.substring(7);else if(e.startsWith("tone-"))c=e.split("-")[1],l="Rewrite the following text in a ".concat(c,' tone: "').concat(r,'"');else if(e.startsWith("style-"))m=e.split("-")[1],l="Rewrite the following text in ".concat(m,' style: "').concat(r,'"');else switch(e){case"improve":l='Improve the writing of the following text while maintaining its meaning: "'.concat(r,'"');break;case"shorter":l='Make the following text shorter and more concise while preserving its key points: "'.concat(r,'"');break;case"longer":l='Expand and elaborate on the following text: "'.concat(r,'"');break;case"summarize":l='Summarize the following text: "'.concat(r,'"');break;case"continue":l="Continue writing from the following text with that text included: ".concat(r);break;default:l='Transform the following text: "'.concat(r,'"')}t.label=1;case 1:return t.trys.push([1,4,5,6]),u="",o?[4,o(l,e)]:[3,3];case 2:if(!(d=t.sent()).success)return console.error("AI generation failed:",d.error),[2];u=d.text,t.label=3;case 3:return u?(a.current&&u&&a.current.update((function(){var e=f();p(e)&&e.insertText(u)})),[3,6]):(console.error("No generated text received from AI generation."),[2]);case 4:return E=t.sent(),console.error("Error processing AI text generation:",E),[3,6];case 5:return i(!1),[7];case 6:return[2]}}))}))}(n,i,v,C),!0):(v(!1),!1)}),h))}),[r,Y,v,C]),b&&c?k(n.createElement(le,{editor:r,anchorElem:c,isLink:N,isBold:T,isItalic:z,isStrikethrough:P,isSubscript:W,isSuperscript:V,isUnderline:F,isCode:H,setIsLinkEditMode:m,editorRef:d,setIsAILoading:v,onAIGeneration:C}),c):null}function ce(e){var t=e.anchorElem,a=e.onAIGeneration,l=m()[0],s=F().setIsLinkEditMode,c=r(l),u=i(!1),d=u[0],f=u[1];return o((function(){c.current=l}),[l]),n.createElement(n.Fragment,null,se(l,t,s,c,f,a),n.createElement(oe,{visible:d}))}export{ce as FloatingTextFormatToolbarPlugin};
//# sourceMappingURL=floating-text-format-plugin.js.map
