import{__extends as e,__awaiter as t,__generator as n,__spreadArray as r}from"../../../../node_modules/tslib/tslib.es6.mjs.js";import*as o from"react";import{useMemo as a,useCallback as i}from"react";import l from"../../../../node_modules/next/dynamic.js";import{$isLinkNode as c,TOGGLE_LINK_COMMAND as s}from"@lexical/link";import{useLexicalComposerContext as u}from"../../../../node_modules/@lexical/react/LexicalComposerContext.mjs.js";import{MenuOption as m}from"../../../../node_modules/@lexical/react/LexicalContextMenuPlugin.mjs.js";import{PopoverPortal as d}from"../../../../node_modules/@radix-ui/react-popover/dist/index.mjs.js";import{COPY_COMMAND as p,CUT_COMMAND as f,PASTE_COMMAND as v,$getSelection as b,$isRangeSelection as h,$getNearestNodeFromDOMNode as x}from"lexical";import{Command as g,CommandList as w,CommandItem as C}from"../../ui/command.js";import{Popover as S,PopoverTrigger as j,PopoverContent as E}from"../../ui/popover.js";var y=l((function(){return import("./default/lexical-context-menu-plugin.js")}),{ssr:!1}),D=function(t){function n(e,n){var r=t.call(this,e)||this;return r.title=e,r.onSelect=n.onSelect.bind(r),r}return e(n,t),n}(m);function P(){var e=u()[0],l=o.useState(!1),m=l[0],P=l[1],N=a((function(){return[new D("Copy",{onSelect:function(t){e.dispatchCommand(p,null)}}),new D("Cut",{onSelect:function(t){e.dispatchCommand(f,null)}}),new D("Paste",{onSelect:function(r){navigator.clipboard.read().then((function(){return t(this,void 0,void 0,(function(){var t,r,o,a,i,l,c,s;return n(this,(function(n){switch(n.label){case 0:return t=new DataTransfer,[4,navigator.clipboard.read()];case 1:return r=n.sent(),o=r[0],[4,navigator.permissions.query({name:"clipboard-read"})];case 2:if("denied"===n.sent().state)return alert("Not allowed to paste from clipboard."),[2];a=0,i=o.types,n.label=3;case 3:return a<i.length?(l=i[a],[4,o.getType(l)]):[3,7];case 4:return[4,n.sent().text()];case 5:c=n.sent(),t.setData(l,c),n.label=6;case 6:return a++,[3,3];case 7:return s=new ClipboardEvent("paste",{clipboardData:t}),e.dispatchCommand(v,s),[2]}}))}))}))}}),new D("Paste as Plain Text",{onSelect:function(r){navigator.clipboard.read().then((function(){return t(this,void 0,void 0,(function(){var t,r,o;return n(this,(function(n){switch(n.label){case 0:return[4,navigator.permissions.query({name:"clipboard-read"})];case 1:return"denied"===n.sent().state?(alert("Not allowed to paste from clipboard."),[2]):(t=new DataTransfer,[4,navigator.clipboard.readText()]);case 2:return r=n.sent(),t.setData("text/plain",r),o=new ClipboardEvent("paste",{clipboardData:t}),e.dispatchCommand(v,o),[2]}}))}))}))}}),new D("Delete Node",{onSelect:function(e){var t=b();if(h(t)){var n=t.anchor.getNode().getParents().at(-2);null==n||n.remove()}}})]}),[e]),O=o.useState(N),T=O[0],_=O[1],k=i((function(t,n,r){e.update((function(){t.onSelect(n),r()}))}),[e]);return o.createElement(y,{options:T,onSelectOption:function(e,t){k(e,t,(function(){P(!1)}))},onWillOpen:function(t){var n=N;P(!0),e.update((function(){var o=x(t.target);if(o){var a=o.getParent();c(a)&&(n=r([new D("Remove Link",{onSelect:function(t){e.dispatchCommand(s,null)}})],N,!0))}})),_(n)},onOpen:function(){P(!0)},onClose:function(){P(!1)},menuRenderFn:function(e,t,n){var r;t.options;var a=t.selectOptionAndCleanUp,i=n.setMenuRef;return e.current?o.createElement(S,{open:m,onOpenChange:P},o.createElement(d,{container:e.current},o.createElement("div",null,o.createElement(j,{ref:i,style:{marginLeft:null===(r=e.current)||void 0===r?void 0:r.style.width,userSelect:"none"}}),o.createElement(E,{className:"w-[200px] p-1"},o.createElement(g,null,o.createElement(w,null,T.map((function(e){return o.createElement(C,{key:e.key,onSelect:function(){a(e)}},e.title)})))))))):null}})}export{D as ContextMenuOption,P as ContextMenuPlugin};
//# sourceMappingURL=context-menu-plugin.js.map
