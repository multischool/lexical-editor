{"version":3,"file":"ComboboxPlugin.jsx","sourceRoot":"","sources":["ComboboxPlugin.tsx"],"names":[],"mappings":"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","sourcesContent":["import { useLexicalComposerContext } from \"@lexical/react/LexicalComposerContext\";\nimport {\n  MenuTextMatch,\n  TriggerFn,\n} from \"@lexical/react/LexicalTypeaheadMenuPlugin\";\nimport { mergeRegister } from \"@lexical/utils\";\nimport {\n  $createTextNode,\n  $getSelection,\n  $isRangeSelection,\n  CLICK_COMMAND,\n  COMMAND_PRIORITY_LOW,\n  COMMAND_PRIORITY_NORMAL,\n  FOCUS_COMMAND,\n  KEY_ARROW_DOWN_COMMAND,\n  KEY_ARROW_UP_COMMAND,\n  KEY_BACKSPACE_COMMAND,\n  KEY_DOWN_COMMAND,\n  KEY_ENTER_COMMAND,\n  KEY_ESCAPE_COMMAND,\n  KEY_TAB_COMMAND,\n  LexicalEditor,\n  RangeSelection,\n  TextNode,\n} from \"lexical\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport {\n  BeautifulMentionsComboboxItem,\n  BeautifulMentionsItemData,\n  BeautifulMentionsPluginProps,\n} from \"./BeautifulMentionsPluginProps\";\nimport { $splitNodeContainingQuery, MenuOption } from \"./Menu\";\nimport { CAN_USE_DOM, IS_MOBILE } from \"./environment\";\nimport { $insertTriggerAtSelection } from \"./mention-commands\";\nimport { getTextContent } from \"./mention-utils\";\nimport { useIsFocused } from \"./useIsFocused\";\n\ninterface ComboboxPluginProps\n  extends Pick<\n      BeautifulMentionsPluginProps,\n      | \"autoSpace\"\n      | \"comboboxOpen\"\n      | \"onComboboxItemSelect\"\n      | \"comboboxAdditionalItems\"\n      | \"comboboxAnchor\"\n      | \"comboboxAnchorClassName\"\n      | \"comboboxComponent\"\n      | \"comboboxItemComponent\"\n      | \"onComboboxOpen\"\n      | \"onComboboxClose\"\n      | \"onComboboxFocusChange\"\n    >,\n    Required<Pick<BeautifulMentionsPluginProps, \"punctuation\">> {\n  loading: boolean;\n  triggerFn: TriggerFn;\n  onSelectOption: (\n    option: MenuOption,\n    textNodeContainingQuery: TextNode | null,\n  ) => void;\n  onQueryChange: (matchingString: string | null) => void;\n  options: MenuOption[];\n  triggers: string[];\n  onReset: () => void;\n  creatable: boolean | string;\n}\n\nclass ComboboxOption extends MenuOption {\n  readonly comboboxItem: BeautifulMentionsComboboxItem;\n  readonly menuOption: MenuOption;\n\n  constructor(\n    public readonly itemType: \"trigger\" | \"value\" | \"additional\",\n    value: string,\n    displayValue: string,\n    data: Record<string, BeautifulMentionsItemData> = {},\n  ) {\n    super(value, displayValue, data);\n    this.comboboxItem = {\n      itemType: itemType,\n      value: value,\n      displayValue: displayValue,\n      data: data,\n    };\n    this.menuOption = new MenuOption(value, displayValue, data);\n  }\n}\n\nfunction getQueryTextForSearch(editor: LexicalEditor): string | null {\n  let text = null;\n  editor.getEditorState().read(() => {\n    const selection = $getSelection();\n    if (!$isRangeSelection(selection)) {\n      return;\n    }\n    text = getTextUpToAnchor(selection);\n  });\n  return text;\n}\n\nfunction getTextUpToAnchor(selection: RangeSelection): string | null {\n  const anchor = selection.anchor;\n  if (anchor.type !== \"text\") {\n    return null;\n  }\n  const anchorNode = anchor.getNode();\n  if (!anchorNode.isSimpleText()) {\n    return null;\n  }\n  const anchorOffset = anchor.offset;\n  return getTextContent(anchorNode).slice(0, anchorOffset);\n}\n\nfunction isCharacterKey(event: KeyboardEvent) {\n  return (\n    event.key.length === 1 &&\n    !event.ctrlKey &&\n    !event.altKey &&\n    !event.metaKey &&\n    !event.repeat\n  );\n}\n\nexport function useAnchorRef(\n  render: boolean,\n  comboboxAnchor?: HTMLElement | null,\n  comboboxAnchorClassName?: string,\n) {\n  const [editor] = useLexicalComposerContext();\n  const [anchor, setAnchor] = useState<HTMLElement | null>(\n    comboboxAnchor ?? null,\n  );\n  const [anchorChild, setAnchorChild] = useState<HTMLElement | null>(null);\n\n  useEffect(() => {\n    if (comboboxAnchor) {\n      setAnchor(comboboxAnchor);\n      return;\n    }\n    return editor.registerRootListener((rootElement) => {\n      if (rootElement) {\n        setAnchor(rootElement.parentElement);\n      }\n    });\n  }, [editor, comboboxAnchor]);\n\n  useEffect(() => {\n    if (!anchor) {\n      return;\n    }\n    if (!render) {\n      if (anchorChild) {\n        anchorChild.remove();\n        setAnchorChild(null);\n      }\n      return;\n    }\n    const { height } = anchor.getBoundingClientRect();\n    const newAnchorChild = anchorChild ?? document.createElement(\"div\");\n    newAnchorChild.style.position = \"absolute\";\n    newAnchorChild.style.left = \"0\";\n    newAnchorChild.style.right = \"0\";\n    newAnchorChild.style.paddingTop = `${height}px`;\n    anchor.prepend(newAnchorChild);\n    if (!anchorChild) {\n      setAnchorChild(newAnchorChild);\n    }\n    const anchorObserver = new ResizeObserver(([entry]) => {\n      newAnchorChild.style.paddingTop = `${entry.contentRect.height}px`;\n    });\n    anchorObserver.observe(anchor);\n    setTimeout(() => {\n      newAnchorChild.className = comboboxAnchorClassName ?? \"\";\n    });\n    return () => {\n      anchorObserver.disconnect();\n      anchor.removeChild(newAnchorChild);\n    };\n  }, [anchor, render, anchorChild, comboboxAnchorClassName]);\n\n  return anchorChild;\n}\n\nexport function checkForTriggers(\n  text: string,\n  triggers: string[],\n): MenuTextMatch | null {\n  const last = text.split(/\\s/).pop() ?? text;\n  const offset = text !== last ? text.lastIndexOf(last) : 0;\n  const match = triggers.some((t) => t.startsWith(last) && t !== last);\n  if (match) {\n    return {\n      leadOffset: offset,\n      matchingString: last,\n      replaceableString: last,\n    };\n  }\n  return null;\n}\n\nexport function ComboboxPlugin(props: ComboboxPluginProps) {\n  const {\n    onSelectOption,\n    triggers,\n    punctuation,\n    autoSpace,\n    loading,\n    triggerFn,\n    onQueryChange,\n    onReset,\n    comboboxAnchor,\n    comboboxAnchorClassName,\n    comboboxComponent: ComboboxComponent = \"div\",\n    comboboxItemComponent: ComboboxItemComponent = \"div\",\n    onComboboxOpen,\n    onComboboxClose,\n    onComboboxFocusChange,\n    comboboxAdditionalItems = [],\n    onComboboxItemSelect,\n  } = props;\n  const focused = useIsFocused();\n  const [editor] = useLexicalComposerContext();\n  const [selectedIndex, setSelectedIndex] = useState<number | null>(null);\n  const [triggerMatch, setTriggerMatch] = useState<MenuTextMatch | null>(null);\n  const [valueMatch, setValueMatch] = useState<MenuTextMatch | null>(null);\n  const [triggerQueryString, setTriggerQueryString] = useState<string | null>(\n    null,\n  );\n  const itemType = props.options.length === 0 ? \"trigger\" : \"value\";\n  const options = useMemo(() => {\n    const additionalOptions = comboboxAdditionalItems.map(\n      (opt) =>\n        new ComboboxOption(\"additional\", opt.value, opt.displayValue, opt.data),\n    );\n    if (itemType === \"trigger\") {\n      const triggerOptions = triggers.map(\n        (trigger) => new ComboboxOption(\"trigger\", trigger, trigger),\n      );\n      if (\n        !triggerQueryString ||\n        triggerOptions.every((o) => !o.value.startsWith(triggerQueryString))\n      ) {\n        return [...triggerOptions, ...additionalOptions];\n      }\n      return [\n        ...triggerOptions.filter((o) => o.value.startsWith(triggerQueryString)),\n        ...additionalOptions,\n      ];\n    }\n    return [\n      ...props.options.map(\n        (opt) =>\n          new ComboboxOption(\"value\", opt.value, opt.displayValue, opt.data),\n      ),\n      ...additionalOptions,\n    ];\n  }, [\n    comboboxAdditionalItems,\n    itemType,\n    props.options,\n    triggers,\n    triggerQueryString,\n  ]);\n  const [open, setOpen] = useState(props.comboboxOpen ?? false);\n  const anchor = useAnchorRef(open, comboboxAnchor, comboboxAnchorClassName);\n\n  const highlightOption = useCallback((index: number | null) => {\n    if (!IS_MOBILE) {\n      setSelectedIndex(index);\n    }\n  }, []);\n\n  const scrollIntoView = useCallback(\n    (index: number) => {\n      const option = options[index];\n      const el = option.ref?.current;\n      if (el) {\n        el.scrollIntoView({ block: \"nearest\" });\n      }\n    },\n    [options],\n  );\n\n  const handleArrowKeyDown = useCallback(\n    (event: KeyboardEvent, direction: \"up\" | \"down\") => {\n      if (!focused) {\n        return false;\n      }\n      let newIndex: number | null;\n      if (direction === \"up\") {\n        if (selectedIndex === null) {\n          newIndex = options.length - 1;\n        } else if (selectedIndex === 0) {\n          newIndex = null;\n        } else {\n          newIndex = selectedIndex - 1;\n        }\n      } else {\n        if (selectedIndex === null) {\n          newIndex = 0;\n        } else if (selectedIndex === options.length - 1) {\n          newIndex = null;\n        } else {\n          newIndex = selectedIndex + 1;\n        }\n      }\n      highlightOption(newIndex);\n      if (newIndex) {\n        scrollIntoView(newIndex);\n      }\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      return true;\n    },\n    [focused, selectedIndex, options.length, scrollIntoView, highlightOption],\n  );\n\n  const handleMouseEnter = useCallback(\n    (index: number) => {\n      highlightOption(index);\n      scrollIntoView(index);\n    },\n    [scrollIntoView, highlightOption],\n  );\n\n  const handleMouseLeave = useCallback(() => {\n    highlightOption(null);\n  }, [highlightOption]);\n\n  const handleSelectValue = useCallback(\n    (index: number) => {\n      const option = options[index];\n      onComboboxItemSelect?.(option.comboboxItem);\n      if (option.itemType === \"additional\") {\n        return;\n      }\n      editor.update(() => {\n        const textNode = valueMatch\n          ? $splitNodeContainingQuery(valueMatch)\n          : null;\n        onSelectOption(option.menuOption, textNode);\n      });\n      setValueMatch(null);\n      onQueryChange(null);\n      setTriggerQueryString(null);\n      highlightOption(null);\n    },\n    [\n      options,\n      editor,\n      onQueryChange,\n      highlightOption,\n      onComboboxItemSelect,\n      valueMatch,\n      onSelectOption,\n    ],\n  );\n\n  const handleSelectTrigger = useCallback(\n    (index: number) => {\n      const option = options[index];\n      onComboboxItemSelect?.(option.comboboxItem);\n      if (option.itemType === \"additional\") {\n        return;\n      }\n      editor.update(() => {\n        const nodeToReplace = triggerMatch\n          ? $splitNodeContainingQuery(triggerMatch)\n          : null;\n        if (nodeToReplace) {\n          const textNode = $createTextNode(option.value);\n          nodeToReplace.replace(textNode);\n          textNode.select();\n        } else {\n          $insertTriggerAtSelection(\n            triggers,\n            punctuation,\n            option.value,\n            autoSpace,\n          );\n        }\n      });\n      setTriggerMatch(null);\n      setTriggerQueryString(null);\n      highlightOption(0);\n    },\n    [\n      options,\n      editor,\n      highlightOption,\n      onComboboxItemSelect,\n      triggerMatch,\n      triggers,\n      punctuation,\n      autoSpace,\n    ],\n  );\n\n  const handleClick = useCallback(\n    (index: number) => {\n      if (itemType === \"trigger\") {\n        handleSelectTrigger(index);\n      }\n      if (itemType === \"value\") {\n        handleSelectValue(index);\n      }\n    },\n    [itemType, handleSelectTrigger, handleSelectValue],\n  );\n\n  const handleKeySelect = useCallback(\n    (event: KeyboardEvent) => {\n      if (!focused || selectedIndex === null) {\n        return false;\n      }\n      let handled = false;\n      if (itemType === \"trigger\") {\n        handled = true;\n        handleSelectTrigger(selectedIndex);\n      }\n      if (itemType === \"value\") {\n        handled = true;\n        handleSelectValue(selectedIndex);\n      }\n      if (handled) {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n      }\n      return handled;\n    },\n    [focused, handleSelectValue, handleSelectTrigger, itemType, selectedIndex],\n  );\n\n  const handleBackspace = useCallback(() => {\n    const text = getQueryTextForSearch(editor);\n    const newText = text ? text.substring(0, text.length - 1) : undefined;\n    if (!newText?.trim()) {\n      highlightOption(null);\n    }\n    return false;\n  }, [editor, highlightOption]);\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      setOpen(true);\n      if (!isCharacterKey(event)) {\n        return false;\n      }\n      const text = getQueryTextForSearch(editor);\n      const value = text === null ? event.key : text + event.key;\n      const valueTrimmed = value.trim();\n      if (\n        options.some(\n          (o) =>\n            o.displayValue.startsWith(valueTrimmed) &&\n            valueTrimmed.length <= o.displayValue.length,\n        )\n      ) {\n        highlightOption(0);\n      } else if (itemType === \"trigger\") {\n        highlightOption(null);\n      }\n      return false;\n    },\n    [editor, options, itemType, highlightOption],\n  );\n\n  const handleFocus = useCallback(() => {\n    setOpen(true);\n    return false;\n  }, []);\n\n  const handleClickOutside = useCallback(() => {\n    setOpen(false);\n    if (!triggerQueryString) {\n      setTriggerQueryString(null);\n      setTriggerMatch(null);\n      setValueMatch(null);\n    }\n    return false;\n  }, [triggerQueryString]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerCommand<KeyboardEvent>(\n        KEY_ARROW_DOWN_COMMAND,\n        (event) => {\n          return handleArrowKeyDown(event, \"down\");\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_ARROW_UP_COMMAND,\n        (event) => {\n          return handleArrowKeyDown(event, \"up\");\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_ENTER_COMMAND,\n        handleKeySelect,\n        COMMAND_PRIORITY_NORMAL,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_TAB_COMMAND,\n        handleKeySelect,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_BACKSPACE_COMMAND,\n        handleBackspace,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_DOWN_COMMAND,\n        handleKeyDown,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        FOCUS_COMMAND,\n        handleFocus,\n        COMMAND_PRIORITY_NORMAL,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        CLICK_COMMAND,\n        () => {\n          if (!open) {\n            setOpen(true);\n          }\n          return false;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_ESCAPE_COMMAND,\n        () => {\n          setOpen(false);\n          return false;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n    );\n  }, [\n    editor,\n    open,\n    handleArrowKeyDown,\n    handleKeySelect,\n    handleBackspace,\n    handleKeyDown,\n    handleFocus,\n  ]);\n\n  useEffect(() => {\n    const updateListener = () => {\n      editor.getEditorState().read(() => {\n        const text = getQueryTextForSearch(editor);\n        // reset if no text\n        if (text === null) {\n          onReset();\n          setTriggerMatch(null);\n          setValueMatch(null);\n          onQueryChange(null);\n          setTriggerQueryString(null);\n          return;\n        }\n        // check for triggers\n        const triggerMatch = checkForTriggers(text, triggers);\n        setTriggerMatch(triggerMatch);\n        if (triggerMatch) {\n          setTriggerQueryString(triggerMatch.matchingString);\n          setValueMatch(null);\n          return;\n        }\n        // check for mentions\n        const valueMatch = triggerFn(text, editor);\n        setValueMatch(valueMatch);\n        onQueryChange(valueMatch ? valueMatch.matchingString : null);\n        if (valueMatch?.matchingString) {\n          setTriggerQueryString(valueMatch.matchingString);\n          return;\n        }\n        setTriggerQueryString(null);\n      });\n    };\n    return editor.registerUpdateListener(updateListener);\n  }, [editor, triggerFn, onQueryChange, onReset, triggers]);\n\n  useEffect(() => {\n    setOpen(props.comboboxOpen ?? false);\n  }, [props.comboboxOpen]);\n\n  // call open/close callbacks when open state changes\n  useEffect(() => {\n    if (open) {\n      onComboboxOpen?.();\n    } else {\n      setSelectedIndex(null);\n      onComboboxClose?.();\n    }\n  }, [onComboboxOpen, onComboboxClose, open]);\n\n  // call focus change callback when selected index changes\n  useEffect(() => {\n    if (selectedIndex !== null && !!options[selectedIndex]) {\n      onComboboxFocusChange?.(options[selectedIndex].comboboxItem);\n    } else {\n      onComboboxFocusChange?.(null);\n    }\n  }, [selectedIndex, options, onComboboxFocusChange]);\n\n  // close combobox when clicking outside\n  useEffect(() => {\n    if (!CAN_USE_DOM) {\n      return;\n    }\n    const root = editor.getRootElement();\n    const handleMousedown = (event: MouseEvent) => {\n      if (\n        anchor &&\n        !anchor.contains(event.target as Node) &&\n        root &&\n        !root.contains(event.target as Node)\n      ) {\n        handleClickOutside();\n      }\n    };\n    document.addEventListener(\"mousedown\", handleMousedown);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleMousedown);\n    };\n  }, [anchor, editor, handleClickOutside]);\n\n  if (!open || !anchor) {\n    return null;\n  }\n\n  return ReactDOM.createPortal(\n    <ComboboxComponent\n      loading={loading}\n      itemType={itemType}\n      role=\"menu\"\n      aria-activedescendant={\n        selectedIndex !== null && !!options[selectedIndex]\n          ? options[selectedIndex].displayValue\n          : \"\"\n      }\n      aria-label={\"Choose trigger and value\"}\n      aria-hidden={!open}\n    >\n      {options.map((option, index) => (\n        <ComboboxItemComponent\n          key={option.key}\n          selected={index === selectedIndex}\n          role=\"menuitem\"\n          aria-selected={selectedIndex === index}\n          aria-label={`Choose ${option.value}`}\n          item={option.comboboxItem}\n          ref={option.setRefElement}\n          onClick={() => {\n            handleClick(index);\n          }}\n          onMouseEnter={() => {\n            handleMouseEnter(index);\n          }}\n          onMouseLeave={handleMouseLeave}\n          onMouseDown={(e) => {\n            e.preventDefault();\n          }}\n        >\n          {option.displayValue}\n        </ComboboxItemComponent>\n      ))}\n    </ComboboxComponent>,\n    anchor,\n  );\n}\n"]}