{"version":3,"file":"useMentionLookupService.spec.jsx","sourceRoot":"","sources":["useMentionLookupService.spec.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,OAAO,EAAE,MAAM,wBAAwB,CAAC;AAC7D,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,EAAE,EAAE,MAAM,QAAQ,CAAC;AAC9C,OAAO,EAAE,uBAAuB,EAAE,MAAM,2BAA2B,CAAC;AAEpE,MAAM,KAAK,GAAG;IACZ,GAAG,EAAE,CAAC,MAAM,CAAC;IACb,OAAO,EAAE,CAAC,OAAO,EAAE,UAAU,CAAC;CAC/B,CAAC;AAEF,MAAM,OAAO,GAAG,KAAK,EAAE,OAAe,EAAE,WAA2B,EAAE,EAAE;IACrE,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;IACzD,MAAM,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE;QACpD,OAAO,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACvC,CAAC,CAAC,CAAC;IACH,OAAO,QAAQ;QACb,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CACvB,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,UAAU,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CACxE;QACH,CAAC,CAAC,EAAE,CAAC;AACT,CAAC,CAAC;AAEF,QAAQ,CAAC,yBAAyB,EAAE,GAAG,EAAE;IACvC,EAAE,CAAC,uEAAuE,EAAE,KAAK,IAAI,EAAE;QACrF,MAAM,EAAE,MAAM,EAAE,GAAG,UAAU,CAAC,GAAG,EAAE,CACjC,uBAAuB,CAAC;YACtB,WAAW,EAAE,EAAE;YACf,OAAO,EAAE,MAAM;YACf,KAAK,EAAE,KAAK;SACb,CAAC,CACH,CAAC;QACF,MAAM,OAAO,CAAC,GAAG,EAAE;YACjB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,aAAa,CAAC,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC,CAAC;QACtE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,sEAAsE,EAAE,KAAK,IAAI,EAAE;QACpF,MAAM,EAAE,MAAM,EAAE,GAAG,UAAU,CAAC,GAAG,EAAE,CACjC,uBAAuB,CAAC;YACtB,WAAW,EAAE,IAAI;YACjB,OAAO,EAAE,MAAM;YACf,KAAK,EAAE,KAAK;SACb,CAAC,CACH,CAAC;QAEF,MAAM,OAAO,CAAC,GAAG,EAAE;YACjB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,aAAa,CAAC,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC,CAAC;QACtE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,4EAA4E,EAAE,KAAK,IAAI,EAAE;QAC1F,MAAM,EAAE,MAAM,EAAE,GAAG,UAAU,CAAC,GAAG,EAAE,CACjC,uBAAuB,CAAC;YACtB,WAAW,EAAE,MAAM;YACnB,OAAO,EAAE,MAAM;YACf,KAAK,EAAE,KAAK;SACb,CAAC,CACH,CAAC;QACF,MAAM,OAAO,CAAC,GAAG,EAAE;YACjB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,aAAa,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;QAC7D,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE;QAI1D,MAAM,OAAO,GAAY;YACvB,WAAW,EAAE,IAAI;YACjB,OAAO,EAAE,IAAI;YACb,QAAQ,EAAE,OAAO;YACjB,WAAW,EAAE,GAAG;SACjB,CAAC;QAEF,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,UAAU,CACrC,CAAC,GAAY,EAAE,EAAE,CAAC,uBAAuB,CAAC,GAAG,CAAC,EAC9C;YACE,YAAY,EAAE,OAAO;SACtB,CACF,CAAC;QAEF,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC3C,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,CAAC;QACxC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;QAEjD,QAAQ,iCAAM,OAAO,KAAE,OAAO,EAAE,MAAM,EAAE,WAAW,EAAE,OAAO,IAAG,CAAC;QAEhE,MAAM,OAAO,CACX,GAAG,EAAE;YACH,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5C,CAAC,EACD,EAAE,OAAO,EAAE,GAAG,EAAE,CACjB,CAAC;QAEF,MAAM,OAAO,CAAC,GAAG,EAAE;YACjB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;YACpD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,aAAa,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;YAC3D,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,iEAAiE,EAAE,KAAK,IAAI,EAAE;QAC/E,MAAM,EAAE,MAAM,EAAE,GAAG,UAAU,CAAC,GAAG,EAAE,CACjC,uBAAuB,CAAC;YACtB,WAAW,EAAE,GAAG;YAChB,OAAO,EAAE,GAAG;YACZ,KAAK,EAAE,KAAK;SACb,CAAC,CACH,CAAC;QAEF,MAAM,OAAO,CAAC,GAAG,EAAE;YACjB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,8BAA8B,EAAE,KAAK,IAAI,EAAE;QAC5C,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,UAAU,CACrC,CAAC,EAAE,WAAW,EAAE,OAAO,EAAE,EAAE,EAAE,CAC3B,uBAAuB,CAAC;YACtB,WAAW,EAAE,WAAW;YACxB,OAAO,EAAE,OAAO;YAChB,KAAK,EAAE,KAAK;SACb,CAAC,EACJ;YACE,YAAY,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE;SAClD,CACF,CAAC;QAEF,MAAM,OAAO,CAAC,GAAG,EAAE;YACjB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,aAAa,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;QACzD,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,EAAE,WAAW,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC;QAEjD,MAAM,OAAO,CAAC,GAAG,EAAE;YACjB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["import { renderHook, waitFor } from \"@testing-library/react\";\nimport { describe, expect, it } from \"vitest\";\nimport { useMentionLookupService } from \"./useMentionLookupService\";\n\nconst items = {\n  \"@\": [\"Jane\"],\n  \"\\\\w+:\": [\"today\", \"tomorrow\"],\n};\n\nconst queryFn = async (trigger: string, queryString?: string | null) => {\n  await new Promise((resolve) => setTimeout(resolve, 100));\n  const mentions = Object.entries(items).find(([key]) => {\n    return new RegExp(key).test(trigger);\n  });\n  return mentions\n    ? mentions[1].filter((m) =>\n        queryString ? m.toLowerCase().startsWith(queryString.toLowerCase()) : m,\n      )\n    : [];\n};\n\ndescribe(\"useMentionLookupService\", () => {\n  it(\"should return the full list of mentions when the search term is empty\", async () => {\n    const { result } = renderHook(() =>\n      useMentionLookupService({\n        queryString: \"\",\n        trigger: \"due:\",\n        items: items,\n      }),\n    );\n    await waitFor(() => {\n      expect(result.current.results).toStrictEqual([\"today\", \"tomorrow\"]);\n    });\n  });\n\n  it(\"should return the full list of mentions when the search term is null\", async () => {\n    const { result } = renderHook(() =>\n      useMentionLookupService({\n        queryString: null,\n        trigger: \"due:\",\n        items: items,\n      }),\n    );\n\n    await waitFor(() => {\n      expect(result.current.results).toStrictEqual([\"today\", \"tomorrow\"]);\n    });\n  });\n\n  it(\"should return a filtered mention list for predefined items and search term\", async () => {\n    const { result } = renderHook(() =>\n      useMentionLookupService({\n        queryString: \"tomo\",\n        trigger: \"due:\",\n        items: items,\n      }),\n    );\n    await waitFor(() => {\n      expect(result.current.results).toStrictEqual([\"tomorrow\"]);\n    });\n  });\n\n  it(\"should execute the mentions query function\", async () => {\n    type Params = Parameters<typeof useMentionLookupService>;\n    type Options = Params[0];\n\n    const options: Options = {\n      queryString: null,\n      trigger: null,\n      onSearch: queryFn,\n      searchDelay: 100,\n    };\n\n    const { result, rerender } = renderHook(\n      (opt: Options) => useMentionLookupService(opt),\n      {\n        initialProps: options,\n      },\n    );\n\n    expect(result.current.loading).toBe(false);\n    expect(result.current.query).toBeNull();\n    expect(result.current.results).toStrictEqual([]);\n\n    rerender({ ...options, trigger: \"due:\", queryString: \"tomor\" });\n\n    await waitFor(\n      () => {\n        expect(result.current.loading).toBe(true);\n      },\n      { timeout: 200 },\n    );\n\n    await waitFor(() => {\n      expect(result.current.query).toStrictEqual(\"tomor\");\n      expect(result.current.results).toStrictEqual([\"tomorrow\"]);\n      expect(result.current.loading).toBe(false);\n    });\n  });\n\n  it(\"should return an empty array when no matching trigger was found\", async () => {\n    const { result } = renderHook(() =>\n      useMentionLookupService({\n        queryString: \"j\",\n        trigger: \"#\",\n        items: items,\n      }),\n    );\n\n    await waitFor(() => {\n      expect(result.current.results).toStrictEqual([]);\n    });\n  });\n\n  it(\"should handle trigger change\", async () => {\n    const { result, rerender } = renderHook(\n      ({ queryString, trigger }) =>\n        useMentionLookupService({\n          queryString: queryString,\n          trigger: trigger,\n          items: items,\n        }),\n      {\n        initialProps: { queryString: \"ja\", trigger: \"@\" },\n      },\n    );\n\n    await waitFor(() => {\n      expect(result.current.results).toStrictEqual([\"Jane\"]);\n    });\n\n    rerender({ queryString: \"ja\", trigger: \"due:\" });\n\n    await waitFor(() => {\n      expect(result.current.results).toEqual([]);\n    });\n  });\n});\n"]}