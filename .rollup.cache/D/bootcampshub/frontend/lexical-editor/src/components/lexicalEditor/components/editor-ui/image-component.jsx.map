{"version":3,"file":"image-component.jsx","sourceRoot":"","sources":["image-component.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react'\nimport { Suspense, useCallback, useEffect, useRef, useState, JSX } from 'react'\n\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin'\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext'\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext'\nimport { LexicalErrorBoundary } from '@lexical/react/LexicalErrorBoundary'\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin'\nimport { LexicalNestedComposer } from '@lexical/react/LexicalNestedComposer'\nimport { RichTextPlugin } from '@lexical/react/LexicalRichTextPlugin'\nimport { useLexicalEditable } from '@lexical/react/useLexicalEditable'\nimport { useLexicalNodeSelection } from '@lexical/react/useLexicalNodeSelection'\nimport { mergeRegister } from '@lexical/utils'\nimport type {\n  BaseSelection,\n  LexicalCommand,\n  LexicalEditor,\n  NodeKey,\n} from 'lexical'\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isNodeSelection,\n  $isRangeSelection,\n  $setSelection,\n  CLICK_COMMAND,\n  COMMAND_PRIORITY_LOW,\n  DRAGSTART_COMMAND,\n  KEY_BACKSPACE_COMMAND,\n  KEY_DELETE_COMMAND,\n  KEY_ENTER_COMMAND,\n  KEY_ESCAPE_COMMAND,\n  ParagraphNode,\n  RootNode,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n  createCommand,\n} from 'lexical'\n\nimport { $isImageNode } from '../nodes/image-node'\n// import brokenImage from '@/registry/default/editor/images/image-broken.svg';\nimport { ContentEditable } from '../editor-ui/content-editable'\nimport { ImageResizer } from '../editor-ui/image-resizer'\n\nconst imageCache = new Set()\n\nexport const RIGHT_CLICK_IMAGE_COMMAND: LexicalCommand<MouseEvent> =\n  createCommand('RIGHT_CLICK_IMAGE_COMMAND')\n\nfunction useSuspenseImage(src: string) {\n  if (!imageCache.has(src)) {\n    throw new Promise((resolve) => {\n      const img = new Image()\n      img.src = src\n      img.onload = () => {\n        imageCache.add(src)\n        resolve(null)\n      }\n      img.onerror = () => {\n        imageCache.add(src)\n      }\n    })\n  }\n}\n\nfunction LazyImage({\n  altText,\n  className,\n  imageRef,\n  src,\n  width,\n  height,\n  maxWidth,\n  onError,\n}: {\n  altText: string\n  className: string | null\n  height: 'inherit' | number\n  imageRef: { current: null | HTMLImageElement }\n  maxWidth: number\n  src: string\n  width: 'inherit' | number\n  onError: () => void\n}): JSX.Element {\n  useSuspenseImage(src)\n  return (\n    <img\n      className={className || undefined}\n      src={src}\n      alt={altText}\n      ref={imageRef}\n      style={{\n        height,\n        maxWidth,\n        width,\n      }}\n      onError={onError}\n      draggable=\"false\"\n    />\n  )\n}\n\nfunction BrokenImage(): JSX.Element {\n  return (\n    <img\n      src={''}\n      style={{\n        height: 200,\n        opacity: 0.2,\n        width: 200,\n      }}\n      draggable=\"false\"\n    />\n  )\n}\n\nexport default function ImageComponent({\n  src,\n  altText,\n  nodeKey,\n  width,\n  height,\n  maxWidth,\n  resizable,\n  showCaption,\n  caption,\n  captionsEnabled,\n}: {\n  altText: string\n  caption: LexicalEditor\n  height: 'inherit' | number\n  maxWidth: number\n  nodeKey: NodeKey\n  resizable: boolean\n  showCaption: boolean\n  src: string\n  width: 'inherit' | number\n  captionsEnabled: boolean\n}): JSX.Element {\n  const imageRef = useRef<null | HTMLImageElement>(null)\n  const buttonRef = useRef<HTMLButtonElement | null>(null)\n  const [isSelected, setSelected, clearSelection] =\n    useLexicalNodeSelection(nodeKey)\n  const [isResizing, setIsResizing] = useState<boolean>(false)\n  const { isCollabActive } = useCollaborationContext()\n  const [editor] = useLexicalComposerContext()\n  const [selection, setSelection] = useState<BaseSelection | null>(null)\n  const activeEditorRef = useRef<LexicalEditor | null>(null)\n  const [isLoadError, setIsLoadError] = useState<boolean>(false)\n  const isEditable = useLexicalEditable()\n\n  const $onDelete = useCallback(\n    (payload: KeyboardEvent) => {\n      const deleteSelection = $getSelection()\n      if (isSelected && $isNodeSelection(deleteSelection)) {\n        const event: KeyboardEvent = payload\n        event.preventDefault()\n        editor.update(() => {\n          deleteSelection.getNodes().forEach((node) => {\n            if ($isImageNode(node)) {\n              node.remove()\n            }\n          })\n        })\n      }\n      return false\n    },\n    [editor, isSelected]\n  )\n\n  const $onEnter = useCallback(\n    (event: KeyboardEvent) => {\n      const latestSelection = $getSelection()\n      const buttonElem = buttonRef.current\n      if (\n        isSelected &&\n        $isNodeSelection(latestSelection) &&\n        latestSelection.getNodes().length === 1\n      ) {\n        if (showCaption) {\n          // Move focus into nested editor\n          $setSelection(null)\n          event.preventDefault()\n          caption.focus()\n          return true\n        } else if (\n          buttonElem !== null &&\n          buttonElem !== document.activeElement\n        ) {\n          event.preventDefault()\n          buttonElem.focus()\n          return true\n        }\n      }\n      return false\n    },\n    [caption, isSelected, showCaption]\n  )\n\n  const $onEscape = useCallback(\n    (event: KeyboardEvent) => {\n      if (\n        activeEditorRef.current === caption ||\n        buttonRef.current === event.target\n      ) {\n        $setSelection(null)\n        editor.update(() => {\n          setSelected(true)\n          const parentRootElement = editor.getRootElement()\n          if (parentRootElement !== null) {\n            parentRootElement.focus()\n          }\n        })\n        return true\n      }\n      return false\n    },\n    [caption, editor, setSelected]\n  )\n\n  const onClick = useCallback(\n    (payload: MouseEvent) => {\n      const event = payload\n\n      if (isResizing) {\n        return true\n      }\n      if (event.target === imageRef.current) {\n        if (event.shiftKey) {\n          setSelected(!isSelected)\n        } else {\n          clearSelection()\n          setSelected(true)\n        }\n        return true\n      }\n\n      return false\n    },\n    [isResizing, isSelected, setSelected, clearSelection]\n  )\n\n  const onRightClick = useCallback(\n    (event: MouseEvent): void => {\n      editor.getEditorState().read(() => {\n        const latestSelection = $getSelection()\n        const domElement = event.target as HTMLElement\n        if (\n          domElement.tagName === 'IMG' &&\n          $isRangeSelection(latestSelection) &&\n          latestSelection.getNodes().length === 1\n        ) {\n          editor.dispatchCommand(RIGHT_CLICK_IMAGE_COMMAND, event as MouseEvent)\n        }\n      })\n    },\n    [editor]\n  )\n\n  useEffect(() => {\n    let isMounted = true\n    const rootElement = editor.getRootElement()\n    const unregister = mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        if (isMounted) {\n          setSelection(editorState.read(() => $getSelection()))\n        }\n      }),\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        (_, activeEditor) => {\n          activeEditorRef.current = activeEditor\n          return false\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<MouseEvent>(\n        CLICK_COMMAND,\n        onClick,\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<MouseEvent>(\n        RIGHT_CLICK_IMAGE_COMMAND,\n        onClick,\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(\n        DRAGSTART_COMMAND,\n        (event) => {\n          if (event.target === imageRef.current) {\n            // TODO This is just a temporary workaround for FF to behave like other browsers.\n            // Ideally, this handles drag & drop too (and all browsers).\n            event.preventDefault()\n            return true\n          }\n          return false\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(\n        KEY_DELETE_COMMAND,\n        $onDelete,\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(\n        KEY_BACKSPACE_COMMAND,\n        $onDelete,\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(KEY_ENTER_COMMAND, $onEnter, COMMAND_PRIORITY_LOW),\n      editor.registerCommand(\n        KEY_ESCAPE_COMMAND,\n        $onEscape,\n        COMMAND_PRIORITY_LOW\n      )\n    )\n\n    rootElement?.addEventListener('contextmenu', onRightClick)\n\n    return () => {\n      isMounted = false\n      unregister()\n      rootElement?.removeEventListener('contextmenu', onRightClick)\n    }\n  }, [\n    clearSelection,\n    editor,\n    isResizing,\n    isSelected,\n    nodeKey,\n    $onDelete,\n    $onEnter,\n    $onEscape,\n    onClick,\n    onRightClick,\n    setSelected,\n  ])\n\n  const setShowCaption = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey)\n      if ($isImageNode(node)) {\n        node.setShowCaption(true)\n      }\n    })\n  }\n\n  const onResizeEnd = (\n    nextWidth: 'inherit' | number,\n    nextHeight: 'inherit' | number\n  ) => {\n    // Delay hiding the resize bars for click case\n    setTimeout(() => {\n      setIsResizing(false)\n    }, 200)\n\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey)\n      if ($isImageNode(node)) {\n        node.setWidthAndHeight(nextWidth, nextHeight)\n      }\n    })\n  }\n\n  const onResizeStart = () => {\n    setIsResizing(true)\n  }\n\n  const draggable = isSelected && $isNodeSelection(selection) && !isResizing\n  const isFocused = (isSelected || isResizing) && isEditable\n  return (\n    <Suspense fallback={null}>\n      <>\n        <div draggable={draggable}>\n          {isLoadError ? (\n            <BrokenImage />\n          ) : (\n            <LazyImage\n              className={`max-w-full cursor-default ${\n                isFocused\n                  ? `${$isNodeSelection(selection) ? 'draggable cursor-grab active:cursor-grabbing' : ''} focused ring-2 ring-primary ring-offset-2`\n                  : null\n              }`}\n              src={src}\n              altText={altText}\n              imageRef={imageRef}\n              width={width}\n              height={height}\n              maxWidth={maxWidth}\n              onError={() => setIsLoadError(true)}\n            />\n          )}\n        </div>\n\n        {showCaption && (\n          <div className=\"image-caption-container absolute bottom-1 left-0 right-0 m-0 block min-w-[100px] overflow-hidden border-t bg-white/90 p-0\">\n            <LexicalNestedComposer\n              initialEditor={caption}\n              initialNodes={[\n                RootNode,\n                TextNode,\n                ParagraphNode,\n              ]}\n            >\n              <AutoFocusPlugin />\n              <HistoryPlugin />\n              <RichTextPlugin\n                contentEditable={\n                  <ContentEditable\n                    className=\"ImageNode__contentEditable user-select-text word-break-break-word relative block min-h-5 w-[calc(100%-20px)] cursor-text resize-none whitespace-pre-wrap border-0 p-2.5 text-sm caret-primary outline-none\"\n                    placeholderClassName=\"ImageNode__placeholder text-sm text-muted-foreground overflow-hidden absolute top-2.5 left-2.5 pointer-events-none text-ellipsis user-select-none whitespace-nowrap inline-block\"\n                    placeholder=\"Enter a caption...\"\n                  />\n                }\n                ErrorBoundary={LexicalErrorBoundary}\n              />\n            </LexicalNestedComposer>\n          </div>\n        )}\n        {resizable && $isNodeSelection(selection) && isFocused && (\n          <ImageResizer\n            showCaption={showCaption}\n            setShowCaption={setShowCaption}\n            editor={editor}\n            buttonRef={buttonRef}\n            imageRef={imageRef}\n            maxWidth={maxWidth}\n            onResizeStart={onResizeStart}\n            onResizeEnd={onResizeEnd}\n            captionsEnabled={!isLoadError && captionsEnabled}\n          />\n        )}\n      </>\n    </Suspense>\n  )\n}\n"]}