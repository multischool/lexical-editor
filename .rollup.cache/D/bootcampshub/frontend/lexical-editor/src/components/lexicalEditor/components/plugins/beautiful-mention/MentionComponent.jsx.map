{"version":3,"file":"MentionComponent.jsx","sourceRoot":"","sources":["MentionComponent.tsx"],"names":[],"mappings":"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","sourcesContent":["import { useLexicalComposerContext } from \"@lexical/react/LexicalComposerContext\";\nimport { useLexicalNodeSelection } from \"@lexical/react/useLexicalNodeSelection\";\nimport { mergeRegister } from \"@lexical/utils\";\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isDecoratorNode,\n  $isElementNode,\n  $isNodeSelection,\n  $isTextNode,\n  $setSelection,\n  BLUR_COMMAND,\n  CLICK_COMMAND,\n  COMMAND_PRIORITY_LOW,\n  KEY_ARROW_LEFT_COMMAND,\n  KEY_ARROW_RIGHT_COMMAND,\n  KEY_BACKSPACE_COMMAND,\n  KEY_DELETE_COMMAND,\n  NodeKey,\n  SELECTION_CHANGE_COMMAND,\n} from \"lexical\";\nimport { ElementType, useCallback, useEffect, useMemo, useRef } from \"react\";\nimport {\n  BeautifulMentionsItemData,\n  BeautifulMentionComponentProps as CustomBeautifulMentionComponentProps,\n} from \"./BeautifulMentionsPluginProps\";\nimport { $isBeautifulMentionNode } from \"./MentionNode\";\nimport { IS_IOS } from \"./environment\";\nimport { getNextSibling, getPreviousSibling } from \"./mention-utils\";\nimport { BeautifulMentionsCssClassNames } from \"./theme\";\nimport { useIsFocused } from \"./useIsFocused\";\n\ninterface BeautifulMentionComponentProps {\n  nodeKey: NodeKey;\n  trigger: string;\n  value: string;\n  data?: Record<string, BeautifulMentionsItemData>;\n  component?: ElementType<CustomBeautifulMentionComponentProps> | null;\n  className?: string;\n  classNameFocused?: string;\n  classNames?: BeautifulMentionsCssClassNames;\n}\n\nexport default function BeautifulMentionComponent(\n  props: BeautifulMentionComponentProps,\n) {\n  const {\n    value,\n    trigger,\n    data,\n    className,\n    classNameFocused,\n    classNames,\n    nodeKey,\n    component: Component,\n  } = props;\n  const [editor] = useLexicalComposerContext();\n  const isEditorFocused = useIsFocused();\n  const [isSelected, setSelected, clearSelection] =\n    useLexicalNodeSelection(nodeKey);\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const ref = useRef<any>(null);\n  const mention = trigger + value;\n\n  const composedClassNames = useMemo(() => {\n    if (className) {\n      const classes = [className];\n      if (isSelected && isEditorFocused && classNameFocused) {\n        classes.push(classNameFocused);\n      }\n      return classes.join(\" \").trim() || undefined;\n    }\n    return \"\";\n  }, [isSelected, className, classNameFocused, isEditorFocused]);\n\n  const onDelete = useCallback(\n    (payload: KeyboardEvent) => {\n      if (isSelected && $isNodeSelection($getSelection())) {\n        payload.preventDefault();\n        const node = $getNodeByKey(nodeKey);\n        if ($isBeautifulMentionNode(node)) {\n          node.remove();\n        }\n      }\n      return false;\n    },\n    [isSelected, nodeKey],\n  );\n\n  const onArrowLeftPress = useCallback(\n    (event: KeyboardEvent) => {\n      const node = $getNodeByKey(nodeKey);\n      if (!node?.isSelected()) {\n        return false;\n      }\n      let handled = false;\n      const nodeToSelect = getPreviousSibling(node);\n      if ($isElementNode(nodeToSelect)) {\n        nodeToSelect.selectEnd();\n        handled = true;\n      }\n      if ($isTextNode(nodeToSelect)) {\n        nodeToSelect.select();\n        handled = true;\n      }\n      if ($isDecoratorNode(nodeToSelect)) {\n        nodeToSelect.selectNext();\n        handled = true;\n      }\n      if (nodeToSelect === null) {\n        node.selectPrevious();\n        handled = true;\n      }\n      if (handled) {\n        event.preventDefault();\n      }\n      return handled;\n    },\n    [nodeKey],\n  );\n\n  const onArrowRightPress = useCallback(\n    (event: KeyboardEvent) => {\n      const node = $getNodeByKey(nodeKey);\n      if (!node?.isSelected()) {\n        return false;\n      }\n      let handled = false;\n      const nodeToSelect = getNextSibling(node);\n      if ($isElementNode(nodeToSelect)) {\n        nodeToSelect.selectStart();\n        handled = true;\n      }\n      if ($isTextNode(nodeToSelect)) {\n        nodeToSelect.select(0, 0);\n        handled = true;\n      }\n      if ($isDecoratorNode(nodeToSelect)) {\n        nodeToSelect.selectPrevious();\n        handled = true;\n      }\n      if (nodeToSelect === null) {\n        node.selectNext();\n        handled = true;\n      }\n      if (handled) {\n        event.preventDefault();\n      }\n      return handled;\n    },\n    [nodeKey],\n  );\n\n  const onClick = useCallback(\n    (event: MouseEvent) => {\n      if (\n        event.target === ref.current ||\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-call\n        ref.current?.contains(event.target as Node)\n      ) {\n        if (!event.shiftKey) {\n          clearSelection();\n        }\n        setSelected(true);\n        return true;\n      }\n      return false;\n    },\n    [clearSelection, setSelected],\n  );\n\n  const onBlur = useCallback(() => {\n    const node = $getNodeByKey(nodeKey);\n    if (!node?.isSelected()) {\n      return false;\n    }\n\n    const selection = $getSelection();\n    if (!$isNodeSelection(selection)) {\n      return false;\n    }\n\n    $setSelection(null);\n    return false;\n  }, [nodeKey]);\n\n  const onSelectionChange = useCallback(() => {\n    if (IS_IOS && isSelected) {\n      // needed to keep the cursor in the editor when clicking next to a selected mention\n      setSelected(false);\n      return true;\n    }\n    return false;\n  }, [isSelected, setSelected]);\n\n  useEffect(() => {\n    const unregister = mergeRegister(\n      editor.registerCommand<MouseEvent>(\n        CLICK_COMMAND,\n        onClick,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_DELETE_COMMAND,\n        onDelete,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_BACKSPACE_COMMAND,\n        onDelete,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_ARROW_LEFT_COMMAND,\n        onArrowLeftPress,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_ARROW_RIGHT_COMMAND,\n        onArrowRightPress,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(BLUR_COMMAND, onBlur, COMMAND_PRIORITY_LOW),\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        onSelectionChange,\n        COMMAND_PRIORITY_LOW,\n      ),\n    );\n    return () => {\n      unregister();\n    };\n  }, [\n    editor,\n    onArrowLeftPress,\n    onArrowRightPress,\n    onClick,\n    onDelete,\n    onBlur,\n    onSelectionChange,\n  ]);\n\n  if (Component) {\n    return (\n      <Component\n        // @ts-ignore\n        ref={ref}\n        trigger={trigger}\n        value={value}\n        data={data}\n        className={composedClassNames}\n        data-beautiful-mention={mention}\n      >\n        {mention}\n      </Component>\n    );\n  }\n\n  if (classNames) {\n    return (\n      <span\n        ref={ref}\n        className={\n          isSelected && !!classNames.containerFocused\n            ? classNames.containerFocused\n            : classNames.container\n        }\n        data-beautiful-mention={mention}\n      >\n        <span className={classNames.trigger}>{trigger}</span>\n        <span className={classNames.value}>{value}</span>\n      </span>\n    );\n  }\n\n  return (\n    <span\n      ref={ref}\n      className={composedClassNames}\n      data-beautiful-mention={mention}\n    >\n      {mention}\n    </span>\n  );\n}\n"]}